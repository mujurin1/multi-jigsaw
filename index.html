<!doctype html>
<!-- Generated by akashic-cli-export-html@1.8.3. -->
<!-- Options: {"strip":true,"minify":true,"atsumaru":true} -->
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>game</title>
  <script>

    !function (t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define([], t) : ("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).engineFilesV3_5_0 = t() }(function () { return function r(o, n, s) { function a(e, t) { if (!n[e]) { if (!o[e]) { var i = "function" == typeof require && require; if (!t && i) return i(e, !0); if (h) return h(e, !0); throw (t = new Error("Cannot find module '" + e + "'")).code = "MODULE_NOT_FOUND", t } i = n[e] = { exports: {} }, o[e][0].call(i.exports, function (t) { return a(o[e][1][t] || t) }, i, i.exports, r, o, n, s) } return n[e].exports } for (var h = "function" == typeof require && require, t = 0; t < s.length; t++)a(s[t]); return a }({ 1: [function (t, e, i) { var r, o, e = e.exports = {}; function n() { throw new Error("setTimeout has not been defined") } function s() { throw new Error("clearTimeout has not been defined") } try { r = "function" == typeof setTimeout ? setTimeout : n } catch (t) { r = n } try { o = "function" == typeof clearTimeout ? clearTimeout : s } catch (t) { o = s } function a(e) { if (r === setTimeout) return setTimeout(e, 0); if ((r === n || !r) && setTimeout) return (r = setTimeout)(e, 0); try { return r(e, 0) } catch (t) { try { return r.call(null, e, 0) } catch (t) { return r.call(this, e, 0) } } } var h, c = [], u = !1, l = -1; function d() { u && h && (u = !1, h.length ? c = h.concat(c) : l = -1, c.length && p()) } function p() { if (!u) { for (var t = a(d), e = (u = !0, c.length); e;) { for (h = c, c = []; ++l < e;)h && h[l].run(); l = -1, e = c.length } h = null, u = !1, !function (e) { if (o === clearTimeout) return clearTimeout(e); if ((o === s || !o) && clearTimeout) return (o = clearTimeout)(e); try { o(e) } catch (t) { try { return o.call(null, e) } catch (t) { return o.call(this, e) } } }(t) } } function f(t, e) { this.fun = t, this.array = e } function _() { } e.nextTick = function (t) { var e = new Array(arguments.length - 1); if (1 < arguments.length) for (var i = 1; i < arguments.length; i++)e[i - 1] = arguments[i]; c.push(new f(t, e)), 1 !== c.length || u || a(p) }, f.prototype.run = function () { this.fun.apply(null, this.array) }, e.title = "browser", e.browser = !0, e.env = {}, e.argv = [], e.version = "", e.versions = {}, e.on = _, e.addListener = _, e.once = _, e.off = _, e.removeListener = _, e.removeAllListeners = _, e.emit = _, e.prependListener = _, e.prependOnceListener = _, e.listeners = function (t) { return [] }, e.binding = function (t) { throw new Error("process.binding is not supported") }, e.cwd = function () { return "/" }, e.chdir = function (t) { throw new Error("process.chdir is not supported") }, e.umask = function () { return 0 } }, {}], 2: [function (t, e, i) { e.exports = t("./lib/index") }, { "./lib/index": 84 }], 3: [function (t, e, i) { "use strict"; function r(t) { this._assetManager = t } Object.defineProperty(i, "__esModule", { value: !0 }), i.AssetAccessor = void 0, r.prototype.getImage = function (t) { return this._assetManager.peekLiveAssetByAccessorPath(t, "image") }, r.prototype.getAudio = function (t) { return this._assetManager.peekLiveAssetByAccessorPath(t, "audio") }, r.prototype.getScript = function (t) { return this._assetManager.peekLiveAssetByAccessorPath(t, "script") }, r.prototype.getText = function (t) { return this._assetManager.peekLiveAssetByAccessorPath(t, "text") }, r.prototype.getTextContent = function (t) { return this.getText(t).data }, r.prototype.getJSONContent = function (t) { return JSON.parse(this.getTextContent(t)) }, r.prototype.getVectorImage = function (t) { return this._assetManager.peekLiveAssetByAccessorPath(t, "vector-image") }, r.prototype.getAllImages = function (t) { return this._assetManager.peekAllLiveAssetsByPattern(null != t ? t : "**/*", "image") }, r.prototype.getAllAudios = function (t) { return this._assetManager.peekAllLiveAssetsByPattern(null != t ? t : "**/*", "audio") }, r.prototype.getAllScripts = function (t) { return this._assetManager.peekAllLiveAssetsByPattern(null != t ? t : "**/*", "script") }, r.prototype.getAllTexts = function (t) { return this._assetManager.peekAllLiveAssetsByPattern(null != t ? t : "**/*", "text") }, r.prototype.getAllVectorImages = function (t) { return this._assetManager.peekAllLiveAssetsByPattern(null != t ? t : "**/*", "vector-image") }, r.prototype.getImageById = function (t) { return this._assetManager.peekLiveAssetById(t, "image") }, r.prototype.getAudioById = function (t) { return this._assetManager.peekLiveAssetById(t, "audio") }, r.prototype.getScriptById = function (t) { return this._assetManager.peekLiveAssetById(t, "script") }, r.prototype.getTextById = function (t) { return this._assetManager.peekLiveAssetById(t, "text") }, r.prototype.getTextContentById = function (t) { return this.getTextById(t).data }, r.prototype.getJSONContentById = function (t) { return JSON.parse(this.getTextById(t).data) }, r.prototype.getVectorImageById = function (t) { return this._assetManager.peekLiveAssetById(t, "vector-image") }, i.AssetAccessor = r }, {}], 4: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 5: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.AssetHolder = void 0; var r = t("./ExceptionFactory"); function o(t) { var e = t.assetManager, i = t.assetIds ? t.assetIds.concat() : []; i.push.apply(i, e.resolvePatternsToAssetIds(t.assetPaths || [])), this.waitingAssetsCount = i.length, this.userData = t.userData, this._assetManager = e, this._assetIds = i, this._assets = [], this._handlerSet = t.handlerSet, this._requested = !1 } o.prototype.request = function () { return 0 !== this.waitingAssetsCount && (this._requested || (this._requested = !0, this._assetManager.requestAssets(this._assetIds, this)), !0) }, o.prototype.destroy = function () { this._requested && this._assetManager.unrefAssets(this._assets), this.waitingAssetsCount = 0, this.userData = void 0, this._handlerSet = void 0, this._assetIds = void 0, this._requested = !1 }, o.prototype.destroyed = function () { return !this._handlerSet }, o.prototype._onAssetError = function (t, e) { var i, r = this._handlerSet; this.destroyed() || r.owner.destroyed() || (r.handleLoadFailure.call(r.owner, i = { asset: t, error: e, cancelRetry: !1 }), e.retriable && !i.cancelRetry ? this._assetManager.retryLoad(t) : this._assetManager.configuration[t.id] && r.handleFinish.call(r.owner, this, !1)) }, o.prototype._onAssetLoad = function (t) { var e = this._handlerSet; if (!(this.destroyed() || e.owner.destroyed() || (e.handleLoad.call(e.owner, t), this._assets.push(t), --this.waitingAssetsCount, 0 < this.waitingAssetsCount))) { if (this.waitingAssetsCount < 0) throw r.ExceptionFactory.createAssertionError("AssetHolder#_onAssetLoad: broken waitingAssetsCount"); e.handleFinish.call(e.owner, this, !0) } }, i.AssetHolder = o }, { "./ExceptionFactory": 26 }], 6: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 7: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.AssetManager = void 0; var r = t("./auxiliary/EmptyGeneratedVectorImageAsset"), s = t("./auxiliary/EmptyVectorImageAsset"), a = t("./auxiliary/PartialImageAsset"), h = t("./ExceptionFactory"), c = t("./VideoSystem"), u = function (t, e) { this.asset = t, this.handlers = [e], this.errorCount = 0, this.loading = !1 }; function l(t) { var e = /([^\*\\\?]*)(\\\*|\\\?|\?|\*(?!\*)|\*\*\/|$)/g, i = { "": "", "\\*": "\\*", "\\?": "\\?", "*": "[^/]*", "?": "[^/]", "**/": "(?:^/)?(?:[^/]+/)*" }, r = /[\\^$.*+?()[\]{}|]/g; for (var o = "", n = e.exec(t); n && "" !== n[0]; n = e.exec(t))o += n[1].replace(r, "\\$&") + i[n[2]]; var s = new RegExp("^" + o + "$"); return function (t) { return s.test(t) } } function n(t, e, i, r) { this._resourceFactory = t.resourceFactory, this._audioSystemManager = t.audio, this._defaultAudioSystemId = t.defaultAudioSystemId, this._audioSystemConfMap = function (t) { void 0 === t && (t = {}); var e, i = { music: { loop: !0, hint: { streaming: !0 } }, sound: { loop: !1, hint: { streaming: !1 } } }; for (e in i) e in t || (t[e] = i[e]); return t }(i), this.configuration = this._normalize(e || {}), this._assets = {}, this._virtualPathToIdTable = {}, this._liveAssetVirtualPathTable = {}, this._liveAssetPathTable = {}, this._moduleMainScripts = r || {}, this._refCounts = {}, this._loadings = {}, this._generatedAssetCount = 0; for (var o = Object.keys(this.configuration), n = 0; n < o.length; ++n) { var s = o[n], a = this.configuration[s]; this._virtualPathToIdTable[a.virtualPath] = s } } n.prototype.destroy = function () { for (var t = Object.keys(this._refCounts), e = 0; e < t.length; ++e)this._releaseAsset(t[e]); this.configuration = void 0, this._assets = void 0, this._liveAssetVirtualPathTable = void 0, this._liveAssetPathTable = void 0, this._refCounts = void 0, this._loadings = void 0 }, n.prototype.destroyed = function () { return void 0 === this._assets }, n.prototype.retryLoad = function (t) { if (!this._loadings.hasOwnProperty(t.id)) throw h.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument."); var e = this._loadings[t.id]; if (e.errorCount > n.MAX_ERROR_COUNT) { if (this.configuration[t.id]) throw h.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.") } else e.loading || (e.loading = !0, t._load(this)) }, n.prototype.globalAssetIds = function () { var t, e = [], i = this.configuration; for (t in i) i.hasOwnProperty(t) && i[t].global && e.push(t); return e }, n.prototype.resolvePatternsToAssetIds = function (t) { if (0 === t.length) return []; for (var e = Object.keys(this._virtualPathToIdTable), i = [], r = 0; r < t.length; ++r)for (var o = t[r], n = "string" == typeof o ? l(this._replaceModulePathToAbsolute(o)) : o, s = 0; s < e.length; ++s) { var a = e[s]; n("/" + a) && i.push(this._virtualPathToIdTable[a]) } return i }, n.prototype.requestAsset = function (t, e) { "string" == typeof t ? i = t : "uri" in t ? (i = t.id, t = this._normalizeAssetBaseDeclaration(i, Object.create(t))) : i = t.id; var i, r, o, n, s = !1; return this._assets.hasOwnProperty(i) ? (++this._refCounts[i], e._onAssetLoad(this._assets[i])) : this._loadings.hasOwnProperty(i) ? ((n = this._loadings[i]).handlers.push(e), ++this._refCounts[i], s = !0) : (r = null == (o = this._getAudioSystem(t)) ? void 0 : o.getDestroyRequestedAsset(i), o && r ? (o.cancelRequestDestroy(r), this._addAssetToTables(r), this._refCounts[i] = 1, e._onAssetLoad(r)) : (o = this._createAssetFor(t), n = new u(o, e), this._loadings[i] = n, this._refCounts[i] = 1, n.loading = s = !0, o._load(this))), s }, n.prototype.unrefAsset = function (t) { t = "string" == typeof t ? t : t.id; 0 < --this._refCounts[t] || this._releaseAsset(t) }, n.prototype.requestAssets = function (t, e) { for (var i = 0, r = 0, o = t.length; r < o; ++r)this.requestAsset(t[r], e) && ++i; return i }, n.prototype.unrefAssets = function (t) { for (var e = 0, i = t.length; e < i; ++e)this.unrefAsset(t[e]) }, n.prototype.peekLiveAssetByAccessorPath = function (t, e) { if ("/" !== (t = this._replaceModulePathToAbsolute(t))[0]) throw h.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): accessorPath must start with '/'"); var i = t.slice(1), i = this._liveAssetVirtualPathTable[i]; if (i && e === i.type) return i; throw h.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): No ".concat(e, " asset for ").concat(t)) }, n.prototype.peekLiveAssetById = function (t, e) { var i = this._assets[t]; if (i && e === i.type) return i; throw h.ExceptionFactory.createAssertionError("SceneAssetManager#_getById(): No ".concat(e, " asset for id ").concat(t)) }, n.prototype.peekAllLiveAssetsByPattern = function (t, e) { for (var i = Object.keys(this._liveAssetVirtualPathTable), r = "string" == typeof t ? l(this._replaceModulePathToAbsolute(t)) : t, o = [], n = 0; n < i.length; ++n) { var s = i[n], a = this._liveAssetVirtualPathTable[s]; e && a.type !== e || r("/" + s) && o.push(a) } return o }, n.prototype._normalize = function (t) { var e, i = {}; if (!(t instanceof Object)) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments."); for (e in t) if (t.hasOwnProperty(e)) { var r = this._normalizeAssetBaseDeclaration(e, Object.create(t[e])); if (!r.path) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: " + e); if (!r.virtualPath) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: " + e); r.global || (r.global = !1), i[e] = r } return i }, n.prototype._normalizeAssetBaseDeclaration = function (t, e) { if (!e.type) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: " + t); if ("image" === e.type) { if ("number" != typeof e.width) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: " + t); if ("number" != typeof e.height) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: " + t); e.slice = e.slice ? (i = e.slice, Array.isArray(i) ? { x: i[0], y: i[1], width: i[2], height: i[3] } : i) : void 0 } if ("audio" === e.type) { void 0 === e.duration && (e.duration = 0); var i = this._audioSystemConfMap[e.systemId]; if (void 0 === e.loop && (e.loop = !!i && !!i.loop), void 0 === e.hint && (e.hint = i ? i.hint : {}), "music" !== e.systemId && "sound" !== e.systemId) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong systemId given for the audio asset: " + t) } if ("video" === e.type && !e.useRealSize) { if ("number" != typeof e.width) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: " + t); if ("number" != typeof e.height) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: " + t); e.useRealSize = !1 } if ("vector-image" === e.type) { if ("number" != typeof e.width) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the vector-image asset: " + t); if ("number" != typeof e.height) throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the vector-image asset: " + t) } return e }, n.prototype._createAssetFor = function (t) { var e, i, r; if ("string" == typeof t) r = this.configuration[e = t], i = this.configuration[e].path; else { if (!("uri" in t)) return this._createGeneratedAssetFor(t); e = t.id, i = (r = t).uri } var o = this._resourceFactory; if (!r) throw h.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: " + e); switch (r.type) { case "image": var n = r.slice ? new a.PartialImageAsset(o, e, i, r.width, r.height, r.slice) : o.createImageAsset(e, i, r.width, r.height); return n.initialize(r.hint), n; case "audio": n = r.systemId ? this._audioSystemManager[r.systemId] : this._audioSystemManager[this._defaultAudioSystemId]; return o.createAudioAsset(e, i, r.duration, n, !!r.loop, r.hint); case "text": return o.createTextAsset(e, i); case "script": return o.createScriptAsset(e, i); case "video": n = new c.VideoSystem; return o.createVideoAsset(e, i, r.width, r.height, n, !!r.loop, !!r.useRealSize); case "vector-image": return o.createVectorImageAsset ? o.createVectorImageAsset(e, i, r.width, r.height, r.hint) : new s.EmptyVectorImageAsset(e, i, r.width, r.height, r.hint); default: throw h.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type " + r.type + " for asset ID: " + e) } }, n.prototype._createGeneratedAssetFor = function (t) { var e = this._resourceFactory, i = "%akashic%/generated-asset-".concat(this._generatedAssetCount++); if ("vector-image" !== t.type) throw h.ExceptionFactory.createAssertionError("AssertionError#_createFromAssetGenerationFor: unsupported asset type ".concat(t.type, " for asset ID: ").concat(t.id)); return e.createVectorImageAssetFromString ? e.createVectorImageAssetFromString(t.id, i, t.data) : new r.EmptyGeneratedVectorImageAsset(t.id, i, t.data) }, n.prototype._releaseAsset = function (t) { var e = this._assets[t] || this._loadings[t] && this._loadings[t].asset, i = null; if (e) if (i = e.path, e.inUse()) if ("audio" === e.type) e._system.requestDestroy(e); else { if ("video" !== e.type) throw h.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use " + e.id); e.destroy() } else e.destroy(); delete this._refCounts[t], delete this._loadings[t], delete this._assets[t], this.configuration[t] && ((e = this.configuration[t].virtualPath) && this._liveAssetVirtualPathTable.hasOwnProperty(e) && delete this._liveAssetVirtualPathTable[e], i && this._liveAssetPathTable.hasOwnProperty(i) && delete this._liveAssetPathTable[i]) }, n.prototype._countLoadingAsset = function () { return Object.keys(this._loadings).length }, n.prototype._onAssetError = function (t, e) { if (!this.destroyed() && !t.destroyed()) { var i = this._loadings[t.id], r = i.handlers; i.loading = !1, ++i.errorCount, (e = i.errorCount > n.MAX_ERROR_COUNT && e.retriable ? h.ExceptionFactory.createAssetLoadError("Retry limit exceeded", !1, null, e) : e).retriable || delete this._loadings[t.id]; for (var o = 0; o < r.length; ++o)r[o]._onAssetError(t, e, this.retryLoad.bind(this)) } }, n.prototype._onAssetLoad = function (t) { if (!this.destroyed() && !t.destroyed()) for (var e = this._loadings[t.id], i = (e.loading = !1, delete this._loadings[t.id], this._addAssetToTables(t), e.handlers), r = 0; r < i.length; ++r)i[r]._onAssetLoad(t) }, n.prototype._replaceModulePathToAbsolute = function (t) { if ("/" !== t[0] && "*" !== t[0]) for (var e in this._moduleMainScripts) if (this._moduleMainScripts.hasOwnProperty(e) && 0 === t.lastIndexOf(e, 0)) return "/node_modules/" + t; return t }, n.prototype._getAudioSystem = function (t) { var e = null; return "string" == typeof t ? e = this.configuration[t] : "uri" in t && (e = t), !e || "audio" !== e.type ? null : e.systemId ? this._audioSystemManager[e.systemId] : this._audioSystemManager[this._defaultAudioSystemId] }, n.prototype._addAssetToTables = function (t) { if (this._assets[t.id] = t, this.configuration[t.id]) { var e = this.configuration[t.id].virtualPath; if (this._liveAssetVirtualPathTable.hasOwnProperty(e)) { if (this._liveAssetVirtualPathTable[e].path !== t.path) throw h.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path") } else this._liveAssetVirtualPathTable[e] = t; this._liveAssetPathTable.hasOwnProperty(t.path) || (this._liveAssetPathTable[t.path] = e) } }, n.MAX_ERROR_COUNT = 3, i.AssetManager = n }, { "./ExceptionFactory": 26, "./VideoSystem": 68, "./auxiliary/EmptyGeneratedVectorImageAsset": 72, "./auxiliary/EmptyVectorImageAsset": 73, "./auxiliary/PartialImageAsset": 74 }], 8: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 9: [function (t, e, i) { "use strict"; var r, o = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), n = (Object.defineProperty(i, "__esModule", { value: !0 }), i.SoundAudioSystem = i.MusicAudioSystem = i.AudioSystem = void 0, t("./ExceptionFactory")), t = (Object.defineProperty(s.prototype, "volume", { get: function () { return this._volume }, set: function (t) { if (t < 0 || 1 < t || isNaN(t) || "number" != typeof t) throw n.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: " + t); this._volume = t, this._onVolumeChanged() }, enumerable: !1, configurable: !0 }), s.prototype.requestDestroy = function (t) { this._destroyRequestedAssets[t.id] = t }, s.prototype.cancelRequestDestroy = function (t) { delete this._destroyRequestedAssets[t.id] }, s.prototype.getDestroyRequestedAsset = function (t) { return this._destroyRequestedAssets.hasOwnProperty(t) ? this._destroyRequestedAssets[t] : null }, s.prototype._reset = function () { this.stopAll(), this._volume = 1, this._destroyRequestedAssets = {}, this._muted = !1, this._suppressed = !1, this._explicitMuted = !1 }, s.prototype._setMuted = function (t) { var e = this._explicitMuted; this._explicitMuted = !!t, this._explicitMuted !== e && (this._updateMuted(), this._onMutedChanged()) }, s.prototype._setPlaybackRate = function (t) { if (t < 0 || isNaN(t) || "number" != typeof t) throw n.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: " + t); this._suppressed = 1 !== t, this._updateMuted(), this._onPlaybackRateChanged() }, s.prototype._updateMuted = function () { this._muted = this._explicitMuted || this._suppressed }, s); function s(t) { this.id = t.id, this._volume = t.volume || 1, this._destroyRequestedAssets = {}, this._explicitMuted = t.muted || !1, this._suppressed = !1, this._muted = !1, this._resourceFactory = t.resourceFactory, this._updateMuted() } i.AudioSystem = t; o(c, a = t), Object.defineProperty(c.prototype, "player", { get: function () { return this._player || (this._player = this._resourceFactory.createAudioPlayer(this), this._player.onPlay.add(this._handlePlay, this), this._player.onStop.add(this._handleStop, this)), this._player }, set: function (t) { this._player = t }, enumerable: !1, configurable: !0 }), c.prototype.findPlayers = function (t) { return this.player.currentAudio && this.player.currentAudio.id === t.id ? [this.player] : [] }, c.prototype.createPlayer = function () { return this.player }, c.prototype.stopAll = function () { this._player && this._player.stop() }, c.prototype._reset = function () { a.prototype._reset.call(this), this._player && (this._player.onPlay.remove(this._handlePlay, this), this._player.onStop.remove(this._handleStop, this)), this._player = void 0 }, c.prototype._onVolumeChanged = function () { this.player._notifyVolumeChanged() }, c.prototype._onMutedChanged = function () { this.player._changeMuted(this._muted) }, c.prototype._onPlaybackRateChanged = function () { this.player._changeMuted(this._muted) }, c.prototype._handlePlay = function (t) { if (t.player !== this._player) throw n.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player") }, c.prototype._handleStop = function (t) { this._destroyRequestedAssets[t.audio.id] && (delete this._destroyRequestedAssets[t.audio.id], t.audio.destroy()) }; var a, h = c; function c(t) { t = a.call(this, t) || this; return t._player = void 0, t } i.MusicAudioSystem = h; o(l, u = t), l.prototype.createPlayer = function () { var t = this._resourceFactory.createAudioPlayer(this); return t.canHandleStopped() && this.players.push(t), t.onPlay.add(this._handlePlay, this), t.onStop.add(this._handleStop, this), t }, l.prototype.findPlayers = function (t) { for (var e = [], i = 0; i < this.players.length; ++i) { var r = this.players[i].currentAudio; r && r.id === t.id && e.push(this.players[i]) } return e }, l.prototype.stopAll = function () { for (var t = this.players.concat(), e = 0; e < t.length; ++e)t[e].stop() }, l.prototype._reset = function () { u.prototype._reset.call(this); for (var t = 0; t < this.players.length; ++t) { var e = this.players[t]; e.onPlay.remove(this._handlePlay, this), e.onStop.remove(this._handleStop, this) } this.players = [] }, l.prototype._onMutedChanged = function () { for (var t = this.players, e = 0; e < t.length; ++e)t[e]._changeMuted(this._muted) }, l.prototype._onPlaybackRateChanged = function () { var t = this.players; if (this._suppressed) for (var e = 0; e < t.length; ++e)t[e]._changeMuted(!0) }, l.prototype._handlePlay = function (t) { }, l.prototype._handleStop = function (t) { var e = this.players.indexOf(t.player); e < 0 || (t.player.onStop.remove(this._handleStop, this), this.players.splice(e, 1), this._destroyRequestedAssets[t.audio.id] && (delete this._destroyRequestedAssets[t.audio.id], t.audio.destroy())) }, l.prototype._onVolumeChanged = function () { for (var t = 0; t < this.players.length; ++t)this.players[t]._notifyVolumeChanged() }; var u, h = l; function l(t) { t = u.call(this, t) || this; return t.players = [], t } i.SoundAudioSystem = h }, { "./ExceptionFactory": 26 }], 10: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.AudioSystemManager = void 0; var r = t("./AudioSystem"); function o(t) { this._muted = !1, this._initializeAudioSystems(t) } o.prototype._reset = function () { this._muted = !1, this.music._reset(), this.sound._reset() }, o.prototype._setMuted = function (t) { this._muted !== t && (this._muted = t, this.music._setMuted(t), this.sound._setMuted(t)) }, o.prototype._setPlaybackRate = function (t) { this.music._setPlaybackRate(t), this.sound._setPlaybackRate(t) }, o.prototype._initializeAudioSystems = function (t) { this.music = new r.MusicAudioSystem({ id: "music", muted: this._muted, resourceFactory: t }), this.sound = new r.SoundAudioSystem({ id: "sound", muted: this._muted, resourceFactory: t }) }, o.prototype.stopAll = function () { this.music.stopAll(), this.sound.stopAll() }, i.AudioSystemManager = o }, { "./AudioSystem": 9 }], 11: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.BitmapFont = void 0, t("./Font")), a = t("./SurfaceUtil"), t = (o = s.Font, n(h, o), h.prototype.glyphForCharacter = function (t) { var e, i, r, o, n, s, a = this.map[t] || this.missingGlyph; return a ? (e = void 0 === a.width ? this.defaultGlyphWidth : a.width, i = void 0 === a.height ? this.defaultGlyphHeight : a.height, r = a.offsetX || 0, o = a.offsetY || 0, n = void 0 === a.advanceWidth ? e : a.advanceWidth, s = 0 === e || 0 === i ? void 0 : this.surface, { code: t, x: a.x, y: a.y, width: e, height: i, surface: s, offsetX: r, offsetY: o, advanceWidth: n, isSurfaceValid: !0, _atlas: null }) : null }, h.prototype.destroy = function () { this.surface && !this.surface.destroyed() && this.surface.destroy(), this.map = void 0 }, h.prototype.destroyed = function () { return !this.map }, h); function h(t) { var e = o.call(this) || this; return e.surface = a.SurfaceUtil.asSurface(t.src), t.glyphInfo ? (e.map = t.glyphInfo.map, e.defaultGlyphWidth = t.glyphInfo.width, e.defaultGlyphHeight = t.glyphInfo.height, e.missingGlyph = t.glyphInfo.missingGlyph, e.size = t.glyphInfo.height) : (e.map = t.map || {}, e.defaultGlyphWidth = t.defaultGlyphWidth || 0, e.defaultGlyphHeight = t.defaultGlyphHeight || 0, e.missingGlyph = t.missingGlyph, e.size = t.defaultGlyphHeight || 0), e } i.BitmapFont = t }, { "./Font": 27, "./SurfaceUtil": 60 }], 12: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 13: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.Camera2D = void 0, t("./Object2D")), t = (o = t.Object2D, n(s, o), s.deserialize = function (t) { return new s(t.param) }, s.prototype.modified = function () { this._modifiedCount = (this._modifiedCount + 1) % 32768, this._matrix && (this._matrix._modified = !0) }, s.prototype.serialize = function () { return { param: { local: this.local, name: this.name, x: this.x, y: this.y, width: this.width, height: this.height, opacity: this.opacity, scaleX: this.scaleX, scaleY: this.scaleY, angle: this.angle, anchorX: this.anchorX, anchorY: this.anchorY, compositeOperation: this.compositeOperation } } }, s.prototype._applyTransformToRenderer = function (t) { this.angle || 1 !== this.scaleX || 1 !== this.scaleY || 0 !== this.anchorX || 0 !== this.anchorY ? t.transform(this.getMatrix()._matrix) : t.translate(-this.x, -this.y), 1 !== this.opacity && t.opacity(this.opacity) }, s.prototype._updateMatrix = function () { this._matrix && (this.angle || 1 !== this.scaleX || 1 !== this.scaleY || 0 !== this.anchorX || 0 !== this.anchorY ? this._matrix.updateByInverse(this.width, this.height, this.scaleX, this.scaleY, this.angle, this.x, this.y, this.anchorX, this.anchorY) : this._matrix.reset(-this.x, -this.y)) }, s); function s(t) { var e = o.call(this, t) || this; return e.local = !!t.local, e.name = t.name, e._modifiedCount = 0, e } i.Camera2D = t }, { "./Object2D": 38 }], 14: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Collision = void 0; var d, n = t("./Util"); function p(t, e) { return t.x * e.y - t.y * e.x } function f(t, e) { return { x: t.x - e.x, y: t.y - e.y } } (d = i.Collision || (i.Collision = {})).intersectEntities = function (t, e, i, r) { var o, n, s, a, h, c, u, l = t._findLowestCommonAncestorWith(e); return !!l && (i = i ? { left: i.x, top: i.y, right: i.x + i.width, bottom: i.y + i.height } : { left: 0, top: 0, right: t.width, bottom: t.height }, r = r ? { left: r.x, top: r.y, right: r.x + r.width, bottom: r.y + r.height } : { left: 0, top: 0, right: e.width, bottom: e.height }, t = t._calculateMatrixTo(l), e = e._calculateMatrixTo(l), l = t.multiplyPoint({ x: i.left, y: i.top }), o = t.multiplyPoint({ x: i.right, y: i.top }), n = t.multiplyPoint({ x: i.left, y: i.bottom }), t = t.multiplyPoint({ x: i.right, y: i.bottom }), i = e.multiplyPoint({ x: r.left, y: r.top }), s = e.multiplyPoint({ x: r.right, y: r.top }), a = e.multiplyPoint({ x: r.left, y: r.bottom }), e = e.multiplyPoint({ x: r.right, y: r.bottom }), r = Math.min(l.x, o.x, n.x, t.x), h = Math.max(l.x, o.x, n.x, t.x), c = Math.min(i.x, s.x, a.x, e.x), u = Math.max(i.x, s.x, a.x, e.x), !(h < c || u < r) && (h = Math.min(l.y, o.y, n.y, t.y), c = Math.max(l.y, o.y, n.y, t.y), u = Math.min(i.y, s.y, a.y, e.y), r = Math.max(i.y, s.y, a.y, e.y), !(c < u || r < h) && (!!(d.intersectLineSegments(l, o, i, s) || d.intersectLineSegments(l, o, s, e) || d.intersectLineSegments(l, o, e, a) || d.intersectLineSegments(l, o, a, i) || d.intersectLineSegments(o, t, i, s) || d.intersectLineSegments(o, t, s, e) || d.intersectLineSegments(o, t, e, a) || d.intersectLineSegments(o, t, a, i) || d.intersectLineSegments(t, n, i, s) || d.intersectLineSegments(t, n, s, e) || d.intersectLineSegments(t, n, e, a) || d.intersectLineSegments(t, n, a, i) || d.intersectLineSegments(n, l, i, s) || d.intersectLineSegments(n, l, s, e) || d.intersectLineSegments(n, l, e, a) || d.intersectLineSegments(n, l, a, i)) || (0 <= (c = p(f(l, o), f(i, o))) * p(f(n, l), f(i, l)) && 0 <= c * p(f(t, n), f(i, n)) && 0 <= c * p(f(o, t), f(i, t)) || 0 <= (u = p(f(i, s), f(l, s))) * p(f(a, i), f(l, i)) && 0 <= u * p(f(e, a), f(l, a)) && 0 <= u * p(f(s, e), f(l, e)))))) }, d.intersectLineSegments = function (t, e, i, r) { var o = f(e, t), n = f(r, i); return p(f(i, t), o) * p(f(r, t), o) <= 0 && p(f(t, i), n) * p(f(e, i), n) <= 0 }, d.intersect = function (t, e, i, r, o, n, s, a) { return t <= o + s && o <= t + i && e <= n + a && n <= e + r }, d.intersectAreas = function (t, e) { return d.intersect(t.x, t.y, t.width, t.height, e.x, e.y, e.width, e.height) }, d.within = function (t, e, i, r, o) { return (o = void 0 === o ? 1 : o) >= n.Util.distance(t, e, i, r) }, d.withinAreas = function (t, e, i) { return (i = void 0 === i ? 1 : i) >= n.Util.distanceBetweenAreas(t, e) } }, { "./Util": 67 }], 15: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.DefaultLoadingScene = void 0, t("./entities/CameraCancellingE")), a = t("./entities/FilledRect"), t = t("./LoadingScene"), t = (o = t.LoadingScene, n(h, o), h.prototype._handleLoad = function () { var t, e, i; return i = "compact" === this._style ? (e = .05 * Math.min(this.game.width, this.game.height), t = this.game.width - e - this._barWidth, e = this.game.height - e - this._barHeight, "transparent") : (t = (this.game.width - this._barWidth) / 2, e = (this.game.height - this._barHeight) / 2, "rgba(0, 0, 0, 0.8)"), this.append(new s.CameraCancellingE({ scene: this, children: [new a.FilledRect({ scene: this, width: this.game.width, height: this.game.height, cssColor: i, children: [new a.FilledRect({ scene: this, x: t, y: e, width: this._barWidth, height: this._barHeight, cssColor: "gray", children: [i = new a.FilledRect({ scene: this, width: 0, height: this._barHeight, cssColor: "white" })] })] })] })), i.onUpdate.add(this._handleUpdate, this), this._gauge = i, !0 }, h.prototype._handleUpdate = function () { ++this._gaugeUpdateCount; var t = Math.round(205 + 50 * Math.sin(this._gaugeUpdateCount / this.game.fps * (2 / 3) * (2 * Math.PI))); this._gauge.cssColor = "rgb(" + t + "," + t + "," + t + ")", this._gauge.modified() }, h.prototype._handleTargetReset = function (t) { this._gauge && (this._gauge.width = 0, this._gauge.modified()), this._totalWaitingAssetCount = t._sceneAssetHolder.waitingAssetsCount }, h.prototype._handleTargetAssetLoad = function (t) { var e = this._targetScene._sceneAssetHolder.waitingAssetsCount; this._gauge.width = Math.ceil((1 - e / this._totalWaitingAssetCount) * this._barWidth), this._gauge.modified() }, h); function h(t) { var e = o.call(this, { game: t.game, name: "akashic:default-loading-scene" }) || this; return "compact" === t.style ? (e._barWidth = e.game.width / 4, e._barHeight = 5, e._style = "compact") : (e._barWidth = Math.min(e.game.width, Math.max(100, e.game.width / 2)), e._barHeight = 5, e._style = "default"), e._gauge = void 0, e._gaugeUpdateCount = 0, e._totalWaitingAssetCount = 0, e.onLoad.add(e._handleLoad, e), e.onTargetReset.add(e._handleTargetReset, e), e.onTargetAssetLoad.add(e._handleTargetAssetLoad, e), e } i.DefaultLoadingScene = t }, { "./LoadingScene": 32, "./entities/CameraCancellingE": 76, "./entities/FilledRect": 78 }], 16: [function (t, e, i) { "use strict"; var r, o = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), l = (Object.defineProperty(i, "__esModule", { value: !0 }), i.DefaultSkippingScene = void 0, t("./entities/CameraCancellingE")), n = t("./entities/FilledRect"), t = t("./Scene"); function d(t, e, i, r) { var o, n, r = .15 * r; return 0 < t && t < r ? (t = t, o = e, n = i, (t /= r / 2) < 1 ? n / 2 * t * t + o : -n / 2 * (--t * (t - 2) - 1) + o) : e + i } s = n.FilledRect, o(a, s), a.prototype._incrementAge = function () { this.age++ }, a.prototype._updateColor = function () { var t = this._calculateCSSColor(); this.cssColor !== t && (this.cssColor = t, this.modified()) }, a.prototype._calculateCSSColor = function () { var t = this, e = t.age, i = t.offsetDurationFrame, r = t.easingDurationFrame, o = t.valueFrom, n = t.valueTo, t = (0, t.easing)(Math.max(e - i, 0) % r, o, n - o, r); return "rgb(".concat(t, ", ").concat(t, ", ").concat(t, ")") }; var s, p = a; function a(t) { var e = s.call(this, t) || this; return e.age = 0, e.offsetDurationFrame = t.offsetDurationFrame, e.easingDurationFrame = t.easingDurationFrame, e.valueFrom = t.valueFrom, e.valueTo = t.valueTo, e.easing = t.easing, e.onUpdate.add(e._incrementAge, e), e.onUpdate.add(e._updateColor, e), e } h = t.Scene, o(c, h), c.prototype._handleLoadForIndicator = function () { var i = this, r = this.game, o = .03 * Math.min(r.width, r.height) | 0, n = .03 * Math.min(r.width, r.height) | 0, s = .05 * Math.min(r.width, r.height) | 0, a = .05 * Math.min(r.width, r.height) | 0, h = 400 / (1e3 / r.fps), c = 2500 / (1e3 / r.fps), u = d; this.append(new l.CameraCancellingE({ scene: this, children: [3, 2, 1, 0].map(function (t, e) { return new p({ scene: i, cssColor: "rgb(".concat(255, ", ").concat(255, ", ").concat(255, ")"), width: o, height: o, x: r.width - e * (o + n) - s, y: r.height - a, anchorX: 1, anchorY: 1, offsetDurationFrame: h * t, easingDurationFrame: c, valueFrom: 205, valueTo: 255, easing: u }) }) })) }; var h, n = c; function c(t) { var e = h.call(this, { game: t.game, local: "full-local", name: "akashic:default-skipping-scene" }) || this; return "indicator" === t.style && e.onLoad.addOnce(e._handleLoadForIndicator, e), e } i.DefaultSkippingScene = n }, { "./Scene": 50, "./entities/CameraCancellingE": 76, "./entities/FilledRect": 78 }], 17: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 18: [function (t, e, i) { "use strict"; var r, l, o = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), d = (Object.defineProperty(i, "__esModule", { value: !0 }), i.DynamicFont = void 0, t("@akashic/pdi-types")), a = t("./BitmapFont"), n = t("./Font"), p = t("./SurfaceAtlasSet"), f = t("./Util"), t = (l = n.Font, o(s, l), s.prototype.glyphForCharacter = function (t) { var e = this._glyphs[t]; if (!e || !e.isSurfaceValid) { if ((e = this._glyphFactory.create(t)).surface && !this._atlasSet.addGlyph(e)) return null; this._glyphs[t] = e } return this._atlasSet.touchGlyph(e), e }, s.prototype.asBitmapFont = function (t) { var i, e, r, o, n, s = this; return 1 !== this._atlasSet.getAtlasNum() ? null : (e = null, t && (e = f.Util.charCodeAt(t, 0), this.glyphForCharacter(e)), i = {}, Object.keys(this._glyphs).forEach(function (t) { var t = Number(t), e = s._glyphs[t], e = { x: e.x, y: e.y, width: e.width, height: e.height, offsetX: e.offsetX, offsetY: e.offsetY, advanceWidth: e.advanceWidth }; i[t] = e }), t = i[e], r = (e = this._atlasSet.getAtlas(0)).getAtlasUsedSize(), (n = (o = this._resourceFactory.createSurface(r.width, r.height)).renderer()).begin(), n.drawImage(e._surface, 0, 0, r.width, r.height, 0, 0), n.end(), new a.BitmapFont({ src: o, map: i, defaultGlyphWidth: 0, defaultGlyphHeight: this.size, missingGlyph: t })) }, s.prototype.destroy = function () { this._isSurfaceAtlasSetOwner && this._atlasSet.destroy(), this._glyphs = void 0, this._glyphFactory = void 0, this._destroyed = !0 }, s.prototype.destroyed = function () { return this._destroyed }, s); function s(t) { var e, i = l.call(this) || this, r = (i.fontFamily = t.fontFamily, i.size = t.size, i.hint = null != t.hint ? t.hint : {}, i.fontColor = null != t.fontColor ? t.fontColor : "black", i.fontWeight = null != t.fontWeight ? t.fontWeight : d.FontWeight.Normal, i.strokeWidth = null != t.strokeWidth ? t.strokeWidth : 0, i.strokeColor = null != t.strokeColor ? t.strokeColor : "black", i.strokeOnly = null != t.strokeOnly && t.strokeOnly, t.game), o = (i._resourceFactory = r.resourceFactory, i.fontFamily); if ("string" == typeof o) e = o; else { if (Array.isArray(o)) for (var n = [], s = 0; s < o.length; ++s) { var a = o[s]; n.push("string" == typeof a ? a : f.Util.enumToSnakeCase(d.FontFamily, a)) } else (n = []).push("string" == typeof o ? o : f.Util.enumToSnakeCase(d.FontFamily, o)); e = n } var h = i.fontWeight, h = "string" == typeof h ? h : f.Util.enumToSnakeCase(d.FontWeight, h); if (i._glyphFactory = i._resourceFactory.createGlyphFactory(e, i.size, i.hint.baselineHeight, i.fontColor, i.strokeWidth, i.strokeColor, i.strokeOnly, h), i._glyphs = {}, i._destroyed = !1, i._isSurfaceAtlasSetOwner = !1, t.surfaceAtlasSet ? i._atlasSet = t.surfaceAtlasSet : t.hint ? (i._isSurfaceAtlasSetOwner = !0, i._atlasSet = new p.SurfaceAtlasSet({ resourceFactory: r.resourceFactory, hint: i.hint })) : i._atlasSet = r.surfaceAtlasSet, i.hint.presetChars) for (var s = 0, c = i.hint.presetChars.length; s < c; s++) { var u = f.Util.charCodeAt(i.hint.presetChars, s); u && i.glyphForCharacter(u) } return i } i.DynamicFont = t }, { "./BitmapFont": 11, "./Font": 27, "./SurfaceAtlasSet": 57, "./Util": 67, "@akashic/pdi-types": 203 }], 19: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 20: [function (t, e, i) { "use strict"; function r(t, e, i, r, o, n) { this.eventFlags = n, this.local = !!o, this.player = r, this.pointerId = t, this.target = e, this.point = i } var o, n, s = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), a = (Object.defineProperty(i, "__esModule", { value: !0 }), i.SeedEvent = i.PlayerInfoEvent = i.TimestampEvent = i.LeaveEvent = i.JoinEvent = i.OperationEvent = i.MessageEvent = i.PointMoveEventBase = i.PointUpEventBase = i.PointDownEventBase = i.PointEventBase = void 0, i.PointEventBase = r, s(h, n = r), h); function h() { var t = null !== n && n.apply(this, arguments) || this; return t.type = "point-down", t } i.PointDownEventBase = a; s(u, c = r); var c, a = u; function u(t, e, i, r, o, n, s, a) { t = c.call(this, t, e, i, n, s, a) || this; return t.type = "point-up", t.prevDelta = r, t.startDelta = o, t } i.PointUpEventBase = a; s(d, l = r); var l, a = d; function d(t, e, i, r, o, n, s, a) { t = l.call(this, t, e, i, n, s, a) || this; return t.type = "point-move", t.prevDelta = r, t.startDelta = o, t } i.PointMoveEventBase = a; function p(t, e, i, r, o) { this.type = "operation", this.eventFlags = o, this.local = !!r, this.player = i, this.code = t, this.data = e } function f(t, e, i) { this.type = "join", this.eventFlags = i, this.player = t, this.storageValues = e } function _(t, e) { this.type = "leave", this.eventFlags = e, this.player = t } function g(t, e, i) { this.type = "timestamp", this.eventFlags = i, this.player = e, this.timestamp = t } function y(t, e) { this.type = "player-info", this.eventFlags = e, this.player = t } function m(t, e) { this.type = "seed", this.eventFlags = e, this.generator = t } i.MessageEvent = function (t, e, i, r) { this.type = "message", this.eventFlags = r, this.local = !!i, this.player = e, this.data = t }, i.OperationEvent = p, i.JoinEvent = f, i.LeaveEvent = _, i.TimestampEvent = g, i.PlayerInfoEvent = y; i.SeedEvent = m }, {}], 21: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.EventConverter = void 0; var _ = t("./entities/E"), g = t("./Event"), y = t("./ExceptionFactory"), m = t("./Storage"); function r(t) { this._game = t.game, this._playerId = null != (t = t.playerId) ? t : null, this._playerTable = {} } r.prototype.toGameEvent = function (t) { var e, i, r, o, n = t[0], s = t[1], a = t[2], h = this._playerTable[a] || { id: a }; switch (n) { case 0: h = { id: a, name: t[3] }, this._playerTable[a] && null != this._playerTable[a].userData && (h.userData = this._playerTable[a].userData), this._playerTable[a] = h; var c, u, l = void 0; return t[4] && (c = [], u = [], t[4].map(function (t) { c.push(t.readKey), u.push(t.values) }), l = new m.StorageValueStore(c, u)), new g.JoinEvent(h, l, s); case 1: return delete this._playerTable[h.id], new g.LeaveEvent(h, s); case 2: return l = t[3], new g.TimestampEvent(l, h, s); case 3: h = { id: a, name: t[3], userData: t[4] }; return this._playerTable[a] = h, new g.PlayerInfoEvent(h, s); case 32: return d = t[4], new g.MessageEvent(t[3], h, d, s); case 33: return d = t[7], f = t[3], e = null == (p = t[6]) ? void 0 : (0 <= p ? this._game.db : this._game._localDb).get(p), i = { x: t[4], y: t[5] }, new _.PointDownEvent(f, e, i, h, d, s); case 34: return d = t[11], f = t[3], e = null == (p = t[10]) ? void 0 : (0 <= p ? this._game.db : this._game._localDb).get(p), i = { x: t[4], y: t[5] }, r = { x: t[6], y: t[7] }, o = { x: t[8], y: t[9] }, new _.PointMoveEvent(f, e, i, o, r, h, d, s); case 35: return d = t[11], f = t[3], e = null == (p = t[10]) ? void 0 : (0 <= p ? this._game.db : this._game._localDb).get(p), i = { x: t[4], y: t[5] }, r = { x: t[6], y: t[7] }, o = { x: t[8], y: t[9] }, new _.PointUpEvent(f, e, i, o, r, h, d, s); case 64: var d = t[5], l = t[3], p = t[4], f = this._game._decodeOperationPluginOperation(l, p); return new g.OperationEvent(l, f, h, d, s); default: throw y.ExceptionFactory.createAssertionError("EventConverter#toGameEvent") } }, r.prototype.toPlaylogEvent = function (t, e) { var i; switch (t.type) { case "join": case "leave": throw y.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: " + t.type); case "timestamp": var r = e ? null != (r = t.player.id) ? r : null : this._playerId; return [2, t.eventFlags, r, t.timestamp]; case "player-info": return r = e ? null != (i = t.player.id) ? i : null : this._playerId, [3, t.eventFlags, r, t.player.name, t.player.userData]; case "point-down": var o = t.target ? t.target.id : null; return r = e && t.player ? null != (i = t.player.id) ? i : null : this._playerId, [33, t.eventFlags, r, t.pointerId, t.point.x, t.point.y, o, !!t.local]; case "point-move": return o = t.target ? t.target.id : null, r = e && t.player ? null != (i = t.player.id) ? i : null : this._playerId, [34, t.eventFlags, r, t.pointerId, t.point.x, t.point.y, t.startDelta.x, t.startDelta.y, t.prevDelta.x, t.prevDelta.y, o, !!t.local]; case "point-up": return o = t.target ? t.target.id : null, r = e && t.player ? null != (i = t.player.id) ? i : null : this._playerId, [35, t.eventFlags, r, t.pointerId, t.point.x, t.point.y, t.startDelta.x, t.startDelta.y, t.prevDelta.x, t.prevDelta.y, o, !!t.local]; case "message": return r = e && t.player ? null != (i = t.player.id) ? i : null : this._playerId, [32, t.eventFlags, r, t.data, !!t.local]; case "operation": return r = e && t.player ? null != (o = t.player.id) ? o : null : this._playerId, [64, t.eventFlags, r, t.code, t.data, !!t.local]; default: throw y.ExceptionFactory.createAssertionError("Unknown type: " + t.type) } }, r.prototype.makePlaylogOperationEvent = function (t) { var e = this._playerId; return [64, null != t.priority ? 3 & t.priority : 0, e, t._code, t.data, !!t.local] }, i.EventConverter = r }, { "./Event": 20, "./ExceptionFactory": 26, "./Storage": 55, "./entities/E": 77 }], 22: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 23: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 24: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 25: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 26: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ExceptionFactory = void 0, (i = i.ExceptionFactory || (i.ExceptionFactory = {})).createAssertionError = function (t, e) { return (t = new Error(t)).name = "AssertionError", t.cause = e, t }, i.createTypeMismatchError = function (t, e, i, r) { if (t = "Type mismatch on " + t + ", expected type is " + e, 2 < arguments.length) try { var o = void 0; t += ", actual type is " + (40 < (o = i && i.constructor && i.constructor.name ? i.constructor.name : typeof i).length ? o.substr(0, 40) : o) } catch (t) { } return t += ".", (o = new Error(t)).name = "TypeMismatchError", o.cause = r, o.expected = e, o.actual = i, o }, i.createAssetLoadError = function (t, e, i, r) { return void 0 === e && (e = !0), void 0 === i && (i = null), (i = new Error(t)).name = "AssetLoadError", i.cause = r, i.retriable = e, i } }, {}], 27: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Font = void 0; var a = t("./Util"); function r() { } r.prototype.measureText = function (t) { for (var e = 0, i = 0, r = 0, o = null, n = 0; n < t.length; n++) { var s = a.Util.charCodeAt(t, n); s && (!(s = this.glyphForCharacter(s)) || s.x < 0 || s.y < 0 || s.width < 0 || s.height < 0 || (0 === n && (i = -s.offsetX), e += (o = s).advanceWidth)) } return { width: e, actualBoundingBoxLeft: i, actualBoundingBoxRight: r = o ? e + o.offsetX + o.width - o.advanceWidth : r } }, i.Font = r }, { "./Util": 67 }], 28: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Game = void 0; var r = t("@akashic/trigger"), o = t("./AssetManager"), n = t("./AudioSystemManager"), s = t("./DefaultLoadingScene"), a = t("./DefaultSkippingScene"), h = t("./EventConverter"), c = t("./ExceptionFactory"), u = t("./LoadingScene"), l = t("./ModuleManager"), d = t("./OperationPluginManager"), p = t("./PointEventResolver"), f = t("./Scene"), _ = t("./Storage"), g = t("./SurfaceAtlasSet"), y = t("./WeakRefKVS"), m = t("./XorshiftRandomGenerator"); function v(t) { var e = this._normalizeConfiguration(t.configuration); this.fps = e.fps, this.width = e.width, this.height = e.height, this.renderers = [], this.scenes = [], this.age = 0, this.assetBase = t.assetBase || "", this.resourceFactory = t.resourceFactory, this.handlerSet = t.handlerSet, this.selfId = t.selfId, this.db = void 0, this.loadingScene = void 0, this.operationPlugins = void 0, this.random = void 0, this.localRandom = void 0, this._defaultLoadingScene = void 0, this._defaultSkippingScene = void 0, this._eventConverter = void 0, this._pointEventResolver = void 0, this._idx = void 0, this._localDb = void 0, this._localIdx = void 0, this._cameraIdx = void 0, this._isTerminated = void 0, this._modified = void 0, this._postTickTasks = void 0, this.playId = void 0, this.isSkipping = !1, this.joinedPlayerIds = [], this.audio = new n.AudioSystemManager(this.resourceFactory), this.defaultAudioSystemId = "sound", this.storage = new _.Storage, this.assets = {}, this.surfaceAtlasSet = new g.SurfaceAtlasSet({ resourceFactory: this.resourceFactory }), this.onJoin = new r.Trigger, this.onLeave = new r.Trigger, this.onPlayerInfo = new r.Trigger, this.onSeed = new r.Trigger, this.join = this.onJoin, this.leave = this.onLeave, this.playerInfo = this.onPlayerInfo, this.seed = this.onSeed, this._eventTriggerMap = { unknown: void 0, timestamp: void 0, join: this.onJoin, leave: this.onLeave, "player-info": this.onPlayerInfo, seed: this.onSeed, message: void 0, "point-down": void 0, "point-move": void 0, "point-up": void 0, operation: void 0 }, this.onResized = new r.Trigger, this.onSkipChange = new r.Trigger, this.resized = this.onResized, this.skippingChanged = this.onSkipChange, this.isLastTickLocal = !0, this.lastOmittedLocalTickCount = 0, this.lastLocalTickMode = null, this.lastTickGenerationMode = null, this._onLoad = new r.Trigger, this._onStart = new r.Trigger, this._loaded = this._onLoad, this._started = this._onStart, this.isLoaded = !1, this.onSnapshotRequest = new r.Trigger, this.snapshotRequest = this.onSnapshotRequest, this.external = {}, this._runtimeValueBase = Object.create(t.engineModule, { game: { value: this, enumerable: !0 } }), this._main = e.main, this._mainFunc = t.mainFunc, this._mainParameter = void 0, this._configuration = e, this._assetManager = new o.AssetManager(this, e.assets, e.audio, e.moduleMainScripts), this._moduleManager = void 0, this.operationPluginManager = new d.OperationPluginManager(this, t.operationPluginViewInfo || null), this._onOperationPluginOperated = new r.Trigger, this._operationPluginOperated = this._onOperationPluginOperated, this._onOperationPluginOperated.add(this._handleOperationPluginOperated, this), this.onSceneChange = new r.Trigger, this._onSceneChange = new r.Trigger, this._onSceneChange.add(this._handleSceneChanged, this), this._sceneChanged = this._onSceneChange, this._initialScene = new f.Scene({ game: this, assetIds: this._assetManager.globalAssetIds(), local: !0, name: "akashic:initial-scene" }), this._initialScene.onLoad.add(this._handleInitialSceneLoad, this), this._reset({ age: 0 }) } Object.defineProperty(v.prototype, "focusingCamera", { get: function () { return this._focusingCamera }, set: function (t) { t !== this._focusingCamera && (this._modified && this.render(), this._focusingCamera = t) }, enumerable: !1, configurable: !0 }), Object.defineProperty(v.prototype, "skippingScene", { get: function () { return this._skippingScene }, set: function (t) { if (t !== this._skippingScene) { if (t) { if ("full-local" !== t.local) throw c.ExceptionFactory.createAssertionError("Game#skippingScene: only 'full-local' scene is supported."); if (t._needsLoading()) throw c.ExceptionFactory.createAssertionError("Game#skippingScene: must not depend on any assets/storages.") } this._skippingScene = t } }, enumerable: !1, configurable: !0 }), v.prototype.pushScene = function (t) { this._postTickTasks.push({ type: 0, scene: t }) }, v.prototype.replaceScene = function (t, e) { this._postTickTasks.push({ type: 1, scene: t, preserveCurrent: !!e }) }, v.prototype.popScene = function (t, e) { void 0 === e && (e = 1); for (var i = 0; i < e; i++)this._postTickTasks.push({ type: 2, preserveCurrent: !!t }) }, v.prototype.scene = function () { if (this.scenes.length) return this.scenes[this.scenes.length - 1] }, v.prototype.tick = function (t, e, i) { var r = null; if (this._isTerminated) return !1; if (this.isLastTickLocal = !t, this.lastOmittedLocalTickCount = e || 0, this.scenes.length) { if (r = this.scenes[this.scenes.length - 1], i && i.length) for (var o = 0; o < i.length; ++o) { var n = this._eventConverter.toGameEvent(i[o]), s = this._eventTriggerMap[n.type]; s && s.fire(n) } r.onUpdate.fire(), t && ++this.age } return !!this._postTickTasks.length && (this._flushPostTickTasks(), r !== this.scenes[this.scenes.length - 1]) }, v.prototype.render = function () { var t, e = null != (e = this._skippingScene) ? e : this._defaultSkippingScene; if (e && this.isSkipping ? (t = e).onUpdate.fire() : t = this.scene(), this._modified && t) { for (var i = this.focusingCamera, r = this.renderers, o = 0; o < r.length; ++o) { for (var n = r[o], s = (n.begin(), n.save(), n.clear(), i && (n.save(), i._applyTransformToRenderer(n)), t.children), a = 0; a < s.length; ++a)s[a].render(n, i); i && n.restore(), n.restore(), n.end() } this._modified = !1 } }, v.prototype.resolvePointEvent = function (t) { switch (t.type) { case 0: return this._pointEventResolver.pointDown(t); case 1: return this._pointEventResolver.pointMove(t); case 2: return this._pointEventResolver.pointUp(t) } }, v.prototype.findPointSource = function (t, e) { e = e || this.focusingCamera; var i = this.scene(); if (i) return i.findPointSourceByPoint(t, !1, e) }, v.prototype.register = function (t) { if (t.local) { if (void 0 === t.id) t.id = --this._localIdx; else { if (0 < t.id) throw c.ExceptionFactory.createAssertionError("Game#register: invalid local id: " + t.id); if (this._localDb.has(t.id)) throw c.ExceptionFactory.createAssertionError("Game#register: conflicted id: " + t.id); this._localIdx > t.id && (this._localIdx = t.id) } this._localDb.set(t.id, t) } else { if (void 0 === t.id) t.id = ++this._idx; else { if (t.id < 0) throw c.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: " + t.id); if (this.db.has(t.id)) throw c.ExceptionFactory.createAssertionError("Game#register: conflicted id: " + t.id); this._idx < t.id && (this._idx = t.id) } this.db.set(t.id, t) } }, v.prototype.unregister = function (t) { (t.local ? this._localDb : this.db).delete(t.id) }, v.prototype.terminateGame = function () { this._isTerminated = !0, this._terminateGame() }, v.prototype.modified = function () { this._modified = !0 }, v.prototype.raiseEvent = function (t) { this.handlerSet.raiseEvent(this._eventConverter.toPlaylogEvent(t)) }, v.prototype.raiseTick = function (t) { if (null != t && t.length) { for (var e = [], i = 0; i < t.length; i++)e.push(this._eventConverter.toPlaylogEvent(t[i])); this.handlerSet.raiseTick(e) } else this.handlerSet.raiseTick() }, v.prototype.addEventFilter = function (t, e) { this.handlerSet.addEventFilter(t, e) }, v.prototype.removeEventFilter = function (t) { this.handlerSet.removeEventFilter(t) }, v.prototype.shouldSaveSnapshot = function () { return this.handlerSet.shouldSaveSnapshot() }, v.prototype.saveSnapshot = function (t, e) { this.handlerSet.saveSnapshot(this.age, t, this.random.serialize(), this._idx, e) }, v.prototype.requestSaveSnapshot = function (e, i) { var r = this; this._postTickTasks.unshift({ type: 3, fun: function () { var t; !r.handlerSet.shouldSaveSnapshot() || (t = e.call(i)) && r.handlerSet.saveSnapshot(r.age, t.snapshot, r.random.serialize(), r._idx, t.timestamp) }, owner: null }) }, v.prototype.getCurrentTime = function () { return this.handlerSet.getCurrentTime() }, v.prototype.isActiveInstance = function () { return "active" === this.handlerSet.getInstanceType() }, v.prototype._pushPostTickTask = function (t, e) { this._postTickTasks.push({ type: 3, fun: t, owner: e }) }, v.prototype._normalizeConfiguration = function (t) { if (!t) throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments"); if (null == t.assets && (t.assets = {}), null == t.fps && (t.fps = 30), "number" != typeof t.fps) throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number"); if (!(0 <= t.fps && t.fps <= 60)) throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60]."); if ("number" != typeof t.width) throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number"); if ("number" != typeof t.height) throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number"); return t }, v.prototype._setAudioPlaybackRate = function (t) { this.audio._setPlaybackRate(t) }, v.prototype._setMuted = function (t) { this.audio._setMuted(t) }, v.prototype._decodeOperationPluginOperation = function (t, e) { t = this.operationPluginManager.plugins[t]; return t && t.decode ? t.decode(e) : e }, v.prototype._reset = function (t) { if (this.operationPluginManager.reset(), this.operationPluginManager.onOperate.add(this._onOperationPluginOperated.fire, this._onOperationPluginOperated), this.scene()) { for (; this.scene() !== this._initialScene;)this.popScene(), this._flushPostTickTasks(); this.isLoaded || this.scenes.pop() } switch (this._skippingScene && !this._skippingScene.destroyed() && this._skippingScene.destroy(), t && (void 0 !== t.age && (this.age = t.age), void 0 !== t.nextEntityId && (this._idx = t.nextEntityId), void 0 !== t.randGenSer ? this.random = m.XorshiftRandomGenerator.deserialize(t.randGenSer) : void 0 !== t.randSeed && (this.random = new m.XorshiftRandomGenerator(t.randSeed))), this.audio._reset(), this._onLoad.removeAll({ func: this._handleLoad, owner: this }), this.onJoin.removeAll(), this.onLeave.removeAll(), this.onSeed.removeAll(), this.onResized.removeAll(), this.onSkipChange.removeAll(), this.onSceneChange.removeAll(), this.handlerSet.removeAllEventFilters(), this.isSkipping = !1, this.onSkipChange.add(this._handleSkipChange, this), this.joinedPlayerIds = [], this.onJoin.add(this._handleJoinEvent, this), this.onLeave.add(this._handleLeaveEvent, this), this._idx = 0, this._localIdx = 0, this._cameraIdx = 0, this.db = new y.WeakRefKVS, this._localDb = new y.WeakRefKVS, this._modified = !0, this.loadingScene = void 0, this._skippingScene = void 0, this._focusingCamera = void 0, this.lastLocalTickMode = null, this.lastTickGenerationMode = null, this.onSnapshotRequest.removeAll(), this._postTickTasks = [], this._eventConverter = new h.EventConverter({ game: this, playerId: this.selfId }), this._pointEventResolver = new p.PointEventResolver({ sourceResolver: this, playerId: this.selfId }), this.localRandom = new m.XorshiftRandomGenerator(Math.floor(9007199254740991 * Math.random())), this._isTerminated = !1, this.vars = {}, this._moduleManager = new l.ModuleManager(this._runtimeValueBase, this._assetManager), this.surfaceAtlasSet.destroy(), this.surfaceAtlasSet = new g.SurfaceAtlasSet({ resourceFactory: this.resourceFactory }), this._configuration.defaultLoadingScene) { case "none": this._defaultLoadingScene = new u.LoadingScene({ game: this }); break; case "compact": this._defaultLoadingScene = new s.DefaultLoadingScene({ game: this, style: "compact" }); break; default: this._defaultLoadingScene = new s.DefaultLoadingScene({ game: this }) }switch (this._configuration.defaultSkippingScene) { case "none": this._defaultSkippingScene = new a.DefaultSkippingScene({ game: this, style: "none" }); break; case "indicator": this._defaultSkippingScene = new a.DefaultSkippingScene({ game: this, style: "indicator" }); break; default: this._defaultSkippingScene = void 0 } }, v.prototype._destroy = function () { if (this.operationPluginManager.destroy(), this.scene()) for (; this.scene() !== this._initialScene;)this.popScene(), this._flushPostTickTasks(); this._initialScene.destroy(), this.loadingScene && !this.loadingScene.destroyed() && this.loadingScene.destroy(), this._defaultLoadingScene.destroyed() || this._defaultLoadingScene.destroy(), this._defaultSkippingScene && !this._defaultSkippingScene.destroyed() && this._defaultSkippingScene.destroy(), this._skippingScene && !this._skippingScene.destroyed() && this._skippingScene.destroy(), this.db = void 0, this.renderers = void 0, this.scenes = void 0, this.random = void 0, this._modified = !1, this.age = 0, this.assets = void 0, this.isLoaded = !1, this.loadingScene = void 0, this.assetBase = "", this.selfId = void 0, this.audio.music.stopAll(), this.audio.sound.stopAll(), this.audio = void 0, this.defaultAudioSystemId = void 0, this.handlerSet = void 0, this.localRandom = void 0, this.onJoin.destroy(), this.onJoin = void 0, this.onLeave.destroy(), this.onLeave = void 0, this.onSeed.destroy(), this.onSeed = void 0, this.onPlayerInfo.destroy(), this.onPlayerInfo = void 0, this.onResized.destroy(), this.onResized = void 0, this.onSkipChange.destroy(), this.onSkipChange = void 0, this.onSceneChange.destroy(), this.onSceneChange = void 0, this.onSnapshotRequest.destroy(), this.onSnapshotRequest = void 0, this.join = void 0, this.leave = void 0, this.seed = void 0, this.playerInfo = void 0, this.snapshotRequest = void 0, this.resized = void 0, this.skippingChanged = void 0, this._sceneChanged = void 0, this._loaded = void 0, this._started = void 0, this._operationPluginOperated = void 0, this._onSceneChange.destroy(), this._onSceneChange = void 0, this._onLoad.destroy(), this._onLoad = void 0, this._onStart.destroy(), this._onStart = void 0, this.resourceFactory = void 0, this.storage = void 0, this.playId = void 0, this.operationPlugins = void 0, this._eventTriggerMap = void 0, this._initialScene = void 0, this._defaultLoadingScene = void 0, this._main = void 0, this._mainFunc = void 0, this._mainParameter = void 0, this._assetManager.destroy(), this._assetManager = void 0, this._eventConverter = void 0, this._pointEventResolver = void 0, this.operationPluginManager = void 0, this._onOperationPluginOperated.destroy(), this._onOperationPluginOperated = void 0, this._idx = 0, this._localDb = void 0, this._localIdx = 0, this._cameraIdx = 0, this._isTerminated = !0, this._focusingCamera = void 0, this._skippingScene = void 0, this._configuration = void 0, this._postTickTasks = [], this.surfaceAtlasSet.destroy(), this.surfaceAtlasSet = void 0, this._moduleManager = void 0 }, v.prototype._loadAndStart = function (t) { this._mainParameter = t || {}, this.isLoaded ? this._handleLoad() : (this._onLoad.add(this._handleLoad, this), this.pushScene(this._initialScene), this._flushPostTickTasks()) }, v.prototype._startLoadingGlobalAssets = function () { if (this.isLoaded) throw c.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded."); this.pushScene(this._initialScene), this._flushPostTickTasks() }, v.prototype._updateEventTriggers = function (t) { this._modified = !0, t ? (this._eventTriggerMap.message = t.onMessage, this._eventTriggerMap["point-down"] = t.onPointDownCapture, this._eventTriggerMap["point-move"] = t.onPointMoveCapture, this._eventTriggerMap["point-up"] = t.onPointUpCapture, this._eventTriggerMap.operation = t.onOperation, t._activate()) : (this._eventTriggerMap.message = void 0, this._eventTriggerMap["point-down"] = void 0, this._eventTriggerMap["point-move"] = void 0, this._eventTriggerMap["point-up"] = void 0, this._eventTriggerMap.operation = void 0) }, v.prototype._handleInitialSceneLoad = function () { this._initialScene.onLoad.remove(this._handleInitialSceneLoad, this), this.assets = this._initialScene.assets, this.isLoaded = !0, this._onLoad.fire(this) }, v.prototype._handleOperationPluginOperated = function (t) { t = this._eventConverter.makePlaylogOperationEvent(t); this.handlerSet.raiseEvent(t) }, v.prototype._handleSceneChanged = function (t) { this._updateEventTriggers(t); var e = t ? t.local : "full-local", t = t ? t.tickGenerationMode : "by-clock"; this.lastLocalTickMode === e && this.lastTickGenerationMode === t || (this.lastLocalTickMode = e, this.lastTickGenerationMode = t, this.handlerSet.changeSceneMode({ local: e, tickGenerationMode: t })) }, v.prototype._handleSkippingSceneReady = function (t) { this._pushPostTickTask(t._fireLoaded, t) }, v.prototype._terminateGame = function () { }, v.prototype._flushPostTickTasks = function () { do { var t = this._postTickTasks; this._postTickTasks = []; for (var e = 0; e < t.length; ++e) { var i = t[e]; switch (i.type) { case 0: var r = this.scene(); r && r._deactivate(), this._doPushScene(i.scene); break; case 1: i.scene.prefetch(), this._doPopScene(i.preserveCurrent, !1), this._doPushScene(i.scene); break; case 2: this._doPopScene(i.preserveCurrent, !0); break; case 3: i.fun.call(i.owner); break; default: throw c.ExceptionFactory.createAssertionError("Game#_flushPostTickTasks: unknown post-tick task type.") } } } while (0 < this._postTickTasks.length) }, v.prototype._handleSkipChange = function (t) { (this.isSkipping = t) && (t = null != (t = this._skippingScene) ? t : this._defaultSkippingScene) && !t._loaded && (t._load(), t._onReady.addOnce(this._handleSkippingSceneReady, this)), this._cleanDB(), this._modified = !0 }, v.prototype._handleJoinEvent = function (t) { t.player.id && -1 === this.joinedPlayerIds.indexOf(t.player.id) && this.joinedPlayerIds.push(t.player.id) }, v.prototype._handleLeaveEvent = function (e) { this.joinedPlayerIds = this.joinedPlayerIds.filter(function (t) { return t !== e.player.id }) }, v.prototype._doPopScene = function (t, e) { var i = this.scenes.pop(); if (!i) throw c.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; scene stack underflow"); if (i === this._initialScene) throw c.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene"); t || i.destroy(), e && (t = this.scene(), this.onSceneChange.fire(t), this._onSceneChange.fire(t)) }, v.prototype._handleLoad = function () { for (var t = 0, e = this._configuration.operationPlugins || []; t < e.length; t++) { var i, r = e[t]; r.script && (i = this._moduleManager._require(r.script), i = this.operationPluginManager.register(i, r.code, r.option), !r.manualStart && i && i.start()) } if (this.operationPlugins = this.operationPluginManager.plugins, this._mainFunc) this._mainFunc(this._runtimeValueBase, this._mainParameter || {}); else { if (!this._main) throw c.ExceptionFactory.createAssertionError("Game#_handleLoad: does not have an entry point"); var o = this._moduleManager._require(this._main); if (!o || "function" != typeof o) throw c.ExceptionFactory.createAssertionError("Game#_handleLoad: Entry point ".concat(this._main, " not found.")); o(this._mainParameter) } this._flushPostTickTasks(), this._onStart.fire() }, v.prototype._doPushScene = function (t, e) { if (e = e || this.loadingScene || this._defaultLoadingScene, this.scenes.push(t), t._needsLoading() && "loaded-fired" !== t._loadingState) { if (this._defaultLoadingScene._needsLoading()) throw c.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages."); this._doPushScene(e, this._defaultLoadingScene), e.reset(t) } else this.onSceneChange.fire(t), this._onSceneChange.fire(t), t._loaded || (t._load(), this._pushPostTickTask(t._fireLoaded, t)); this._modified = !0 }, v.prototype._cleanDB = function () { this.db.clean(), this._localDb.clean() }, i.Game = v }, { "./AssetManager": 7, "./AudioSystemManager": 10, "./DefaultLoadingScene": 15, "./DefaultSkippingScene": 16, "./EventConverter": 21, "./ExceptionFactory": 26, "./LoadingScene": 32, "./ModuleManager": 36, "./OperationPluginManager": 40, "./PointEventResolver": 45, "./Scene": 50, "./Storage": 55, "./SurfaceAtlasSet": 57, "./WeakRefKVS": 69, "./XorshiftRandomGenerator": 71, "@akashic/trigger": 223 }], 29: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 30: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 31: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 32: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.LoadingScene = void 0, t("@akashic/trigger")), a = t("./ExceptionFactory"), t = t("./Scene"), t = (o = t.Scene, n(h, o), h.prototype.destroy = function () { this._clearTargetScene(), o.prototype.destroy.call(this) }, h.prototype.reset = function (t) { this._clearTargetScene(), this._targetScene = t, "loaded-fired" !== this._loadingState ? this.onLoad.addOnce(this._doReset, this) : this._doReset() }, h.prototype.getTargetWaitingAssetsCount = function () { return this._targetScene ? this._targetScene._sceneAssetHolder.waitingAssetsCount : 0 }, h.prototype.end = function () { var t; if (!this._targetScene || "initial" === this._targetScene._loadingState) throw t = this._targetScene ? this._targetScene._loadingState : "(no scene)", a.ExceptionFactory.createAssertionError("LoadingScene#end(): the target scene is in invalid state: " + t); this.game.popScene(!0), this.game._pushPostTickTask(this._targetScene._fireLoaded, this._targetScene), this._clearTargetScene() }, h.prototype._clearTargetScene = function () { this._targetScene && (this._targetScene._onReady.removeAll({ owner: this }), this._targetScene.onAssetLoad.removeAll({ owner: this }), this._targetScene = void 0) }, h.prototype._doReset = function () { this.onTargetReset.fire(this._targetScene), "initial" === this._targetScene._loadingState || "ready" === this._targetScene._loadingState ? (this._targetScene._onReady.add(this._handleReady, this), this._targetScene.onAssetLoad.add(this._handleAssetLoad, this), this._targetScene._load()) : this._handleReady(this._targetScene) }, h.prototype._handleAssetLoad = function (t) { this.onTargetAssetLoad.fire(t) }, h.prototype._handleReady = function (t) { this.onTargetReady.fire(t), this._explicitEnd || this.end() }, h); function h(t) { var e = this; return t.local = !0, (e = o.call(this, t) || this).onTargetReset = new s.Trigger, e.onTargetReady = new s.Trigger, e.onTargetAssetLoad = new s.Trigger, e.targetReset = e.onTargetReset, e.targetReady = e.onTargetReady, e.targetAssetLoaded = e.onTargetAssetLoad, e._explicitEnd = !!t.explicitEnd, e._targetScene = void 0, e } i.LoadingScene = t }, { "./ExceptionFactory": 26, "./Scene": 50, "@akashic/trigger": 223 }], 33: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 34: [function (t, e, i) { "use strict"; function r(t, e, i, r, o, n, s) { void 0 === t ? (this._modified = !1, this._matrix = [1, 0, 0, 1, 0, 0]) : "number" == typeof t ? (this._modified = !1, this._matrix = new Array(6), this.update(t, e, i, r, o, 0, 0, n, s)) : (this._modified = t._modified, this._matrix = [t._matrix[0], t._matrix[1], t._matrix[2], t._matrix[3], t._matrix[4], t._matrix[5]]) } Object.defineProperty(i, "__esModule", { value: !0 }), i.PlainMatrix = void 0, r.prototype.update = function (t, e, i, r, o, n, s, a, h) { var c, u; null == a || null == h ? this._updateWithoutAnchor(t, e, i, r, o, n, s) : (o = o * Math.PI / 180, c = Math.cos(o), u = (o = Math.sin(o)) * i, o *= r, r *= c, a *= t, t = h * e, this._matrix[0] = h = c * i, this._matrix[1] = u, this._matrix[2] = -o, this._matrix[3] = r, this._matrix[4] = -h * a + o * t + n, this._matrix[5] = -u * a - r * t + s) }, r.prototype._updateWithoutAnchor = function (t, e, i, r, o, n, s) { var o = o * Math.PI / 180, a = Math.cos(o), o = Math.sin(o), h = a * i, i = o * i, o = o * r, a = a * r, r = t / 2, t = e / 2; this._matrix[0] = h, this._matrix[1] = i, this._matrix[2] = -o, this._matrix[3] = a, this._matrix[4] = -h * r + o * t + r + n, this._matrix[5] = -i * r - a * t + t + s }, r.prototype.updateByInverse = function (t, e, i, r, o, n, s, a, h) { var c, u; null == a || null == h ? this._updateByInverseWithoutAnchor(t, e, i, r, o, n, s) : (o = o * Math.PI / 180, c = Math.cos(o), u = (o = Math.sin(o)) / r, o /= i, r = c / r, a *= t, t = h * e, this._matrix[0] = h = c / i, this._matrix[1] = -u, this._matrix[2] = o, this._matrix[3] = r, this._matrix[4] = -h * n - o * s + a, this._matrix[5] = u * n - r * s + t) }, r.prototype._updateByInverseWithoutAnchor = function (t, e, i, r, o, n, s) { var o = o * Math.PI / 180, a = Math.cos(o), o = Math.sin(o), h = a / i, c = o / r, o = o / i, i = a / r, a = t / 2, r = e / 2; this._matrix[0] = h, this._matrix[1] = -c, this._matrix[2] = o, this._matrix[3] = i, this._matrix[4] = -h * (a + n) - o * (r + s) + a, this._matrix[5] = c * (a + n) - i * (r + s) + r }, r.prototype.multiply = function (t) { var e = this._matrix, t = t._matrix, i = e[0], r = e[1], o = e[2], n = e[3]; e[0] = i * t[0] + o * t[1], e[1] = r * t[0] + n * t[1], e[2] = i * t[2] + o * t[3], e[3] = r * t[2] + n * t[3], e[4] = i * t[4] + o * t[5] + e[4], e[5] = r * t[4] + n * t[5] + e[5] }, r.prototype.multiplyLeft = function (t) { var t = t._matrix, e = this._matrix, i = e[0], r = e[2], o = e[4]; e[0] = t[0] * i + t[2] * e[1], e[1] = t[1] * i + t[3] * e[1], e[2] = t[0] * r + t[2] * e[3], e[3] = t[1] * r + t[3] * e[3], e[4] = t[0] * o + t[2] * e[5] + t[4], e[5] = t[1] * o + t[3] * e[5] + t[5] }, r.prototype.multiplyNew = function (t) { var e = this.clone(); return e.multiply(t), e }, r.prototype.reset = function (t, e) { this._matrix[0] = 1, this._matrix[1] = 0, this._matrix[2] = 0, this._matrix[3] = 1, this._matrix[4] = t || 0, this._matrix[5] = e || 0 }, r.prototype.clone = function () { return new r(this) }, r.prototype.multiplyInverseForPoint = function (t) { var e = this._matrix, i = 1 / (e[0] * e[3] + e[2] * -e[1]); return { x: e[3] * i * t.x + -e[2] * i * t.y + (e[5] * e[2] - e[4] * e[3]) * i, y: e[0] * i * t.y + -e[1] * i * t.x + (-e[5] * e[0] + e[4] * e[1]) * i } }, r.prototype.scale = function (t, e) { var i = this._matrix; i[0] *= t, i[1] *= e, i[2] *= t, i[3] *= e, i[4] *= t, i[5] *= e }, r.prototype.multiplyPoint = function (t) { var e = this._matrix; return { x: e[0] * t.x + e[2] * t.y + e[4], y: e[1] * t.x + e[3] * t.y + e[5] } }, i.PlainMatrix = r }, {}], 35: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Module = void 0; var h = t("./PathUtil"); i.Module = function (t) { function e(t) { return s(t, i) } var i = this, r = t.path, o = h.PathUtil.resolveDirname(r), n = (n = t.virtualPath) ? h.PathUtil.resolveDirname(n) : void 0, s = t.requireFunc, a = t.resolveFunc; this._runtimeValue = Object.create(t.runtimeValueBase, { filename: { value: r, enumerable: !0 }, dirname: { value: o, enumerable: !0 }, module: { value: this, writable: !0, enumerable: !0, configurable: !0 } }), this.id = t.id, this.filename = t.path, this.exports = {}, this.parent = null, this.loaded = !1, this.children = [], this.paths = n ? h.PathUtil.makeNodeModulePaths(n) : [], this._dirname = o, this._virtualDirname = n, e.resolve = function (t) { return a(t, i) }, this.require = e } }, { "./PathUtil": 43 }], 36: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ModuleManager = void 0; var u = t("./ExceptionFactory"), l = t("./Module"), d = t("./PathUtil"), p = t("./RequireCachedValue"), f = t("./ScriptAssetContext"); function r(t, e) { this._assetManager = e, this._runtimeValueBase = t, this._scriptCaches = {} } r.prototype._require = function (t, e) { var i = this, r = this._assetManager._liveAssetVirtualPathTable, o = this._assetManager._moduleMainScripts; if (-1 === t.indexOf("/") && this._assetManager._assets.hasOwnProperty(t) && (a = this._assetManager._assets[t], c = this._assetManager._liveAssetPathTable[a.path]), /^\.\/|^\.\.\/|^\//.test(t)) { if (e) { if (!e._virtualDirname) throw u.ExceptionFactory.createAssertionError("g._require: require from modules without virtualPath is not supported"); c = d.PathUtil.resolvePath(e._virtualDirname, t) } else { if (!/^\.\//.test(t)) throw u.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'"); c = t.substring(2) } if (this._scriptCaches.hasOwnProperty(c)) return this._scriptCaches[c]._cachedValue(); if (this._scriptCaches.hasOwnProperty(c + ".js")) return this._scriptCaches[c + ".js"]._cachedValue(); a = (a = a || this._findAssetByPathAsFile(c, r)) || this._findAssetByPathAsDirectory(c, r) } else if (!(a = o[t] ? r[c = o[t]] : a)) { var n = e ? e.paths : []; n.push("node_modules"); for (var s = 0; s < n.length; ++s) { var a, h = n[s], c = d.PathUtil.resolvePath(h, t); if (a = this._findAssetByPathAsFile(c, r)) break; if (a = this._findAssetByPathAsDirectory(c, r)) break } } if (a) { if (this._scriptCaches.hasOwnProperty(c)) return this._scriptCaches[c]._cachedValue(); if ("script" === a.type) return o = new l.Module({ runtimeValueBase: this._runtimeValueBase, id: a.id, path: a.path, virtualPath: this._assetManager._liveAssetPathTable[a.path], requireFunc: function (t, e) { return i._require(t, e) }, resolveFunc: function (t, e) { return i._resolvePath(t, e) } }), o = new f.ScriptAssetContext(a, o), (this._scriptCaches[c] = o)._executeScript(e); if ("text" === a.type && a && ".json" === d.PathUtil.resolveExtname(t)) return (this._scriptCaches[c] = new p.RequireCachedValue(JSON.parse(a.data)))._cachedValue() } throw u.ExceptionFactory.createAssertionError("g._require: can not find module: " + t) }, r.prototype._resolvePath = function (t, e) { var i = null, r = this._assetManager._liveAssetVirtualPathTable, o = this._assetManager._moduleMainScripts; if (/^\.\/|^\.\.\/|^\//.test(t)) { if (!e) throw u.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the moudle without currentModule"); if (!e._virtualDirname) throw u.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the moudle path without virtualPath"); i = d.PathUtil.resolvePath(e._virtualDirname, t); if (h = this._resolveAbsolutePathAsFile(i, r)) return h; if (h = this._resolveAbsolutePathAsDirectory(i, r)) return h } else { if (o[t]) return o[t]; var n = e ? e.paths.concat() : []; n.push("node_modules"); for (var s = 0; s < n.length; ++s) { var a = n[s], h = d.PathUtil.resolvePath(a, t); if (i = this._resolveAbsolutePathAsFile(h, r)) return i; if (i = this._resolveAbsolutePathAsDirectory(h, r)) return i } } throw u.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the path: " + t) }, r.prototype._findAssetByPathAsFile = function (t, e) { return e.hasOwnProperty(t) ? e[t] : e.hasOwnProperty(t + ".js") ? e[t + ".js"] : void 0 }, r.prototype._findAssetByPathAsDirectory = function (t, e) { var i = t + "/package.json"; if (e.hasOwnProperty(i) && "text" === e[i].type) { var r = JSON.parse(e[i].data); if (r && "string" == typeof r.main) { r = this._findAssetByPathAsFile(d.PathUtil.resolvePath(t, r.main), e); if (r) return r } } if (e.hasOwnProperty(i = t + "/index.js")) return e[i] }, r.prototype._resolveAbsolutePathAsFile = function (t, e) { return e.hasOwnProperty(t) ? "/" + t : e.hasOwnProperty(t + ".js") ? "/" + t + ".js" : null }, r.prototype._resolveAbsolutePathAsDirectory = function (t, e) { var i = t + "/package.json"; if (e.hasOwnProperty(i) && "text" === e[i].type) { var r = JSON.parse(e[i].data); if (r && "string" == typeof r.main) { r = this._resolveAbsolutePathAsFile(d.PathUtil.resolvePath(t, r.main), e); if (r) return "/" + r } } return e.hasOwnProperty(i = t + "/index.js") ? "/" + i : null }, i.ModuleManager = r }, { "./ExceptionFactory": 26, "./Module": 35, "./PathUtil": 43, "./RequireCachedValue": 49, "./ScriptAssetContext": 51 }], 37: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.NinePatchSurfaceEffector = void 0; var r = t("./SurfaceUtil"); function o(t, e) { void 0 === e && (e = 4), this.game = t, this.borderWidth = "number" == typeof e ? { top: e, bottom: e, left: e, right: e } : e } o.prototype.render = function (t, e, i) { return this._surface && this._surface.width === e && this._surface.height === i && this._beforeSrcSurface === t || (this._surface = this.game.resourceFactory.createSurface(Math.ceil(e), Math.ceil(i)), this._beforeSrcSurface = t), r.SurfaceUtil.drawNinePatch(this._surface, t, this.borderWidth), this._surface }, i.NinePatchSurfaceEffector = o }, { "./SurfaceUtil": 60 }], 38: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Object2D = void 0; var r = t("./ExceptionFactory"), o = t("./Matrix"); function n(t) { t ? (this.x = t.x || 0, this.y = t.y || 0, this.width = t.width || 0, this.height = t.height || 0, this.opacity = null != t.opacity ? t.opacity : 1, this.scaleX = null != t.scaleX ? t.scaleX : 1, this.scaleY = null != t.scaleY ? t.scaleY : 1, this.angle = t.angle || 0, this.compositeOperation = t.compositeOperation, this.anchorX = void 0 === t.anchorX ? 0 : t.anchorX, this.anchorY = void 0 === t.anchorY ? 0 : t.anchorY) : (this.x = 0, this.y = 0, this.width = 0, this.height = 0, this.opacity = 1, this.scaleX = 1, this.scaleY = 1, this.angle = 0, this.compositeOperation = void 0, this.anchorX = 0, this.anchorY = 0), this._matrix = void 0 } n.prototype.moveTo = function (t, e) { if ("number" == typeof t && "number" != typeof e) throw r.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number."); "number" == typeof t ? (this.x = t, this.y = e) : (this.x = t.x, this.y = t.y) }, n.prototype.moveBy = function (t, e) { this.x += t, this.y += e }, n.prototype.resizeTo = function (t, e) { if ("number" == typeof t && "number" != typeof e) throw r.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number."); "number" == typeof t ? (this.width = t, this.height = e) : (this.width = t.width, this.height = t.height) }, n.prototype.resizeBy = function (t, e) { this.width += t, this.height += e }, n.prototype.scale = function (t) { this.scaleX = t, this.scaleY = t }, n.prototype.anchor = function (t, e) { this.anchorX = t, this.anchorY = e }, n.prototype.getMatrix = function () { if (this._matrix) { if (!this._matrix._modified) return this._matrix } else this._matrix = new o.PlainMatrix; return this._updateMatrix(), this._matrix._modified = !1, this._matrix }, n.prototype._updateMatrix = function () { this.angle || 1 !== this.scaleX || 1 !== this.scaleY || 0 !== this.anchorX || 0 !== this.anchorY ? this._matrix.update(this.width, this.height, this.scaleX, this.scaleY, this.angle, this.x, this.y, this.anchorX, this.anchorY) : this._matrix.reset(this.x, this.y) }, i.Object2D = n }, { "./ExceptionFactory": 26, "./Matrix": 34 }], 39: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 40: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.OperationPluginManager = void 0; var r = t("@akashic/trigger"), o = (n.prototype.onOperation = function (t) { var e; t instanceof Array ? e = { _code: this._code, data: t } : (e = t)._code = this._code, this._handler.call(this._handlerOwner, e) }, n); function n(t, e, i) { this._code = t, this._handler = i, this._handlerOwner = e } function s(t, e) { this.onOperate = new r.Trigger, this.operated = this.onOperate, this.plugins = {}, this._game = t, this._viewInfo = e } s.prototype.register = function (t, e, i) { return this._instantiateOperationPlugin(t, e, i) }, s.prototype.start = function (t) { t = this.plugins[t]; t && t.start() }, s.prototype.stop = function (t) { t = this.plugins[t]; t && t.stop() }, s.prototype.destroy = function () { this.stopAll(), this.onOperate.destroy(), this.onOperate = void 0, this.operated = void 0, this.plugins = void 0, this._game = void 0, this._viewInfo = void 0 }, s.prototype.reset = function () { this.stopAll(), this.onOperate.removeAll(), this.plugins = {} }, s.prototype.stopAll = function () { for (var t in this.plugins) this.plugins.hasOwnProperty(t) && ((t = this.plugins[t]) && t.stop()) }, s.prototype._instantiateOperationPlugin = function (t, e, i) { if (t.isSupported()) { if (this.plugins[e]) throw new Error("Plugin#code conflicted for code: ".concat(e)); t = new t(this._game, this._viewInfo, i), i = (this.plugins[e] = t, new o(e, this.onOperate, this.onOperate.fire)); return t.operationTrigger.add(i.onOperation, i), t } }, i.OperationPluginManager = s }, { "@akashic/trigger": 223 }], 41: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 42: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 43: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.PathUtil = void 0; var h, c = t("./ExceptionFactory"); (h = i.PathUtil || (i.PathUtil = {})).resolvePath = function (t, e) { function i(t) { t = t.split("/"); return "" === t[t.length - 1] && t.pop(), t } if ("" === e) return t; for (var r = i((t = h.splitPath(t)).path).concat(i(e)), o = [], n = 0; n < r.length; ++n) { var s = r[n]; switch (s) { case "..": var a = o.pop(); if (void 0 === a || "" === a || "." === a) throw c.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments"); break; case ".": 0 === o.length && o.push("."); break; case "": o = [""]; break; default: o.push(s) } } return t.host + o.join("/") }, h.resolveDirname = function (t) { var e = t.lastIndexOf("/"); return -1 === e ? t : t.substr(0, e) }, h.resolveExtname = function (t) { for (var e = t.length - 1; 0 <= e; --e) { var i = t.charAt(e); if ("." === i) return t.substr(e); if ("/" === i) return "" } return "" }, h.makeNodeModulePaths = function (t) { for (var e, i = h.splitPath(t), r = i.host, o = (t = "/" === (t = i.path)[t.length - 1] ? t.slice(0, t.length - 1) : t).split("/"), n = 0 < (i = o.indexOf("node_modules")) ? i - 1 : 0, s = [], a = o.length - 1; n <= a; --a)"node_modules" !== o[a] && ((e = o.slice(0, a + 1)).push("node_modules"), e = e.join("/"), s.push(r + e)); return s }, h.splitPath = function (t) { var e = "", i = t.indexOf("//"); return 0 <= i ? t = 0 <= (i = t.indexOf("/", i + 2)) ? (e = t.slice(0, i), t.slice(i)) : (e = t, "/") : e = "", { host: e, path: t } } }, { "./ExceptionFactory": 26 }], 44: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 45: [function (t, e, i) { "use strict"; function r(t) { this._pointEventMap = {}, this._sourceResolver = t.sourceResolver, this._playerId = t.playerId } Object.defineProperty(i, "__esModule", { value: !0 }), i.PointEventResolver = void 0, r.prototype.pointDown = function (t) { var e = this._sourceResolver.findPointSource(t.offset), i = e.point || t.offset, r = e.target ? e.target.id : void 0, o = e.local, o = (this._pointEventMap[t.identifier] = { targetId: r, local: o, point: i, start: { x: t.offset.x, y: t.offset.y }, prev: { x: t.offset.x, y: t.offset.y } }, [33, 2, this._playerId, t.identifier, i.x, i.y, r]); return e && e.local && o.push(e.local), o }, r.prototype.pointMove = function (t) { var e, i, r = this._pointEventMap[t.identifier]; return r ? (this._pointMoveAndUp(r, t.offset, e = { x: 0, y: 0 }, i = { x: 0, y: 0 }), t = [34, 2, this._playerId, t.identifier, r.point.x, r.point.y, i.x, i.y, e.x, e.y, r.targetId], r.local && t.push(r.local), t) : null }, r.prototype.pointUp = function (t) { var e, i, r = this._pointEventMap[t.identifier]; return r ? (this._pointMoveAndUp(r, t.offset, e = { x: 0, y: 0 }, i = { x: 0, y: 0 }), delete this._pointEventMap[t.identifier], t = [35, 2, this._playerId, t.identifier, r.point.x, r.point.y, i.x, i.y, e.x, e.y, r.targetId], r.local && t.push(r.local), t) : null }, r.prototype._pointMoveAndUp = function (t, e, i, r) { r.x = e.x - t.start.x, r.y = e.y - t.start.y, i.x = e.x - t.prev.x, i.y = e.y - t.prev.y, t.prev.x = e.x, t.prev.y = e.y }, i.PointEventResolver = r }, {}], 46: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.RandomGenerator = void 0, i.RandomGenerator = function (t) { this.seed = t } }, {}], 47: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 48: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 49: [function (t, e, i) { "use strict"; function r(t) { this._value = t } Object.defineProperty(i, "__esModule", { value: !0 }), i.RequireCachedValue = void 0, r.prototype._cachedValue = function () { return this._value }, i.RequireCachedValue = r }, {}], 50: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Scene = void 0; var o = t("@akashic/trigger"), n = t("./AssetAccessor"), s = t("./AssetHolder"), h = t("./Camera2D"), r = t("./ExceptionFactory"), a = t("./TimerManager"); function c(t) { var e = t.game, i = void 0 === t.local || !1 === t.local ? "non-local" : !0 === t.local ? "full-local" : t.local, r = void 0 !== t.tickGenerationMode ? t.tickGenerationMode : "by-clock"; t.storageKeys ? (this._storageLoader = e.storage._createLoader(t.storageKeys, t.storageValuesSerialization), this.storageValues = this._storageLoader._valueStore) : (this._storageLoader = void 0, this.storageValues = void 0), this.name = t.name, this.game = e, this.local = i, this.tickGenerationMode = r, this.onLoad = new o.Trigger, this.loaded = this.onLoad, this._onReady = new o.Trigger, this._ready = this._onReady, this.assets = {}, this.asset = new n.AssetAccessor(e._assetManager), this._loaded = !1, this._prefetchRequested = !1, this._loadingState = "initial", this.onUpdate = new o.Trigger, this.update = this.onUpdate, this._timer = new a.TimerManager(this.onUpdate, this.game.fps), this.onAssetLoad = new o.Trigger, this.onAssetLoadFailure = new o.Trigger, this.onAssetLoadComplete = new o.Trigger, this.assetLoaded = this.onAssetLoad, this.assetLoadFailed = this.onAssetLoadFailure, this.assetLoadCompleted = this.onAssetLoadComplete, this.onMessage = new o.Trigger, this.onPointDownCapture = new o.Trigger, this.onPointMoveCapture = new o.Trigger, this.onPointUpCapture = new o.Trigger, this.onOperation = new o.Trigger, this.message = this.onMessage, this.pointDownCapture = this.onPointDownCapture, this.pointMoveCapture = this.onPointMoveCapture, this.pointUpCapture = this.onPointUpCapture, this.operation = this.onOperation, this.children = [], this.state = "standby", this.onStateChange = new o.Trigger, this._assetHolders = [], this._sceneAssetHolder = new s.AssetHolder({ assetManager: this.game._assetManager, assetIds: t.assetIds, assetPaths: t.assetPaths, handlerSet: { owner: this, handleLoad: this._handleSceneAssetLoad, handleLoadFailure: this._handleSceneAssetLoadFailure, handleFinish: this._handleSceneAssetLoadFinish }, userData: null }) } c.prototype.modified = function (t) { this.game.modified() }, c.prototype.destroy = function () { this.state = "before-destroyed", this.onStateChange.fire(this.state); for (var t = 0, e = [this.game.db, this.game._localDb]; t < e.length; t++)for (var i = e[t], r = 0, o = i.keys(); r < o.length; r++) { var n = o[r], n = i.get(n); (null == n ? void 0 : n.scene) === this && n.destroy() } this._timer.destroy(), this.onUpdate.destroy(), this.onMessage.destroy(), this.onPointDownCapture.destroy(), this.onPointMoveCapture.destroy(), this.onPointUpCapture.destroy(), this.onOperation.destroy(), this.onLoad.destroy(), this.onAssetLoad.destroy(), this.onAssetLoadFailure.destroy(), this.onAssetLoadComplete.destroy(), this.assets = {}; for (var s = 0; s < this._assetHolders.length; ++s)this._assetHolders[s].destroy(); this._sceneAssetHolder.destroy(), this._storageLoader = void 0, this.game = void 0, this.state = "destroyed", this.onStateChange.fire(this.state), this.onStateChange.destroy() }, c.prototype.destroyed = function () { return void 0 === this.game }, c.prototype.createTimer = function (t) { return this._timer.createTimer(t) }, c.prototype.deleteTimer = function (t) { this._timer.deleteTimer(t) }, c.prototype.setInterval = function (t, e, i) { return this._timer.setInterval(t, e, i) }, c.prototype.clearInterval = function (t) { this._timer.clearInterval(t) }, c.prototype.setTimeout = function (t, e, i) { return this._timer.setTimeout(t, e, i) }, c.prototype.clearTimeout = function (t) { this._timer.clearTimeout(t) }, c.prototype.isCurrentScene = function () { return this.game.scene() === this }, c.prototype.gotoScene = function (t, e) { if (!this.isCurrentScene()) throw r.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene"); e ? this.game.pushScene(t) : this.game.replaceScene(t) }, c.prototype.end = function () { if (!this.isCurrentScene()) throw r.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene"); this.game.popScene() }, c.prototype.register = function (t) { this.game.register(t), t.scene = this }, c.prototype.unregister = function (t) { t.scene = void 0, this.game.unregister(t) }, c.prototype.append = function (t) { this.insertBefore(t, void 0) }, c.prototype.insertBefore = function (t, e) { t.parent && t.remove(), t.parent = this; var i = -1; void 0 !== e && -1 < (i = this.children.indexOf(e)) ? this.children.splice(i, 0, t) : this.children.push(t), this.modified(!0) }, c.prototype.remove = function (t) { t = this.children.indexOf(t); -1 !== t && (this.children[t].parent = void 0, this.children.splice(t, 1), this.modified(!0)) }, c.prototype.findPointSourceByPoint = function (t, e, i) { for (var r = "non-local" !== this.local, o = this.children, n = i && i instanceof h.Camera2D ? i.getMatrix() : void 0, s = o.length - 1; 0 <= s; --s) { var a = o[s].findPointSourceByPoint(t, n, e); if (a) return a.local = a.target && a.target.local || r, a } return { target: void 0, point: void 0, local: r } }, c.prototype.prefetch = function () { this._loaded || this._prefetchRequested || (this._prefetchRequested = !0, this._sceneAssetHolder.request()) }, c.prototype.serializeStorageValues = function () { if (this._storageLoader) return this._storageLoader._valueStoreSerialization }, c.prototype.requestAssets = function (t, e) { var i = this; if ("ready-fired" !== this._loadingState && "loaded-fired" !== this._loadingState) throw r.ExceptionFactory.createAssertionError("Scene#requestAssets(): can be called after loaded."); t = new s.AssetHolder({ assetManager: this.game._assetManager, assetIds: t, handlerSet: { owner: this, handleLoad: this._handleSceneAssetLoad, handleLoadFailure: this._handleSceneAssetLoadFailure, handleFinish: this._handleSceneAssetLoadFinish }, userData: function () { i.destroyed() || e() } }); this._assetHolders.push(t), t.request() }, c.prototype._activate = function () { this.state = "active", this.onStateChange.fire(this.state) }, c.prototype._deactivate = function () { this.state = "deactive", this.onStateChange.fire(this.state) }, c.prototype._needsLoading = function () { return 0 < this._sceneAssetHolder.waitingAssetsCount || !!this._storageLoader && !this._storageLoader._loaded }, c.prototype._load = function () { var t; this._loaded || (this._loaded = !0, t = this._sceneAssetHolder.request(), this._storageLoader && (this._storageLoader._load(this), t = !0), t || this._notifySceneReady()) }, c.prototype._handleSceneAssetLoad = function (t) { this.assets[t.id] = t, this.onAssetLoad.fire(t), this.onAssetLoadComplete.fire(t) }, c.prototype._handleSceneAssetLoadFailure = function (t) { this.onAssetLoadFailure.fire(t), this.onAssetLoadComplete.fire(t.asset) }, c.prototype._handleSceneAssetLoadFinish = function (t, e) { e ? t.userData ? this.game._pushPostTickTask(t.userData, null) : !this._loaded || this._storageLoader && !this._storageLoader._loaded || this._notifySceneReady() : this.game.terminateGame() }, c.prototype._onStorageLoadError = function (t) { this.game.terminateGame() }, c.prototype._onStorageLoaded = function () { 0 === this._sceneAssetHolder.waitingAssetsCount && this._notifySceneReady() }, c.prototype._notifySceneReady = function () { this._loadingState = "ready", this.game._pushPostTickTask(this._fireReady, this) }, c.prototype._fireReady = function () { this.destroyed() || (this._onReady.fire(this), this._loadingState = "ready-fired") }, c.prototype._fireLoaded = function () { this.destroyed() || "loaded-fired" !== this._loadingState && (this.onLoad.fire(this), this._loadingState = "loaded-fired") }, i.Scene = c }, { "./AssetAccessor": 3, "./AssetHolder": 5, "./Camera2D": 13, "./ExceptionFactory": 26, "./TimerManager": 66, "@akashic/trigger": 223 }], 51: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ScriptAssetContext = void 0; var r = t("./ExceptionFactory"); function o(t, e) { this._asset = t, this._module = e, this._started = !1 } o.prototype._cachedValue = function () { if (this._started) return this._module.exports; throw r.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.") }, o.prototype._executeScript = function (t) { return this._started || (t && (this._module.parent = t).children.push(this._module), this._started = !0, this._asset.execute(this._module._runtimeValue), this._module.loaded = !0), this._module.exports }, i.ScriptAssetContext = o }, { "./ExceptionFactory": 26 }], 52: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ShaderProgram = void 0, i.ShaderProgram = function (t) { this.fragmentShader = t.fragmentShader, this.uniforms = t.uniforms } }, {}], 53: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 54: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.SpriteFactory = void 0; var u = t("./entities/Sprite"), l = t("./ExceptionFactory"); function r() { } r.createSpriteFromE = function (t, e, i) { var r, o, n = e.x, s = e.y, a = 0, h = 0, c = (e.width, e.height, e.calculateBoundingRect()); if (!c) throw l.ExceptionFactory.createAssertionError("SpriteFactory.createSpriteFromE: camera must look e"); r = c.right - c.left, o = c.bottom - c.top, c.left < e.x && (a = e.x - c.left), c.top < e.y && (h = e.y - c.top), e.moveTo(a, h), e._matrix && (e._matrix._modified = !0); a = t.game.resourceFactory.createSurface(Math.ceil(r), Math.ceil(o)), h = a.renderer(), h.begin(), e.render(h, i), h.end(), i = new u.Sprite({ scene: t, src: a, width: r, height: o }); return i.moveTo(c.left, c.top), e.moveTo(n, s), e._matrix && (e._matrix._modified = !0), i }, r.createSpriteFromScene = function (t, e, i) { for (var r = t.game.resourceFactory.createSurface(Math.ceil(e.game.width), Math.ceil(e.game.height)), o = r.renderer(), n = (o.begin(), e.children), s = 0; s < n.length; ++s)n[s].render(o, i); return o.end(), new u.Sprite({ scene: t, src: r, width: e.game.width, height: e.game.height }) }, i.SpriteFactory = r }, { "./ExceptionFactory": 26, "./entities/Sprite": 82 }], 55: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Storage = i.StorageLoader = i.StorageValueStore = i.StorageCountsOperation = i.StorageCondition = i.StorageOrder = i.StorageRegion = void 0, (r = i.StorageRegion || (i.StorageRegion = {}))[r.Slots = 1] = "Slots", r[r.Scores = 2] = "Scores", r[r.Counts = 3] = "Counts", r[r.Values = 4] = "Values", (r = i.StorageOrder || (i.StorageOrder = {}))[r.Asc = 0] = "Asc", r[r.Desc = 1] = "Desc", (r = i.StorageCondition || (i.StorageCondition = {}))[r.Equal = 1] = "Equal", r[r.GreaterThan = 2] = "GreaterThan", r[r.LessThan = 3] = "LessThan", (r = i.StorageCountsOperation || (i.StorageCountsOperation = {}))[r.Incr = 1] = "Incr", r[r.Decr = 2] = "Decr", n.prototype.get = function (t) { if (void 0 !== this._values) { if ("number" == typeof t) return this._values[t]; var e = this._keys.indexOf(t); if (-1 !== e) return this._values[e]; for (var i = 0; i < this._keys.length; ++i) { var r = this._keys[i]; if (r.region === t.region && r.regionKey === t.regionKey && r.userId === t.userId && r.gameId === t.gameId) return this._values[i] } } return [] }, n.prototype.getOne = function (t) { t = this.get(t); if (t) return t[0] }; var r, o = n; function n(t, e) { this._keys = t, this._values = e } i.StorageValueStore = o; a.prototype._load = function (t) { this._handler = t, this._storage._load && this._storage._load.call(this._storage, this._valueStore._keys, this, this._valueStoreSerialization) }, a.prototype._onLoaded = function (t, e) { this._valueStore._values = t, this._loaded = !0, e && (this._valueStoreSerialization = e), this._handler && this._handler._onStorageLoaded() }, a.prototype._onError = function (t) { this._handler && this._handler._onStorageLoadError(t) }; var s = a; function a(t, e, i) { this._loaded = !1, this._storage = t, this._valueStore = new o(e), this._handler = void 0, this._valueStoreSerialization = i } function h() { } i.StorageLoader = s, h.prototype.write = function (t, e, i) { this._write && this._write(t, e, i) }, h.prototype.requestValuesForJoinPlayer = function (t) { this._requestedKeysForJoinPlayer = t }, h.prototype._createLoader = function (t, e) { return new s(this, t, e) }, h.prototype._registerWrite = function (t) { this._write = t }, h.prototype._registerLoad = function (t) { this._load = t }, i.Storage = h }, {}], 56: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.SurfaceAtlas = void 0; var s = t("./SurfaceAtlasSlot"); function r(t) { this._surface = t, this._emptySurfaceAtlasSlotHead = new s.SurfaceAtlasSlot(0, 0, this._surface.width, this._surface.height), this._accessScore = 0, this._usedRectangleAreaSize = { width: 0, height: 0 } } r.prototype.reset = function () { var t = this._surface.renderer(); t.begin(), t.clear(), t.end(), this._emptySurfaceAtlasSlotHead = new s.SurfaceAtlasSlot(0, 0, this._surface.width, this._surface.height), this._accessScore = 0, this._usedRectangleAreaSize.width = 0, this._usedRectangleAreaSize.height = 0 }, r.prototype._acquireSurfaceAtlasSlot = function (t, e) { var i, r, o, n = function (t, e, i) { for (; t;) { if (t.width >= e && t.height >= i) return t; t = t.next } return null }(this._emptySurfaceAtlasSlotHead, t += 1, e += 1); return n ? (r = (o = n.width - t) <= (r = n.height - e) ? (i = new s.SurfaceAtlasSlot(n.x + t, n.y, o, e), new s.SurfaceAtlasSlot(n.x, n.y + e, n.width, r)) : (i = new s.SurfaceAtlasSlot(n.x, n.y + e, t, r), new s.SurfaceAtlasSlot(n.x + t, n.y, o, n.height)), i.prev = n.prev, i.next = r, null === i.prev ? this._emptySurfaceAtlasSlotHead = i : i.prev.next = i, r.prev = i, r.next = n.next, r.next && (r.next.prev = r), o = new s.SurfaceAtlasSlot(n.x, n.y, t, e), this._updateUsedRectangleAreaSize(o), o) : null }, r.prototype._updateUsedRectangleAreaSize = function (t) { var e = t.x + t.width, t = t.y + t.height; e > this._usedRectangleAreaSize.width && (this._usedRectangleAreaSize.width = e), t > this._usedRectangleAreaSize.height && (this._usedRectangleAreaSize.height = t) }, r.prototype.addSurface = function (t, e, i, r, o) { var n, s = this._acquireSurfaceAtlasSlot(r, o); return s ? ((n = this._surface.renderer()).begin(), n.drawImage(t, e, i, r, o, s.x, s.y), n.end(), s) : null }, r.prototype.destroy = function () { this._surface.destroy() }, r.prototype.destroyed = function () { return this._surface.destroyed() }, r.prototype.getAtlasUsedSize = function () { return this._usedRectangleAreaSize }, r.prototype.getAccessScore = function () { return this._accessScore }, i.SurfaceAtlas = r }, { "./SurfaceAtlasSlot": 58 }], 57: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.SurfaceAtlasSet = void 0; var r = t("./SurfaceAtlas"); function o(t) { this._surfaceAtlases = [], this._atlasGlyphsTable = [], this._resourceFactory = t.resourceFactory, this._currentAtlasIndex = 0; var t = t.hint || {}; this._maxAtlasNum = t.maxAtlasNum || o.INITIAL_MAX_SURFACEATLAS_NUM, t.initialAtlasWidth = t.initialAtlasWidth || 512, t.initialAtlasHeight = t.initialAtlasHeight || 512, t.maxAtlasWidth = t.maxAtlasWidth || 512, t.maxAtlasHeight = t.maxAtlasHeight || 512, this._atlasSize = (t = t, { width: Math.ceil(Math.min(t.initialAtlasWidth, t.maxAtlasWidth)), height: Math.ceil(Math.min(t.initialAtlasHeight, t.maxAtlasHeight)) }) } o.prototype._deleteAtlas = function (t) { for (var e = 0; e < t; ++e) { var i = this._spliceLeastFrequentlyUsedAtlas(); if (!i) return; i.destroy() } }, o.prototype._findLeastFrequentlyUsedAtlasIndex = function () { for (var t = Number.MAX_VALUE, e = -1, i = 0; i < this._surfaceAtlases.length; ++i)this._surfaceAtlases[i]._accessScore <= t && (t = this._surfaceAtlases[i]._accessScore, e = i); return e }, o.prototype._spliceLeastFrequentlyUsedAtlas = function () { var t = this._findLeastFrequentlyUsedAtlasIndex(); if (-1 === t) return null; this._currentAtlasIndex >= t && --this._currentAtlasIndex; for (var e = this._surfaceAtlases.splice(t, 1)[0], i = this._atlasGlyphsTable.splice(t, 1)[0], r = 0; r < i.length; r++) { var o = i[r]; o.surface = void 0, o.isSurfaceValid = !1, o._atlas = null } return e }, o.prototype._moveGlyphSurface = function (t) { for (var e = 0; e < this._surfaceAtlases.length; ++e) { var i = (this._currentAtlasIndex + e) % this._surfaceAtlases.length, r = this._surfaceAtlases[i], o = r.addSurface(t.surface, t.x, t.y, t.width, t.height); if (o) return this._currentAtlasIndex = i, t.surface && t.surface.destroy(), t.surface = r._surface, t.x = o.x, t.y = o.y, t._atlas = r, this._atlasGlyphsTable[i].push(t), !0 } return !1 }, o.prototype._reallocateAtlas = function () { var t = null; this._surfaceAtlases.length >= this._maxAtlasNum ? (t = this._spliceLeastFrequentlyUsedAtlas()).reset() : t = new r.SurfaceAtlas(this._resourceFactory.createSurface(this._atlasSize.width, this._atlasSize.height)), this._surfaceAtlases.push(t), this._atlasGlyphsTable.push([]), this._currentAtlasIndex = this._surfaceAtlases.length - 1 }, o.prototype.getAtlas = function (t) { return this._surfaceAtlases[t] }, o.prototype.getAtlasNum = function () { return this._surfaceAtlases.length }, o.prototype.getMaxAtlasNum = function () { return this._maxAtlasNum }, o.prototype.changeMaxAtlasNum = function (t) { this._maxAtlasNum = t, this._surfaceAtlases.length > this._maxAtlasNum && (t = this._surfaceAtlases.length - this._maxAtlasNum, this._deleteAtlas(t)) }, o.prototype.getAtlasUsedSize = function () { return this._atlasSize }, o.prototype.addGlyph = function (t) { return !(t.width > this._atlasSize.width || t.height > this._atlasSize.height) && (!!this._moveGlyphSurface(t) || (this._reallocateAtlas(), this._moveGlyphSurface(t))) }, o.prototype.touchGlyph = function (t) { t._atlas && (t._atlas._accessScore += 1); for (var e = 0; e < this._surfaceAtlases.length; e++)this._surfaceAtlases[e]._accessScore /= 2 }, o.prototype.destroy = function () { for (var t = 0; t < this._surfaceAtlases.length; ++t)this._surfaceAtlases[t].destroy(); this._surfaceAtlases = void 0, this._resourceFactory = void 0, this._atlasGlyphsTable = void 0 }, o.prototype.destroyed = function () { return void 0 === this._surfaceAtlases }, o.INITIAL_MAX_SURFACEATLAS_NUM = 10, i.SurfaceAtlasSet = o }, { "./SurfaceAtlas": 56 }], 58: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.SurfaceAtlasSlot = void 0, i.SurfaceAtlasSlot = function (t, e, i, r) { this.x = t, this.y = e, this.width = i, this.height = r, this.prev = null, this.next = null } }, {}], 59: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 60: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.SurfaceUtil = void 0; var r = t("./ExceptionFactory"); function o(t, e, i, r, o) { for (var n = (o = "number" == typeof (o = void 0 === o ? 4 : o) ? { top: o, bottom: o, left: o, right: o } : o).left, s = r.width - o.right, a = o.top, h = r.height - o.bottom, c = o.left, e = e - o.right, u = o.top, i = i - o.bottom, l = [{ x: 0, y: 0, width: o.left, height: o.top }, { x: s, y: 0, width: o.right, height: o.top }, { x: 0, y: h, width: o.left, height: o.bottom }, { x: s, y: h, width: o.right, height: o.bottom }], d = [{ x: 0, y: 0 }, { x: e, y: 0 }, { x: 0, y: i }, { x: e, y: i }], p = 0; p < l.length; ++p) { var f = l[p]; t.save(), t.translate(d[p].x, d[p].y), t.drawImage(r, f.x, f.y, f.width, f.height, 0, 0), t.restore() } for (var _ = [{ x: n, y: 0, width: s - n, height: o.top }, { x: 0, y: a, width: o.left, height: h - a }, { x: s, y: a, width: o.right, height: h - a }, { x: n, y: h, width: s - n, height: o.bottom }], g = [{ x: c, y: 0, width: e - c, height: o.top }, { x: 0, y: u, width: o.left, height: i - u }, { x: e, y: u, width: o.right, height: i - u }, { x: c, y: i, width: e - c, height: o.bottom }], p = 0; p < _.length; ++p) { var y = _[p], m = g[p]; t.save(), t.translate(m.x, m.y), t.transform([m.width / y.width, 0, 0, m.height / y.height, 0, 0]), t.drawImage(r, y.x, y.y, y.width, y.height, 0, 0), t.restore() } o = s - n, s = h - a, h = e - c, e = i - u; t.save(), t.translate(c, u), t.transform([h / o, 0, 0, e / s, 0, 0]), t.drawImage(r, n, a, o, s, 0, 0), t.restore() } (t = i.SurfaceUtil || (i.SurfaceUtil = {})).asSurface = function (t) { if (t) { if ("type" in t && "image" === t.type) return t.asSurface(); if ("_drawable" in t) return t; throw r.ExceptionFactory.createTypeMismatchError("SurfaceUtil#asSurface", "ImageAsset|Surface", t) } }, t.setupAnimatingHandler = function (t, e) { e.isPlaying() && t._handleAnimationStart() }, t.migrateAnimatingHandler = function (t, e, i) { t._handleAnimationStop(), i.isPlaying() && t._handleAnimationStart() }, t.drawNinePatch = function (t, e, i) { void 0 === i && (i = 4); var r = t.renderer(); r.begin(), r.clear(), o(r, t.width, t.height, e, i), r.end() }, t.renderNinePatch = o }, { "./ExceptionFactory": 26 }], 61: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.TextAlign = void 0, (i = i.TextAlign || (i.TextAlign = {}))[i.Left = 0] = "Left", i[i.Center = 1] = "Center", i[i.Right = 2] = "Right" }, {}], 62: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 63: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 64: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 65: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Timer = void 0; var r = t("@akashic/trigger"); function o(t, e) { this.interval = t, this._scaledInterval = Math.round(t * e), this.onElapse = new r.Trigger, this.elapsed = this.onElapse, this._scaledElapsed = 0 } o.prototype.tick = function () { for (this._scaledElapsed += 1e3; this._scaledElapsed >= this._scaledInterval && this.onElapse;)this.onElapse.fire(), this._scaledElapsed -= this._scaledInterval }, o.prototype.canDelete = function () { return !this.onElapse || 0 === this.onElapse.length }, o.prototype.destroy = function () { this.interval = void 0, this.onElapse.destroy(), this.onElapse = void 0, this.elapsed = void 0, this._scaledInterval = 0, this._scaledElapsed = 0 }, o.prototype.destroyed = function () { return void 0 === this.onElapse }, i.Timer = o }, { "@akashic/trigger": 223 }], 66: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.TimerManager = i.TimerIdentifier = void 0; var o = t("./ExceptionFactory"), n = t("./Timer"), r = (s.prototype.destroy = function () { this._timer.onElapse.remove(this._handleElapse, this), this._timer = void 0, this._handler = void 0, this._handlerOwner = void 0, this._fired = void 0, this._firedOwner = void 0 }, s.prototype.destroyed = function () { return void 0 === this._timer }, s.prototype._handleElapse = function () { this.destroyed() || (this._handler.call(this._handlerOwner), this._fired && this._fired.call(this._firedOwner, this)) }, s); function s(t, e, i, r, o) { this._timer = t, this._handler = e, this._handlerOwner = i, this._fired = r, this._firedOwner = o, this._timer.onElapse.add(this._handleElapse, this) } function a(t, e) { this._timers = [], this._trigger = t, this._identifiers = [], this._fps = e, this._registered = !1 } i.TimerIdentifier = r, a.prototype.destroy = function () { for (var t = 0; t < this._identifiers.length; ++t)this._identifiers[t].destroy(); for (t = 0; t < this._timers.length; ++t)this._timers[t].destroy(); this._timers = void 0, this._trigger = void 0, this._identifiers = void 0, this._fps = void 0 }, a.prototype.destroyed = function () { return void 0 === this._timers }, a.prototype.createTimer = function (t) { if (this._registered || (this._trigger.add(this._tick, this), this._registered = !0), t < 0) throw o.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval"); t < 1 && (t = 1); for (var e = Math.min(1e3, t * this._fps), i = 0; i < this._timers.length; ++i)if (this._timers[i].interval === t && this._timers[i]._scaledElapsed < e) return this._timers[i]; var r = new n.Timer(t, this._fps); return this._timers.push(r), r }, a.prototype.deleteTimer = function (t) { if (t.canDelete()) { var e = this._timers.indexOf(t); if (e < 0) throw o.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer"); if (this._timers.splice(e, 1), t.destroy(), !this._timers.length) { if (!this._registered) throw o.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled"); this._trigger.remove(this._tick, this), this._registered = !1 } } }, a.prototype.setTimeout = function (t, e, i) { e = this.createTimer(e), e = new r(e, t, i, this._onTimeoutFired, this); return this._identifiers.push(e), e }, a.prototype.clearTimeout = function (t) { this._clear(t) }, a.prototype.setInterval = function (t, e, i) { e = this.createTimer(e), e = new r(e, t, i); return this._identifiers.push(e), e }, a.prototype.clearInterval = function (t) { this._clear(t) }, a.prototype._tick = function () { for (var t = this._timers.concat(), e = 0; e < t.length; ++e)t[e].tick() }, a.prototype._onTimeoutFired = function (t) { var e = this._identifiers.indexOf(t); if (e < 0) throw o.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier"); this._identifiers.splice(e, 1); e = t._timer; t.destroy(), this.deleteTimer(e) }, a.prototype._clear = function (t) { var e = this._identifiers.indexOf(t); if (e < 0) throw o.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier"); if (t.destroyed()) throw o.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier"); this._identifiers.splice(e, 1); e = t._timer; t.destroy(), this.deleteTimer(e) }, i.TimerManager = a }, { "./ExceptionFactory": 26, "./Timer": 65 }], 67: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Util = void 0; var r, t = t("@akashic/pdi-types"); (r = i.Util || (i.Util = {})).distance = function (t, e, i, r) { return Math.sqrt(Math.pow(t - i, 2) + Math.pow(e - r, 2)) }, r.distanceBetweenOffsets = function (t, e) { return r.distance(t.x, t.y, e.x, e.y) }, r.distanceBetweenAreas = function (t, e) { return r.distance(t.x + t.width / 2, t.y + t.height / 2, e.x + e.width / 2, e.y + e.height / 2) }, r.charCodeAt = function (t, e) { var i = t.charCodeAt(e); return 55296 <= i && i <= 56319 ? i << 16 | t.charCodeAt(e + 1) : 56320 <= i && i <= 57343 ? null : i }, r.enumToSnakeCase = function (t, e) { return (t = t[e])[0].toLowerCase() + t.slice(1).replace(/[A-Z]/g, function (t) { return "-" + t.toLowerCase() }) }, r.compositeOperationStringTable = ((i = {})[t.CompositeOperation.SourceOver] = "source-over", i[t.CompositeOperation.SourceAtop] = "source-atop", i[t.CompositeOperation.Lighter] = "lighter", i[t.CompositeOperation.Copy] = "copy", i[t.CompositeOperation.ExperimentalSourceIn] = "experimental-source-in", i[t.CompositeOperation.ExperimentalSourceOut] = "experimental-source-out", i[t.CompositeOperation.ExperimentalDestinationAtop] = "experimental-destination-atop", i[t.CompositeOperation.ExperimentalDestinationIn] = "experimental-destination-in", i[t.CompositeOperation.DestinationOut] = "destination-out", i[t.CompositeOperation.DestinationOver] = "destination-over", i[t.CompositeOperation.Xor] = "xor", i) }, { "@akashic/pdi-types": 203 }], 68: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.VideoSystem = void 0, i.VideoSystem = function () { } }, {}], 69: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.WeakRefKVS = void 0; o.prototype.deref = function () { return this._target }; var r = o; function o(t) { this._target = t } function n() { this._weakRefClass = "undefined" != typeof WeakRef ? WeakRef : r, this._refMap = Object.create(null) } n.prototype.set = function (t, e) { this._refMap[t] && this.delete(t), this._refMap[t] = new this._weakRefClass(e) }, n.prototype.get = function (t) { t = this._refMap[t]; if (t) return t.deref() }, n.prototype.has = function (t) { return t in this._refMap }, n.prototype.delete = function (t) { delete this._refMap[t] }, n.prototype.keys = function () { return Object.keys(this._refMap) }, n.prototype.clear = function () { this._refMap = Object.create(null) }, n.prototype.clean = function () { for (var t = 0, e = Object.entries(this._refMap); t < e.length; t++) { var i = e[t], r = i[0]; void 0 === i[1].deref() && this.delete(r) } }, i.WeakRefKVS = n }, {}], 70: [function (t, e, i) { "use strict"; function r(t) { this.initState(t) } Object.defineProperty(i, "__esModule", { value: !0 }), i.Xorshift = void 0, r.deserialize = function (t) { var e = new r(0); return e._state0U = t._state0U, e._state0L = t._state0L, e._state1U = t._state1U, e._state1L = t._state1L, e }, r.prototype.initState = function (t) { var e = 1812433253; this._state0U = t = e * (t ^ t >> 30) + 1, this._state0L = t = e * (t ^ t >> 30) + 2, this._state1U = t = e * (t ^ t >> 30) + 3, this._state1L = t = e * (t ^ t >> 30) + 4 }, r.prototype.randomInt = function () { var t = this._state0U, e = this._state0L, i = this._state1U, r = this._state1L, o = 0, n = 0, e = (o = (t ^= o = t << 23 | (-512 & e) >>> 9) ^ (this._state0U = i), o ^= t >>> 17, n = (n = (e ^= n = e << 23) ^ (this._state0L = r)) ^ (e >>> 17 | (131071 & t) << 15) ^ (r >>> 26 | (67108863 & i) << 6), this._state1U = o ^= i >>> 26, ((this._state1L = n) >>> 0) + (r >>> 0)); return [o + i + (e / 2 >>> 31) >>> 0, e >>> 0] }, r.prototype.random = function () { var t = this.randomInt(); return (4294967296 * t[0] + t[1]) / 0x10000000000000000 }, r.prototype.nextInt = function (t, e) { return Math.floor(t + this.random() * (e - t)) }, r.prototype.serialize = function () { return { _state0U: this._state0U, _state0L: this._state0L, _state1U: this._state1U, _state1L: this._state1L } }, i.Xorshift = r }, {}], 71: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.XorshiftRandomGenerator = void 0, t("./ExceptionFactory")), a = t("./RandomGenerator"), h = t("./Xorshift"), t = (o = a.RandomGenerator, n(c, o), c.deserialize = function (t) { return new c(t._seed, t._xorshift) }, c.prototype.get = function (t, e) { return this._xorshift.nextInt(t, e + 1) }, c.prototype.generate = function () { return this._xorshift.random() }, c.prototype.serialize = function () { return { _seed: this.seed, _xorshift: this._xorshift.serialize() } }, c); function c(t, e) { var i = this; if (void 0 === t) throw s.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined"); return (i = o.call(this, t) || this)._xorshift = e ? h.Xorshift.deserialize(e) : new h.Xorshift(t), i } i.XorshiftRandomGenerator = t }, { "./ExceptionFactory": 26, "./RandomGenerator": 46, "./Xorshift": 70 }], 72: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.EmptyGeneratedVectorImageAsset = void 0, t("./EmptyVectorImageAsset")), t = (o = t.EmptyVectorImageAsset, n(s, o), s); function s(t, e, i) { t = o.call(this, t, e, 0, 0) || this; return t.data = i, t } i.EmptyGeneratedVectorImageAsset = t }, { "./EmptyVectorImageAsset": 73 }], 73: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.EmptyVectorImageAsset = void 0; var n = t("@akashic/trigger"); function r(t, e, i, r, o) { this.type = "vector-image", this.width = 0, this.height = 0, this.onDestroyed = new n.Trigger, this.id = t, this.path = e, this.originalPath = e, this.width = i, this.height = r, this.hint = o } r.prototype.createSurface = function (t, e, i, r, o, n) { return null }, r.prototype.inUse = function () { return !1 }, r.prototype.destroy = function () { this.destroyed() || (this.onDestroyed.destroy(), this.onDestroyed = void 0) }, r.prototype.destroyed = function () { return !this.onDestroyed }, r.prototype._load = function (t) { t._onAssetLoad(this) }, r.prototype._assetPathFilter = function (t) { return t }, i.EmptyVectorImageAsset = r }, { "@akashic/trigger": 223 }], 74: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.PartialImageAsset = void 0; var s = t("@akashic/trigger"); function r(t, e, i, r, o, n) { this.type = "image", this.hint = void 0, this.onDestroyed = new s.Trigger, this._surface = null, this._loadHandler = null, this.id = e, this.path = i, this.originalPath = i, this.width = n.width, this.height = n.height, this._slice = n, this._resourceFactory = t; n = "".concat(e, "/<internal>"); this._src = t.createImageAsset(n, i, r, o) } r.prototype.initialize = function (t) { this.hint = t, this._src.initialize(t) }, r.prototype.inUse = function () { return !1 }, r.prototype.destroy = function () { this.destroyed() || (this.onDestroyed.fire(this), this._src.destroy(), this._src = null, this._slice = null, this._resourceFactory = null, this._surface = null, this._loadHandler = null, this.onDestroyed.destroy(), this.onDestroyed = void 0) }, r.prototype.destroyed = function () { return !this._src }, r.prototype.asSurface = function () { var t, e, i, r, o, n; return this._surface || (t = (r = this._slice).x, e = r.y, i = r.width, r = r.height, (n = (o = this._resourceFactory.createSurface(i, r)).renderer()).begin(), n.drawImage(this._src.asSurface(), t, e, i, r, 0, 0), n.end(), this._surface = o) }, r.prototype._load = function (t) { this._loadHandler = t, this._src._load(this) }, r.prototype._onAssetLoad = function (t) { this._loadHandler._onAssetLoad(this) }, r.prototype._onAssetError = function (t, e) { this._loadHandler._onAssetError(this, e) }, r.prototype._assetPathFilter = function (t) { return t }, i.PartialImageAsset = r }, { "@akashic/trigger": 223 }], 75: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.CacheableE = void 0, t("./E")), t = (o = t.E, n(s, o), s.prototype.invalidate = function () { this.state &= -3, this.modified() }, s.prototype.renderSelf = function (t, e) { var i, r, o, n = s.PADDING; return this._renderedCamera !== e && (this.state &= -3, this._renderedCamera = e), 2 & this.state || (this._cacheSize = this.calculateCacheSize(), o = Math.ceil(this._cacheSize.width) + 2 * n, i = Math.ceil(this._cacheSize.height) + 2 * n, (r = !this._cache || this._cache.width < o || this._cache.height < i) && (this._cache && !this._cache.destroyed() && this._cache.destroy(), this._cache = this.scene.game.resourceFactory.createSurface(o, i), this._renderer = this._cache.renderer()), (o = this._renderer).begin(), r || o.clear(), o.save(), o.translate(n, n), this.renderCache(o, e), o.restore(), this.state |= 2, o.end()), this._cache && 0 < this._cacheSize.width && 0 < this._cacheSize.height && (t.translate(-n, -n), this.renderSelfFromCache(t), t.translate(n, n)), this._shouldRenderChildren }, s.prototype.renderSelfFromCache = function (t) { t.drawImage(this._cache, 0, 0, this._cacheSize.width + s.PADDING, this._cacheSize.height + s.PADDING, 0, 0) }, s.prototype.destroy = function () { this._cache && !this._cache.destroyed() && this._cache.destroy(), this._cache = void 0, o.prototype.destroy.call(this) }, s.prototype.calculateCacheSize = function () { return { width: this.width, height: this.height } }, s.PADDING = 1, s); function s(t) { t = o.call(this, t) || this; return t._shouldRenderChildren = !0, t._cache = void 0, t._renderer = void 0, t._renderedCamera = void 0, t } i.CacheableE = t }, { "./E": 77 }], 76: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.CameraCancellingE = void 0, t("../Object2D")), t = t("./E"), t = (o = t.E, n(a, o), a.prototype.renderSelf = function (t, e) { if (this.children) { e && (r = this._canceller, (i = e).x === r.x && i.y === r.y && i.angle === r.angle && i.scaleX === r.scaleX && i.scaleY === r.scaleY || (r.x = i.x, r.y = i.y, r.angle = i.angle, r.scaleX = i.scaleX, r.scaleY = i.scaleY, r._matrix && (r._matrix._modified = !0)), t.save(), t.transform(r.getMatrix()._matrix)); for (var i, r, o = this.children, n = 0; n < o.length; ++n)o[n].render(t, e); e && t.restore() } return !1 }, a); function a(t) { t = o.call(this, t) || this; return t._canceller = new s.Object2D, t } i.CameraCancellingE = t }, { "../Object2D": 38, "./E": 77 }], 77: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.E = i.PointMoveEvent = i.PointUpEvent = i.PointDownEvent = void 0, t("@akashic/trigger")), a = t("../Event"), h = t("../ExceptionFactory"), c = t("../Matrix"), u = t("../Object2D"), l = t("../Util"), t = (o = a.PointDownEventBase, n(d, o), d); function d() { return null !== o && o.apply(this, arguments) || this } i.PointDownEvent = t; p = a.PointUpEventBase, n(f, p); var p, t = f; function f() { return null !== p && p.apply(this, arguments) || this } i.PointUpEvent = t; _ = a.PointMoveEventBase, n(g, _); var _, t = g; function g() { return null !== _ && _.apply(this, arguments) || this } i.PointMoveEvent = t; y = u.Object2D, n(m, y), Object.defineProperty(m.prototype, "onUpdate", { get: function () { return this._onUpdate || (this._onUpdate = new s.ChainTrigger(this.scene.onUpdate)), this._onUpdate }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "onMessage", { get: function () { return this._onMessage || (this._onMessage = new s.ChainTrigger(this.scene.onMessage)), this._onMessage }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "onPointDown", { get: function () { return this._onPointDown || (this._onPointDown = new s.ChainTrigger(this.scene.onPointDownCapture, this._isTargetOperation, this)), this._onPointDown }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "onPointUp", { get: function () { return this._onPointUp || (this._onPointUp = new s.ChainTrigger(this.scene.onPointUpCapture, this._isTargetOperation, this)), this._onPointUp }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "onPointMove", { get: function () { return this._onPointMove || (this._onPointMove = new s.ChainTrigger(this.scene.onPointMoveCapture, this._isTargetOperation, this)), this._onPointMove }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "touchable", { get: function () { return this._touchable }, set: function (t) { this._touchable !== t && ((this._touchable = t) ? this._enableTouchPropagation() : this._disableTouchPropagation()) }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "update", { get: function () { return this.onUpdate }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "message", { get: function () { return this.onMessage }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "pointDown", { get: function () { return this.onPointDown }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "pointUp", { get: function () { return this.onPointUp }, enumerable: !1, configurable: !0 }), Object.defineProperty(m.prototype, "pointMove", { get: function () { return this.onPointMove }, enumerable: !1, configurable: !0 }), m.prototype.render = function (t, e) { if (this.state &= -5, !(1 & this.state)) if (8 & this.state) { if (t.translate(this.x, this.y), this.renderSelf(t, e) && this.children) for (var i = (n = this.children).length, r = 0; r < i; ++r)n[r].render(t, e); t.translate(-this.x, -this.y) } else { t.save(), this.angle || 1 !== this.scaleX || 1 !== this.scaleY || 0 !== this.anchorX || 0 !== this.anchorY ? t.transform(this.getMatrix()._matrix) : t.translate(this.x, this.y), 1 !== this.opacity && t.opacity(this.opacity); var o = this.compositeOperation; if (void 0 !== o && t.setCompositeOperation("string" == typeof o ? o : l.Util.compositeOperationStringTable[o]), void 0 !== this.shaderProgram && t.isSupportedShaderProgram() && t.setShaderProgram(this.shaderProgram), this.renderSelf(t, e) && this.children) for (var n = this.children, r = 0; r < n.length; ++r)n[r].render(t, e); t.restore() } }, m.prototype.renderSelf = function (t, e) { return !0 }, m.prototype.game = function () { return this.scene.game }, m.prototype.append = function (t) { this.insertBefore(t, void 0) }, m.prototype.insertBefore = function (t, e) { t.parent && t.remove(), this.children || (this.children = []), t.parent = this; var i = -1; void 0 !== e && -1 < (i = this.children.indexOf(e)) ? this.children.splice(i, 0, t) : this.children.push(t), (t._touchable || t._hasTouchableChildren) && (this._hasTouchableChildren = !0, this._enableTouchPropagation()), this.modified(!0) }, m.prototype.remove = function (t) { if (void 0 === t) this.parent.remove(this); else { var e = this.children ? this.children.indexOf(t) : -1; if (e < 0) throw h.ExceptionFactory.createAssertionError("E#remove: invalid child"); this.children[e].parent = void 0, this.children.splice(e, 1), !t._touchable && !t._hasTouchableChildren || this._findTouchableChildren(this) || (this._hasTouchableChildren = !1, this._disableTouchPropagation()), this.modified(!0) } }, m.prototype.destroy = function () { if (this.parent && this.remove(), this.children) { for (var t = this.children.length - 1; 0 <= t; --t)this.children[t].destroy(); if (0 !== this.children.length) throw h.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, " + this.children.length); this.children = void 0 } this._onUpdate && (this._onUpdate.destroy(), this._onUpdate = void 0), this._onMessage && (this._onMessage.destroy(), this._onMessage = void 0), this._onPointDown && (this._onPointDown.destroy(), this._onPointDown = void 0), this._onPointMove && (this._onPointMove.destroy(), this._onPointMove = void 0), this._onPointUp && (this._onPointUp.destroy(), this._onPointUp = void 0), this.scene.unregister(this) }, m.prototype.destroyed = function () { return void 0 === this.scene }, m.prototype.modified = function (t) { this._matrix && (this._matrix._modified = !0), this.angle || 1 !== this.scaleX || 1 !== this.scaleY || 0 !== this.anchorX || 0 !== this.anchorY || 1 !== this.opacity || void 0 !== this.compositeOperation || void 0 !== this.shaderProgram ? this.state &= -9 : this.state |= 8, 4 & this.state || (this.state |= 4, this.parent && this.parent.modified(!0)) }, m.prototype.shouldFindChildrenByPoint = function (t) { return !0 }, m.prototype.findPointSourceByPoint = function (t, e, i) { if (!(1 & this.state)) { var r = (e = e ? e.multiplyNew(this.getMatrix()) : this.getMatrix().clone()).multiplyInverseForPoint(t); if (this._hasTouchableChildren || i && this.children && this.children.length) { var o = this.children; if (this.shouldFindChildrenByPoint(r)) for (var n = o.length - 1; 0 <= n; --n) { var s = o[n]; if (i || s._touchable || s._hasTouchableChildren) { s = s.findPointSourceByPoint(t, e, i); if (s) return s } } } return i || this._touchable ? 0 <= r.x && this.width > r.x && 0 <= r.y && this.height > r.y ? { target: this, point: r } : void 0 : void 0 } }, m.prototype.visible = function () { return 1 != (1 & this.state) }, m.prototype.show = function () { 1 & this.state && (this.state &= -2, this.parent && this.parent.modified(!0)) }, m.prototype.hide = function () { 1 & this.state || (this.state |= 1, this.parent && this.parent.modified(!0)) }, m.prototype.calculateBoundingRect = function () { return this._calculateBoundingRect(void 0) }, m.prototype.localToGlobal = function (t) { for (var e = t, i = this; i instanceof m; i = i.parent)e = i.getMatrix().multiplyPoint(e); return e }, m.prototype.globalToLocal = function (t) { for (var e = new c.PlainMatrix, i = this; i instanceof m; i = i.parent)e.multiplyLeft(i.getMatrix()); return e.multiplyInverseForPoint(t) }, m.prototype._calculateMatrixTo = function (t) { for (var e = new c.PlainMatrix, i = this; i instanceof m && i !== t; i = i.parent)e.multiplyLeft(i.getMatrix()); return e }, m.prototype._findLowestCommonAncestorWith = function (t) { for (var e = {}, i = this; i instanceof m; i = i.parent)e[i.id] = !0; for (var r = t; r instanceof m && !e.hasOwnProperty(r.id); r = r.parent); return r }, m.prototype._calculateBoundingRect = function (t) { var e = this.getMatrix(); if (t && (e = t.multiplyNew(e)), this.visible()) { for (var t = { left: 0, right: this.width, top: 0, bottom: this.height }, i = [{ x: t.left, y: t.top }, { x: t.left, y: t.bottom }, { x: t.right, y: t.top }, { x: t.right, y: t.bottom }], r = e.multiplyPoint(i[0]), o = { left: r.x, right: r.x, top: r.y, bottom: r.y }, n = 1; n < i.length; ++n)r = e.multiplyPoint(i[n]), o.left > r.x && (o.left = r.x), o.right < r.x && (o.right = r.x), o.top > r.y && (o.top = r.y), o.bottom < r.y && (o.bottom = r.y); if (void 0 !== this.children) for (n = 0; n < this.children.length; ++n) { var s = this.children[n]._calculateBoundingRect(e); s && (o.left > s.left && (o.left = s.left), o.right < s.right && (o.right = s.right), o.top > s.top && (o.top = s.top), o.bottom < s.bottom && (o.bottom = s.bottom)) } return o } }, m.prototype._enableTouchPropagation = function () { for (var t = this.parent; t instanceof m && !t._hasTouchableChildren;)t._hasTouchableChildren = !0, t = t.parent }, m.prototype._disableTouchPropagation = function () { for (var t = this.parent; t instanceof m && t._hasTouchableChildren && !this._findTouchableChildren(t);)t._hasTouchableChildren = !1, t = t.parent }, m.prototype._isTargetOperation = function (t) { return !(1 & this.state) && (t instanceof a.PointEventBase && (this._touchable && t.target === this)) }, m.prototype._findTouchableChildren = function (t) { if (t.children) for (var e = 0; e < t.children.length; ++e) { if (t.children[e].touchable) return t.children[e]; var i = this._findTouchableChildren(t.children[e]); if (i) return i } }; var y, t = m; function m(t) { var e = y.call(this, t) || this; if (e.children = void 0, e.parent = void 0, e._touchable = !1, e.state = 0, e._hasTouchableChildren = !1, e._onUpdate = void 0, e._onMessage = void 0, e._onPointDown = void 0, e._onPointMove = void 0, e._onPointUp = void 0, e.tag = t.tag, e.shaderProgram = t.shaderProgram, e.local = "non-local" !== t.scene.local || !!t.local, t.children) for (var i = 0; i < t.children.length; ++i)e.append(t.children[i]); return t.parent && t.parent.append(e), null != t.touchable && (e.touchable = t.touchable), t.hidden && e.hide(), e.id = t.id, t.scene.register(e), e } i.E = t }, { "../Event": 20, "../ExceptionFactory": 26, "../Matrix": 34, "../Object2D": 38, "../Util": 67, "@akashic/trigger": 223 }], 78: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.FilledRect = void 0, t("../ExceptionFactory")), t = t("./E"), t = (o = t.E, n(a, o), a.prototype.renderSelf = function (t) { return t.fillRect(0, 0, this.width, this.height, this.cssColor), !0 }, a); function a(t) { var e = o.call(this, t) || this; if ("string" != typeof t.cssColor) throw s.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)", "string", t.cssColor); return e.cssColor = t.cssColor, e } i.FilledRect = t }, { "../ExceptionFactory": 26, "./E": 77 }], 79: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.FrameSprite = void 0, t("@akashic/trigger")), t = t("./Sprite"), t = (o = t.Sprite, n(a, o), a.createBySprite = function (t, e, i) { var r = new a({ scene: t.scene, src: t.src, width: void 0 === e ? t.width : e, height: void 0 === i ? t.height : i }); return r.srcHeight = void 0 === i ? t.srcHeight : i, r.srcWidth = void 0 === e ? t.srcWidth : e, r }, a.prototype.start = function () { void 0 === this.interval && (this.interval = 1e3 / this.game().fps), this._timer && this._free(), this._timer = this.scene.createTimer(this.interval), this._timer.onElapse.add(this._handleElapse, this) }, a.prototype.destroy = function (t) { this.stop(), o.prototype.destroy.call(this, t) }, a.prototype.stop = function () { this._timer && this._free() }, a.prototype.modified = function (t) { this._modifiedSelf(t), o.prototype.modified.call(this, t) }, a.prototype._handleElapse = function () { this.frameNumber === this.frames.length - 1 ? this.loop ? this.frameNumber = 0 : (this.stop(), this.onFinish.fire()) : this.frameNumber++, this.modified() }, a.prototype._free = function () { this._timer && (this._timer.onElapse.remove(this._handleElapse, this), this._timer.canDelete() && this.scene.deleteTimer(this._timer), this._timer = void 0) }, a.prototype._changeFrame = function () { var t = this.frames[this.frameNumber], e = Math.floor(this._surface.width / this.srcWidth); this.srcX = t % e * this.srcWidth, this.srcY = Math.floor(t / e) * this.srcHeight, this._lastUsedIndex = t }, a.prototype._modifiedSelf = function (t) { this._lastUsedIndex !== this.frames[this.frameNumber] && this._changeFrame() }, a); function a(t) { var e = o.call(this, t) || this; return e._lastUsedIndex = 0, e.frameNumber = t.frameNumber || 0, e.frames = null != t.frames ? t.frames : [0], e.interval = t.interval, e._timer = void 0, e.loop = null == t.loop || t.loop, e.onFinish = new s.Trigger, e.finished = e.onFinish, e._modifiedSelf(), e } i.FrameSprite = t }, { "./Sprite": 82, "@akashic/trigger": 223 }], 80: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), h = (Object.defineProperty(i, "__esModule", { value: !0 }), i.Label = void 0, t("../TextAlign")), c = t("../Util"), s = t("./CacheableE"), t = (o = s.CacheableE, n(a, o), a.prototype.aligning = function (t, e) { this.width = t, this.widthAutoAdjust = !1, this.textAlign = e }, a.prototype.invalidate = function () { this._invalidateSelf(), o.prototype.invalidate.call(this) }, a.prototype.renderSelfFromCache = function (t) { var e; switch (this._realTextAlign) { case "center": e = this.widthAutoAdjust ? this._overhangLeft : 0; break; case "right": e = this.widthAutoAdjust ? this._overhangLeft : this._overhangRight; break; default: e = this._overhangLeft }t.drawImage(this._cache, 0, 0, this._cacheSize.width + s.CacheableE.PADDING, this._cacheSize.height + s.CacheableE.PADDING, e, 0) }, a.prototype.renderCache = function (t) { if (!(!this.fontSize || this.height <= 0 || this._textWidth <= 0)) { var e = this.maxWidth && 0 < this.maxWidth && this.maxWidth < this._textWidth ? this.maxWidth / this._textWidth : 1, i = 0; switch (this._realTextAlign) { case "center": i = this.width / 2 - (this._textWidth + this._overhangLeft) / 2 * e; break; case "right": i = this.width - (this._textWidth + this._overhangLeft) * e; break; default: i -= this._overhangLeft * e }t.translate(Math.round(i), 0), 1 != e && t.transform([e, 0, 0, 1, 0, 0]), t.save(); for (var r = this.fontSize / this.font.size, o = 0, n = 0; n < this.glyphs.length; ++n) { var s = this.glyphs[n], a = s.advanceWidth * r, h = s.code; s.isSurfaceValid || (s = this.font.glyphForCharacter(h)) ? (s.surface && (t.save(), t.translate(Math.round(o), 0), t.transform([r, 0, 0, r, 0, 0]), t.drawImage(s.surface, s.x, s.y, s.width, s.height, s.offsetX, s.offsetY), t.restore()), o += a) : this._outputOfWarnLogWithNoGlyph(h, "renderCache()") } t.restore(), t.save(), this.textColor && (t.setCompositeOperation("source-atop"), t.fillRect(0, 0, this._textWidth, this.height, this.textColor)), t.restore() } }, a.prototype.destroy = function () { o.prototype.destroy.call(this) }, a.prototype._invalidateSelf = function () { this.glyphs.length = 0, this._textWidth = 0; var t = this.textAlign; if (this._realTextAlign = "string" == typeof t ? t : c.Util.enumToSnakeCase(h.TextAlign, t), this.fontSize) { for (var e = this.text.length - 1, i = this.text.length - 1; 0 <= i; --i) { var r = c.Util.charCodeAt(this.text, i); if (r) if ((o = this.font.glyphForCharacter(r)) && 0 !== o.width && 0 !== o.advanceWidth) { e = i; break } } for (var o, n, s = 0, a = 0 < this.font.size ? this.fontSize / this.font.size : 0, i = 0; i <= e; ++i)(r = c.Util.charCodeAt(this.text, i)) && ((o = this.font.glyphForCharacter(r)) ? o.width < 0 || o.height < 0 || o.x < 0 || o.y < 0 || (this.glyphs.push(o), (n = 0) === i && (this._overhangLeft = Math.min(o.offsetX, 0), n = -this._overhangLeft), i === e && (this._overhangRight = Math.max(o.width + o.offsetX - o.advanceWidth, 0), n += this._overhangRight), this._textWidth += (o.advanceWidth + n) * a, s < (n = o.offsetY + o.height) && (s = n)) : this._outputOfWarnLogWithNoGlyph(r, "_invalidateSelf()")); this.widthAutoAdjust && (this.width = this._textWidth), this.height = s * a } else this.height = 0 }, a.prototype._outputOfWarnLogWithNoGlyph = function (t, e) { t = 4294901760 & t ? String.fromCharCode((4294901760 & t) >>> 16, 65535 & t) : String.fromCharCode(t); console.warn("Label#" + e + ": failed to get a glyph for '" + t + "' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).") }, a); function a(t) { var e = o.call(this, t) || this; return e.text = t.text, e.font = t.font, e.textAlign = null != t.textAlign ? t.textAlign : h.TextAlign.Left, e.glyphs = new Array(t.text.length), e.fontSize = null != t.fontSize ? t.fontSize : t.font.size, e.maxWidth = t.maxWidth, e.widthAutoAdjust = null == t.widthAutoAdjust || t.widthAutoAdjust, e.textColor = t.textColor, e._realTextAlign = "left", e._textWidth = 0, e._overhangLeft = 0, e._overhangRight = 0, e._invalidateSelf(), e } i.Label = t }, { "../TextAlign": 61, "../Util": 67, "./CacheableE": 75 }], 81: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.Pane = void 0, t("../SurfaceUtil")), t = t("./CacheableE"), t = (o = t.CacheableE, n(a, o), Object.defineProperty(a.prototype, "padding", { get: function () { return this._padding }, set: function (t) { this._padding = t, this._paddingChanged = !0 }, enumerable: !1, configurable: !0 }), a.prototype.modified = function (t) { t && (this.state &= -3), o.prototype.modified.call(this) }, a.prototype.shouldFindChildrenByPoint = function (t) { var e = this._normalizedPadding; return e.left < t.x && this.width - e.right > t.x && e.top < t.y && this.height - e.bottom > t.y }, a.prototype.renderCache = function (t, e) { this.width <= 0 || this.height <= 0 || (this._renderBackground(), this._renderChildren(e), this._bgSurface ? t.drawImage(this._bgSurface, 0, 0, this.width, this.height, 0, 0) : this._backgroundImageSurface && t.drawImage(this._backgroundImageSurface, 0, 0, this.width, this.height, 0, 0), this._childrenArea.width <= 0 || this._childrenArea.height <= 0 || (t.save(), 0 === this._childrenArea.x && 0 === this._childrenArea.y || t.translate(this._childrenArea.x, this._childrenArea.y), t.drawImage(this._childrenSurface, 0, 0, this._childrenArea.width, this._childrenArea.height, 0, 0), t.restore())) }, a.prototype.destroy = function (t) { t && this._backgroundImageSurface && !this._backgroundImageSurface.destroyed() && this._backgroundImageSurface.destroy(), this._bgSurface && !this._bgSurface.destroyed() && this._bgSurface.destroy(), this._childrenSurface && !this._childrenSurface.destroyed() && this._childrenSurface.destroy(), this.backgroundImage = void 0, this._backgroundImageSurface = void 0, this._beforeBackgroundImage = void 0, this._bgSurface = void 0, this._childrenSurface = void 0, o.prototype.destroy.call(this) }, a.prototype._renderBackground = function () { var t; this.backgroundImage !== this._beforeBackgroundImage && (this._backgroundImageSurface = s.SurfaceUtil.asSurface(this.backgroundImage), this._beforeBackgroundImage = this.backgroundImage), this._backgroundImageSurface && this.backgroundEffector ? (t = this.backgroundEffector.render(this._backgroundImageSurface, this.width, this.height), this._bgSurface !== t && (this._bgSurface && !this._bgSurface.destroyed() && this._bgSurface.destroy(), this._bgSurface = t)) : this._bgSurface = void 0 }, a.prototype._renderChildren = function (t) { var e = this._oldWidth !== this.width || this._oldHeight !== this.height || this._paddingChanged; if (e && (this._initialize(), this._paddingChanged = !1, this._oldWidth = this.width, this._oldHeight = this.height), this._childrenRenderer.begin(), e || this._childrenRenderer.clear(), this.children) for (var i = this.children, r = 0; r < i.length; ++r)i[r].render(this._childrenRenderer, t); this._childrenRenderer.end() }, a.prototype._initialize = function () { var t = this._padding, t = "number" == typeof t ? { top: t, bottom: t, left: t, right: t } : this._padding, e = (this._childrenArea = { x: t.left, y: t.top, width: this.width - t.left - t.right, height: this.height - t.top - t.bottom }, this.scene.game.resourceFactory); this._childrenSurface && !this._childrenSurface.destroyed() && this._childrenSurface.destroy(), this._childrenSurface = e.createSurface(Math.ceil(this._childrenArea.width), Math.ceil(this._childrenArea.height)), this._childrenRenderer = this._childrenSurface.renderer(), this._normalizedPadding = t }, a.prototype._calculateBoundingRect = function (t) { var e = this.getMatrix(); if (t && (e = t.multiplyNew(e)), this.visible()) { for (var t = { left: 0, right: this.width, top: 0, bottom: this.height }, i = [{ x: t.left, y: t.top }, { x: t.left, y: t.bottom }, { x: t.right, y: t.top }, { x: t.right, y: t.bottom }], r = e.multiplyPoint(i[0]), o = { left: r.x, right: r.x, top: r.y, bottom: r.y }, n = 1; n < i.length; ++n)r = e.multiplyPoint(i[n]), o.left > r.x && (o.left = r.x), o.right < r.x && (o.right = r.x), o.top > r.y && (o.top = r.y), o.bottom < r.y && (o.bottom = r.y); return o } }, a); function a(t) { var e = o.call(this, t) || this; return e._oldWidth = t.width, e._oldHeight = t.height, e.backgroundImage = t.backgroundImage, e._beforeBackgroundImage = t.backgroundImage, e._backgroundImageSurface = s.SurfaceUtil.asSurface(t.backgroundImage), e.backgroundEffector = t.backgroundEffector, e._shouldRenderChildren = !1, e._padding = t.padding || 0, e._initialize(), e._paddingChanged = !1, e } i.Pane = t }, { "../SurfaceUtil": 60, "./CacheableE": 75 }], 82: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.Sprite = void 0, t("../Matrix")), a = t("../SurfaceUtil"), t = t("./E"), t = (o = t.E, n(h, o), h.prototype._handleUpdate = function () { this.modified() }, h.prototype._handleAnimationStart = function () { this.onUpdate.contains(this._handleUpdate, this) || this.onUpdate.add(this._handleUpdate, this) }, h.prototype._handleAnimationStop = function () { this.destroyed() || this.onUpdate.remove(this._handleUpdate, this) }, h.prototype.renderSelf = function (t, e) { return this.srcWidth <= 0 || this.srcHeight <= 0 || (this._stretchMatrix && (t.save(), t.transform(this._stretchMatrix._matrix)), t.drawImage(this._surface, this.srcX, this.srcY, this.srcWidth, this.srcHeight, 0, 0), this._stretchMatrix && t.restore()), !0 }, h.prototype.invalidate = function () { this._invalidateSelf(), this.modified() }, h.prototype.destroy = function (t) { this._surface && !this._surface.destroyed() && t && this._surface.destroy(), this.src = void 0, this._beforeSrc = void 0, this._surface = void 0, o.prototype.destroy.call(this) }, h.prototype._invalidateSelf = function () { this.width === this.srcWidth && this.height === this.srcHeight ? this._stretchMatrix = void 0 : (this._stretchMatrix = new s.PlainMatrix, this._stretchMatrix.scale(this.width / this.srcWidth, this.height / this.srcHeight)), this.src !== this._beforeSrc && (this._beforeSrc = this.src, "_drawable" in this.src ? this._surface = this.src : this._surface = a.SurfaceUtil.asSurface(this.src)), this._surface !== this._beforeSurface && (a.SurfaceUtil.migrateAnimatingHandler(this, this._beforeSurface, this._surface), this._beforeSurface = this._surface) }, h); function h(t) { var e = o.call(this, t) || this; return e.src = t.src, "_drawable" in t.src ? e._surface = t.src : e._surface = a.SurfaceUtil.asSurface(t.src), null == t.width && (e.width = e._surface.width), null == t.height && (e.height = e._surface.height), e.srcWidth = null != t.srcWidth ? t.srcWidth : e.width, e.srcHeight = null != t.srcHeight ? t.srcHeight : e.height, e.srcX = t.srcX || 0, e.srcY = t.srcY || 0, e._stretchMatrix = void 0, e._beforeSrc = e.src, e._beforeSurface = e._surface, a.SurfaceUtil.setupAnimatingHandler(e, e._surface), e._invalidateSelf(), e } i.Sprite = t }, { "../Matrix": 34, "../SurfaceUtil": 60, "./E": 77 }], 83: [function (t, e, i) { "use strict"; var r = this && this.__createBinding || (Object.create ? function (t, e, i, r) { void 0 === r && (r = i); var o = Object.getOwnPropertyDescriptor(e, i); o && ("get" in o ? e.__esModule : !o.writable && !o.configurable) || (o = { enumerable: !0, get: function () { return e[i] } }), Object.defineProperty(t, r, o) } : function (t, e, i, r) { t[r = void 0 === r ? i : r] = e[i] }), o = this && this.__exportStar || function (t, e) { for (var i in t) "default" === i || Object.prototype.hasOwnProperty.call(e, i) || r(e, t, i) }, n = (Object.defineProperty(i, "__esModule", { value: !0 }), i.VideoSystem = i.ShaderProgram = i.Module = i.AudioSystem = void 0, o(t("@akashic/game-configuration"), i), o(t("@akashic/trigger"), i), o(t("@akashic/pdi-types"), i), t("./AudioSystem")), s = (Object.defineProperty(i, "AudioSystem", { enumerable: !0, get: function () { return n.AudioSystem } }), t("./Module")), a = (Object.defineProperty(i, "Module", { enumerable: !0, get: function () { return s.Module } }), t("./ShaderProgram")), h = (Object.defineProperty(i, "ShaderProgram", { enumerable: !0, get: function () { return a.ShaderProgram } }), t("./VideoSystem")); Object.defineProperty(i, "VideoSystem", { enumerable: !0, get: function () { return h.VideoSystem } }), o(t("./AudioSystem"), i), o(t("./entities/CacheableE"), i), o(t("./entities/E"), i), o(t("./entities/FilledRect"), i), o(t("./entities/FrameSprite"), i), o(t("./entities/Label"), i), o(t("./entities/Pane"), i), o(t("./entities/Sprite"), i), o(t("./AssetAccessor"), i), o(t("./AssetGenerationConfiguration"), i), o(t("./AssetHolder"), i), o(t("./AssetLoadFailureInfo"), i), o(t("./AssetManager"), i), o(t("./AssetManagerLoadHandler"), i), o(t("./AudioSystemManager"), i), o(t("./BitmapFont"), i), o(t("./Camera"), i), o(t("./Camera2D"), i), o(t("./Collision"), i), o(t("./DefaultLoadingScene"), i), o(t("./DefaultSkippingScene"), i), o(t("./DynamicAssetConfiguration"), i), o(t("./DynamicFont"), i), o(t("./EntityStateFlags"), i), o(t("./Event"), i), o(t("./EventConverter"), i), o(t("./EventFilter"), i), o(t("./EventFilterController"), i), o(t("./EventIndex"), i), o(t("./EventPriority"), i), o(t("./ExceptionFactory"), i), o(t("./Font"), i), o(t("./GameMainParameterObject"), i), o(t("./InternalOperationPluginInfo"), i), o(t("./LoadingScene"), i), o(t("./LocalTickModeString"), i), o(t("./Matrix"), i), o(t("./Module"), i), o(t("./ModuleManager"), i), o(t("./NinePatchSurfaceEffector"), i), o(t("./Object2D"), i), o(t("./OperationPlugin"), i), o(t("./OperationPluginManager"), i), o(t("./OperationPluginOperation"), i), o(t("./OperationPluginStatic"), i), o(t("./PathUtil"), i), o(t("./Player"), i), o(t("./PointEventResolver"), i), o(t("./RandomGenerator"), i), o(t("./Require"), i), o(t("./RequireCacheable"), i), o(t("./RequireCachedValue"), i), o(t("./ScriptAssetContext"), i), o(t("./ShaderProgram"), i), o(t("./SnapshotSaveRequest"), i), o(t("./SpriteFactory"), i), o(t("./Storage"), i), o(t("./SurfaceAtlas"), i), o(t("./SurfaceAtlasSet"), i), o(t("./SurfaceAtlasSlot"), i), o(t("./SurfaceEffector"), i), o(t("./SurfaceUtil"), i), o(t("./TextAlign"), i), o(t("./TextAlignString"), i), o(t("./TextMetrics"), i), o(t("./TickGenerationModeString"), i), o(t("./Timer"), i), o(t("./TimerManager"), i), o(t("./Util"), i), o(t("./VideoSystem"), i), o(t("./WeakRefKVS"), i), o(t("./Xorshift"), i), o(t("./XorshiftRandomGenerator"), i), o(t("./Scene"), i), o(t("./Game"), i) }, { "./AssetAccessor": 3, "./AssetGenerationConfiguration": 4, "./AssetHolder": 5, "./AssetLoadFailureInfo": 6, "./AssetManager": 7, "./AssetManagerLoadHandler": 8, "./AudioSystem": 9, "./AudioSystemManager": 10, "./BitmapFont": 11, "./Camera": 12, "./Camera2D": 13, "./Collision": 14, "./DefaultLoadingScene": 15, "./DefaultSkippingScene": 16, "./DynamicAssetConfiguration": 17, "./DynamicFont": 18, "./EntityStateFlags": 19, "./Event": 20, "./EventConverter": 21, "./EventFilter": 22, "./EventFilterController": 23, "./EventIndex": 24, "./EventPriority": 25, "./ExceptionFactory": 26, "./Font": 27, "./Game": 28, "./GameMainParameterObject": 30, "./InternalOperationPluginInfo": 31, "./LoadingScene": 32, "./LocalTickModeString": 33, "./Matrix": 34, "./Module": 35, "./ModuleManager": 36, "./NinePatchSurfaceEffector": 37, "./Object2D": 38, "./OperationPlugin": 39, "./OperationPluginManager": 40, "./OperationPluginOperation": 41, "./OperationPluginStatic": 42, "./PathUtil": 43, "./Player": 44, "./PointEventResolver": 45, "./RandomGenerator": 46, "./Require": 47, "./RequireCacheable": 48, "./RequireCachedValue": 49, "./Scene": 50, "./ScriptAssetContext": 51, "./ShaderProgram": 52, "./SnapshotSaveRequest": 53, "./SpriteFactory": 54, "./Storage": 55, "./SurfaceAtlas": 56, "./SurfaceAtlasSet": 57, "./SurfaceAtlasSlot": 58, "./SurfaceEffector": 59, "./SurfaceUtil": 60, "./TextAlign": 61, "./TextAlignString": 62, "./TextMetrics": 63, "./TickGenerationModeString": 64, "./Timer": 65, "./TimerManager": 66, "./Util": 67, "./VideoSystem": 68, "./WeakRefKVS": 69, "./Xorshift": 70, "./XorshiftRandomGenerator": 71, "./entities/CacheableE": 75, "./entities/E": 77, "./entities/FilledRect": 78, "./entities/FrameSprite": 79, "./entities/Label": 80, "./entities/Pane": 81, "./entities/Sprite": 82, "@akashic/game-configuration": 90, "@akashic/pdi-types": 203, "@akashic/trigger": 223 }], 84: [function (t, e, i) { "use strict"; var r = this && this.__createBinding || (Object.create ? function (t, e, i, r) { void 0 === r && (r = i); var o = Object.getOwnPropertyDescriptor(e, i); o && ("get" in o ? e.__esModule : !o.writable && !o.configurable) || (o = { enumerable: !0, get: function () { return e[i] } }), Object.defineProperty(t, r, o) } : function (t, e, i, r) { t[r = void 0 === r ? i : r] = e[i] }), o = this && this.__exportStar || function (t, e) { for (var i in t) "default" === i || Object.prototype.hasOwnProperty.call(e, i) || r(e, t, i) }; Object.defineProperty(i, "__esModule", { value: !0 }), o(t("./index.common"), i), o(t("./GameHandlerSet"), i) }, { "./GameHandlerSet": 29, "./index.common": 83 }], 85: [function (t, e, i) { "use strict"; function r(t) { this._tickHandlers = [], this._eventHandlers = [], this._events = [], this._tickList = null, this._playId = t.playId, this._putStorageDataSyncFunc = t.putStorageDataSyncFunc || function () { throw new Error("Implementation not given") }, this._getStorageDataSyncFunc = t.getStorageDataSyncFunc || function () { throw new Error("Implementation not given") }, t.startPoints ? (t.tickList && (this._tickList = t.tickList), this._startPoints = t.startPoints) : this._startPoints = [] } function o(i) { return i && "object" == typeof i ? Array.isArray(i) ? i.map(o) : Object.keys(i).reduce(function (t, e) { return t[e] = o(i[e]), t }, {}) : i } Object.defineProperty(i, "__esModule", { value: !0 }), i._cloneDeep = i.MemoryAmflowClient = void 0, r.prototype.dump = function () { return { tickList: this._tickList, startPoints: this._startPoints } }, r.prototype.open = function (t, e) { var i = this; setTimeout(function () { e && (t !== i._playId ? e(new Error("MemoryAmflowClient#open: unknown playId")) : e(null)) }, 0) }, r.prototype.close = function (t) { t && setTimeout(function () { t(null) }, 0) }, r.prototype.authenticate = function (t, e) { setTimeout(function () { switch (t) { case r.TOKEN_ACTIVE: e(null, { writeTick: !0, readTick: !0, subscribeTick: !1, sendEvent: !1, subscribeEvent: !0, maxEventPriority: 2 }); break; case r.TOKEN_PASSIVE: e(null, { writeTick: !1, readTick: !0, subscribeTick: !0, sendEvent: !0, subscribeEvent: !1, maxEventPriority: 2 }); break; default: e(null, { writeTick: !0, readTick: !0, subscribeTick: !0, sendEvent: !0, subscribeEvent: !0, maxEventPriority: 2 }) } }, 0) }, r.prototype.sendTick = function (e) { if (e = o(e), this._tickList) { if (this._tickList[0] <= e[0] && e[0] <= this._tickList[1]) throw new Error("illegal age tick"); this._tickList[1] = e[0] } else this._tickList = [e[0], e[0], []]; var t = e[1], i = e[2]; (t || i) && (t && (e[1] = t.filter(function (t) { return !(8 & t[1]) })), this._tickList[2].push(e)), this._tickHandlers.forEach(function (t) { return t(e) }) }, r.prototype.onTick = function (t) { this._tickHandlers.push(t) }, r.prototype.offTick = function (e) { this._tickHandlers = this._tickHandlers.filter(function (t) { return t !== e }) }, r.prototype.sendEvent = function (e) { e = o(e), 0 === this._eventHandlers.length ? this._events.push(e) : this._eventHandlers.forEach(function (t) { return t(e) }) }, r.prototype.onEvent = function (t) { var i = this; this._eventHandlers.push(t), 0 < this._events.length && (this._events.forEach(function (e) { i._eventHandlers.forEach(function (t) { return t(e) }) }), this._events = []) }, r.prototype.offEvent = function (e) { this._eventHandlers = this._eventHandlers.filter(function (t) { return t !== e }) }, r.prototype.getTickList = function (t, e, i) { var r, o, n, s, a = "number" == typeof t ? (r = { begin: t, end: e }, i) : (r = t, e); this._tickList ? (o = Math.max(r.begin, this._tickList[0]), n = Math.min(r.end, this._tickList[1]), i = this._tickList[2].filter(function (t) { t = t[0]; return o <= t && t <= n }), s = [o, n, i], setTimeout(function () { return a(null, s) }, 0)) : a && setTimeout(function () { return a(null) }, 0) }, r.prototype.putStartPoint = function (t, e) { var i = this; setTimeout(function () { i._startPoints.push(t), e(null) }, 0) }, r.prototype.getStartPoint = function (s, a) { var h = this; setTimeout(function () { if (h._startPoints && 0 !== h._startPoints.length) { var t = 0; if (null != s.frame) for (var e = h._startPoints[0].frame, i = 1; i < h._startPoints.length; ++i) { var r = h._startPoints[i].frame; r <= s.frame && e < r && (e = r, t = i) } else for (var o = h._startPoints[0].timestamp, i = 1; i < h._startPoints.length; ++i) { var n = h._startPoints[i].timestamp; n <= s.timestamp && o < n && (o = n, t = i) } a(null, h._startPoints[t]) } else a(new Error("no startpoint")) }, 0) }, r.prototype.putStorageData = function (t, e, i, r) { var o = this; setTimeout(function () { try { o._putStorageDataSyncFunc(t, e, i), r(null) } catch (t) { r(t) } }, 0) }, r.prototype.getStorageData = function (e, i) { var r = this; setTimeout(function () { try { var t = r._getStorageDataSyncFunc(e); i(null, t) } catch (t) { i(t) } }, 0) }, r.prototype.dropAfter = function (e) { var i, t; this._tickList && (i = this._tickList[0], t = this._tickList[1], e <= i ? (this._tickList = null, this._startPoints = []) : e <= t && (this._tickList[1] = e - 1, this._tickList[2] = this._tickList[2].filter(function (t) { t = t[0]; return i <= t && t <= e - 1 }), this._startPoints = this._startPoints.filter(function (t) { return t.frame < e }))) }, r.TOKEN_ACTIVE = "mamfc-token:active", r.TOKEN_PASSIVE = "mamfc-token:passive", i.MemoryAmflowClient = r, i._cloneDeep = o }, {}], 86: [function (t, e, i) { "use strict"; function r(t) { this._amflow = t.amflow, this._tickList = t.tickList, this._startPoints = t.startPoints } Object.defineProperty(i, "__esModule", { value: !0 }), i.ReplayAmflowProxy = void 0, r.prototype.dropAfter = function (e) { var t, i, r; this._tickList && (t = this._tickList[0], i = this._tickList[1], r = this._tickList[2] || [], e <= t ? (this._tickList = null, this._startPoints = []) : e <= i && (this._tickList[1] = e - 1, this._tickList[2] = this._sliceTicks(r, i, e - 1), this._startPoints = this._startPoints.filter(function (t) { return t.frame < e }))) }, r.prototype.open = function (t, e) { this._amflow.open(t, e) }, r.prototype.close = function (t) { this._amflow.close(t) }, r.prototype.authenticate = function (t, e) { this._amflow.authenticate(t, e) }, r.prototype.sendTick = function (t) { this._amflow.sendTick(t) }, r.prototype.onTick = function (t) { this._amflow.onTick(t) }, r.prototype.offTick = function (t) { this._amflow.offTick(t) }, r.prototype.sendEvent = function (t) { this._amflow.sendEvent(t) }, r.prototype.onEvent = function (t) { this._amflow.onEvent(t) }, r.prototype.offEvent = function (t) { this._amflow.offEvent(t) }, r.prototype.getTickList = function (t, e, i) { var r, o, n, s, a, h, c, u, l = this, d = "number" == typeof t ? (r = { begin: t, end: e }, i) : (r = t, e); this._tickList ? (o = r.begin, n = r.end, s = this._tickList[0], a = this._tickList[1], h = this._tickList[2] || [], u = s <= n && n <= a, (c = s <= o && o <= a) && u ? setTimeout(function () { d(null, [o, n, l._sliceTicks(h, o, n)]) }, 0) : this._amflow.getTickList({ begin: o, end: n }, function (t, e) { var i, r; t ? d(t) : e ? c || u ? c ? (i = l._sliceTicks(h, o, n).concat(e[2] || []), d(null, [o, e[1], i])) : (i = (e[2] || []).concat(l._sliceTicks(h, o, n)), d(null, [e[0], n, i])) : n < s || a < o ? d(null, e) : (i = (i = e[2]) ? (t = l._sliceTicks(i, o, s - 1), r = l._sliceTicks(i, a + 1, n), t.concat(h, r)) : h, d(null, [o, n, i])) : d(null, c || u ? c ? [o, a, l._sliceTicks(h, o, n)] : [s, n, l._sliceTicks(h, o, n)] : n < s || a < o ? e : [s, a, l._sliceTicks(h, o, n)]) })) : this._amflow.getTickList(r, d) }, r.prototype.putStartPoint = function (t, e) { this._amflow.putStartPoint(t, e) }, r.prototype.getStartPoint = function (t, i) { var r = this, o = 0; if (0 < this._startPoints.length) if (null != t.frame) for (var e = this._startPoints[0].frame, n = 1; n < this._startPoints.length; ++n) { var s = this._startPoints[n].frame; s <= t.frame && e < s && (e = s, o = n) } else for (var a = this._startPoints[0].timestamp, n = 1; n < this._startPoints.length; ++n) { var h = this._startPoints[n].timestamp; h <= t.timestamp && a < h && (a = h, o = n) } var c = this._tickList ? this._tickList[1] : -1; "number" == typeof t.frame && t.frame > c ? this._amflow.getStartPoint(t, function (t, e) { t ? i(t) : e && c < e.frame ? i(null, e) : i(null, r._startPoints[o]) }) : setTimeout(function () { i(null, r._startPoints[o]) }, 0) }, r.prototype.putStorageData = function (t, e, i, r) { this._amflow.putStorageData(t, e, i, r) }, r.prototype.getStorageData = function (t, e) { this._amflow.getStorageData(t, e) }, r.prototype._sliceTicks = function (t, e, i) { return t.filter(function (t) { t = t[0]; return e <= t && t <= i }) }, i.ReplayAmflowProxy = r }, {}], 87: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }) }, {}], 88: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 89: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 90: [function (t, e, i) { "use strict"; var r = this && this.__createBinding || (Object.create ? function (t, e, i, r) { void 0 === r && (r = i); var o = Object.getOwnPropertyDescriptor(e, i); o && ("get" in o ? e.__esModule : !o.writable && !o.configurable) || (o = { enumerable: !0, get: function () { return e[i] } }), Object.defineProperty(t, r, o) } : function (t, e, i, r) { t[r = void 0 === r ? i : r] = e[i] }), o = this && this.__exportStar || function (t, e) { for (var i in t) "default" === i || Object.prototype.hasOwnProperty.call(e, i) || r(e, t, i) }; Object.defineProperty(i, "__esModule", { value: !0 }), o(t("./AssetConfiguration"), i), o(t("./GameConfiguration"), i), o(t("./OperationPluginInfo"), i) }, { "./AssetConfiguration": 87, "./GameConfiguration": 88, "./OperationPluginInfo": 89 }], 91: [function (t, e, i) { "use strict"; var h; Object.defineProperty(i, "__esModule", { value: !0 }), i.PathUtil = void 0, (h = i.PathUtil || (i.PathUtil = {})).resolvePath = function (t, e) { function i(t) { t = t.split("/"); return "" === t[t.length - 1] && t.pop(), t } if ("" === e) return t; for (var r = i((t = h.splitPath(t)).path).concat(i(e)), o = [], n = 0; n < r.length; ++n) { var s = r[n]; switch (s) { case "..": var a = o.pop(); if (void 0 === a || "" === a || "." === a) throw new Error("PathUtil.resolvePath: invalid arguments"); break; case ".": 0 === o.length && o.push("."); break; case "": o = [""]; break; default: o.push(s) } } return t.host + o.join("/") }, h.resolveDirname = function (t) { var e = t.lastIndexOf("/"); return -1 === e ? t : t.substr(0, e) }, h.resolveExtname = function (t) { for (var e = t.length - 1; 0 <= e; --e) { var i = t.charAt(e); if ("." === i) return t.substr(e); if ("/" === i) return "" } return "" }, h.makeNodeModulePaths = function (t) { for (var e, i = h.splitPath(t), r = i.host, o = (t = "/" === (t = i.path)[t.length - 1] ? t.slice(0, t.length - 1) : t).split("/"), n = 0 < (i = o.indexOf("node_modules")) ? i - 1 : 0, s = [], a = o.length - 1; n <= a; --a)"node_modules" !== o[a] && ((e = o.slice(0, a + 1)).push("node_modules"), e = e.join("/"), s.push(r + e)); return s }, h.splitPath = function (t) { var e = "", i = t.indexOf("//"); return 0 <= i ? t = 0 <= (i = t.indexOf("/", i + 2)) ? (e = t.slice(0, i), t.slice(i)) : (e = t, "/") : e = "", { host: e, path: t } } }, {}], 92: [function (t, e, i) { "use strict"; var r = this && this.__createBinding || (Object.create ? function (t, e, i, r) { void 0 === r && (r = i); var o = Object.getOwnPropertyDescriptor(e, i); o && ("get" in o ? e.__esModule : !o.writable && !o.configurable) || (o = { enumerable: !0, get: function () { return e[i] } }), Object.defineProperty(t, r, o) } : function (t, e, i, r) { t[r = void 0 === r ? i : r] = e[i] }), o = this && this.__exportStar || function (t, e) { for (var i in t) "default" === i || Object.prototype.hasOwnProperty.call(e, i) || r(e, t, i) }; Object.defineProperty(i, "__esModule", { value: !0 }), o(t("./PathUtil"), i), o(t("./types"), i), o(t("./utils"), i) }, { "./PathUtil": 91, "./types": 93, "./utils": 94 }], 93: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 94: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i._mergeObject = i.makeLoadConfigurationFunc = void 0; var a = t("es6-promise"), h = t("./PathUtil"); function c(t, e) { for (var i = Object.keys(e), r = 0, o = i.length; r < o; ++r) { var n = i[r], s = e[n], a = typeof s; if (a != typeof t[n]) t[n] = s; else if ("string" == a || "number" == a || "boolean" == a) t[n] = s; else { if ("object" != a) throw new Error("_mergeObject(): unknown type"); null == s ? t[n] = s : Array.isArray(s) ? t[n] = t[n].concat(s) : c(t[n], s) } } return t } i.makeLoadConfigurationFunc = function (t) { function n(i, r, o, n) { t(i, function (t, e) { if (t) n(t); else if ("definitions" in e) { t = e.definitions.map(function (t) { return "string" == typeof t ? s(o ? h.PathUtil.resolvePath(o, t) : t, void 0, o) : s(o ? h.PathUtil.resolvePath(o, t.url) : t.url, t.basePath, o) }); a.Promise.all(t).then(function (t) { return n(null, t.reduce(c)) }).catch(function (t) { return n(t) }) } else { t = void 0; try { t = function (t, r) { var e, i = {}; function o(t, e) { if (i.hasOwnProperty(t)) throw new Error("_normalizeAssets: asset ID already exists: " + t); i[t] = e } if (Array.isArray(t.assets)) t.assets.forEach(function (t) { var e, i = t.path; i && (t.virtualPath = null != (e = t.virtualPath) ? e : t.path, t.path = h.PathUtil.resolvePath(r, i)), o(i, t) }); else if ("object" == typeof t.assets) for (var n in t.assets) { var s; t.assets.hasOwnProperty(n) && ((s = t.assets[n]).path && (s.virtualPath = null != (e = s.virtualPath) ? e : s.path, s.path = h.PathUtil.resolvePath(r, s.path)), o(n, s)) } t.globalScripts && (t.globalScripts.forEach(function (t) { o(t, { type: /\.json$/i.test(t) ? "text" : "script", virtualPath: t, path: h.PathUtil.resolvePath(r, t), global: !0 }) }), delete t.globalScripts); return t.assets = i, t }(e, null != r ? r : h.PathUtil.resolveDirname(i)) } catch (t) { return void n(t) } n(null, t) } }) } function s(t, e, o) { return new a.Promise(function (i, r) { n(t, e, o, function (t, e) { return t ? r(t) : i(e) }) }) } return n }, i._mergeObject = c }, { "./PathUtil": 91, "es6-promise": 224 }], 95: [function (t, e, i) { arguments[4][2][0].apply(i, arguments) }, { "./lib/index": 113, dup: 2 }], 96: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Clock = void 0; var r = t("@akashic/akashic-engine"); function o(t) { this.fps = t.fps, this.scaleFactor = t.scaleFactor || 1, this.frameTrigger = new r.Trigger, this.rawFrameTrigger = new r.Trigger, this._platform = t.platform, this._maxFramePerOnce = t.maxFramePerOnce, this._deltaTimeBrokenThreshold = t.deltaTimeBrokenThreshold || o.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD, t.frameHandler && this.frameTrigger.add(t.frameHandler, t.frameHandlerOwner), this.running = !1, this._totalDeltaTime = 0, this._onLooperCall_bound = this._onLooperCall.bind(this), this._looper = this._platform.createLooper(this._onLooperCall_bound), this._waitTime = 0, this._waitTimeDoubled = 0, this._waitTimeMax = 0, this._skipFrameWaitTime = 0, this._realMaxFramePerOnce = 0 } o.prototype.start = function () { this.running || (this._totalDeltaTime = 0, this._updateWaitTimes(this.fps, this.scaleFactor), this._looper.start(), this.running = !0) }, o.prototype.stop = function () { this.running && (this._looper.stop(), this.running = !1) }, o.prototype.changeScaleFactor = function (t) { this.running ? (this.stop(), this.scaleFactor = t, this.start()) : this.scaleFactor = t }, o.prototype._onLooperCall = function (t) { var e = t = isNaN(t) ? this._waitTime - this._totalDeltaTime : t; if (t <= 0) return this._waitTime - this._totalDeltaTime; t > this._deltaTimeBrokenThreshold && (t = this._waitTime); var i = this._totalDeltaTime; if (!((i += t) <= this._skipFrameWaitTime)) { for (var t, r = t = i < this._waitTimeDoubled ? 1 : i > this._waitTimeMax ? this._realMaxFramePerOnce : i / this._waitTime | 0, o = { deltaTime: e, interrupt: !1 }; 0 < r && this.running && !o.interrupt;)--r, this.frameTrigger.fire(o), o.deltaTime = 0; i -= (t - r) * this._waitTime, this.rawFrameTrigger.fire() } return this._totalDeltaTime = i, this._waitTime - i }, o.prototype._updateWaitTimes = function (t, e) { t *= e; this._waitTime = 1e3 / t, this._waitTimeDoubled = Math.max(2e3 / t | 0, 1), this._waitTimeMax = Math.max(e * (1e3 * this._maxFramePerOnce / t) | 0, 1), this._skipFrameWaitTime = this._waitTime * o.ANTICIPATE_RATE | 0, this._realMaxFramePerOnce = this._maxFramePerOnce * e }, o.ANTICIPATE_RATE = .8, o.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD = 150, i.Clock = o }, { "@akashic/akashic-engine": 2 }], 97: [function (t, e, i) { "use strict"; function a(t) { var e = this; this._discardsEventsDuringSkip = !0, this._discardsLocalEventsDuringSkip = !0, this._filters = null, this._amflow = t.amflow, this._isLocalReceiver = !0, this._isReceiver = !1, this._isSender = !1, this._isDiscarder = !1, this._skipping = !1, this._defaultEventPriority = 0, this._buffer = [], this._joinLeaveBuffer = [], this._localBuffer = [], this._filters = null, this._filterController = { processNext: function (t) { (a.isEventLocal(t) ? e._unfilteredLocalEvents : e._unfilteredEvents).push(t) } }, this._unfilteredLocalEvents = [], this._unfilteredEvents = [], this._resolvePointEvent_bound = t.game.resolvePointEvent.bind(t.game), this._onEvent_bound = this.onEvent.bind(this) } Object.defineProperty(i, "__esModule", { value: !0 }), i.EventBuffer = void 0, a.isEventLocal = function (t) { switch (t[0]) { case 0: return t[5]; case 1: return t[3]; case 2: return t[4]; case 3: return t[5]; case 32: return t[4]; case 33: return t[7]; case 34: case 35: return t[11]; case 64: return t[5]; default: throw new Error("EventBuffer.isEventLocal") } }, a.prototype.setMode = function (t) { null != t.isLocalReceiver && (this._isLocalReceiver = t.isLocalReceiver), null != t.isReceiver && this._isReceiver !== t.isReceiver && (this._isReceiver = t.isReceiver, t.isReceiver ? this._amflow.onEvent(this._onEvent_bound) : this._amflow.offEvent(this._onEvent_bound)), null != t.isSender && (this._isSender = t.isSender), null != t.isDiscarder && (this._isDiscarder = t.isDiscarder), null != t.defaultEventPriority && (this._defaultEventPriority = 3 & t.defaultEventPriority) }, a.prototype.getMode = function () { return { isLocalReceiver: this._isLocalReceiver, isReceiver: this._isReceiver, isSender: this._isSender, isDiscarder: this._isDiscarder, defaultEventPriority: this._defaultEventPriority } }, a.prototype.onEvent = function (t) { a.isEventLocal(t) ? !this._isLocalReceiver || this._isDiscarder || this._skipping && this._discardsLocalEventsDuringSkip || this._unfilteredLocalEvents.push(t) : this._skipping && this._discardsEventsDuringSkip || (this._isReceiver && !this._isDiscarder && this._unfilteredEvents.push(t), this._isSender && (null == t[1] && (t[1] = 3 & this._defaultEventPriority), this._amflow.sendEvent(t))) }, a.prototype.onPointEvent = function (t) { t = this._resolvePointEvent_bound(t); t && this.onEvent(t) }, a.prototype.addEventDirect = function (t) { if (a.isEventLocal(t)) return !this._isLocalReceiver || this._isDiscarder ? void 0 : void this._localBuffer.push(t); this._isReceiver && !this._isDiscarder && (0 === t[0] || 1 === t[0] ? this._joinLeaveBuffer : this._buffer).push(t), this._isSender && (null == t[1] && (t[1] = 3 & this._defaultEventPriority), this._amflow.sendEvent(t)) }, a.prototype.readEvents = function () { var t = this._buffer; return 0 === t.length ? null : (this._buffer = [], t) }, a.prototype.readJoinLeaves = function () { var t = this._joinLeaveBuffer; return 0 === t.length ? null : (this._joinLeaveBuffer = [], t) }, a.prototype.readLocalEvents = function () { var t = this._localBuffer; return 0 === t.length ? null : (this._localBuffer = [], t) }, a.prototype.addFilter = function (t, e) { this._filters || (this._filters = []), this._filters.push({ func: t, handleEmpty: !!e }) }, a.prototype.removeFilter = function (t) { if (this._filters) if (t) for (var e = this._filters.length - 1; 0 <= e; --e)this._filters[e].func === t && this._filters.splice(e, 1); else this._filters = null }, a.prototype.processEvents = function (t) { var e = this._unfilteredLocalEvents, i = this._unfilteredEvents, r = (this._unfilteredLocalEvents = [], e); if (!t && 0 < i.length && (r = 0 < r.length ? r.concat(i) : i, this._unfilteredEvents = []), this._filters) for (var o = 0; o < this._filters.length; ++o) { var n = this._filters[o]; (0 < r.length || n.handleEmpty) && (r = this._filters[o].func(r, this._filterController) || []) } for (o = 0; o < r.length; ++o) { var s = r[o]; (a.isEventLocal(s) ? this._localBuffer : 0 === s[0] || 1 === s[0] ? this._joinLeaveBuffer : this._buffer).push(s) } }, a.prototype.startSkipping = function () { this._skipping = !0 }, a.prototype.endSkipping = function () { this._skipping = !1 }, i.EventBuffer = a }, {}], 98: [function (t, e, i) { "use strict"; var r, o; Object.defineProperty(i, "__esModule", { value: !0 }), (o = r = r || {})[o.Active = 0] = "Active", o[o.Passive = 1] = "Passive", i.default = r }, {}], 99: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.Game = void 0, t("@akashic/akashic-engine")), t = (o = s.Game, n(a, o), a.prototype.requestNotifyAgePassed = function (t) { this._notifyPassedAgeTable[t] = !0 }, a.prototype.cancelNotifyAgePassed = function (t) { delete this._notifyPassedAgeTable[t] }, a.prototype.requestNotifyTargetTimeReached = function () { this._notifiesTargetTimeReached = !0 }, a.prototype.cancelNofityTargetTimeReached = function () { this._notifiesTargetTimeReached = !1 }, a.prototype.fireAgePassedIfNeeded = function () { var t = this.age - 1; return !!this._notifyPassedAgeTable[t] && (delete this._notifyPassedAgeTable[t], this.agePassedTrigger.fire(t), !0) }, a.prototype.setStorageFunc = function (t) { this.storage._registerLoad(t.storageGetFunc), this.storage._registerWrite(t.storagePutFunc), this.storage.requestValuesForJoinPlayer = t.requestValuesForJoinFunc }, a.prototype.getIsSkipAware = function () { return this._isSkipAware }, a.prototype.setIsSkipAware = function (t) { this._isSkipAware = t }, a.prototype._destroy = function () { this.agePassedTrigger.destroy(), this.agePassedTrigger = null, this.targetTimeReachedTrigger.destroy(), this.targetTimeReachedTrigger = null, this.skippingChangedTrigger.destroy(), this.skippingChangedTrigger = null, this.abortTrigger.destroy(), this.abortTrigger = null, this.player = null, this.handlerSet = null, this._notifyPassedAgeTable = null, this._gameArgs = null, this._globalGameArgs = null, o.prototype._destroy.call(this) }, a.prototype._restartWithSnapshot = function (t) { var e = t.data; null != e.seed ? (this._reset({ age: t.frame, randSeed: e.seed }), this._loadAndStart({ args: this._gameArgs, globalArgs: this._globalGameArgs })) : (this._reset({ age: t.frame, nextEntityId: e.nextEntityId, randGenSer: e.randGenSer }), this._loadAndStart({ snapshot: e.gameSnapshot })) }, a.prototype._abortGame = function () { this.abortTrigger.fire() }, a.prototype._onRawTargetTimeReached = function (t) { this._notifiesTargetTimeReached && (this._notifiesTargetTimeReached = !1, this.targetTimeReachedTrigger.fire(t)) }, a.prototype._onSkippingChanged = function (t) { this._isSkipAware && this.onSkipChange.fire(t) }, a); function a(t) { var e = o.call(this, t) || this; return e.agePassedTrigger = new s.Trigger, e.targetTimeReachedTrigger = new s.Trigger, e.skippingChangedTrigger = new s.Trigger, e.abortTrigger = new s.Trigger, e._notifyPassedAgeTable = Object.create(null), e._notifiesTargetTimeReached = !1, e._isSkipAware = !1, e.player = t.player, e.handlerSet = t.handlerSet, e._gameArgs = t.gameArgs, e._globalGameArgs = t.globalGameArgs, e.skippingChangedTrigger.add(e._onSkippingChanged, e), e } i.Game = t }, { "@akashic/akashic-engine": 2 }], 100: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.GameDriver = void 0; var g = t("@akashic/akashic-engine"), r = t("@akashic/game-configuration/lib/utils"), s = t("es6-promise"), o = t("./constants"), y = t("./EventBuffer"), m = t("./ExecutionMode"), v = t("./Game"), A = t("./GameHandlerSet"), T = t("./GameLoop"), n = t("./LoopMode"), a = "GAME_DESTROYED"; function h(t) { this.errorTrigger = new g.Trigger, this.configurationLoadedTrigger = new g.Trigger, this.gameCreatedTrigger = new g.Trigger, this._rendererRequirement = null, this._game = null, this._gameLoop = null, this._eventBuffer = null, this._openedAmflow = !1, this._playToken = null, this._permission = null, this._hidden = !1, this._destroyed = !1, t.errorHandler && this.errorTrigger.add(t.errorHandler, t.errorHandlerOwner), this._platform = t.platform, this._loadConfigurationFunc = (0, r.makeLoadConfigurationFunc)(t.platform.loadGameConfiguration), this._player = t.player } h.prototype.initialize = function (t, e) { this.doInitialize(t).then(function () { e() }, e) }, h.prototype.changeState = function (t, e) { var i, r = this, o = this._gameLoop && this._gameLoop.running; o && null != (i = this._gameLoop) && i.stop(), this.initialize(t, function (t) { t ? e(t) : (o && null != (t = r._gameLoop) && t.start(), e()) }) }, h.prototype.startGame = function () { this._gameLoop ? this._gameLoop.start() : this.errorTrigger.fire(new Error("Not initialized")) }, h.prototype.stopGame = function () { this._gameLoop && this._gameLoop.stop() }, h.prototype.setNextAge = function (t) { var e; null != (e = this._gameLoop) && e.setNextAge(t) }, h.prototype.getPermission = function () { return this._permission }, h.prototype.getDriverConfiguration = function () { var t; return { playId: this._playId, playToken: null != (t = this._playToken) ? t : void 0, executionMode: this._gameLoop ? this._gameLoop.getExecutionMode() : void 0, eventBufferMode: this._eventBuffer ? this._eventBuffer.getMode() : void 0 } }, h.prototype.getLoopConfiguration = function () { return this._gameLoop ? this._gameLoop.getLoopConfiguration() : null }, h.prototype.getHidden = function () { return this._hidden }, h.prototype.resetPrimarySurface = function (t, e, i) { i = i || (this._rendererRequirement ? this._rendererRequirement.rendererCandidates : void 0); var r = this._game, o = this._platform, n = o.getPrimarySurface(); r.renderers = r.renderers.filter(function (t) { return t !== n.renderer() }), o.setRendererRequirement({ primarySurfaceWidth: t, primarySurfaceHeight: e, rendererCandidates: i }), this._rendererRequirement = { primarySurfaceWidth: t, primarySurfaceHeight: e, rendererCandidates: i }, r.renderers.push(o.getPrimarySurface().renderer()), r.width = t, r.height = e, r.onResized.fire({ width: t, height: e }), r.modified() }, h.prototype.doInitialize = function (i) { var r = this, t = new s.Promise(function (t, e) { if (r._gameLoop && r._gameLoop.running) return e(new Error("Game is running. Must be stopped.")); r._gameLoop && i.loopConfiguration && r._gameLoop.setLoopConfiguration(i.loopConfiguration), null != i.hidden && (r._hidden = i.hidden, r._game && r._game._setMuted(i.hidden)), t() }).then(function () { return r._assertLive(), r._doSetDriverConfiguration(i.driverConfiguration) }), e = i.configurationUrl; return e ? t.then(function () { return r._assertLive(), r._loadConfiguration(e, i.assetBase, i.configurationBase) }).then(function (t) { return r._assertLive(), r._createGame(t, r._player, i) }) : t }, h.prototype.destroy = function () { var i = this; return new s.Promise(function (t, e) { i.stopGame(), i._game && (i._game._destroy(), i._game = null), i.errorTrigger.destroy(), i.errorTrigger = null, i.configurationLoadedTrigger.destroy(), i.configurationLoadedTrigger = null, i.gameCreatedTrigger.destroy(), i.gameCreatedTrigger = null, i._platform.destroy ? i._platform.destroy() : i._platform.setRendererRequirement(void 0), i._platform = null, i._loadConfigurationFunc = null, i._player = null, i._rendererRequirement = null, i._playId = void 0, i._gameLoop = null, i._eventBuffer = null, i._openedAmflow = !1, i._playToken = null, i._permission = null, i._hidden = !1, i._destroyed = !0, t() }) }, h.prototype._doSetDriverConfiguration = function (t) { var e = this; if (null == t) return s.Promise.resolve(); void 0 === t.playId && (t.playId = null != (i = this._playId) ? i : void 0), void 0 === t.playToken && (t.playToken = null != (i = this._playToken) ? i : void 0), void 0 === t.eventBufferMode && (t.executionMode === m.default.Active ? t.eventBufferMode = { isReceiver: !0, isSender: !1 } : t.executionMode === m.default.Passive && (t.eventBufferMode = { isReceiver: !1, isSender: !0 })); var i = s.Promise.resolve(); return this._playId !== t.playId && (i = i.then(function () { return e._assertLive(), e._doOpenAmflow(t.playId) })), (i = this._playToken !== t.playToken ? i.then(function () { return e._assertLive(), e._doAuthenticate(t.playToken) }) : i).then(function () { e._assertLive(), null != t.eventBufferMode && (null == t.eventBufferMode.defaultEventPriority && (e._permission ? t.eventBufferMode.defaultEventPriority = 3 & e._permission.maxEventPriority : t.eventBufferMode.defaultEventPriority = 0), e._eventBuffer && e._eventBuffer.setMode(t.eventBufferMode)), null != t.executionMode && e._gameLoop && e._gameLoop.setExecutionMode(t.executionMode) }) }, h.prototype._doCloseAmflow = function () { var r = this; return new s.Promise(function (e, i) { if (!r._openedAmflow) return e(); r._platform.amflow.close(function (t) { r._openedAmflow = !1; t = r._getCallbackError(t); if (t) return i(t); e() }) }) }, h.prototype._doOpenAmflow = function (r) { var o = this; return void 0 === r ? s.Promise.resolve() : this._doCloseAmflow().then(function () { return o._assertLive(), new s.Promise(function (e, i) { if (null === r) return e(); o._platform.amflow.open(r, function (t) { t = o._getCallbackError(t); if (t) return i(t); o._openedAmflow = !0, o._playId = r, o._game && o._updateGamePlayId(o._game), e() }) }) }) }, h.prototype._doAuthenticate = function (o) { var n = this; return null == o ? s.Promise.resolve() : new s.Promise(function (i, r) { n._platform.amflow.authenticate(o, function (t, e) { t = n._getCallbackError(t); if (t) return r(t); e ? (n._playToken = o, n._permission = e, n._game && (n._game.handlerSet.isSnapshotSaver = e.writeTick), i()) : r(new Error("Permission denied.")) }) }) }, h.prototype._loadConfiguration = function (t, e, o) { var n = this; return new s.Promise(function (i, r) { n._loadConfigurationFunc(t, e, o, function (t, e) { t = n._getCallbackError(t); t ? r(t) : e ? (n.configurationLoadedTrigger.fire(e), i(e)) : r(new Error("GameDriver#_loadConfiguration: No configuration found.")) }) }) }, h.prototype._putZerothStartPoint = function (r) { var o = this; return new s.Promise(function (e, i) { var t = { frame: 0, timestamp: r.startedAt, data: r }; o._platform.amflow.putStartPoint(t, function (t) { t = o._getCallbackError(t); if (t) return i(t); e() }) }) }, h.prototype._getStartPoint = function (t) { var o = this; return new s.Promise(function (i, r) { o._platform.amflow.getStartPoint({ frame: t }, function (t, e) { t = o._getCallbackError(t); return t ? r(t) : e ? void i(e) : r(new Error("GameDriver#_getStartPoint: No startPoint found")) }) }) }, h.prototype._createGame = function (u, l, d) { var t, p, f = this, _ = !(null == (t = this._permission) || !t.writeTick), i = !((null == (t = d.driverConfiguration) ? void 0 : t.executionMode) !== m.default.Active) && _; if (d.loopConfiguration) return p = d.loopConfiguration, (i ? this._putZerothStartPoint({ seed: Date.now(), globalArgs: d.globalGameArgs, fps: u.fps, startedAt: Date.now() }) : s.Promise.resolve()).then(function () { return f._assertLive(), f._getStartPoint(0) }).then(function (e) { return i || p.loopMode !== n.default.Realtime ? [e, e] : f._getStartPoint(o.PSEUDO_INFINITE_AGE).then(function (t) { return [e, t] }) }).then(function (t) { var e = t[0], t = t[1], e = (f._assertLive(), e.data); if ("number" != typeof e.seed) throw new Error("GameDriver#_createGame: No seed found in the zeroth startpoint."); var i = f._platform, r = d.driverConfiguration || { eventBufferMode: { isReceiver: !0, isSender: !1 }, executionMode: m.default.Active }, o = e.seed, n = d.gameArgs, s = e.globalArgs, e = e.startedAt, a = { primarySurfaceWidth: u.width, primarySurfaceHeight: u.height, rendererCandidates: u.renderers }, h = (i.setRendererRequirement(a), new A.GameHandlerSet({ isSnapshotSaver: _ })), n = new v.Game({ engineModule: g, handlerSet: h, configuration: u, selfId: l.id, player: l, resourceFactory: i.getResourceFactory(), assetBase: d.assetBase, operationPluginViewInfo: i.getOperationPluginViewInfo ? i.getOperationPluginViewInfo() : void 0, gameArgs: n, globalGameArgs: s }), s = new y.EventBuffer({ game: n, amflow: i.amflow }), c = r.eventBufferMode, r = r.executionMode, c = (s.setMode(c), i.setPlatformEventHandler(s), h.setEventFilterFuncs({ addFilter: s.addFilter.bind(s), removeFilter: s.removeFilter.bind(s) }), n.renderers.push(i.getPrimarySurface().renderer()), new T.GameLoop({ game: n, amflow: i.amflow, platform: i, executionMode: r, eventBuffer: s, configuration: p, startedAt: e, profiler: d.profiler })); c.rawTargetTimeReachedTrigger.add(n._onRawTargetTimeReached, n), h.setCurrentTimeFunc(c.getCurrentTime.bind(c)), n._reset({ age: 0, randSeed: o }), f._updateGamePlayId(n), f._hidden && n._setMuted(!0), h.snapshotTrigger.add(function (t) { 0 !== t.frame && f._platform.amflow.putStartPoint(t, function (t) { t = f._getCallbackError(t); t && f.errorTrigger.fire(t) }) }), f._game = n, f._eventBuffer = s, f._gameLoop = c, f._rendererRequirement = a, f.gameCreatedTrigger.fire(n), c.reset(t) }); throw new Error("GameDriver#_createGame: No loopConfiguration") }, h.prototype._updateGamePlayId = function (t) { var e = this; t.playId = this._playId, t.external.send = function (t) { e._playId && e._platform.sendToExternal(e._playId, t) } }, h.prototype._assertLive = function () { if (this._destroyed) throw new Error(a) }, h.prototype._getCallbackError = function (t) { return t || (this._destroyed ? new Error(a) : null) }, i.GameDriver = h }, { "./EventBuffer": 97, "./ExecutionMode": 98, "./Game": 99, "./GameHandlerSet": 101, "./GameLoop": 102, "./LoopMode": 104, "./constants": 112, "@akashic/akashic-engine": 2, "@akashic/game-configuration/lib/utils": 92, "es6-promise": 224 }], 101: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.GameHandlerSet = void 0; var r = t("@akashic/akashic-engine"); function o(t) { this.raiseEventTrigger = new r.Trigger, this.raiseTickTrigger = new r.Trigger, this.snapshotTrigger = new r.Trigger, this.changeSceneModeTrigger = new r.Trigger, this._getCurrentTimeFunc = null, this._eventFilterFuncs = null, this._local = null, this._tickGenerationMode = null, this.isSnapshotSaver = !!t.isSnapshotSaver } o.prototype.setCurrentTimeFunc = function (t) { this._getCurrentTimeFunc = t }, o.prototype.setEventFilterFuncs = function (t) { this._eventFilterFuncs = t }, o.prototype.removeAllEventFilters = function () { this._eventFilterFuncs && this._eventFilterFuncs.removeFilter() }, o.prototype.changeSceneMode = function (t) { this._local = t.local, this._tickGenerationMode = t.tickGenerationMode, this.changeSceneModeTrigger.fire(t) }, o.prototype.getCurrentTime = function () { return Math.floor(this._getCurrentTimeFunc()) }, o.prototype.raiseEvent = function (t) { this.raiseEventTrigger.fire(t) }, o.prototype.raiseTick = function (t) { this.raiseTickTrigger.fire(t) }, o.prototype.addEventFilter = function (t, e) { this._eventFilterFuncs && this._eventFilterFuncs.addFilter(t, e) }, o.prototype.removeEventFilter = function (t) { this._eventFilterFuncs && this._eventFilterFuncs.removeFilter(t) }, o.prototype.shouldSaveSnapshot = function () { return this.isSnapshotSaver }, o.prototype.getInstanceType = function () { return this.shouldSaveSnapshot() ? "active" : "passive" }, o.prototype.saveSnapshot = function (t, e, i, r, o) { void 0 === o && (o = this._getCurrentTimeFunc()), this.shouldSaveSnapshot() && this.snapshotTrigger.fire({ frame: t, timestamp: o, data: { randGenSer: i, nextEntityId: r, gameSnapshot: e } }) }, i.GameHandlerSet = o }, { "@akashic/akashic-engine": 2 }], 102: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.GameLoop = void 0; var r = t("@akashic/akashic-engine"), o = t("./Clock"), n = t("./constants"), s = t("./ExecutionMode"), d = t("./LoopMode"), a = t("./LoopRenderMode"), h = t("./ProfilerClock"), c = t("./TickController"); r.EventIndex; function u(t) { this.errorTrigger = new r.Trigger, this.rawTargetTimeReachedTrigger = new r.Trigger, this.running = !1, this._omittedTickDuration = 0, this._sceneTickMode = null, this._sceneLocalMode = null, this._waitingStartPoint = !1, this._lastRequestedStartPointAge = -1, this._lastRequestedStartPointTime = -1, this._waitingNextTick = !1, this._foundLatestTick = !1, this._skipping = !1, this._lastPollingTickTime = 0, this._events = [], this._currentTime = t.startedAt, this._frameTime = 1e3 / t.game.fps, t.errorHandler && this.errorTrigger.add(t.errorHandler, t.errorHandlerOwner); var e = t.configuration, i = (this._startedAt = t.startedAt, this._targetTimeFunc = e.targetTimeFunc || null, this._targetTimeOffset = e.targetTimeOffset || null, this._originDate = e.originDate || null, this._realTargetTimeOffset = null != this._originDate ? this._originDate : (this._targetTimeOffset || 0) + this._startedAt, this._delayIgnoreThreshold = e.delayIgnoreThreshold || n.DEFAULT_DELAY_IGNORE_THRESHOLD, this._skipTicksAtOnce = e.skipTicksAtOnce || n.DEFAULT_SKIP_TICKS_AT_ONCE, this._skipThreshold = e.skipThreshold || n.DEFAULT_SKIP_THRESHOLD, this._skipThresholdTime = this._skipThreshold * this._frameTime, this._jumpTryThreshold = e.jumpTryThreshold || n.DEFAULT_JUMP_TRY_THRESHOLD, this._jumpIgnoreThreshold = e.jumpIgnoreThreshold || n.DEFAULT_JUMP_IGNORE_THRESHOLD, this._pollingTickThreshold = e._pollingTickThreshold || n.DEFAULT_POLLING_TICK_THRESHOLD, this._playbackRate = e.playbackRate || 1, null != e.loopRenderMode ? e.loopRenderMode : a.default.AfterRawFrame); this._loopRenderMode = null, this._omitInterpolatedTickOnReplay = null == e.omitInterpolatedTickOnReplay || e.omitInterpolatedTickOnReplay, this._loopMode = e.loopMode, this._amflow = t.amflow, this._game = t.game, this._eventBuffer = t.eventBuffer, this._executionMode = t.executionMode, this._targetAge = null != e.targetAge ? e.targetAge : null, t.profiler ? this._clock = new h.ProfilerClock({ fps: t.game.fps, scaleFactor: this._playbackRate, platform: t.platform, maxFramePerOnce: 5, profiler: t.profiler }) : this._clock = new o.Clock({ fps: t.game.fps, scaleFactor: this._playbackRate, platform: t.platform, maxFramePerOnce: 5 }), this._tickController = new c.TickController({ amflow: t.amflow, clock: this._clock, game: t.game, eventBuffer: t.eventBuffer, executionMode: t.executionMode, startedAt: t.startedAt, errorHandler: this.errorTrigger.fire, errorHandlerOwner: this.errorTrigger }), this._tickBuffer = this._tickController.getBuffer(), this._onGotStartPoint_bound = this._onGotStartPoint.bind(this), this._setLoopRenderMode(i), this._game.setIsSkipAware(null == e.skipAwareGame || e.skipAwareGame), this._game.setStorageFunc(this._tickController.storageFunc()), this._game.handlerSet.raiseEventTrigger.add(this._onGameRaiseEvent, this), this._game.handlerSet.raiseTickTrigger.add(this._onGameRaiseTick, this), this._game.handlerSet.changeSceneModeTrigger.add(this._handleSceneChange, this), this._game._onStart.add(this._onGameStarted, this), this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick, this), this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick, this), this._tickBuffer.start(), this._updateGamePlaybackRate() } u.prototype.reset = function (t) { this._clock.frameTrigger.remove(this._onEventsProcessed, this), this._skipping && this._stopSkipping(), this._tickBuffer.setCurrentAge(t.frame), this._currentTime = t.timestamp || t.data.timestamp || 0, this._waitingNextTick = !1, this._foundLatestTick = !1, this._lastRequestedStartPointAge = -1, this._lastRequestedStartPointTime = -1, this._omittedTickDuration = 0, this._game._restartWithSnapshot(t) }, u.prototype.start = function () { this.running = !0, this._clock.start() }, u.prototype.stop = function () { this._clock.stop(), this.running = !1 }, u.prototype.setNextAge = function (t) { this._tickController.setNextAge(t) }, u.prototype.getExecutionMode = function () { return this._executionMode }, u.prototype.setExecutionMode = function (t) { this._executionMode = t, this._tickController.setExecutionMode(t) }, u.prototype.getLoopConfiguration = function () { var t; return { loopMode: this._loopMode, delayIgnoreThreshold: this._delayIgnoreThreshold, skipTicksAtOnce: this._skipTicksAtOnce, skipThreshold: this._skipThreshold, skipAwareGame: this._game.getIsSkipAware(), jumpTryThreshold: this._jumpTryThreshold, jumpIgnoreThreshold: this._jumpIgnoreThreshold, playbackRate: this._playbackRate, loopRenderMode: null != (t = this._loopRenderMode) ? t : void 0, targetTimeFunc: null != (t = this._targetTimeFunc) ? t : void 0, targetTimeOffset: null != (t = this._targetTimeOffset) ? t : void 0, originDate: null != (t = this._originDate) ? t : void 0, omitInterpolatedTickOnReplay: this._omitInterpolatedTickOnReplay, targetAge: null != (t = this._targetAge) ? t : void 0 } }, u.prototype.setLoopConfiguration = function (t) { null != t.loopMode && (this._loopMode = t.loopMode), null != t.delayIgnoreThreshold && (this._delayIgnoreThreshold = t.delayIgnoreThreshold), null != t.skipTicksAtOnce && (this._skipTicksAtOnce = t.skipTicksAtOnce), null != t.skipThreshold && (this._skipThreshold = t.skipThreshold, this._skipThresholdTime = this._skipThreshold * this._frameTime), null != t.skipAwareGame && this._game.setIsSkipAware(t.skipAwareGame), null != t.jumpTryThreshold && (this._jumpTryThreshold = t.jumpTryThreshold), null != t.jumpIgnoreThreshold && (this._jumpIgnoreThreshold = t.jumpIgnoreThreshold), null != t.playbackRate && (this._playbackRate = t.playbackRate, this._clock.changeScaleFactor(this._playbackRate), this._updateGamePlaybackRate()), null != t.loopRenderMode && this._setLoopRenderMode(t.loopRenderMode), null != t.targetTimeFunc && (this._targetTimeFunc = t.targetTimeFunc), null != t.targetTimeOffset && (this._targetTimeOffset = t.targetTimeOffset), null != t.originDate && (this._originDate = t.originDate), this._realTargetTimeOffset = null != this._originDate ? this._originDate : (this._targetTimeOffset || 0) + this._startedAt, null != t.omitInterpolatedTickOnReplay && (this._omitInterpolatedTickOnReplay = t.omitInterpolatedTickOnReplay), null != t.targetAge && (this._targetAge !== t.targetAge && (this._waitingNextTick = !1), this._targetAge = t.targetAge) }, u.prototype.addTickList = function (t) { this._tickBuffer.addTickList(t) }, u.prototype.getCurrentTime = function () { return this._currentTime }, u.prototype._startSkipping = function (t) { this._skipping = !0, t || this._updateGamePlaybackRate(), this._tickBuffer.startSkipping(), this._eventBuffer.startSkipping(), this._game.skippingChangedTrigger.fire(!0) }, u.prototype._stopSkipping = function () { this._skipping = !1, this._updateGamePlaybackRate(), this._tickBuffer.endSkipping(), this._eventBuffer.endSkipping(), this._game.skippingChangedTrigger.fire(!1) }, u.prototype._updateGamePlaybackRate = function () { var t = this._skipping ? this._playbackRate * this._skipTicksAtOnce : this._playbackRate; this._game._setAudioPlaybackRate(t) }, u.prototype._handleSceneChange = function (t) { var e = t.local, i = t.tickGenerationMode; if (this._sceneLocalMode !== e || this._sceneTickMode !== i) switch (this._sceneLocalMode = e, this._sceneTickMode = i, this._clock.frameTrigger.remove(this._onFrame, this), this._clock.frameTrigger.remove(this._onLocalFrame, this), e) { case "full-local": this._tickController.stopTick(), this._clock.frameTrigger.add(this._onLocalFrame, this); break; case "non-local": case "interpolate-local": "by-clock" === i ? this._tickController.startTick() : this._tickController.startTickOnce(), this._clock.frameTrigger.add(this._onFrame, this); break; default: return void this.errorTrigger.fire(new Error("Unknown LocalTickMode: " + e)) } }, u.prototype._onLocalFrame = function () { this._doLocalTick() }, u.prototype._doLocalTick = function () { var t = this._game, e = this._eventBuffer.readLocalEvents(); this._currentTime += this._frameTime, e ? t.tick(!1, Math.floor(this._omittedTickDuration / this._frameTime), e) : t.tick(!1, Math.floor(this._omittedTickDuration / this._frameTime)), this._omittedTickDuration = 0 }, u.prototype._onFrame = function (t) { var e, i, r; this._loopMode === d.default.Replay && this._targetTimeFunc ? (i = (e = this._targetTimeFunc()) + this._realTargetTimeOffset, r = this._currentTime, this._onFrameForTimedReplay(i, t), r === this._currentTime && r <= i && i <= r + this._frameTime && this.rawTargetTimeReachedTrigger.fire(e)) : this._onFrameNormal(t) }, u.prototype._onFrameForTimedReplay = function (t, e) { var i = !1, r = this._game, o = (t - this._currentTime) / this._frameTime; if ((o > this._jumpTryThreshold || o < 0) && !this._waitingStartPoint && this._lastRequestedStartPointTime < this._currentTime && (this._waitingStartPoint = !0, this._lastRequestedStartPointTime = t, this._amflow.getStartPoint({ timestamp: t }, this._onGotStartPoint_bound)), o <= 0) this._skipping && this._stopSkipping(); else { this._skipping || (o > this._skipThreshold || 0 === this._tickBuffer.currentAge) && (this._tickBuffer.hasNextTick() || this._omitInterpolatedTickOnReplay && this._foundLatestTick) && (o = o <= this._skipThreshold, this._startSkipping(o)); for (var n = 0; n < this._skipTicksAtOnce; ++n) { var s = this._currentTime + this._frameTime; if (!this._tickBuffer.hasNextTick()) { this._waitingNextTick || (this._startWaitingNextTick(), this._foundLatestTick || this._tickBuffer.requestNonIgnorableTicks()), this._omitInterpolatedTickOnReplay && "interpolate-local" === this._sceneLocalMode && (this._foundLatestTick && (this._currentTime = t - this._frameTime), s < t && this._doLocalTick()); break } var a = this._tickBuffer.readNextTickTime(); if (null == a && (a = s), t < s) { if (!(a <= t)) break; s = t } else if (s < a) { if (!this._omitInterpolatedTickOnReplay || !this._skipping) { "interpolate-local" === this._sceneLocalMode && this._doLocalTick(); continue } if (t <= a) { this._omittedTickDuration += t - this._currentTime, this._currentTime = Math.floor(t / this._frameTime) * this._frameTime; break } s = a, this._omittedTickDuration += a - this._currentTime } this._currentTime = s; var h, c, a = this._tickBuffer.consume(), s = -1; if (this._events.length = 0, null != a && ((h = this._eventBuffer.readLocalEvents()) && (c = this._events).push.apply(c, h), i = ("number" == typeof a ? s = a : (s = a[0], (c = a[1]) && (h = this._events).push.apply(h, c)), r.tick(!0, Math.floor(this._omittedTickDuration / this._frameTime), this._events))), this._omittedTickDuration = 0, r._notifyPassedAgeTable[s] && r.fireAgePassedIfNeeded()) { e.interrupt = !0; break } if (i) break } this._skipping && t - this._currentTime < this._frameTime && (this._stopSkipping(), this._tickBuffer.dropAll(), this._tickBuffer.requestTicks()) } }, u.prototype._onFrameNormal = function (t) { var e = !1, i = this._game; if (!this._skipping && t.deltaTime > this._skipThresholdTime && (this._startSkipping(!1), this._waitingNextTick && this._stopSkipping()), this._waitingNextTick) "interpolate-local" === this._sceneLocalMode && this._doLocalTick(); else { var r, o = this._tickBuffer.currentAge, n = this._loopMode === d.default.Realtime ? (r = this._tickBuffer.knownLatestAge + 1) - o : null === this._targetAge ? (r = null, 1) : this._targetAge === o ? (r = this._targetAge = null, 1) : (r = this._targetAge) - o; if ((n > this._jumpTryThreshold || n < 0) && !this._waitingStartPoint && this._lastRequestedStartPointAge < o && (this._waitingStartPoint = !0, this._lastRequestedStartPointAge = r, this._amflow.getStartPoint({ frame: r }, this._onGotStartPoint_bound)), n <= 0) 0 === n && (this._foundLatestTick || this._tickBuffer.requestNonIgnorableTicks(), this._startWaitingNextTick()), "interpolate-local" === this._sceneLocalMode && this._doLocalTick(), this._skipping && this._stopSkipping(); else { !this._skipping && (n > this._skipThreshold || 0 === o) && this._tickBuffer.hasNextTick() && (o = 0 === o && this._tickBuffer.isKnownLatestTickTimeNear(this._skipThresholdTime, this._currentTime, this._frameTime), this._startSkipping(o)); for (var s = !this._skipping && n <= this._delayIgnoreThreshold ? 1 : Math.min(n, this._skipTicksAtOnce), a = 0; a < s; ++a) { var h = this._currentTime + this._frameTime, c = this._tickBuffer.readNextTickTime(); if (null != c && h < c) { if (!(this._loopMode === d.default.Realtime || this._omitInterpolatedTickOnReplay && this._skipping)) { if ("interpolate-local" !== this._sceneLocalMode) break; this._doLocalTick(); continue } h = Math.ceil(c / this._frameTime) * this._frameTime, this._omittedTickDuration += h - this._currentTime } this._currentTime = h; c = this._tickBuffer.consume(), h = -1; if (this._events.length = 0, null == c) { this._tickBuffer.requestTicks(), this._startWaitingNextTick(); break } var u, l = this._eventBuffer.readLocalEvents(); if (l && (u = this._events).push.apply(u, l), e = ("number" == typeof c ? h = c : (h = c[0], (u = c[1]) && (l = this._events).push.apply(l, u)), i.tick(!0, Math.floor(this._omittedTickDuration / this._frameTime), this._events)), this._omittedTickDuration = 0, i._notifyPassedAgeTable[h] && i.fireAgePassedIfNeeded()) { t.interrupt = !0; break } if (e) break } this._skipping && r - this._tickBuffer.currentAge < 1 && this._stopSkipping() } } }, u.prototype._onGotNextFrameTick = function () { this._waitingNextTick && this._loopMode !== d.default.FrameByFrame && this._stopWaitingNextTick() }, u.prototype._onGotNoTick = function () { this._waitingNextTick && (this._foundLatestTick = !0) }, u.prototype._onGotStartPoint = function (t, e) { if (this._waitingStartPoint = !1, t) this.errorTrigger.fire(t); else if (e) { if (this._targetTimeFunc && this._loopMode !== d.default.Realtime) { t = this._targetTimeFunc() + this._realTargetTimeOffset; if (t < e.timestamp) return; var i = this._currentTime; if (i <= t && e.timestamp < i + this._jumpIgnoreThreshold * this._frameTime) return } else { t = this._loopMode === d.default.Realtime ? this._tickBuffer.knownLatestAge + 1 : this._targetAge; if (null === t || t < e.frame) return; i = this._tickBuffer.currentAge; if (i <= t && e.frame < i + this._jumpIgnoreThreshold) return } this.reset(e) } }, u.prototype._onGameStarted = function () { this._clock.frameTrigger.add({ index: 0, owner: this, func: this._onEventsProcessed }) }, u.prototype._onEventsProcessed = function () { this._eventBuffer.processEvents("full-local" === this._sceneLocalMode) }, u.prototype._setLoopRenderMode = function (t) { if (t !== this._loopRenderMode) switch (this._loopRenderMode = t) { case a.default.AfterRawFrame: this._clock.rawFrameTrigger.add(this._renderOnRawFrame, this); break; case a.default.None: this._clock.rawFrameTrigger.remove(this._renderOnRawFrame, this); break; default: this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: " + t)) } }, u.prototype._renderOnRawFrame = function () { this._game.render() }, u.prototype._onGameRaiseEvent = function (t) { this._eventBuffer.onEvent(t) }, u.prototype._onGameRaiseTick = function (t) { if (this._executionMode === s.default.Active) { if (t) for (var e = 0; e < t.length; ++e)this._eventBuffer.addEventDirect(t[e]); this._tickController.forceGenerateTick() } }, u.prototype._onPollingTick = function () { var t = Date.now(); t - this._lastPollingTickTime > this._pollingTickThreshold && (this._lastPollingTickTime = t, this._tickBuffer.requestTicks()) }, u.prototype._startWaitingNextTick = function () { this._waitingNextTick = !0, this._clock.rawFrameTrigger.add(this._onPollingTick, this), this._lastPollingTickTime = Date.now(), this._skipping && this._stopSkipping() }, u.prototype._stopWaitingNextTick = function () { this._waitingNextTick = !1, this._clock.rawFrameTrigger.remove(this._onPollingTick, this) }, i.GameLoop = u }, { "./Clock": 96, "./ExecutionMode": 98, "./LoopMode": 104, "./LoopRenderMode": 105, "./ProfilerClock": 106, "./TickController": 109, "./constants": 112, "@akashic/akashic-engine": 2 }], 103: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.JoinResolver = i.JoinLeaveRequest = void 0; var r = t("@akashic/akashic-engine"), o = (n.prototype._onGotStorageData = function (t, e) { this.resolved = !0, t ? this.joinResolver.errorTrigger.fire(t) : this.pev[4] = e }, n); function n(t, e, i, r) { this.joinResolver = e, 0 === (this.pev = t)[0] && r ? (this.resolved = !1, null != i && i.getStorageData(r, this._onGotStorageData.bind(this))) : this.resolved = !0 } function s(t) { this._keysForJoin = null, this._requested = [], this.errorTrigger = new r.Trigger, t.errorHandler && this.errorTrigger.add(t.errorHandler, t.errorHandlerOwner), this._amflow = t.amflow } i.JoinLeaveRequest = o, s.prototype.request = function (t) { this._requested.push(new o(t, this, this._amflow, this._keysForJoin || void 0)) }, s.prototype.readResolved = function () { var t = this._requested.length; if (0 === t || !this._requested[0].resolved) return null; for (var e = [], i = 0; i < t; ++i) { var r = this._requested[i]; if (!r.resolved) break; e.push(r.pev) } return this._requested.splice(0, i), e }, s.prototype.setRequestValuesForJoin = function (t) { this._keysForJoin = t }, i.JoinResolver = s }, { "@akashic/akashic-engine": 2 }], 104: [function (t, e, i) { "use strict"; var r, o; Object.defineProperty(i, "__esModule", { value: !0 }), (o = r = r || {})[o.Realtime = 0] = "Realtime", o[o.Replay = 1] = "Replay", o[o.FrameByFrame = 2] = "FrameByFrame", i.default = r }, {}], 105: [function (t, e, i) { "use strict"; var r, o; Object.defineProperty(i, "__esModule", { value: !0 }), (o = r = r || {})[o.AfterRawFrame = 0] = "AfterRawFrame", o[o.None = 1] = "None", i.default = r }, {}], 106: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.ProfilerClock = void 0, t("./Clock")), t = (o = t.Clock, n(s, o), s.prototype._onLooperCall = function (t) { var e = t; if (t <= 0) return this._waitTime - this._totalDeltaTime; t > this._deltaTimeBrokenThreshold && (t = this._waitTime); var i = this._totalDeltaTime; if ((i += t) <= this._skipFrameWaitTime) this._totalDeltaTime = i; else { this._profiler.timeEnd(1), this._profiler.time(1); var t = i < this._waitTimeDoubled ? 1 : i > this._waitTimeMax ? this._realMaxFramePerOnce : i / this._waitTime | 0, r = t, o = { deltaTime: e, interrupt: !1 }; for (this._profiler.setValue(0, r - 1); 0 < r && this.running && !o.interrupt;)--r, this._profiler.time(2), this.frameTrigger.fire(o), this._profiler.timeEnd(2), o.deltaTime = 0; i -= (t - r) * this._waitTime, this._profiler.time(3), this.rawFrameTrigger.fire(), this._profiler.timeEnd(3), this._totalDeltaTime = i, this._profiler.flush() } return this._waitTime - i }, s); function s(t) { var e = o.call(this, t) || this; return e._profiler = t.profiler, e } i.ProfilerClock = t }, { "./Clock": 96 }], 107: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.StorageResolver = void 0; var r = t("@akashic/akashic-engine"), o = t("./ExecutionMode"); function n(t) { this.errorTrigger = new r.Trigger, this._unresolvedLoaders = Object.create(null), this._unresolvedStorages = Object.create(null), t.errorHandler && this.errorTrigger.add(t.errorHandler, t.errorHandlerOwner), this.getStorageFunc = this._getStorage.bind(this), this.putStorageFunc = this._putStorage.bind(this), this.requestValuesForJoinFunc = this._requestValuesForJoin.bind(this), this._onStoragePut_bound = this._onStoragePut.bind(this), this._game = t.game, this._amflow = t.amflow, this._tickGenerator = t.tickGenerator, this._tickBuffer = t.tickBuffer, this._executionMode = null, this.setExecutionMode(t.executionMode) } n.prototype.setExecutionMode = function (t) { var e, i; this._executionMode !== t && (this._executionMode = t, e = this._tickBuffer, i = this._tickGenerator, (t === o.default.Active ? (e.gotStorageTrigger.remove(this._onGotStorageOnTick, this), i) : (i.gotStorageTrigger.remove(this._onGotStorageOnTick, this), e)).gotStorageTrigger.add(this._onGotStorageOnTick, this)) }, n.prototype._onGotStorageOnTick = function (t) { var e, i, r = t.age, t = t.storageData, o = this._unresolvedLoaders[r]; o ? (delete this._unresolvedLoaders[r], e = r, i = t.map(function (t) { return t.values }), o._onLoaded(i, e)) : this._unresolvedStorages[r] = t }, n.prototype._getStorage = function (t, e, i) { null != i ? this._tickBuffer.requestTicks(r = i, 1) : this._executionMode === o.default.Active ? r = this._tickGenerator.requestStorageTick(t) : (r = this._game.age, this._tickBuffer.requestTicks(r, 1)); var r, i = this._unresolvedStorages[r]; i ? (delete this._unresolvedStorages[r], t = r, i = i.map(function (t) { return t.values }), e._onLoaded(i, t)) : this._unresolvedLoaders[r] = e }, n.prototype._putStorage = function (t, e, i) { this._executionMode === o.default.Active && this._amflow.putStorageData(t, e, i, this._onStoragePut_bound) }, n.prototype._requestValuesForJoin = function (t) { this._tickGenerator.setRequestValuesForJoin(t) }, n.prototype._onStoragePut = function (t) { t && this.errorTrigger.fire(t) }, i.StorageResolver = n }, { "./ExecutionMode": 98, "@akashic/akashic-engine": 2 }], 108: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.TickBuffer = void 0; var r = t("@akashic/akashic-engine"), o = t("./ExecutionMode"); r.EventIndex; function n(t) { this.currentAge = 0, this.knownLatestAge = -1, this.gotNextTickTrigger = new r.Trigger, this.gotNoTickTrigger = new r.Trigger, this.gotStorageTrigger = new r.Trigger, this._receiving = !1, this._skipping = !1, this._tickRanges = [], this._nextTickTimeCache = null, this._amflow = t.amflow, this._prefetchThreshold = t.prefetchThreshold || n.DEFAULT_PREFETCH_THRESHOLD, this._sizeRequestOnce = t.sizeRequestOnce || n.DEFAULT_SIZE_REQUEST_ONCE, this._executionMode = t.executionMode, this._startedAt = t.startedAt || 0, this._oldTimestampThreshold = null != t.startedAt ? t.startedAt - 864e6 : 0, this._nearestAbsentAge = this.currentAge, this._addTick_bound = this.addTick.bind(this), this._onTicks_bound = this._onTicks.bind(this) } n.prototype.start = function () { this._receiving = !0, this._updateAmflowReceiveState() }, n.prototype.stop = function () { this._receiving = !1, this._updateAmflowReceiveState() }, n.prototype.setExecutionMode = function (t) { this._executionMode !== t && (this._dropUntil(this.knownLatestAge + 1), this.knownLatestAge = this.currentAge, this._nextTickTimeCache = null, this._nearestAbsentAge = this.currentAge, this._executionMode = t, this._updateAmflowReceiveState()) }, n.prototype.setCurrentAge = function (t) { this._dropUntil(t), this._nextTickTimeCache = null, this.currentAge = t, this.knownLatestAge < t - 1 && (this.knownLatestAge = t - 1), this._nearestAbsentAge = this._findNearestAbscentAge(t) }, n.prototype.startSkipping = function () { this._skipping = !0 }, n.prototype.endSkipping = function () { this._skipping = !1 }, n.prototype.hasNextTick = function () { return this.currentAge !== this._nearestAbsentAge }, n.prototype.consume = function () { var t, e; return this.currentAge === this._nearestAbsentAge ? null : (t = this.currentAge) === (e = this._tickRanges[0]).start ? (this._nextTickTimeCache = null, ++this.currentAge, ++e.start, t + this._prefetchThreshold === this._nearestAbsentAge && this.requestTicks(this._nearestAbsentAge, this._sizeRequestOnce), e.start === e.end && this._tickRanges.shift(), 0 < e.ticks.length && e.ticks[0][0] === t ? e.ticks.shift() : t) : (this._dropUntil(this.currentAge), this.consume()) }, n.prototype.readNextTickTime = function () { if (null != this._nextTickTimeCache) return this._nextTickTimeCache; if (this.currentAge !== this._nearestAbsentAge) { var t = this.currentAge, e = this._tickRanges[0]; if (t !== e.start) return this._dropUntil(this.currentAge), this.readNextTickTime(); if (0 !== e.ticks.length) { e = e.ticks[0]; if (e[0] === t) { var i = e[1]; if (i) for (var r, o = 0; o < i.length; ++o)if (2 === i[o][0]) return (r = i[o][3]) < this._oldTimestampThreshold && (r += this._startedAt), this._nextTickTimeCache = r } } } return null }, n.prototype.isKnownLatestTickTimeNear = function (t, e, i) { return this._calcKnownLatestTickTimeDelta(t, e, i) < t }, n.prototype.requestTicks = function (t, e) { void 0 === t && (t = this.currentAge), void 0 === e && (e = this._sizeRequestOnce), this._skipping ? this.requestNonIgnorableTicks(t, e) : this.requestAllTicks(t, e) }, n.prototype.requestAllTicks = function (t, e) { void 0 === t && (t = this.currentAge), void 0 === e && (e = this._sizeRequestOnce), this._executionMode === o.default.Passive && ("undefined" != typeof window && window.prompt === window.confirm ? this._amflow.getTickList(t, t + e, this._onTicks_bound) : this._amflow.getTickList({ begin: t, end: t + e }, this._onTicks_bound)) }, n.prototype.requestNonIgnorableTicks = function (t, e) { void 0 === t && (t = this.currentAge), void 0 === e && (e = this._sizeRequestOnce), this._executionMode === o.default.Passive && ("undefined" != typeof window && window.prompt === window.confirm ? this._amflow.getTickList(t, t + e, this._onTicks_bound) : this._amflow.getTickList({ begin: t, end: t + e, excludeEventFlags: { ignorable: !0 } }, this._onTicks_bound)) }, n.prototype.addTick = function (t) { for (var e = t[0], i = this.currentAge === e && this._nearestAbsentAge === e, r = (this.knownLatestAge < e && (this.knownLatestAge = e), t[2]), o = (r && this.gotStorageTrigger.fire({ age: t[0], storageData: r }), this._tickRanges.length - 1); 0 <= o && !(e >= (n = this._tickRanges[o]).start); --o); var n, r = this._tickRanges[o + 1]; o < 0 ? this._tickRanges.unshift(this._createTickRangeFromTick(t)) : e === (n = this._tickRanges[o]).end ? (++n.end, t[1] && n.ticks.push(t)) : e > n.end && this._tickRanges.splice(o + 1, 0, this._createTickRangeFromTick(t)), this._nearestAbsentAge === e && (++this._nearestAbsentAge, r && this._nearestAbsentAge === r.start && (this._nearestAbsentAge = this._findNearestAbscentAge(this._nearestAbsentAge))), i && this.gotNextTickTrigger.fire() }, n.prototype.addTickList = function (t) { for (var e = t[0], i = t[1] + 1, r = t[2], t = e, o = i, n = (this.knownLatestAge < i - 1 && (this.knownLatestAge = i - 1), 0), s = this._tickRanges.length, n = 0; n < s; ++n) { var a = this._tickRanges[n]; if (e < a.start) break } var h = n; for (0 < n && (d = this._tickRanges[--n].end, e < d && (e = d)); n < s; ++n) { a = this._tickRanges[n]; if (i <= a.end) break } if (n < s && ((d = this._tickRanges[n].start) < i && (i = d)), i <= e) return { start: e, end: e, ticks: [] }; r = r || [], t === e && o === i || (r = r.filter(function (t) { t = t[0]; return e <= t && t < i })); for (var c = 0; c < r.length; ++c) { var u = r[c], l = u[2]; l && this.gotStorageTrigger.fire({ age: u[0], storageData: l }) } var d = { start: e, end: i, ticks: r }, t = Math.max(0, n - h); return this._tickRanges.splice(h, t, d), e <= this._nearestAbsentAge && this._nearestAbsentAge < i && (this._nearestAbsentAge = this._findNearestAbscentAge(this._nearestAbsentAge)), d }, n.prototype.dropAll = function () { this._tickRanges = [], this._nearestAbsentAge = this.currentAge, this._nextTickTimeCache = null }, n.prototype._updateAmflowReceiveState = function () { this._receiving && this._executionMode === o.default.Passive ? this._amflow.onTick(this._addTick_bound) : this._amflow.offTick(this._addTick_bound) }, n.prototype._onTicks = function (t, e) { if (t) throw t; e && (t = this.currentAge === this._nearestAbsentAge, e = this.addTickList(e), t && e.start <= this.currentAge && this.currentAge < e.end && this.gotNextTickTrigger.fire(), e.start !== e.end) || this.gotNoTickTrigger.fire() }, n.prototype._findNearestAbscentAge = function (t) { for (var e = 0, i = this._tickRanges.length; e < i && !(t <= this._tickRanges[e].end); ++e); for (; e < i; ++e) { var r = this._tickRanges[e]; if (t < r.start) break; t = r.end } return t }, n.prototype._dropUntil = function (t) { for (var e = 0; e < this._tickRanges.length && !(t < this._tickRanges[e].end); ++e); if (this._tickRanges = this._tickRanges.slice(e), 0 !== this._tickRanges.length) { var i = this._tickRanges[0]; if (!(t < i.start)) { for (i.start = t, e = 0; e < i.ticks.length && !(t <= i.ticks[e][0]); ++e); i.ticks = i.ticks.slice(e) } } }, n.prototype._calcKnownLatestTickTimeDelta = function (t, e, i) { var r = this._tickRanges; if (0 === r.length) return 0; for (var o = 0, n = h = r[r.length - 1].end, s = r.length - 1; 0 <= s; --s) { var a = r[s]; if (a.end !== h) return 1 / 0; for (var h = a.start, c = a.ticks, u = c.length - 1; 0 <= u; --u) { var l = c[u], d = l[1]; if (d) { l = l[0]; if (t < (o += (n - l) * i)) return t; for (var p, n = l, f = 0; f < d.length; ++f)if (2 === d[f][0]) return p = d[f][3], Math.min(p - e + o, t) } } } return o += (n - r[0].start) * i, Math.min(o, t) }, n.prototype._createTickRangeFromTick = function (t) { var e = t[0], e = { start: e, end: e + 1, ticks: [] }; return t[1] && e.ticks.push(t), e }, n.DEFAULT_PREFETCH_THRESHOLD = 1800, n.DEFAULT_SIZE_REQUEST_ONCE = 9e3, i.TickBuffer = n }, { "./ExecutionMode": 98, "@akashic/akashic-engine": 2 }], 109: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.TickController = void 0; var r = t("@akashic/akashic-engine"), o = t("./ExecutionMode"), n = t("./StorageResolver"), s = t("./TickBuffer"), a = t("./TickGenerator"); function h(t) { this.errorTrigger = new r.Trigger, t.errorHandler && this.errorTrigger.add(t.errorHandler, t.errorHandlerOwner), this._amflow = t.amflow, this._clock = t.clock, this._started = !1, this._executionMode = t.executionMode, this._generator = new a.TickGenerator({ amflow: t.amflow, eventBuffer: t.eventBuffer, errorHandler: this.errorTrigger.fire, errorHandlerOwner: this.errorTrigger }), this._buffer = new s.TickBuffer({ amflow: t.amflow, executionMode: t.executionMode, startedAt: t.startedAt }), this._storageResolver = new n.StorageResolver({ game: t.game, amflow: t.amflow, tickGenerator: this._generator, tickBuffer: this._buffer, executionMode: t.executionMode, errorHandler: this.errorTrigger.fire, errorHandlerOwner: this.errorTrigger }), this._generator.tickTrigger.add(this._onTickGenerated, this), this._clock.frameTrigger.add(this._generator.next, this._generator) } h.prototype.startTick = function () { this._started = !0, this._updateGeneratorState() }, h.prototype.stopTick = function () { this._started = !1, this._updateGeneratorState() }, h.prototype.startTickOnce = function () { this._started = !0, this._generator.tickTrigger.addOnce(this._stopTriggerOnTick, this), this._updateGeneratorState() }, h.prototype.setNextAge = function (t) { this._generator.setNextAge(t) }, h.prototype.forceGenerateTick = function () { this._generator.forceNext() }, h.prototype.getBuffer = function () { return this._buffer }, h.prototype.storageFunc = function () { return { storageGetFunc: this._storageResolver.getStorageFunc, storagePutFunc: this._storageResolver.putStorageFunc, requestValuesForJoinFunc: this._storageResolver.requestValuesForJoinFunc } }, h.prototype.setExecutionMode = function (t) { this._executionMode !== t && (this._executionMode = t, this._updateGeneratorState(), this._buffer.setExecutionMode(t), this._storageResolver.setExecutionMode(t)) }, h.prototype._stopTriggerOnTick = function () { this.stopTick() }, h.prototype._updateGeneratorState = function () { var t = this._started && this._executionMode === o.default.Active; this._generator.startStopGenerate(t) }, h.prototype._onTickGenerated = function (t) { this._amflow.sendTick(t), this._buffer.addTick(t) }, i.TickController = h }, { "./ExecutionMode": 98, "./StorageResolver": 107, "./TickBuffer": 108, "./TickGenerator": 110, "@akashic/akashic-engine": 2 }], 110: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.TickGenerator = void 0; var r = t("@akashic/akashic-engine"), o = t("./JoinResolver"); function n(t) { this.tickTrigger = new r.Trigger, this.gotStorageTrigger = new r.Trigger, this.errorTrigger = new r.Trigger, this._nextAge = 0, this._storageDataForNext = null, this._generatingTick = !1, this._waitingStorage = !1, t.errorHandler && this.errorTrigger.add(t.errorHandler, t.errorHandlerOwner), this._amflow = t.amflow, this._eventBuffer = t.eventBuffer, this._joinResolver = new o.JoinResolver({ amflow: t.amflow, errorHandler: this.errorTrigger.fire, errorHandlerOwner: this.errorTrigger }), this._onGotStorageData_bound = this._onGotStorageData.bind(this) } n.prototype.next = function () { if (this._generatingTick && !this._waitingStorage) { var t = this._eventBuffer.readJoinLeaves(); if (t) for (var e = 0; e < t.length; ++e)this._joinResolver.request(t[e]); var i = this._eventBuffer.readEvents(), r = this._joinResolver.readResolved(), r = (r && (i ? i.push.apply(i, r) : i = r), this._storageDataForNext); this._storageDataForNext = null, r ? this.tickTrigger.fire([this._nextAge++, i, r]) : this.tickTrigger.fire([this._nextAge++, i]) } }, n.prototype.forceNext = function () { var t; this._waitingStorage ? this.errorTrigger.fire(new Error("TickGenerator#forceNext(): cannot generate tick while waiting storage.")) : (t = this._generatingTick, this._generatingTick = !0, this.next(), this._generatingTick = t) }, n.prototype.startStopGenerate = function (t) { this._generatingTick = t }, n.prototype.startTick = function () { this._generatingTick = !0 }, n.prototype.stopTick = function () { this._generatingTick = !1 }, n.prototype.setNextAge = function (t) { this._waitingStorage ? this.errorTrigger.fire(new Error("TickGenerator#setNextAge(): cannot change the next age while waiting storage.")) : this._nextAge = t }, n.prototype.requestStorageTick = function (t) { var e; return this._waitingStorage ? (e = new Error("TickGenerator#requestStorageTick(): Unsupported: multiple storage request"), this.errorTrigger.fire(e), -1) : (this._waitingStorage = !0, this._amflow.getStorageData(t, this._onGotStorageData_bound), this._nextAge) }, n.prototype.setRequestValuesForJoin = function (t) { this._joinResolver.setRequestValuesForJoin(t) }, n.prototype._onGotStorageData = function (t, e) { this._waitingStorage = !1, t ? this.errorTrigger.fire(t) : e && (this._storageDataForNext = e, this.gotStorageTrigger.fire({ age: this._nextAge, storageData: e })) }, i.TickGenerator = n }, { "./JoinResolver": 103, "@akashic/akashic-engine": 2 }], 111: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.SimpleProfiler = void 0; var r = t("@akashic/akashic-engine"); function o(t) { var e; this._startTime = 0, this._beforeFlushTime = 0, this._beforeTimes = [], this._values = [], this._calculateProfilerValueTrigger = new r.Trigger, this._interval = null != (e = t.interval) ? e : o.DEFAULT_INTERVAL, null != t.limit ? this._limit = t.limit >= o.DEFAULT_LIMIT ? t.limit : o.DEFAULT_LIMIT : this._limit = o.DEFAULT_LIMIT, t.getValueHandler && this._calculateProfilerValueTrigger.add(t.getValueHandler, t.getValueHandlerOwner), this._reset() } o.prototype.time = function (t) { this._beforeTimes[t] = this._getCurrentTime() }, o.prototype.timeEnd = function (t) { var e = this._getCurrentTime(), i = null != this._beforeTimes[t] ? e - this._beforeTimes[t] : 0; this._values[t].push({ time: e, value: i }) }, o.prototype.flush = function () { var t = this._getCurrentTime(); if (0 === this._beforeFlushTime && (this._beforeFlushTime = t), this._beforeFlushTime + this._interval < t && (this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)), this._beforeFlushTime = t), this._values[1].length > this._limit) for (var e in this._values) this._values.hasOwnProperty(e) && (this._values[e] = this._values[e].slice(-o.BACKUP_MARGIN)) }, o.prototype.setValue = function (t, e) { this._values[t].push({ time: this._getCurrentTime(), value: e }) }, o.prototype.getProfilerValue = function (t) { var e = this._calculateProfilerValue(1, t); return { skippedFrameCount: this._calculateProfilerValue(0, t), rawFrameInterval: e, framePerSecond: { ave: 1e3 / e.ave, max: 1e3 / e.min, min: 1e3 / e.max }, frameTime: this._calculateProfilerValue(2, t), renderingTime: this._calculateProfilerValue(3, t) } }, o.prototype._reset = function () { this._startTime = this._getCurrentTime(), this._beforeFlushTime = 0, this._beforeTimes = [], this._beforeTimes[1] = 0, this._beforeTimes[2] = 0, this._beforeTimes[3] = 0, this._beforeTimes[0] = 0, this._values = [], this._values[1] = [], this._values[2] = [], this._values[3] = [], this._values[0] = [] }, o.prototype._calculateProfilerValue = function (t, e) { for (var i = this._getCurrentTime() - e, r = 0, o = 0, n = 0, s = Number.MAX_VALUE, a = this._values[t].length - 1; 0 <= a && !(0 < o && this._values[t][a].time < i); --a) { var h = this._values[t][a].value; n < h && (n = h), h < s && (s = h), r += h, ++o } return { ave: r / o, max: n, min: s } }, o.prototype._getCurrentTime = function () { return +new Date }, o.DEFAULT_INTERVAL = 1e3, o.DEFAULT_LIMIT = 1e3, o.BACKUP_MARGIN = 100, i.SimpleProfiler = o }, { "@akashic/akashic-engine": 2 }], 112: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.PSEUDO_INFINITE_AGE = i.DEFAULT_POLLING_TICK_THRESHOLD = i.DEFAULT_JUMP_IGNORE_THRESHOLD = i.DEFAULT_JUMP_TRY_THRESHOLD = i.DEFAULT_SKIP_THRESHOLD = i.DEFAULT_SKIP_TICKS_AT_ONCE = i.DEFAULT_DELAY_IGNORE_THRESHOLD = void 0, i.DEFAULT_DELAY_IGNORE_THRESHOLD = 6, i.DEFAULT_SKIP_TICKS_AT_ONCE = 100, i.DEFAULT_SKIP_THRESHOLD = 100, i.DEFAULT_JUMP_TRY_THRESHOLD = 3e4, i.DEFAULT_JUMP_IGNORE_THRESHOLD = 15e3, i.DEFAULT_POLLING_TICK_THRESHOLD = 1e4, i.PSEUDO_INFINITE_AGE = 189216e4 }, {}], 113: [function (t, e, i) { "use strict"; var r = this && this.__createBinding || (Object.create ? function (t, e, i, r) { void 0 === r && (r = i); var o = Object.getOwnPropertyDescriptor(e, i); o && ("get" in o ? e.__esModule : !o.writable && !o.configurable) || (o = { enumerable: !0, get: function () { return e[i] } }), Object.defineProperty(t, r, o) } : function (t, e, i, r) { t[r = void 0 === r ? i : r] = e[i] }), o = this && this.__exportStar || function (t, e) { for (var i in t) "default" === i || Object.prototype.hasOwnProperty.call(e, i) || r(e, t, i) }, n = (Object.defineProperty(i, "__esModule", { value: !0 }), i.LoopRenderMode = i.LoopMode = i.GameDriver = i.Game = i.ExecutionMode = i.SimpleProfiler = i.ReplayAmflowProxy = i.MemoryAmflowClient = void 0, o(t("./constants"), i), t("@akashic/amflow-util/lib/MemoryAmflowClient")), s = (Object.defineProperty(i, "MemoryAmflowClient", { enumerable: !0, get: function () { return n.MemoryAmflowClient } }), t("@akashic/amflow-util/lib/ReplayAmflowProxy")), a = (Object.defineProperty(i, "ReplayAmflowProxy", { enumerable: !0, get: function () { return s.ReplayAmflowProxy } }), t("./auxiliary/SimpleProfiler")), o = (Object.defineProperty(i, "SimpleProfiler", { enumerable: !0, get: function () { return a.SimpleProfiler } }), t("./ExecutionMode")), h = (i.ExecutionMode = o.default, t("./Game")), c = (Object.defineProperty(i, "Game", { enumerable: !0, get: function () { return h.Game } }), t("./GameDriver")), o = (Object.defineProperty(i, "GameDriver", { enumerable: !0, get: function () { return c.GameDriver } }), t("./LoopMode")), o = (i.LoopMode = o.default, t("./LoopRenderMode")); i.LoopRenderMode = o.default }, { "./ExecutionMode": 98, "./Game": 99, "./GameDriver": 100, "./LoopMode": 104, "./LoopRenderMode": 105, "./auxiliary/SimpleProfiler": 111, "./constants": 112, "@akashic/amflow-util/lib/MemoryAmflowClient": 85, "@akashic/amflow-util/lib/ReplayAmflowProxy": 86 }], 114: [function (t, e, i) { e.exports = t("./lib/full/index") }, { "./lib/full/index": 156 }], 115: [function (t, e, i) { "use strict"; function r() { this.audioAssets = [], this._masterVolume = 1 } Object.defineProperty(i, "__esModule", { value: !0 }), i.AudioManager = void 0, r.prototype.registerAudioAsset = function (t) { -1 === this.audioAssets.indexOf(t) && this.audioAssets.push(t) }, r.prototype.removeAudioAsset = function (t) { t = this.audioAssets.indexOf(t); -1 === t && this.audioAssets.splice(t, 1) }, r.prototype.setMasterVolume = function (t) { this._masterVolume = t; for (var e = 0; e < this.audioAssets.length; e++)this.audioAssets[e]._lastPlayedPlayer && this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged() }, r.prototype.getMasterVolume = function () { return this._masterVolume }, i.AudioManager = r }, {}], 116: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ContainerController = void 0; var r = t("@akashic/trigger"), o = t("./InputHandlerLayer"); function n(t) { this.container = null, this.surface = null, this.inputHandlerLayer = null, this.rootView = null, this.useResizeForScaling = !1, this.pointEventTrigger = new r.Trigger, this._rendererReq = null, this._disablePreventDefault = !1, this.resourceFactory = t } n.prototype.initialize = function (t) { this._rendererReq = t.rendererRequirement, this._disablePreventDefault = !!t.disablePreventDefault, this._loadView() }, n.prototype.setRootView = function (t) { t !== this.rootView && (this.rootView && (this.unloadView(), this._loadView()), this.rootView = t, this._appendToRootView(t)) }, n.prototype.resetView = function (t) { this.unloadView(), this._rendererReq = t, this._loadView(), this._appendToRootView(this.rootView) }, n.prototype.getRenderer = function () { if (this.surface) return this.surface.renderer(); throw new Error("this container has no surface") }, n.prototype.changeScale = function (t, e) { this.useResizeForScaling ? this.surface.changePhysicalScale(t, e) : this.surface.changeVisualScale(t, e), this.inputHandlerLayer._inputHandler.setScale(t, e) }, n.prototype.unloadView = function () { if (this.inputHandlerLayer.disablePointerEvent(), this.rootView) for (; this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild) }, n.prototype._loadView = function () { var t = this._rendererReq, e = t.primarySurfaceWidth, t = t.primarySurfaceHeight, i = this._disablePreventDefault; this.container = document.createDocumentFragment(), this.inputHandlerLayer ? (this.inputHandlerLayer.setViewSize({ width: e, height: t }), this.inputHandlerLayer.pointEventTrigger.removeAll(), this.surface && !this.surface.destroyed() && (this.inputHandlerLayer.view.removeChild(this.surface.canvas), this.surface.destroy())) : this.inputHandlerLayer = new o.InputHandlerLayer({ width: e, height: t, disablePreventDefault: i }), this.surface = this.resourceFactory.createPrimarySurface(e, t), this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()), this.container.appendChild(this.inputHandlerLayer.view) }, n.prototype._appendToRootView = function (t) { t.appendChild(this.container), this.inputHandlerLayer.enablePointerEvent(), this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire, this.pointEventTrigger) }, i.ContainerController = n }, { "./InputHandlerLayer": 117, "@akashic/trigger": 223 }], 117: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.InputHandlerLayer = void 0; var r = t("@akashic/trigger"), o = t("./handler/TouchHandler"); function n(t) { this.view = this._createInputView(t.width, t.height), this._inputHandler = void 0, this.pointEventTrigger = new r.Trigger, this._disablePreventDefault = !!t.disablePreventDefault } n.prototype.enablePointerEvent = function () { var e = this; this._inputHandler = new o.TouchHandler(this.view, this._disablePreventDefault), this._inputHandler.pointTrigger.add(function (t) { e.pointEventTrigger.fire(t) }), this._inputHandler.start() }, n.prototype.disablePointerEvent = function () { this._inputHandler && this._inputHandler.stop() }, n.prototype.setOffset = function (t) { t = "position:relative; left:".concat(t.x, "px; top:").concat(t.y, "px"); this._inputHandler.inputView.setAttribute("style", t) }, n.prototype.setViewSize = function (t) { var e = this.view; e.style.width = t.width + "px", e.style.height = t.height + "px" }, n.prototype._createInputView = function (t, e) { var i = document.createElement("div"); return i.setAttribute("tabindex", "1"), i.className = "input-handler", i.setAttribute("style", "display:inline-block; outline:none;"), i.style.width = t + "px", i.style.height = e + "px", i }, i.InputHandlerLayer = n }, { "./handler/TouchHandler": 155, "@akashic/trigger": 223 }], 118: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.addExtname = void 0, i.addExtname = function (t, e) { var i = t.indexOf("?"); return -1 === i ? t + "." + e : t.substring(0, i) + "." + e + t.substring(i, t.length) } }, {}], 119: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Platform = void 0; var r = t("./asset/XHRTextAsset"), o = t("./AudioManager"), n = t("./ContainerController"), s = t("./plugin/AudioPluginManager"), a = t("./plugin/AudioPluginRegistry"), h = t("./RafLooper"), c = t("./ResourceFactory"); function u(t) { this.containerView = t.containerView, this.audioPluginManager = new s.AudioPluginManager, t.audioPlugins && this.audioPluginManager.tryInstallPlugin(t.audioPlugins), this.audioPluginManager.tryInstallPlugin(a.AudioPluginRegistry.getRegisteredAudioPlugins()), this._audioManager = new o.AudioManager, this.amflow = t.amflow, this._platformEventHandler = null, this._resourceFactory = t.resourceFactory || new c.ResourceFactory({ audioPluginManager: this.audioPluginManager, platform: this, audioManager: this._audioManager }), this.containerController = new n.ContainerController(this._resourceFactory), this._rendererReq = null, this._disablePreventDefault = !!t.disablePreventDefault } u.prototype.setPlatformEventHandler = function (t) { this.containerController && (this.containerController.pointEventTrigger.removeAll({ owner: this._platformEventHandler }), this.containerController.pointEventTrigger.add(t.onPointEvent, t)), this._platformEventHandler = t }, u.prototype.loadGameConfiguration = function (t, i) { var e = new r.XHRTextAsset("(game.json)", t); e._load({ _onAssetLoad: function (t) { i(null, JSON.parse(e.data)) }, _onAssetError: function (t, e) { i(e, null) } }) }, u.prototype.getResourceFactory = function () { return this._resourceFactory }, u.prototype.setRendererRequirement = function (t) { t ? (this._rendererReq = t, this._resourceFactory._rendererCandidates = this._rendererReq.rendererCandidates, this.containerController && !this.containerController.inputHandlerLayer ? (this.containerController.initialize({ rendererRequirement: t, disablePreventDefault: this._disablePreventDefault }), this.containerController.setRootView(this.containerView), this._platformEventHandler && this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent, this._platformEventHandler)) : this.containerController.resetView(t)) : this.containerController && this.containerController.unloadView() }, u.prototype.getPrimarySurface = function () { return this.containerController.surface }, u.prototype.getOperationPluginViewInfo = function () { var t = this; return { type: "pdi-browser", view: this.containerController.inputHandlerLayer.view, getScale: function () { return t.containerController.inputHandlerLayer._inputHandler.getScale() } } }, u.prototype.createLooper = function (t) { return new h.RafLooper(t) }, u.prototype.sendToExternal = function (t, e) { }, u.prototype.registerAudioPlugins = function (t) { return this.audioPluginManager.tryInstallPlugin(t) }, u.prototype.setScale = function (t, e) { this.containerController.changeScale(t, e) }, u.prototype.notifyViewMoved = function () { }, u.prototype.setMasterVolume = function (t) { this._audioManager && this._audioManager.setMasterVolume(t) }, u.prototype.getMasterVolume = function () { if (this._audioManager) return this._audioManager.getMasterVolume() }, u.prototype.destroy = function () { this.setRendererRequirement(void 0), this.setMasterVolume(0) }, i.Platform = u }, { "./AudioManager": 115, "./ContainerController": 116, "./RafLooper": 120, "./ResourceFactory": 121, "./asset/XHRTextAsset": 131, "./plugin/AudioPluginManager": 158, "./plugin/AudioPluginRegistry": 159 }], 120: [function (t, e, i) { "use strict"; function r(t) { this._fun = t, this._timerId = void 0, this._prev = 0 } Object.defineProperty(i, "__esModule", { value: !0 }), i.RafLooper = void 0, r.prototype.start = function () { var e = this, i = function (t) { null != e._timerId && (e._timerId = requestAnimationFrame(i), e._fun(t - e._prev), e._prev = t) }; this._timerId = requestAnimationFrame(function (t) { e._timerId = requestAnimationFrame(i), e._fun(0), e._prev = t }) }, r.prototype.stop = function () { cancelAnimationFrame(this._timerId), this._timerId = void 0, this._prev = 0 }, i.RafLooper = r }, {}], 121: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ResourceFactory = void 0; var r = t("./asset/GeneratedSVGImageAsset"), o = t("./asset/HTMLImageAsset"), a = t("./asset/HTMLVideoAsset"), n = t("./asset/SVGImageAsset"), s = t("./asset/XHRScriptAsset"), h = t("./asset/XHRTextAsset"), c = t("./canvas/GlyphFactory"), u = t("./canvas/shims/SurfaceFactory"); function l(t) { this._audioPluginManager = t.audioPluginManager, this._audioManager = t.audioManager, this._platform = t.platform, this._surfaceFactory = new u.SurfaceFactory } l.prototype.createAudioAsset = function (t, e, i, r, o, n) { t = this._audioPluginManager.getActivePlugin().createAsset(t, e, i, r, o, n); return this._audioManager.registerAudioAsset(t), t.onDestroyed.addOnce(this._onAudioAssetDestroyed, this), t }, l.prototype.createAudioPlayer = function (t) { return this._audioPluginManager.getActivePlugin().createPlayer(t, this._audioManager) }, l.prototype.createImageAsset = function (t, e, i, r) { return new o.HTMLImageAsset(t, e, i, r) }, l.prototype.createVideoAsset = function (t, e, i, r, o, n, s) { return new a.HTMLVideoAsset(t, e, i, r, o, n, s) }, l.prototype.createTextAsset = function (t, e) { return new h.XHRTextAsset(t, e) }, l.prototype.createScriptAsset = function (t, e) { return new s.XHRScriptAsset(t, e) }, l.prototype.createPrimarySurface = function (t, e) { return this._surfaceFactory.createPrimarySurface(t, e, this._rendererCandidates) }, l.prototype.createSurface = function (t, e) { return this._surfaceFactory.createBackSurface(t, e, this._rendererCandidates) }, l.prototype.createGlyphFactory = function (t, e, i, r, o, n, s, a) { return new c.GlyphFactory(t, e, i, r, o, n, s, a) }, l.prototype.createVectorImageAsset = function (t, e, i, r, o) { return new n.SVGImageAsset(t, e, i, r, o) }, l.prototype.createVectorImageAssetFromString = function (t, e, i) { return new r.GeneratedSVGImageAsset(t, e, i) }, l.prototype._onAudioAssetDestroyed = function (t) { this._audioManager.removeAudioAsset(t) }, i.ResourceFactory = l }, { "./asset/GeneratedSVGImageAsset": 125, "./asset/HTMLImageAsset": 126, "./asset/HTMLVideoAsset": 127, "./asset/SVGImageAsset": 129, "./asset/XHRScriptAsset": 130, "./asset/XHRTextAsset": 131, "./canvas/GlyphFactory": 134, "./canvas/shims/SurfaceFactory": 141 }], 122: [function (t, e, i) { "use strict"; function r(t, e, i) { if (this.width = t, this.height = e, this._drawable = i, t % 1 != 0 || e % 1 != 0) throw new Error("Surface#constructor: width and height must be integers"); this.width = t, this.height = e, this._drawable = i } Object.defineProperty(i, "__esModule", { value: !0 }), i.Surface = void 0, r.prototype.destroy = function () { this._destroyed = !0 }, r.prototype.destroyed = function () { return !!this._destroyed }, i.Surface = r }, {}], 123: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Asset = void 0; var r = t("@akashic/trigger"); function o(t, e) { this.onDestroyed = new r.Trigger, this.id = t, this.originalPath = e, this.path = this._assetPathFilter(e) } o.prototype.destroy = function () { this.onDestroyed.fire(this), this.id = void 0, this.originalPath = void 0, this.path = void 0, this.onDestroyed.destroy(), this.onDestroyed = void 0 }, o.prototype.destroyed = function () { return void 0 === this.id }, o.prototype.inUse = function () { return !1 }, o.prototype._assetPathFilter = function (t) { return t }, i.Asset = o }, { "@akashic/trigger": 223 }], 124: [function (t, e, i) { "use strict"; var r, s, o = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.AudioAsset = void 0, t("./Asset")), t = (s = t.Asset, o(n, s), n.prototype.play = function () { var t = this._system.createPlayer(); return t.play(this), this._lastPlayedPlayer = t }, n.prototype.stop = function () { for (var t = this._system.findPlayers(this), e = 0; e < t.length; ++e)t[e].stop() }, n.prototype.inUse = function () { return 0 < this._system.findPlayers(this).length }, n.prototype.destroy = function () { this._system && this.stop(), this.data = void 0, this._system = void 0, this._lastPlayedPlayer = void 0, s.prototype.destroy.call(this) }, n); function n(t, e, i, r, o, n) { t = s.call(this, t, e) || this; return t.type = "audio", t.duration = i, t.loop = o, t.hint = n, t._system = r, t.data = void 0, t } i.AudioAsset = t }, { "./Asset": 123 }], 125: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), c = (Object.defineProperty(i, "__esModule", { value: !0 }), i.GeneratedSVGImageAsset = void 0, t("../utils/ExceptionFactory")), t = t("./SVGImageAsset"), t = (o = t.SVGImageAsset, n(s, o), s.prototype.destroy = function () { this._svgString = null, o.prototype.destroy.call(this) }, s.prototype._load = function (e) { var t, i = this, r = this._svgString, o = new DOMParser; try { var n = o.parseFromString(r, "text/xml").getElementsByTagName("svg")[0], s = n.getAttribute("width"), a = n.getAttribute("height"); if (null == s) throw new Error("must give width in the root element."); if (null == a) throw new Error("must give height in the root element."); if (!u(s)) throw new Error('the width in the root element must be given in "px" units'); if (!u(a)) throw new Error('the height in the root element must be given in "px" units'); t = window.btoa(r), this.width = parseFloat(s), this.height = parseFloat(a) } catch (t) { return void e._onAssetError(this, c.ExceptionFactory.createAssetLoadError(t.message, !1, t)) } var h = new Image; h.onerror = function (t) { e._onAssetError(i, c.ExceptionFactory.createAssetLoadError("GeneratedSVGImageAsset: unknown loading error", void 0, t)) }, h.onload = function () { i.data = h, e._onAssetLoad(i) }, h.src = "data:image/svg+xml;base64," + t }, s); function s(t, e, i) { t = o.call(this, t, e, 0, 0) || this; return t._svgString = i, t } function u(t) { return /^[+-]?(?:(?:[0-9]+(?:\.[0-9]*)?)|(?:\.[0-9]+))(?:[eE][+-]?[0-9]+)?(?:px)?$/.test(t) } i.GeneratedSVGImageAsset = t }, { "../utils/ExceptionFactory": 172, "./SVGImageAsset": 129 }], 126: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.HTMLImageAsset = i.ImageAssetSurface = void 0, t("../Surface")), a = t("../utils/ExceptionFactory"), t = t("./Asset"), h = (o = s.Surface, n(c, o), c.prototype.renderer = function () { throw new Error("ImageAssetSurface cannot be rendered.") }, c.prototype.isPlaying = function () { return !1 }, c); function c() { return null !== o && o.apply(this, arguments) || this } i.ImageAssetSurface = h; u = t.Asset, n(l, u), l.prototype.initialize = function (t) { this.hint = t }, l.prototype.destroy = function () { this._surface && !this._surface.destroyed() && this._surface.destroy(), this.data = void 0, this._surface = void 0, u.prototype.destroy.call(this) }, l.prototype._load = function (t) { var e = this, i = new Image; this.hint && this.hint.untainted && (i.crossOrigin = "anonymous"), i.onerror = function () { t._onAssetError(e, a.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error")) }, i.onload = function () { e.data = i, t._onAssetLoad(e) }, i.src = this.path }, l.prototype.asSurface = function () { if (this.data) return this._surface || (this._surface = new h(this.width, this.height, this.data)), this._surface; throw new Error("ImageAssetImpl#asSurface: not yet loaded.") }; var u, s = l; function l(t, e, i, r) { t = u.call(this, t, e) || this; return t.type = "image", t.width = i, t.height = r, t.data = void 0, t._surface = void 0, t } i.HTMLImageAsset = s }, { "../Surface": 122, "../utils/ExceptionFactory": 172, "./Asset": 123 }], 127: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.HTMLVideoAsset = void 0, t("../Surface")), a = t("./Asset"), h = t("./HTMLVideoPlayer"), c = (o = s.Surface, n(u, o), u.prototype.renderer = function () { throw new Error("VideoAssetSurface cannot be rendered.") }, u.prototype.isPlaying = function () { return !1 }, u); function u(t, e, i) { return o.call(this, t, e, i) || this } l = a.Asset, n(d, l), d.prototype.play = function (t) { return this.getPlayer().play(this), this.getPlayer() }, d.prototype.stop = function () { this.getPlayer().stop() }, d.prototype.inUse = function () { return !1 }, d.prototype._load = function (t) { var e = this; setTimeout(function () { t._onAssetLoad(e) }, 0) }, d.prototype.getPlayer = function () { return this._player }, d.prototype.asSurface = function () { return this._surface }; var l, t = d; function d(t, e, i, r, o, n, s) { t = l.call(this, t, e) || this; return t.type = "video", t.width = i, t.height = r, t.realWidth = 0, t.realHeight = 0, t._system = o, t._loop = n, t._useRealSize = s, t._player = new h.HTMLVideoPlayer, t._surface = new c(i, r, null), t } i.HTMLVideoAsset = t }, { "../Surface": 122, "./Asset": 123, "./HTMLVideoPlayer": 128 }], 128: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.HTMLVideoPlayer = void 0; var r = t("@akashic/trigger"); function o(t) { this._loop = !!t, this.onPlay = new r.Trigger, this.onStop = new r.Trigger, this.played = this.onPlay, this.stopped = this.onStop, this.currentVideo = void 0, this.volume = 1, this.isDummy = !0 } o.prototype.play = function (t) { }, o.prototype.stop = function () { }, o.prototype.changeVolume = function (t) { }, i.HTMLVideoPlayer = o }, { "@akashic/trigger": 223 }], 129: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), c = (Object.defineProperty(i, "__esModule", { value: !0 }), i.SVGImageAsset = i.SVGImageAssetSurface = void 0, t("../canvas/context2d/Context2DSurface")), s = t("../Surface"), a = t("../utils/ExceptionFactory"), t = t("./Asset"), u = (o = s.Surface, n(h, o), h.prototype.renderer = function () { throw new Error("SVGImageAssetSurface cannot be rendered.") }, h.prototype.isPlaying = function () { return !1 }, h); function h() { return null !== o && o.apply(this, arguments) || this } i.SVGImageAssetSurface = u; l = t.Asset, n(d, l), d.prototype.destroy = function () { this.data = null, this.hint = void 0, this._surface = null, l.prototype.destroy.call(this) }, d.prototype._load = function (t) { var e = this, i = new Image; this.hint && this.hint.untainted && (i.crossOrigin = "anonymous"), i.onerror = function () { t._onAssetError(e, a.ExceptionFactory.createAssetLoadError("SVGImageAsset unknown loading error")) }, i.onload = function () { e.data = i, t._onAssetLoad(e) }, i.src = this.path }, d.prototype.createSurface = function (t, e, i, r, o, n) { void 0 === i && (i = 0), void 0 === r && (r = 0); var s = this.width, a = this.height, h = this.data; if (!h) throw new Error("SVGImageAsset#asSurface: not yet loaded."); this._surface || (this._surface = new u(s, a, h)), o = o || s, n = n || a; h = new c.Context2DSurface(t, e), s = h.renderer(); return s.save(), s.transform([t / o, 0, 0, e / n, 0, 0]), s.drawImage(this._surface, i, r, o, n, 0, 0), s.restore(), h }; var l, s = d; function d(t, e, i, r, o) { t = l.call(this, t, e) || this; return t.type = "vector-image", t.width = i, t.height = r, t.hint = o, t.data = null, t._surface = null, t } i.SVGImageAsset = s }, { "../Surface": 122, "../canvas/context2d/Context2DSurface": 139, "../utils/ExceptionFactory": 172, "./Asset": 123 }], 130: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.XHRScriptAsset = void 0, t("../utils/XHRLoader")), t = t("./Asset"), t = (o = t.Asset, n(a, o), a.prototype._load = function (i) { var r = this; (new s.XHRLoader).get(this.path, function (t, e) { t ? i._onAssetError(r, t) : (r.script = e + "\n", i._onAssetLoad(r)) }) }, a.prototype.execute = function (t) { return this._wrap()(t), t.module.exports }, a.prototype.destroy = function () { this.script = void 0, o.prototype.destroy.call(this) }, a.prototype._wrap = function () { return new Function("g", a.PRE_SCRIPT + this.script + a.POST_SCRIPT) }, a.PRE_SCRIPT = "(function(exports, require, module, __filename, __dirname) {", a.POST_SCRIPT = "\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);", a); function a() { var t = null !== o && o.apply(this, arguments) || this; return t.type = "script", t } i.XHRScriptAsset = t }, { "../utils/XHRLoader": 173, "./Asset": 123 }], 131: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.XHRTextAsset = void 0, t("../utils/XHRLoader")), t = t("./Asset"), t = (o = t.Asset, n(a, o), a.prototype._load = function (i) { var r = this; (new s.XHRLoader).get(this.path, function (t, e) { t ? i._onAssetError(r, t) : (r.data = e, i._onAssetLoad(r)) }) }, a.prototype.destroy = function () { this.data = void 0, o.prototype.destroy.call(this) }, a); function a(t, e) { t = o.call(this, t, e) || this; return t.type = "text", t } i.XHRTextAsset = t }, { "../utils/XHRLoader": 173, "./Asset": 123 }], 132: [function (t, e, i) { "use strict"; function r(t) { this.matrix = t ? new Float32Array(t.matrix) : new Float32Array([1, 0, 0, 1, 0, 0]) } Object.defineProperty(i, "__esModule", { value: !0 }), i.AffineTransformer = void 0, r.prototype.scale = function (t, e) { var i = this.matrix; return i[0] *= t, i[1] *= t, i[2] *= e, i[3] *= e, this }, r.prototype.translate = function (t, e) { var i = this.matrix; return i[4] += i[0] * t + i[2] * e, i[5] += i[1] * t + i[3] * e, this }, r.prototype.transform = function (t) { var e = this.matrix, i = t[0] * e[0] + t[1] * e[2], r = t[0] * e[1] + t[1] * e[3], o = t[2] * e[0] + t[3] * e[2], n = t[2] * e[1] + t[3] * e[3], s = t[4] * e[0] + t[5] * e[2] + e[4], t = t[4] * e[1] + t[5] * e[3] + e[5]; return e[0] = i, e[1] = r, e[2] = o, e[3] = n, e[4] = s, e[5] = t, this }, r.prototype.setTransform = function (t) { var e = this.matrix; e[0] = t[0], e[1] = t[1], e[2] = t[2], e[3] = t[3], e[4] = t[4], e[5] = t[5] }, r.prototype.copyFrom = function (t) { return this.matrix.set(t.matrix), this }, i.AffineTransformer = r }, {}], 133: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.CanvasSurface = void 0, t("../Surface")), t = (o = t.Surface, n(s, o), s.prototype.destroy = function () { this.canvas.width = 1, this.canvas.height = 1, this.canvas = null, o.prototype.destroy.call(this) }, s.prototype.getHTMLElement = function () { return this.canvas }, s.prototype.changeVisualScale = function (t, e) { var i = this.canvas.style; "transform" in i ? (i.transformOrigin = "0 0", i.transform = "scale(" + t + "," + e + ")") : "webkitTransform" in i ? (i.webkitTransformOrigin = "0 0", i.webkitTransform = "scale(" + t + "," + e + ")") : (i.width = Math.floor(t * this.width) + "px", i.height = Math.floor(e * this.width) + "px") }, s); function s(t, e) { var i = this, r = document.createElement("canvas"), i = o.call(this, t, e, r) || this; return r.width = t, r.height = e, i.canvas = r, i } i.CanvasSurface = t }, { "../Surface": 122 }], 134: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.GlyphFactory = void 0; var g = t("./context2d/Context2DSurface"); function o(t, e, i, r, o, n, s, a, h, c, u, l) { var d = e < y._environmentMinimumFontSize ? e / y._environmentMinimumFontSize : 1, p = Math.ceil((e + 2 * o) * d), f = Math.ceil((e + 2 * n) * d), p = new g.Context2DSurface(p, f), f = p.canvas, _ = f.getContext("2d"), t = 4294901760 & t ? String.fromCharCode((4294901760 & t) >>> 16, 65535 & t) : String.fromCharCode(t), l = (_.save(), _.font = l + " " + e + "px " + i, _.textAlign = "left", _.textBaseline = "alphabetic", _.lineJoin = "bevel", 1 != d && _.scale(d, d), 0 < h && (_.lineWidth = h, _.strokeStyle = c, _.strokeText(t, o, n + r)), u || (_.fillStyle = a, _.fillText(t, o, n + r)), _.measureText(t).width); return _.restore(), { surface: p, advanceWidth: l, imageData: s ? _.getImageData(0, 0, f.width, f.height) : void 0 } } var r = ["serif", "sans-serif", "monospace", "cursive", "fantasy", "system-ui"]; function h(t) { return -1 !== r.indexOf(t) ? t : '"' + t + '"' } function n(t, e, i, r, o, n, s, a, h, c) { return { code: t, x: e, y: i, width: r, height: o, surface: h, offsetX: n, offsetY: s, advanceWidth: a, isSurfaceValid: c, _atlas: null } } c.prototype.create = function (t) { var e, i, r = this._glyphAreas[t]; return r || ((r = function (t) { for (var e = t.width, i = t.height, r = 0, o = 0, n = 0, s = 0, a = t.height; s < a; s = s + 1 | 0)for (var h = 0, c = t.width; h < c; h = h + 1 | 0)0 !== t.data[n + 3] && (h < e && (e = h), r < h && (r = h), s < i && (i = s), o < s && (o = s)), n += 4; return e === t.width ? { x: 0, y: 0, width: 0, height: 0 } : { x: e, y: i, width: r - e + 1, height: o - i + 1 } }((e = o(t, this.fontSize, this._cssFontFamily, this.baselineHeight, this._marginW, this._marginH, !0, this.fontColor, this.strokeWidth, this.strokeColor, this.strokeOnly, this.fontWeight)).imageData)).advanceWidth = e.advanceWidth, this._glyphAreas[t] = r), 0 === (i = r).width || 0 === i.height ? (e && e.surface.destroy(), n(t, 0, 0, 0, 0, 0, 0, r.advanceWidth, void 0, !0)) : (e = e || o(t, this.fontSize, this._cssFontFamily, this.baselineHeight, this._marginW, this._marginH, !1, this.fontColor, this.strokeWidth, this.strokeColor, this.strokeOnly, this.fontWeight), n(t, r.x, r.y, r.width, r.height, r.x - this._marginW, r.y - this._marginH, r.advanceWidth, e.surface, !0)) }, c.prototype.measureMinimumFontSize = function () { for (var t, e = 1, i = document.createElement("canvas").getContext("2d"), r = (i.textAlign = "left", i.textBaseline = "alphabetic", i.lineJoin = "bevel", i.font = e + "px sans-serif", i.measureText("M").width); t = r, i.font = (e += 1) + "px sans-serif", t === (r = i.measureText("M").width) || 50 < e;); return e }; var y = c; function c(t, e, i, r, o, n, s, a) { void 0 === i && (i = e), void 0 === r && (r = "black"), void 0 === o && (o = 0), void 0 === n && (n = "black"), void 0 === s && (s = !1), void 0 === a && (a = "normal"), this._glyphAreas = Object.create(null), this.fontFamily = t, this.fontSize = e, this.baselineHeight = i, this.fontColor = r, this.strokeWidth = o, this.strokeColor = n, this.strokeOnly = s, this.fontWeight = a, this._cssFontFamily = "string" == typeof t ? h(t) : t.map(h).join(","), -1 === this._cssFontFamily.indexOf("sans-serif") && (this._cssFontFamily += ",sans-serif"), this._marginW = Math.ceil(.3 * this.fontSize + this.strokeWidth / 2), this._marginH = Math.ceil(.3 * this.fontSize + this.strokeWidth / 2), void 0 === c._environmentMinimumFontSize && (c._environmentMinimumFontSize = this.measureMinimumFontSize()) } i.GlyphFactory = y }, { "./context2d/Context2DSurface": 139 }], 135: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.RenderingHelper = void 0, (i = i.RenderingHelper || (i.RenderingHelper = {})).toPowerOfTwo = function (t) { if (0 == (t & t - 1)) return t; for (var e = 1; e < t;)e *= 2; return e }, i.clamp = function (t) { return Math.min(Math.max(t, 0), 1) }, i.usedWebGL = function (t) { var e = !1; return e = t && 0 < t.length ? "webgl" === t[0] : e } }, {}], 136: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.CanvasRenderingState = void 0; var r = t("../AffineTransformer"); i.CanvasRenderingState = function (t) { t ? (this.fillStyle = t.fillStyle, this.globalAlpha = t.globalAlpha, this.globalCompositeOperation = t.globalCompositeOperation, this.transformer = new r.AffineTransformer(t.transformer)) : (this.fillStyle = "#000000", this.globalAlpha = 1, this.globalCompositeOperation = "source-over", this.transformer = new r.AffineTransformer) } }, { "../AffineTransformer": 132 }], 137: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.CanvasSurfaceContext = void 0; var r = t("./CanvasRenderingState"); function o(t) { this._stateStack = [], this._modifiedTransform = !1, this._context = t; t = new r.CanvasRenderingState; this._contextFillStyle = t.fillStyle, this._contextGlobalAlpha = t.globalAlpha, this._contextGlobalCompositeOperation = t.globalCompositeOperation, this.pushState(t) } Object.defineProperty(o.prototype, "fillStyle", { get: function () { return this.currentState().fillStyle }, set: function (t) { this.currentState().fillStyle = t }, enumerable: !1, configurable: !0 }), Object.defineProperty(o.prototype, "globalAlpha", { get: function () { return this.currentState().globalAlpha }, set: function (t) { this.currentState().globalAlpha = t }, enumerable: !1, configurable: !0 }), Object.defineProperty(o.prototype, "globalCompositeOperation", { get: function () { return this.currentState().globalCompositeOperation }, set: function (t) { this.currentState().globalCompositeOperation = t }, enumerable: !1, configurable: !0 }), o.prototype.getCanvasRenderingContext2D = function () { return this._context }, o.prototype.clearRect = function (t, e, i, r) { this.prerender(), this._context.clearRect(t, e, i, r) }, o.prototype.save = function () { var t = new r.CanvasRenderingState(this.currentState()); this.pushState(t) }, o.prototype.restore = function () { this.popState() }, o.prototype.scale = function (t, e) { this.currentState().transformer.scale(t, e), this._modifiedTransform = !0 }, o.prototype.drawImage = function (t, e, i, r, o, n, s, a, h) { this.prerender(), this._context.drawImage(t, e, i, r, o, n, s, a, h) }, o.prototype.fillRect = function (t, e, i, r) { this.prerender(), this._context.fillRect(t, e, i, r) }, o.prototype.fillText = function (t, e, i, r) { this.prerender(), this._context.fillText(t, e, i, r) }, o.prototype.strokeText = function (t, e, i, r) { this.prerender(), this._context.strokeText(t, e, i, r) }, o.prototype.translate = function (t, e) { this.currentState().transformer.translate(t, e), this._modifiedTransform = !0 }, o.prototype.transform = function (t, e, i, r, o, n) { this.currentState().transformer.transform([t, e, i, r, o, n]), this._modifiedTransform = !0 }, o.prototype.setTransform = function (t, e, i, r, o, n) { this.currentState().transformer.setTransform([t, e, i, r, o, n]), this._modifiedTransform = !0 }, o.prototype.setGlobalAlpha = function (t) { this.currentState().globalAlpha = t }, o.prototype.getImageData = function (t, e, i, r) { return this._context.getImageData(t, e, i, r) }, o.prototype.putImageData = function (t, e, i, r, o, n, s) { this._context.putImageData(t, e, i, r, o, n, s) }, o.prototype.prerender = function () { var t = this.currentState(); t.fillStyle !== this._contextFillStyle && (this._context.fillStyle = t.fillStyle, this._contextFillStyle = t.fillStyle), t.globalAlpha !== this._contextGlobalAlpha && (this._context.globalAlpha = t.globalAlpha, this._contextGlobalAlpha = t.globalAlpha), t.globalCompositeOperation !== this._contextGlobalCompositeOperation && (this._context.globalCompositeOperation = t.globalCompositeOperation, this._contextGlobalCompositeOperation = t.globalCompositeOperation), this._modifiedTransform && (t = t.transformer, this._context.setTransform(t.matrix[0], t.matrix[1], t.matrix[2], t.matrix[3], t.matrix[4], t.matrix[5]), this._modifiedTransform = !1) }, o.prototype.pushState = function (t) { this._stateStack.push(t) }, o.prototype.popState = function () { this._stateStack.length <= 1 || (this._stateStack.pop(), this._modifiedTransform = !0, this._contextFillStyle = this._context.fillStyle, this._contextGlobalAlpha = this._context.globalAlpha, this._contextGlobalCompositeOperation = this._context.globalCompositeOperation) }, o.prototype.currentState = function () { return this._stateStack[this._stateStack.length - 1] }, i.CanvasSurfaceContext = o }, { "./CanvasRenderingState": 136 }], 138: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Context2DRenderer = void 0; var r = { "source-over": "source-over", "source-atop": "source-atop", lighter: "lighter", copy: "copy", "experimental-source-in": "source-in", "experimental-source-out": "source-out", "experimental-destination-atop": "destination-atop", "experimental-destination-in": "destination-in", "destination-out": "destination-out", "destination-over": "destination-over", xor: "xor" }; function o(t) { this.surface = t, this.context = t.context(), this.canvasRenderingContext2D = this.context.getCanvasRenderingContext2D() } o.prototype.begin = function () { this.canvasRenderingContext2D.save(), this.context.save() }, o.prototype.end = function () { this.canvasRenderingContext2D.restore(), this.context.restore() }, o.prototype.clear = function () { this.context.clearRect(0, 0, this.surface.width, this.surface.height) }, o.prototype.drawImage = function (t, e, i, r, o, n, s) { this.context.drawImage(t._drawable, e, i, r, o, n, s, r, o) }, o.prototype.drawSprites = function (t, e, i, r, o, n, s, a) { for (var h = 0; h < a; ++h)this.drawImage(t, e[h], i[h], r[h], o[h], n[h], s[h]) }, o.prototype.translate = function (t, e) { this.context.translate(t, e) }, o.prototype.transform = function (t) { this.context.transform(t[0], t[1], t[2], t[3], t[4], t[5]) }, o.prototype.opacity = function (t) { this.context.globalAlpha *= t }, o.prototype.save = function () { this.context.save() }, o.prototype.restore = function () { this.context.restore() }, o.prototype.fillRect = function (t, e, i, r, o) { this.context.fillStyle = o, this.context.fillRect(t, e, i, r) }, o.prototype.setCompositeOperation = function (t) { this.context.globalCompositeOperation = r[t] || "source-over" }, o.prototype.setOpacity = function (t) { this.context.globalAlpha = t }, o.prototype.setTransform = function (t) { this.context.setTransform(t[0], t[1], t[2], t[3], t[4], t[5]) }, o.prototype.setShaderProgram = function (t) { throw new Error("Context2DRenderer#setShaderProgram() is not implemented") }, o.prototype.isSupportedShaderProgram = function () { return !1 }, o.prototype._getImageData = function (t, e, i, r) { return this.context.getImageData(t, e, i, r) }, o.prototype._putImageData = function (t, e, i, r, o, n, s) { void 0 === n && (n = t.width), void 0 === s && (s = t.height), this.context.putImageData(t, e, i, r = void 0 === r ? 0 : r, o = void 0 === o ? 0 : o, n, s) }, i.Context2DRenderer = o }, {}], 139: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.Context2DSurface = void 0, t("../CanvasSurface")), a = t("./CanvasSurfaceContext"), h = t("./Context2DRenderer"), t = (o = s.CanvasSurface, n(c, o), c.prototype.context = function () { return this._context || (this._context = new a.CanvasSurfaceContext(this.canvas.getContext("2d"))), this._context }, c.prototype.renderer = function () { return this._renderer || (this._renderer = new h.Context2DRenderer(this)), this._renderer }, c.prototype.changePhysicalScale = function (t, e) { this.canvas.width = this.width * t, this.canvas.height = this.height * e, this._context.scale(t, e) }, c.prototype.isPlaying = function () { return !1 }, c); function c() { return null !== o && o.apply(this, arguments) || this } i.Context2DSurface = t }, { "../CanvasSurface": 133, "./CanvasSurfaceContext": 137, "./Context2DRenderer": 138 }], 140: [function (t, e, i) { "use strict"; function r() { this._idCounter = 0, this._canvasMap = {}, this._registry = "undefined" != typeof FinalizationRegistry ? new FinalizationRegistry(this._dispose.bind(this)) : null } Object.defineProperty(i, "__esModule", { value: !0 }), i.CanvasDisposer = void 0, r.prototype.register = function (t, e) { var i; this._registry && (i = "".concat(this._idCounter++), this._canvasMap[i] = e, this._registry.register(t, i)) }, r.prototype._dispose = function (t) { var e = this._canvasMap[t]; e && (e.width = 1, e.height = 1, delete this._canvasMap[t]) }, i.CanvasDisposer = r }, {}], 141: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.SurfaceFactory = void 0; var r = t("../context2d/Context2DSurface"), o = t("../RenderingHelper"), n = t("../webgl/WebGLSharedObject"), s = t("./CanvasDisposer"); function a() { this._disposer = new s.CanvasDisposer } a.prototype.createPrimarySurface = function (t, e, i) { return o.RenderingHelper.usedWebGL(i) ? (this._shared || (this._shared = new n.WebGLSharedObject(t, e)), this._shared.getPrimarySurface()) : new r.Context2DSurface(t, e) }, a.prototype.createBackSurface = function (t, e, i) { i = o.RenderingHelper.usedWebGL(i) ? this._shared.createBackSurface(t, e) : new r.Context2DSurface(t, e); return this._disposer.register(i, i.getHTMLElement()), i }, i.SurfaceFactory = a }, { "../RenderingHelper": 135, "../context2d/Context2DSurface": 139, "../webgl/WebGLSharedObject": 150, "./CanvasDisposer": 140 }], 142: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLBackSurface = void 0, t("./WebGLBackSurfaceRenderer")), t = t("./WebGLPrimarySurface"), t = (o = t.WebGLPrimarySurface, n(a, o), a.prototype.renderer = function () { return this._renderer || (this._renderer = new s.WebGLBackSurfaceRenderer(this, this._shared)), this._renderer }, a.prototype.destroy = function () { this._renderer && this._renderer.destroy(), this._renderer = void 0, this._drawable = void 0, o.prototype.destroy.call(this) }, a); function a() { return null !== o && o.apply(this, arguments) || this } i.WebGLBackSurface = t }, { "./WebGLBackSurfaceRenderer": 143, "./WebGLPrimarySurface": 145 }], 143: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLBackSurfaceRenderer = void 0, t("./WebGLRenderer")), a = t("./WebGLRenderingState"), t = (o = s.WebGLRenderer, n(h, o), h.prototype.begin = function () { o.prototype.begin.call(this), this.save(); var t = new a.WebGLRenderingState(this.currentState()), e = t.transformer.matrix; e[1] *= -1, e[3] *= -1, e[5] = -e[5] + this._renderTarget.height, this.currentState().copyFrom(t), this._shared.pushRenderTarget(this._renderTarget) }, h.prototype.end = function () { this.restore(), this._shared.popRenderTarget(), o.prototype.end.call(this) }, h); function h(t, e) { e = o.call(this, e, e.createRenderTarget(t.width, t.height)) || this; return t._drawable = { texture: e._renderTarget.texture, textureOffsetX: 0, textureOffsetY: 0, textureWidth: t.width, textureHeight: t.height }, e } i.WebGLBackSurfaceRenderer = t }, { "./WebGLRenderer": 147, "./WebGLRenderingState": 148 }], 144: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLColor = void 0; var r, o = t("../RenderingHelper"); (r = i.WebGLColor || (i.WebGLColor = {})).colorMap = { ALICEBLUE: [240 / 255, 248 / 255, 1, 1], ANTIQUEWHITE: [250 / 255, 235 / 255, 215 / 255, 1], AQUA: [0, 1, 1, 1], AQUAMARINE: [127 / 255, 1, 212 / 255, 1], AZURE: [240 / 255, 1, 1, 1], BEIGE: [245 / 255, 245 / 255, 220 / 255, 1], BISQUE: [1, 228 / 255, 196 / 255, 1], BLACK: [0, 0, 0, 1], BLANCHEDALMOND: [1, 235 / 255, 205 / 255, 1], BLUE: [0, 0, 1, 1], BLUEVIOLET: [138 / 255, 43 / 255, 226 / 255, 1], BROWN: [165 / 255, 42 / 255, 42 / 255, 1], BURLYWOOD: [222 / 255, 184 / 255, 135 / 255, 1], CADETBLUE: [95 / 255, 158 / 255, 160 / 255, 1], CHARTREUSE: [127 / 255, 1, 0, 1], CHOCOLATE: [210 / 255, 105 / 255, 30 / 255, 1], CORAL: [1, 127 / 255, 80 / 255, 1], CORNFLOWERBLUE: [100 / 255, 149 / 255, 237 / 255, 1], CORNSILK: [1, 248 / 255, 220 / 255, 1], CRIMSON: [220 / 255, 20 / 255, 60 / 255, 1], CYAN: [0, 1, 1, 1], DARKBLUE: [0, 0, 139 / 255, 1], DARKCYAN: [0, 139 / 255, 139 / 255, 1], DARKGOLDENROD: [184 / 255, 134 / 255, 11 / 255, 1], DARKGRAY: [169 / 255, 169 / 255, 169 / 255, 1], DARKGREEN: [0, 100 / 255, 0, 1], DARKGREY: [169 / 255, 169 / 255, 169 / 255, 1], DARKKHAKI: [189 / 255, 183 / 255, 107 / 255, 1], DARKMAGENTA: [139 / 255, 0, 139 / 255, 1], DARKOLIVEGREEN: [85 / 255, 107 / 255, 47 / 255, 1], DARKORANGE: [1, 140 / 255, 0, 1], DARKORCHID: [.6, 50 / 255, .8, 1], DARKRED: [139 / 255, 0, 0, 1], DARKSALMON: [233 / 255, 150 / 255, 122 / 255, 1], DARKSEAGREEN: [143 / 255, 188 / 255, 143 / 255, 1], DARKSLATEBLUE: [72 / 255, 61 / 255, 139 / 255, 1], DARKSLATEGRAY: [47 / 255, 79 / 255, 79 / 255, 1], DARKSLATEGREY: [47 / 255, 79 / 255, 79 / 255, 1], DARKTURQUOISE: [0, 206 / 255, 209 / 255, 1], DARKVIOLET: [148 / 255, 0, 211 / 255, 1], DEEPPINK: [1, 20 / 255, 147 / 255, 1], DEEPSKYBLUE: [0, 191 / 255, 1, 1], DIMGRAY: [105 / 255, 105 / 255, 105 / 255, 1], DIMGREY: [105 / 255, 105 / 255, 105 / 255, 1], DODGERBLUE: [30 / 255, 144 / 255, 1, 1], FIREBRICK: [178 / 255, 34 / 255, 34 / 255, 1], FLORALWHITE: [1, 250 / 255, 240 / 255, 1], FORESTGREEN: [34 / 255, 139 / 255, 34 / 255, 1], FUCHSIA: [1, 0, 1, 1], GAINSBORO: [220 / 255, 220 / 255, 220 / 255, 1], GHOSTWHITE: [248 / 255, 248 / 255, 1, 1], GOLD: [1, 215 / 255, 0, 1], GOLDENROD: [218 / 255, 165 / 255, 32 / 255, 1], GRAY: [128 / 255, 128 / 255, 128 / 255, 1], GREEN: [0, 128 / 255, 0, 1], GREENYELLOW: [173 / 255, 1, 47 / 255, 1], GREY: [128 / 255, 128 / 255, 128 / 255, 1], HONEYDEW: [240 / 255, 1, 240 / 255, 1], HOTPINK: [1, 105 / 255, 180 / 255, 1], INDIANRED: [205 / 255, 92 / 255, 92 / 255, 1], INDIGO: [75 / 255, 0, 130 / 255, 1], IVORY: [1, 1, 240 / 255, 1], KHAKI: [240 / 255, 230 / 255, 140 / 255, 1], LAVENDER: [230 / 255, 230 / 255, 250 / 255, 1], LAVENDERBLUSH: [1, 240 / 255, 245 / 255, 1], LAWNGREEN: [124 / 255, 252 / 255, 0, 1], LEMONCHIFFON: [1, 250 / 255, 205 / 255, 1], LIGHTBLUE: [173 / 255, 216 / 255, 230 / 255, 1], LIGHTCORAL: [240 / 255, 128 / 255, 128 / 255, 1], LIGHTCYAN: [224 / 255, 1, 1, 1], LIGHTGOLDENRODYELLOW: [250 / 255, 250 / 255, 210 / 255, 1], LIGHTGRAY: [211 / 255, 211 / 255, 211 / 255, 1], LIGHTGREEN: [144 / 255, 238 / 255, 144 / 255, 1], LIGHTGREY: [211 / 255, 211 / 255, 211 / 255, 1], LIGHTPINK: [1, 182 / 255, 193 / 255, 1], LIGHTSALMON: [1, 160 / 255, 122 / 255, 1], LIGHTSEAGREEN: [32 / 255, 178 / 255, 170 / 255, 1], LIGHTSKYBLUE: [135 / 255, 206 / 255, 250 / 255, 1], LIGHTSLATEGRAY: [119 / 255, 136 / 255, .6, 1], LIGHTSLATEGREY: [119 / 255, 136 / 255, .6, 1], LIGHTSTEELBLUE: [176 / 255, 196 / 255, 222 / 255, 1], LIGHTYELLOW: [1, 1, 224 / 255, 1], LIME: [0, 1, 0, 1], LIMEGREEN: [50 / 255, 205 / 255, 50 / 255, 1], LINEN: [250 / 255, 240 / 255, 230 / 255, 1], MAGENTA: [1, 0, 1, 1], MAROON: [128 / 255, 0, 0, 1], MEDIUMAQUAMARINE: [.4, 205 / 255, 170 / 255, 1], MEDIUMBLUE: [0, 0, 205 / 255, 1], MEDIUMORCHID: [186 / 255, 85 / 255, 211 / 255, 1], MEDIUMPURPLE: [147 / 255, 112 / 255, 219 / 255, 1], MEDIUMSEAGREEN: [60 / 255, 179 / 255, 113 / 255, 1], MEDIUMSLATEBLUE: [123 / 255, 104 / 255, 238 / 255, 1], MEDIUMSPRINGGREEN: [0, 250 / 255, 154 / 255, 1], MEDIUMTURQUOISE: [72 / 255, 209 / 255, .8, 1], MEDIUMVIOLETRED: [199 / 255, 21 / 255, 133 / 255, 1], MIDNIGHTBLUE: [25 / 255, 25 / 255, 112 / 255, 1], MINTCREAM: [245 / 255, 1, 250 / 255, 1], MISTYROSE: [1, 228 / 255, 225 / 255, 1], MOCCASIN: [1, 228 / 255, 181 / 255, 1], NAVAJOWHITE: [1, 222 / 255, 173 / 255, 1], NAVY: [0, 0, 128 / 255, 1], OLDLACE: [253 / 255, 245 / 255, 230 / 255, 1], OLIVE: [128 / 255, 128 / 255, 0, 1], OLIVEDRAB: [107 / 255, 142 / 255, 35 / 255, 1], ORANGE: [1, 165 / 255, 0, 1], ORANGERED: [1, 69 / 255, 0, 1], ORCHID: [218 / 255, 112 / 255, 214 / 255, 1], PALEGOLDENROD: [238 / 255, 232 / 255, 170 / 255, 1], PALEGREEN: [152 / 255, 251 / 255, 152 / 255, 1], PALETURQUOISE: [175 / 255, 238 / 255, 238 / 255, 1], PALEVIOLETRED: [219 / 255, 112 / 255, 147 / 255, 1], PAPAYAWHIP: [1, 239 / 255, 213 / 255, 1], PEACHPUFF: [1, 218 / 255, 185 / 255, 1], PERU: [205 / 255, 133 / 255, 63 / 255, 1], PINK: [1, 192 / 255, 203 / 255, 1], PLUM: [221 / 255, 160 / 255, 221 / 255, 1], POWDERBLUE: [176 / 255, 224 / 255, 230 / 255, 1], PURPLE: [128 / 255, 0, 128 / 255, 1], RED: [1, 0, 0, 1], ROSYBROWN: [188 / 255, 143 / 255, 143 / 255, 1], ROYALBLUE: [65 / 255, 105 / 255, 225 / 255, 1], SADDLEBROWN: [139 / 255, 69 / 255, 19 / 255, 1], SALMON: [250 / 255, 128 / 255, 114 / 255, 1], SANDYBROWN: [244 / 255, 164 / 255, 96 / 255, 1], SEAGREEN: [46 / 255, 139 / 255, 87 / 255, 1], SEASHELL: [1, 245 / 255, 238 / 255, 1], SIENNA: [160 / 255, 82 / 255, 45 / 255, 1], SILVER: [192 / 255, 192 / 255, 192 / 255, 1], SKYBLUE: [135 / 255, 206 / 255, 235 / 255, 1], SLATEBLUE: [106 / 255, 90 / 255, 205 / 255, 1], SLATEGRAY: [112 / 255, 128 / 255, 144 / 255, 1], SLATEGREY: [112 / 255, 128 / 255, 144 / 255, 1], SNOW: [1, 250 / 255, 250 / 255, 1], SPRINGGREEN: [0, 1, 127 / 255, 1], STEELBLUE: [70 / 255, 130 / 255, 180 / 255, 1], TAN: [210 / 255, 180 / 255, 140 / 255, 1], TEAL: [0, 128 / 255, 128 / 255, 1], THISTLE: [216 / 255, 191 / 255, 216 / 255, 1], TOMATO: [1, 99 / 255, 71 / 255, 1], TURQUOISE: [64 / 255, 224 / 255, 208 / 255, 1], VIOLET: [238 / 255, 130 / 255, 238 / 255, 1], WHEAT: [245 / 255, 222 / 255, 179 / 255, 1], WHITE: [1, 1, 1, 1], WHITESMOKE: [245 / 255, 245 / 255, 245 / 255, 1], YELLOW: [1, 1, 0, 1], YELLOWGREEN: [154 / 255, 205 / 255, 50 / 255, 1] }, r.get = function (t) { return (t = "string" == typeof t ? r._toColor(t) : [t[0], t[1], t[2], t[3]])[3] = o.RenderingHelper.clamp(t[3]), t[0] = o.RenderingHelper.clamp(t[0]) * t[3], t[1] = o.RenderingHelper.clamp(t[1]) * t[3], t[2] = o.RenderingHelper.clamp(t[2]) * t[3], t }, r._hsl2rgb = function (t) { var e = t[0] % 360, i = t[1], r = 50 < t[2] ? 100 - t[2] : t[2], t = t[3], o = r + r * i, r = r - r * i; return e < 60 ? [o, e / 60 * (o - r) + r, r, t] : e < 120 ? [(120 - e) / 60 * (o - r) + r, o, r, t] : e < 180 ? [r, o, (e - 120) / 60 * (o - r) + r, t] : e < 240 ? [r, (240 - e) / 60 * (o - r) + r, o, t] : e < 300 ? [(e - 240) / 60 * (o - r) + r, r, o, t] : [o, r, (360 - e) / 60 * (o - r) + r, t] }, r._toColor = function (t) { var t = t.toUpperCase().replace(/\s+/g, ""), e = r.colorMap[t]; if (e) return e; if (t.match(/^#([\dA-F])([\dA-F])([\dA-F])$/)) return [parseInt(RegExp.$1, 16) / 15, parseInt(RegExp.$2, 16) / 15, parseInt(RegExp.$3, 16) / 15, 1]; if (t.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/)) return [parseInt(RegExp.$1, 16) / 255, parseInt(RegExp.$2, 16) / 255, parseInt(RegExp.$3, 16) / 255, 1]; if (t.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)) return [parseInt(RegExp.$1, 10) / 255, parseInt(RegExp.$2, 10) / 255, parseInt(RegExp.$3, 10) / 255, 1]; if (t.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/)) return [parseInt(RegExp.$1, 10) / 255, parseInt(RegExp.$2, 10) / 255, parseInt(RegExp.$3, 10) / 255, parseFloat(RegExp.$4)]; if (t.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/)) return r._hsl2rgb([parseInt(RegExp.$1, 10), o.RenderingHelper.clamp(parseInt(RegExp.$2, 10) / 100), o.RenderingHelper.clamp(parseInt(RegExp.$3, 10) / 100), 1]); if (t.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/)) return r._hsl2rgb([parseInt(RegExp.$1, 10), o.RenderingHelper.clamp(parseInt(RegExp.$2, 10) / 100), o.RenderingHelper.clamp(parseInt(RegExp.$3, 10) / 100), parseFloat(RegExp.$4)]); throw Error("illigal cssColor format: " + t) } }, { "../RenderingHelper": 135 }], 145: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLPrimarySurface = void 0, t("../CanvasSurface")), a = t("./WebGLPrimarySurfaceRenderer"), t = (o = s.CanvasSurface, n(h, o), h.prototype.renderer = function () { return this._renderer || (this._renderer = new a.WebGLPrimarySurfaceRenderer(this._shared, this._shared.getPrimaryRenderTarget(this.width, this.height))), this._renderer }, h.prototype.changePhysicalScale = function (t, e) { t = Math.ceil(this.width * t), e = Math.ceil(this.height * e); this.canvas.width = t, this.canvas.height = e, this.renderer().changeViewportSize(t, e) }, h.prototype.isPlaying = function () { return !1 }, h); function h(t, e, i) { e = o.call(this, e, i) || this; return e.canvas.style.position = "absolute", e._shared = t, e } i.WebGLPrimarySurface = t }, { "../CanvasSurface": 133, "./WebGLPrimarySurfaceRenderer": 146 }], 146: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLPrimarySurfaceRenderer = void 0, t("./WebGLRenderer")), t = (o = t.WebGLRenderer, n(s, o), s.prototype.begin = function () { o.prototype.begin.call(this), this._shared.begin() }, s); function s(t, e) { t = o.call(this, t, e) || this; return t._shared.pushRenderTarget(t._renderTarget), t } i.WebGLPrimarySurfaceRenderer = t }, { "./WebGLRenderer": 147 }], 147: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLRenderer = void 0; var n = t("./WebGLColor"), r = t("./WebGLRenderingState"); function o(t, e) { this._stateStack = [], this._stateStackPointer = 0, this._capacity = 0, this._reallocation(o.DEFAULT_CAPACITY), this._whiteColor = [1, 1, 1, 1], this._shared = t, this._renderTarget = e } o.prototype.clear = function () { this._shared.clear() }, o.prototype.begin = function () { }, o.prototype.end = function () { this._shared.end() }, o.prototype.save = function () { this._pushState() }, o.prototype.restore = function () { this._popState() }, o.prototype.translate = function (t, e) { this.currentState().transformer.translate(t, e) }, o.prototype.transform = function (t) { this.currentState().transformer.transform(t) }, o.prototype.opacity = function (t) { this.currentState().globalAlpha *= t }, o.prototype.setCompositeOperation = function (t) { this.currentState().globalCompositeOperation = t }, o.prototype.currentState = function () { return this._stateStack[this._stateStackPointer] }, o.prototype.fillRect = function (t, e, i, r, o) { this._shared.draw(this.currentState(), this._shared.getFillRectSurfaceTexture(), 0, 0, i, r, t, e, n.WebGLColor.get(o)) }, o.prototype.drawSprites = function (t, e, i, r, o, n, s, a) { for (var h = 0; h < a; ++h)this.drawImage(t, e[h], i[h], r[h], o[h], n[h], s[h]) }, o.prototype.drawImage = function (t, e, i, r, o, n, s) { if (!t._drawable) throw new Error("WebGLRenderer#drawImage: no drawable surface."); if (t._drawable.texture instanceof WebGLTexture || this._shared.makeTextureForSurface(t), !t._drawable.texture) throw new Error("WebGLRenderer#drawImage: could not create a texture."); this._shared.draw(this.currentState(), t._drawable, e, i, r, o, n, s, this._whiteColor) }, o.prototype.setTransform = function (t) { this.currentState().transformer.setTransform(t) }, o.prototype.setOpacity = function (t) { this.currentState().globalAlpha = t }, o.prototype.setShaderProgram = function (t) { this.currentState().shaderProgram = this._shared.initializeShaderProgram(t) }, o.prototype.isSupportedShaderProgram = function () { return !0 }, o.prototype.changeViewportSize = function (t, e) { var i = this._renderTarget; this._renderTarget = { width: i.width, height: i.height, viewportWidth: t, viewportHeight: e, texture: i.texture, framebuffer: i.framebuffer } }, o.prototype.destroy = function () { this._shared.requestDeleteRenderTarget(this._renderTarget), this._shared = void 0, this._renderTarget = void 0, this._whiteColor = void 0 }, o.prototype._getImageData = function () { throw new Error("WebGLRenderer#_getImageData() is not implemented") }, o.prototype._putImageData = function (t, e, i, r, o, n, s) { throw new Error("WebGLRenderer#_putImageData() is not implemented") }, o.prototype._pushState = function () { var t = this.currentState(); ++this._stateStackPointer, this._isOverCapacity() && this._reallocation(this._stateStackPointer + 1), this.currentState().copyFrom(t) }, o.prototype._popState = function () { if (!(0 < this._stateStackPointer)) throw new Error("WebGLRenderer#restore: state stack under-flow."); this.currentState().shaderProgram = null, --this._stateStackPointer }, o.prototype._isOverCapacity = function () { return this._capacity <= this._stateStackPointer }, o.prototype._reallocation = function (t) { var e = this._capacity; if (e < t) { t < 2 * e ? this._capacity *= 2 : this._capacity = t; for (var i = e; i < this._capacity; ++i)this._stateStack.push(new r.WebGLRenderingState) } }, o.DEFAULT_CAPACITY = 16, i.WebGLRenderer = o }, { "./WebGLColor": 144, "./WebGLRenderingState": 148 }], 148: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLRenderingState = void 0; var r = t("../AffineTransformer"); function o(t) { t ? (this.globalAlpha = t.globalAlpha, this.globalCompositeOperation = t.globalCompositeOperation, this.transformer = new r.AffineTransformer(t.transformer), this.shaderProgram = t.shaderProgram) : (this.globalAlpha = 1, this.globalCompositeOperation = "source-over", this.transformer = new r.AffineTransformer, this.shaderProgram = null) } o.prototype.copyFrom = function (t) { return this.globalAlpha = t.globalAlpha, this.globalCompositeOperation = t.globalCompositeOperation, this.transformer.copyFrom(t.transformer), this.shaderProgram = t.shaderProgram, this }, i.WebGLRenderingState = o }, { "../AffineTransformer": 132 }], 149: [function (t, e, i) { "use strict"; function o(t, e, i) { e = o._makeShaderProgram(t, o._DEFAULT_VERTEX_SHADER, e = e || o._DEFAULT_FRAGMENT_SHADER); this.program = e, this._context = t, this._aVertex = t.getAttribLocation(this.program, "aVertex"), this._uColor = t.getUniformLocation(this.program, "uColor"), this._uAlpha = t.getUniformLocation(this.program, "uAlpha"), this._uSampler = t.getUniformLocation(this.program, "uSampler"), this._uniforms = i, this._uniformCaches = [], this._uniformSetterTable = { float: this._uniform1f.bind(this), int: this._uniform1i.bind(this), float_v: this._uniform1fv.bind(this), int_v: this._uniform1iv.bind(this), vec2: this._uniform2fv.bind(this), vec3: this._uniform3fv.bind(this), vec4: this._uniform4fv.bind(this), ivec2: this._uniform2iv.bind(this), ivec3: this._uniform3iv.bind(this), ivec4: this._uniform4iv.bind(this), mat2: this._uniformMatrix2fv.bind(this), mat3: this._uniformMatrix3fv.bind(this), mat4: this._uniformMatrix4fv.bind(this) } } Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLShaderProgram = void 0, o._makeShader = function (t, e, i) { e = t.createShader(e); if (t.shaderSource(e, i), t.compileShader(e), t.getShaderParameter(e, t.COMPILE_STATUS)) return e; throw i = t.getShaderInfoLog(e), t.deleteShader(e), new Error(i) }, o._makeShaderProgram = function (t, e, i) { var r = t.createProgram(), e = o._makeShader(t, t.VERTEX_SHADER, e), e = (t.attachShader(r, e), t.deleteShader(e), o._makeShader(t, t.FRAGMENT_SHADER, i)); if (t.attachShader(r, e), t.deleteShader(e), t.linkProgram(r), t.getProgramParameter(r, t.LINK_STATUS)) return r; throw i = t.getProgramInfoLog(r), t.deleteProgram(r), new Error(i) }, o.prototype.set_aVertex = function (t) { this._context.bindBuffer(this._context.ARRAY_BUFFER, t), this._context.enableVertexAttribArray(this._aVertex), this._context.vertexAttribPointer(this._aVertex, 4, this._context.FLOAT, !1, 0, 0) }, o.prototype.set_uColor = function (t) { this._context.uniform4f(this._uColor, t[0], t[1], t[2], t[3]) }, o.prototype.set_uAlpha = function (t) { this._context.uniform1f(this._uAlpha, t) }, o.prototype.set_uSampler = function (t) { this._context.uniform1i(this._uSampler, t) }, o.prototype.updateUniforms = function () { for (var t = 0; t < this._uniformCaches.length; ++t) { var e = this._uniformCaches[t], i = this._uniforms[e.name].value; !e.isArray && i === e.beforeValue || (e.update(e.loc, i), e.beforeValue = i) } }, o.prototype.initializeUniforms = function () { var o = this, n = [], s = this._uniforms; null != s && Object.keys(s).forEach(function (t) { var e = s[t].type, i = !("number" == typeof s[t].value), r = (!i || "int" !== e && "float" !== e || (e += "_v"), o._uniformSetterTable[e]); if (!r) throw new Error("WebGLShaderProgram#initializeUniforms: Uniform type '" + e + "' is not supported."); n.push({ name: t, update: r, beforeValue: null, isArray: i, loc: o._context.getUniformLocation(o.program, t) }) }), this._uniformCaches = n }, o.prototype.use = function () { this._context.useProgram(this.program) }, o.prototype.unuse = function () { this._context.useProgram(null) }, o.prototype.destroy = function () { this._context.deleteProgram(this.program) }, o.prototype._uniform1f = function (t, e) { this._context.uniform1f(t, e) }, o.prototype._uniform1i = function (t, e) { this._context.uniform1i(t, e) }, o.prototype._uniform1fv = function (t, e) { this._context.uniform1fv(t, e) }, o.prototype._uniform1iv = function (t, e) { this._context.uniform1iv(t, e) }, o.prototype._uniform2fv = function (t, e) { this._context.uniform2fv(t, e) }, o.prototype._uniform3fv = function (t, e) { this._context.uniform3fv(t, e) }, o.prototype._uniform4fv = function (t, e) { this._context.uniform4fv(t, e) }, o.prototype._uniform2iv = function (t, e) { this._context.uniform2iv(t, e) }, o.prototype._uniform3iv = function (t, e) { this._context.uniform3iv(t, e) }, o.prototype._uniform4iv = function (t, e) { this._context.uniform4iv(t, e) }, o.prototype._uniformMatrix2fv = function (t, e) { this._context.uniformMatrix2fv(t, !1, e) }, o.prototype._uniformMatrix3fv = function (t, e) { this._context.uniformMatrix3fv(t, !1, e) }, o.prototype._uniformMatrix4fv = function (t, e) { this._context.uniformMatrix4fv(t, !1, e) }, o._DEFAULT_VERTEX_SHADER = "#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}", o._DEFAULT_FRAGMENT_SHADER = "#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}", i.WebGLShaderProgram = o }, {}], 150: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLSharedObject = void 0; var r = t("./WebGLBackSurface"), o = t("./WebGLPrimarySurface"), n = t("./WebGLShaderProgram"), s = t("./WebGLTextureAtlas"); function a(t, e) { t = new o.WebGLPrimarySurface(this, t, e), e = t.canvas.getContext("webgl", { depth: !1, preserveDrawingBuffer: !0 }); if (!e) throw new Error("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext"); this._surface = t, this._context = e, this._init() } a.prototype.getFillRectSurfaceTexture = function () { return this._fillRectSurfaceTexture }, a.prototype.getPrimarySurface = function () { return this._surface }, a.prototype.createBackSurface = function (t, e) { return new r.WebGLBackSurface(this, t, e) }, a.prototype.pushRenderTarget = function (t) { this._commit(), this._renderTargetStack.push(t), this._context.bindFramebuffer(this._context.FRAMEBUFFER, t.framebuffer), this._context.viewport(0, 0, t.viewportWidth, t.viewportHeight) }, a.prototype.popRenderTarget = function () { this._commit(), this._renderTargetStack.pop(); var t = this.getCurrentRenderTarget(); this._context.bindFramebuffer(this._context.FRAMEBUFFER, t.framebuffer), this._context.viewport(0, 0, t.viewportWidth, t.viewportHeight) }, a.prototype.getCurrentRenderTarget = function () { return this._renderTargetStack[this._renderTargetStack.length - 1] }, a.prototype.begin = function () { this.clear(), this._currentShaderProgram.use(), this._currentShaderProgram.set_aVertex(this._vertices), this._currentShaderProgram.set_uColor(this._currentColor), this._currentShaderProgram.set_uAlpha(this._currentAlpha), this._currentShaderProgram.set_uSampler(0), this._currentShaderProgram.updateUniforms() }, a.prototype.clear = function () { this._context.clear(this._context.COLOR_BUFFER_BIT) }, a.prototype.draw = function (t, e, i, r, o, n, s, a, h) { this._numSprites >= this._maxSpriteCount && this._commit(), c = e === this._fillRectSurfaceTexture || null == t.shaderProgram || null == t.shaderProgram._program ? this._defaultShaderProgram : t.shaderProgram._program, this._currentShaderProgram !== c && (this._commit(), this._currentShaderProgram = c, this._currentShaderProgram.use(), this._currentShaderProgram.updateUniforms(), this._currentCompositeOperation = null, this._currentAlpha = null, this._currentColor = [], this._currentTexture = null), this._currentTexture !== e.texture && (this._currentTexture = e.texture, this._commit(), this._context.bindTexture(this._context.TEXTURE_2D, e.texture)), this._currentColor[0] === h[0] && this._currentColor[1] === h[1] && this._currentColor[2] === h[2] && this._currentColor[3] === h[3] || (this._currentColor = h, this._commit(), this._currentShaderProgram.set_uColor(h)), this._currentAlpha !== t.globalAlpha && (this._currentAlpha = t.globalAlpha, this._commit(), this._currentShaderProgram.set_uAlpha(t.globalAlpha)), this._currentCompositeOperation !== t.globalCompositeOperation && (this._currentCompositeOperation = t.globalCompositeOperation, this._commit(), c = this._compositeOps[this._currentCompositeOperation], this._context.blendFunc(c[0], c[1])); var h = 1 / e.textureWidth, c = 1 / e.textureHeight, u = e.textureOffsetX, e = e.textureOffsetY, l = h * (u + i + o), d = c * (e + r + n), h = h * (u + i), u = c * (e + r); this._register(this._transformVertex(s, a, o, n, t.transformer), [h, u, l, u, l, d, h, u, l, d, h, d]) }, a.prototype.end = function () { if (this._commit(), 0 < this._deleteRequestedTargets.length) { for (var t = 0; t < this._deleteRequestedTargets.length; ++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]); this._deleteRequestedTargets = [] } }, a.prototype.makeTextureForSurface = function (t) { this._textureAtlas.makeTextureForSurface(this, t) }, a.prototype.disposeTexture = function (t) { this._currentTexture === t && this._commit() }, a.prototype.assignTexture = function (t, e, i, r) { if (this._context.bindTexture(this._context.TEXTURE_2D, r), t instanceof HTMLVideoElement) throw new Error("WebGLRenderer#assignTexture: HTMLVideoElement is not supported."); this._context.texSubImage2D(this._context.TEXTURE_2D, 0, e, i, this._context.RGBA, this._context.UNSIGNED_BYTE, t), this._context.bindTexture(this._context.TEXTURE_2D, this._currentTexture) }, a.prototype.clearTexture = function (t, e, i, r) { this._context.bindTexture(this._context.TEXTURE_2D, r), this._context.texSubImage2D(this._context.TEXTURE_2D, 0, 0, 0, e, i, this._context.RGBA, this._context.UNSIGNED_BYTE, t), this._context.bindTexture(this._context.TEXTURE_2D, this._currentTexture) }, a.prototype.makeTextureRaw = function (t, e, i) { void 0 === i && (i = null); var r = this._context.createTexture(); return this._context.bindTexture(this._context.TEXTURE_2D, r), this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1), this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_WRAP_S, this._context.CLAMP_TO_EDGE), this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_WRAP_T, this._context.CLAMP_TO_EDGE), this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_MAG_FILTER, this._context.NEAREST), this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_MIN_FILTER, this._context.NEAREST), this._context.texImage2D(this._context.TEXTURE_2D, 0, this._context.RGBA, t, e, 0, this._context.RGBA, this._context.UNSIGNED_BYTE, i), this._context.bindTexture(this._context.TEXTURE_2D, this._currentTexture), r }, a.prototype.makeTexture = function (t) { var e = this._context.createTexture(); return this._context.bindTexture(this._context.TEXTURE_2D, e), this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1), this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_WRAP_S, this._context.CLAMP_TO_EDGE), this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_WRAP_T, this._context.CLAMP_TO_EDGE), this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_MAG_FILTER, this._context.NEAREST), this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_MIN_FILTER, this._context.NEAREST), (t instanceof HTMLImageElement || t instanceof HTMLCanvasElement || t instanceof ImageData) && this._context.texImage2D(this._context.TEXTURE_2D, 0, this._context.RGBA, this._context.RGBA, this._context.UNSIGNED_BYTE, t), this._context.bindTexture(this._context.TEXTURE_2D, this._currentTexture), e }, a.prototype.getPrimaryRenderTarget = function (t, e) { return this._renderTarget }, a.prototype.createRenderTarget = function (t, e) { var i = this._context, r = i.createFramebuffer(), o = (i.bindFramebuffer(i.FRAMEBUFFER, r), i.createTexture()), n = (i.bindTexture(i.TEXTURE_2D, o), i.texParameteri(i.TEXTURE_2D, i.TEXTURE_MAG_FILTER, i.LINEAR), i.texParameteri(i.TEXTURE_2D, i.TEXTURE_MIN_FILTER, i.LINEAR), i.texParameteri(i.TEXTURE_2D, i.TEXTURE_WRAP_S, i.CLAMP_TO_EDGE), i.texParameteri(i.TEXTURE_2D, i.TEXTURE_WRAP_T, i.CLAMP_TO_EDGE), i.texImage2D(i.TEXTURE_2D, 0, i.RGBA, t, e, 0, i.RGBA, i.UNSIGNED_BYTE, null), i.framebufferTexture2D(i.FRAMEBUFFER, i.COLOR_ATTACHMENT0, i.TEXTURE_2D, o, 0), i.bindTexture(i.TEXTURE_2D, this._currentTexture), this.getCurrentRenderTarget()); return i.bindFramebuffer(i.FRAMEBUFFER, n.framebuffer), { width: t, height: e, viewportWidth: t, viewportHeight: e, framebuffer: r, texture: o } }, a.prototype.requestDeleteRenderTarget = function (t) { this._deleteRequestedTargets.push(t) }, a.prototype.deleteRenderTarget = function (t) { var e = this._context; this.getCurrentRenderTarget() === t && this._commit(), e.deleteFramebuffer(t.framebuffer), e.deleteTexture(t.texture) }, a.prototype.getContext = function () { return this._context }, a.prototype.getDefaultShaderProgram = function () { return this._defaultShaderProgram }, a.prototype.initializeShaderProgram = function (t) { var e; return t && !t._program && ((e = new n.WebGLShaderProgram(this._context, t.fragmentShader, t.uniforms)).initializeUniforms(), t._program = e), t }, a.prototype._init = function () { var t = new n.WebGLShaderProgram(this._context); this._textureAtlas = new s.WebGLTextureAtlas, this._fillRectTexture = this.makeTextureRaw(1, 1, new Uint8Array([255, 255, 255, 255])), this._fillRectSurfaceTexture = { texture: this._fillRectTexture, textureWidth: 1, textureHeight: 1, textureOffsetX: 0, textureOffsetY: 0 }, this._renderTarget = { width: this._surface.width, height: this._surface.height, viewportWidth: this._surface.width, viewportHeight: this._surface.height, framebuffer: null, texture: null }, this._maxSpriteCount = 1024, this._vertices = this._makeBuffer(24 * this._maxSpriteCount * 4), this._verticesCache = new Float32Array(24 * this._maxSpriteCount), this._numSprites = 0, this._currentTexture = null, this._currentColor = [1, 1, 1, 1], this._currentAlpha = 1, this._currentCompositeOperation = "source-over", this._currentShaderProgram = t, this._defaultShaderProgram = t, this._renderTargetStack = [], this._deleteRequestedTargets = [], this._currentShaderProgram.use(); try { this._currentShaderProgram.set_aVertex(this._vertices), this._currentShaderProgram.set_uColor(this._currentColor), this._currentShaderProgram.set_uAlpha(this._currentAlpha), this._currentShaderProgram.set_uSampler(0) } finally { this._currentShaderProgram.unuse() } this._context.enable(this._context.BLEND), this._context.activeTexture(this._context.TEXTURE0), this._context.bindTexture(this._context.TEXTURE_2D, this._fillRectTexture), this._compositeOps = { "source-atop": [this._context.DST_ALPHA, this._context.ONE_MINUS_SRC_ALPHA], "experimental-source-in": [this._context.DST_ALPHA, this._context.ZERO], "experimental-source-out": [this._context.ONE_MINUS_DST_ALPHA, this._context.ZERO], "source-over": [this._context.ONE, this._context.ONE_MINUS_SRC_ALPHA], "experimental-destination-atop": [this._context.ONE_MINUS_DST_ALPHA, this._context.SRC_ALPHA], "experimental-destination-in": [this._context.ZERO, this._context.SRC_ALPHA], "destination-out": [this._context.ZERO, this._context.ONE_MINUS_SRC_ALPHA], "destination-over": [this._context.ONE_MINUS_DST_ALPHA, this._context.ONE], lighter: [this._context.ONE, this._context.ONE], copy: [this._context.ONE, this._context.ZERO], xor: [this._context.ONE_MINUS_DST_ALPHA, this._context.ONE_MINUS_SRC_ALPHA] }; t = this._compositeOps[this._currentCompositeOperation]; this._context.blendFunc(t[0], t[1]) }, a.prototype._makeBuffer = function (t) { var e = this._context.createBuffer(); return this._context.bindBuffer(this._context.ARRAY_BUFFER, e), this._context.bufferData(this._context.ARRAY_BUFFER, t, this._context.DYNAMIC_DRAW), e }, a.prototype._transformVertex = function (t, e, i, r, o) { var n = this.getCurrentRenderTarget(), s = 2 / n.width, n = -2 / n.height, o = o.matrix, a = s * i * o[0], i = n * i * o[1], h = s * r * o[2], r = n * r * o[3], s = s * (t * o[0] + e * o[2] + o[4]) - 1, n = n * (t * o[1] + e * o[3] + o[5]) + 1; return [s, n, a + s, i + n, a + h + s, i + r + n, s, n, a + h + s, i + r + n, h + s, r + n] }, a.prototype._register = function (t, e) { var i = 6 * this._numSprites; ++this._numSprites; for (var r = 0; r < 6; ++r)this._verticesCache[4 * (r + i) + 0] = t[2 * r + 0], this._verticesCache[4 * (r + i) + 1] = t[2 * r + 1], this._verticesCache[4 * (r + i) + 2] = e[2 * r + 0], this._verticesCache[4 * (r + i) + 3] = e[2 * r + 1] }, a.prototype._commit = function () { 0 < this._numSprites && (this._context.bindBuffer(this._context.ARRAY_BUFFER, this._vertices), this._context.bufferSubData(this._context.ARRAY_BUFFER, 0, this._verticesCache.subarray(0, 24 * this._numSprites)), this._context.drawArrays(this._context.TRIANGLES, 0, 6 * this._numSprites), this._numSprites = 0) }, i.WebGLSharedObject = a }, { "./WebGLBackSurface": 142, "./WebGLPrimarySurface": 145, "./WebGLShaderProgram": 149, "./WebGLTextureAtlas": 151 }], 151: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLTextureAtlas = void 0; var s = t("../RenderingHelper"), n = t("./WebGLTextureMap"); function a() { this._maps = [], this._insertPos = 0, this.emptyTexturePixels = new Uint8Array(a.TEXTURE_SIZE * a.TEXTURE_SIZE * 4) } a.prototype.clear = function () { for (var t = 0; t < this._maps.length; ++t)this._maps[t].dispose() }, a.prototype.showOccupancy = function () { for (var t = 0; t < this._maps.length; ++t)console.log("occupancy[" + t + "]: " + this._maps[t].occupancy()) }, a.prototype.makeTextureForSurface = function (t, e) { var i, r, o, n = e._drawable; n && !n.texture && (i = n.width, r = n.height, a.TEXTURE_SIZE <= i || a.TEXTURE_SIZE <= r ? (i = s.RenderingHelper.toPowerOfTwo(n.width), r = s.RenderingHelper.toPowerOfTwo(n.height), i === n.width && r === n.height || ((o = document.createElement("canvas")).width = i, o.height = r, (o = o.getContext("2d")).globalCompositeOperation = "copy", o.drawImage(n, 0, 0), n = o.getImageData(0, 0, i, r)), e._drawable.texture = t.makeTexture(n), e._drawable.textureOffsetX = 0, e._drawable.textureOffsetY = 0, e._drawable.textureWidth = i, e._drawable.textureHeight = r) : this._assign(t, e, this._maps)) }, a.prototype._assign = function (t, e, i) { for (var r, o = 0; o < i.length; ++o)if (r = i[(o + this._insertPos) % i.length].insert(e)) return this._register(t, r, e._drawable), void (this._insertPos = o); r = null, i.length >= a.TEXTURE_COUNT && (r = i.shift(), t.disposeTexture(r.texture), r.dispose(), t.clearTexture(this.emptyTexturePixels, a.TEXTURE_SIZE, a.TEXTURE_SIZE, r.texture)), r = r || new n.WebGLTextureMap(t.makeTextureRaw(a.TEXTURE_SIZE, a.TEXTURE_SIZE), 0, 0, a.TEXTURE_SIZE, a.TEXTURE_SIZE), i.push(r), r = r.insert(e), this._register(t, r, e._drawable) }, a.prototype._register = function (t, e, i) { i.texture = e.texture, i.textureOffsetX = e.offsetX, i.textureOffsetY = e.offsetY, i.textureWidth = a.TEXTURE_SIZE, i.textureHeight = a.TEXTURE_SIZE, t.assignTexture(i, e.offsetX, e.offsetY, e.texture) }, a.TEXTURE_SIZE = 1024, a.TEXTURE_COUNT = 16, i.WebGLTextureAtlas = a }, { "../RenderingHelper": 135, "./WebGLTextureMap": 152 }], 152: [function (t, e, i) { "use strict"; function n(t, e, i, r, o) { this.texture = t, this.offsetX = e, this.offsetY = i, this._width = r, this._height = o } Object.defineProperty(i, "__esModule", { value: !0 }), i.WebGLTextureMap = void 0, n.prototype.dispose = function () { this._left && (this._left.dispose(), this._left = null), this._right && (this._right.dispose(), this._right = null), this._surface && (this._surface._drawable && (this._surface._drawable.texture = null), this._surface = null) }, n.prototype.capacity = function () { return this._width * this._height }, n.prototype.area = function () { var t; return this._surface ? (t = (t = this._surface._drawable).width * t.height, this._left && (t += this._left.area()), this._right && (t += this._right.area()), t) : 0 }, n.prototype.occupancy = function () { return this.area() / this.capacity() }, n.prototype.insert = function (t) { var e, i = t._drawable, r = i.width + n.TEXTURE_MARGIN, i = i.height + n.TEXTURE_MARGIN; if (this._surface) { if (this._left) { var o = this._left.insert(t); if (o) return o } if (this._right) { var o = this._right.insert(t); if (o) return o } return null } return this._width < r || this._height < i ? null : ((o = this._width - r) <= (e = this._height - i) ? (this._left = new n(this.texture, this.offsetX + r, this.offsetY, o, i), this._right = new n(this.texture, this.offsetX, this.offsetY + i, this._width, e)) : (this._left = new n(this.texture, this.offsetX, this.offsetY + i, r, e), this._right = new n(this.texture, this.offsetX + r, this.offsetY, o, this._height)), this._surface = t, this) }, n.TEXTURE_MARGIN = 1, i.WebGLTextureMap = n }, {}], 153: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.InputAbstractHandler = void 0; var r = t("@akashic/trigger"); function o(t, e) { if (Object.getPrototypeOf && Object.getPrototypeOf(this) === o.prototype) throw new Error("InputAbstractHandler is abstract and should not be directly instantiated"); this.inputView = t, this.pointerEventLock = {}, this._xScale = 1, this._yScale = 1, this._disablePreventDefault = !!e, this.pointTrigger = new r.Trigger } o.isSupported = function () { return !1 }, o.prototype.start = function () { throw new Error("This method is abstract") }, o.prototype.stop = function () { throw new Error("This method is abstract") }, o.prototype.setScale = function (t, e) { void 0 === e && (e = t), this._xScale = t, this._yScale = e }, o.prototype.pointDown = function (t, e) { this.pointTrigger.fire({ type: 0, identifier: t, offset: this.getOffsetFromEvent(e) }), this.pointerEventLock[t] = !0 }, o.prototype.pointMove = function (t, e) { this.pointerEventLock.hasOwnProperty(t + "") && this.pointTrigger.fire({ type: 1, identifier: t, offset: this.getOffsetFromEvent(e) }) }, o.prototype.pointUp = function (t, e) { this.pointerEventLock.hasOwnProperty(t + "") && (this.pointTrigger.fire({ type: 2, identifier: t, offset: this.getOffsetFromEvent(e) }), delete this.pointerEventLock[t]) }, o.prototype.getOffsetFromEvent = function (t) { return { x: t.offsetX, y: t.offsetY } }, o.prototype.getScale = function () { return { x: this._xScale, y: this._yScale } }, o.prototype.getOffsetPositionFromInputView = function (t) { var e = this.inputView.getBoundingClientRect(), i = this.getScale(); return { offsetX: (t.pageX - Math.round(window.pageXOffset + e.left)) / i.x, offsetY: (t.pageY - Math.round(window.pageYOffset + e.top)) / i.y } }, i.InputAbstractHandler = o }, { "@akashic/trigger": 223 }], 154: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.MouseHandler = void 0, t("./InputAbstractHandler")), t = (o = t.InputAbstractHandler, n(s, o), s.prototype.start = function () { this.inputView.addEventListener("mousedown", this.onMouseDown, !1) }, s.prototype.stop = function () { this.inputView.removeEventListener("mousedown", this.onMouseDown, !1) }, s); function s(t, e) { var i = o.call(this, t, e) || this; return i.onMouseDown = function (t) { 0 === t.button && (i.pointDown(1, i.getOffsetPositionFromInputView(t)), window.addEventListener("mousemove", i.onMouseMove, !1), window.addEventListener("mouseup", i.onMouseUp, !1), i._disablePreventDefault || (t.stopPropagation(), t.preventDefault())) }, i.onMouseMove = function (t) { i.pointMove(1, i.getOffsetPositionFromInputView(t)), i._disablePreventDefault || (t.stopPropagation(), t.preventDefault()) }, i.onMouseUp = function (t) { i.pointUp(1, i.getOffsetPositionFromInputView(t)), window.removeEventListener("mousemove", i.onMouseMove, !1), window.removeEventListener("mouseup", i.onMouseUp, !1), i._disablePreventDefault || (t.stopPropagation(), t.preventDefault()) }, i } i.MouseHandler = t }, { "./InputAbstractHandler": 153 }], 155: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.TouchHandler = void 0, t("./MouseHandler")), t = (o = t.MouseHandler, n(s, o), s.prototype.start = function () { o.prototype.start.call(this), this.inputView.addEventListener("touchstart", this.onTouchDown), this.inputView.addEventListener("touchmove", this.onTouchMove), this.inputView.addEventListener("touchend", this.onTouchUp) }, s.prototype.stop = function () { o.prototype.stop.call(this), this.inputView.removeEventListener("touchstart", this.onTouchDown), this.inputView.removeEventListener("touchmove", this.onTouchMove), this.inputView.removeEventListener("touchend", this.onTouchUp) }, s); function s(t, e) { var n = o.call(this, t, e) || this; return n.onTouchDown = function (t) { for (var e = t.changedTouches, i = 0, r = e.length; i < r; i++) { var o = e[i]; n.pointDown(o.identifier, n.getOffsetPositionFromInputView(o)) } n._disablePreventDefault || (t.stopPropagation(), t.cancelable && t.preventDefault()) }, n.onTouchMove = function (t) { for (var e = t.changedTouches, i = 0, r = e.length; i < r; i++) { var o = e[i]; n.pointMove(o.identifier, n.getOffsetPositionFromInputView(o)) } n._disablePreventDefault || (t.stopPropagation(), t.cancelable && t.preventDefault()) }, n.onTouchUp = function (t) { for (var e = t.changedTouches, i = 0, r = e.length; i < r; i++) { var o = e[i]; n.pointUp(o.identifier, n.getOffsetPositionFromInputView(o)) } n._disablePreventDefault || (t.stopPropagation(), t.cancelable && t.preventDefault()) }, n } i.TouchHandler = t }, { "./MouseHandler": 154 }], 156: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ProxyAudioPlugin = i.WebAudioPlugin = i.HTMLAudioPlugin = i.AudioPluginManager = i.AudioPluginRegistry = i.ResourceFactory = i.Platform = void 0; var r = t("./Platform"), o = (Object.defineProperty(i, "Platform", { enumerable: !0, get: function () { return r.Platform } }), t("./plugin/AudioPluginRegistry")), n = (Object.defineProperty(i, "AudioPluginRegistry", { enumerable: !0, get: function () { return o.AudioPluginRegistry } }), t("./plugin/AudioPluginManager")), s = (Object.defineProperty(i, "AudioPluginManager", { enumerable: !0, get: function () { return n.AudioPluginManager } }), t("./plugin/HTMLAudioPlugin/HTMLAudioPlugin")), a = (Object.defineProperty(i, "HTMLAudioPlugin", { enumerable: !0, get: function () { return s.HTMLAudioPlugin } }), t("./plugin/ProxyAudioPlugin/ProxyAudioPlugin")), h = (Object.defineProperty(i, "ProxyAudioPlugin", { enumerable: !0, get: function () { return a.ProxyAudioPlugin } }), t("./plugin/WebAudioPlugin/WebAudioPlugin")), c = (Object.defineProperty(i, "WebAudioPlugin", { enumerable: !0, get: function () { return h.WebAudioPlugin } }), t("./ResourceFactory")); Object.defineProperty(i, "ResourceFactory", { enumerable: !0, get: function () { return c.ResourceFactory } }) }, { "./Platform": 119, "./ResourceFactory": 121, "./plugin/AudioPluginManager": 158, "./plugin/AudioPluginRegistry": 159, "./plugin/HTMLAudioPlugin/HTMLAudioPlugin": 163, "./plugin/ProxyAudioPlugin/ProxyAudioPlugin": 166, "./plugin/WebAudioPlugin/WebAudioPlugin": 171 }], 157: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.AudioPlayer = void 0; var r = t("@akashic/trigger"); function o(t) { this.onPlay = new r.Trigger, this.onStop = new r.Trigger, this.played = this.onPlay, this.stopped = this.onStop, this.volume = 1, this._muted = !1, this._system = t } o.prototype.play = function (t) { this.currentAudio = t, this.onPlay.fire({ player: this, audio: t }) }, o.prototype.stop = function () { var t = this.currentAudio; t && (this.currentAudio = void 0, this.onStop.fire({ player: this, audio: t })) }, o.prototype.canHandleStopped = function () { return !0 }, o.prototype.changeVolume = function (t) { this.volume = t }, o.prototype._changeMuted = function (t) { }, o.prototype._notifyVolumeChanged = function () { this.changeVolume(this.volume) }, i.AudioPlayer = o }, { "@akashic/trigger": 223 }], 158: [function (t, e, i) { "use strict"; function r() { this._activePlugin = null } Object.defineProperty(i, "__esModule", { value: !0 }), i.AudioPluginManager = void 0, r.prototype.getActivePlugin = function () { return this._activePlugin }, r.prototype.tryInstallPlugin = function (t) { for (var e = 0, i = t.length; e < i; e++) { var r = t[e]; if (!r.isSupported) return this._activePlugin = r, !0; if (r.isSupported()) return this._activePlugin = new r, !0 } return !1 }, i.AudioPluginManager = r }, {}], 159: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.AudioPluginRegistry = void 0; var r = []; i.AudioPluginRegistry = { addPlugin: function (t) { -1 === r.indexOf(t) && r.push(t) }, getRegisteredAudioPlugins: function () { return r }, clear: function () { r = [] } } }, {}], 160: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.HTMLAudioAsset = void 0, t("../../asset/AudioAsset")), h = t("../../PathUtil"), c = t("../../utils/ExceptionFactory"), t = (o = s.AudioAsset, n(u, o), u.prototype._load = function (t) { var i, e, r, o, n, s, a = this; null == this.path ? (this.data = null, setTimeout(function () { return t._onAssetLoad(a) }, 0)) : (i = new Audio, e = function (t, e) { i.autoplay = !1, i.preload = "none", i.src = t, a._attachAll(i, e), i.preload = "auto", o(i, e), i.load() }, r = { success: function () { a._detachAll(i, r), a.data = i, t._onAssetLoad(a), window.clearInterval(a._intervalId) }, error: function () { a._detachAll(i, r), a.data = i, t._onAssetError(a, c.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")), window.clearInterval(a._intervalId) } }, o = function (t, e) { a._intervalCount = 0, a._intervalId = window.setInterval(function () { 4 === t.readyState ? e.success() : (++a._intervalCount, 600 === a._intervalCount && e.error()) }, 100) }, ".aac" === (0 <= (n = this.path.indexOf("?")) ? this.path.substring(0, n) : this.path).slice(-4) && -1 !== u.supportedFormats.indexOf("mp4") ? (s = { success: r.success, error: function () { a._detachAll(i, s), window.clearInterval(a._intervalId), a.path = (0, h.addExtname)(a.originalPath, "mp4"), e(a.path, r) } }, e(this.path, s)) : e(this.path, r)) }, u.prototype.cloneElement = function () { return this.data ? new Audio(this.data.src) : null }, u.prototype._assetPathFilter = function (t) { return -1 !== u.supportedFormats.indexOf("ogg") ? (0, h.addExtname)(t, "ogg") : -1 !== u.supportedFormats.indexOf("aac") ? (0, h.addExtname)(t, "aac") : null }, u.prototype._attachAll = function (t, e) { e.success && t.addEventListener("canplaythrough", e.success, !1), e.error && (t.addEventListener("stalled", e.error, !1), t.addEventListener("error", e.error, !1), t.addEventListener("abort", e.error, !1)) }, u.prototype._detachAll = function (t, e) { e.success && t.removeEventListener("canplaythrough", e.success, !1), e.error && (t.removeEventListener("stalled", e.error, !1), t.removeEventListener("error", e.error, !1), t.removeEventListener("abort", e.error, !1)) }, u); function u() { return null !== o && o.apply(this, arguments) || this } i.HTMLAudioAsset = t }, { "../../PathUtil": 118, "../../asset/AudioAsset": 124, "../../utils/ExceptionFactory": 172 }], 161: [function (t, e, i) { "use strict"; var r, o = 0, n = []; function s() { a(), document.removeEventListener("keydown", s), document.removeEventListener("mousedown", s), document.removeEventListener("touchend", s) } function a() { o = 2, n.forEach(function (t) { return t.play() }), n = [] } (r || (r = {})).setupChromeMEIWorkaround = function (t) { var e = null; function i() { switch (o) { case 0: case 1: a() }o = 2, clearTimeout(e) } function r() { switch (t.removeEventListener("play", i), o) { case 0: n.push(t), o = 1, document.addEventListener("keydown", s, !0), document.addEventListener("mousedown", s, !0), document.addEventListener("touchend", s, !0); break; case 1: n.push(t); break; case 2: t.play() } } switch (o) { case 0: t.addEventListener("play", i, !0), e = setTimeout(r, 100); break; case 1: n.push(t) } }, e.exports = r }, {}], 162: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.HTMLAudioPlayer = void 0, t("../AudioPlayer")), a = t("./HTMLAudioAutoplayHelper"), t = (o = s.AudioPlayer, n(h, o), h.prototype.play = function (t) { this.currentAudio && this.stop(); var e = t.cloneElement(); e ? (a.setupChromeMEIWorkaround(e), e.volume = this._calculateVolume(), e.play().catch(function (t) { }), e.loop = t.loop, e.addEventListener("ended", this._endedEventHandler, !1), e.addEventListener("play", this._onPlayEventHandler, !1), this._isWaitingPlayEvent = !0, this._audioInstance = e) : this._dummyDurationWaitTimer = setTimeout(this._endedEventHandler, t.duration), o.prototype.play.call(this, t) }, h.prototype.stop = function () { this.currentAudio && (this._clearEndedEventHandler(), this._audioInstance && (this._isWaitingPlayEvent ? this._isStopRequested = !0 : (this._audioInstance.pause(), this._audioInstance = null))), o.prototype.stop.call(this) }, h.prototype.changeVolume = function (t) { o.prototype.changeVolume.call(this, t), this._audioInstance && (this._audioInstance.volume = this._calculateVolume()) }, h.prototype._changeMuted = function (t) { o.prototype._changeMuted.call(this, t), this._audioInstance && (this._audioInstance.volume = this._calculateVolume()) }, h.prototype.notifyMasterVolumeChanged = function () { this._audioInstance && (this._audioInstance.volume = this._calculateVolume()) }, h.prototype._onAudioEnded = function () { this._clearEndedEventHandler(), o.prototype.stop.call(this) }, h.prototype._clearEndedEventHandler = function () { this._audioInstance && this._audioInstance.removeEventListener("ended", this._endedEventHandler, !1), null != this._dummyDurationWaitTimer && (clearTimeout(this._dummyDurationWaitTimer), this._dummyDurationWaitTimer = null) }, h.prototype._onPlayEvent = function () { this._isWaitingPlayEvent && (this._isWaitingPlayEvent = !1, this._isStopRequested && (this._isStopRequested = !1, this._audioInstance.pause(), this._audioInstance = null)) }, h.prototype._calculateVolume = function () { return this._system._muted ? 0 : this.volume * this._system.volume * this._manager.getMasterVolume() }, h); function h(t, e) { var i = o.call(this, t) || this; return i._manager = e, i._endedEventHandler = function () { i._onAudioEnded() }, i._onPlayEventHandler = function () { i._onPlayEvent() }, i._dummyDurationWaitTimer = null, i } i.HTMLAudioPlayer = t }, { "../AudioPlayer": 157, "./HTMLAudioAutoplayHelper": 161 }], 163: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.HTMLAudioPlugin = void 0; var s = t("./HTMLAudioAsset"), r = t("./HTMLAudioPlayer"); function o() { this._supportedFormats = this._detectSupportedFormats(), s.HTMLAudioAsset.supportedFormats = this.supportedFormats } o.isSupported = function () { var t = document.createElement("audio"), e = !1; try { e = void 0 !== t.canPlayType } catch (t) { } return e }, Object.defineProperty(o.prototype, "supportedFormats", { get: function () { return this._supportedFormats }, set: function (t) { this._supportedFormats = t, s.HTMLAudioAsset.supportedFormats = t }, enumerable: !1, configurable: !0 }), o.prototype.createAsset = function (t, e, i, r, o, n) { return new s.HTMLAudioAsset(t, e, i, r, o, n) }, o.prototype.createPlayer = function (t, e) { return new r.HTMLAudioPlayer(t, e) }, o.prototype._detectSupportedFormats = function () { if (-1 !== navigator.userAgent.indexOf("Edge/")) return ["aac"]; var t = document.createElement("audio"), e = []; try { for (var i = ["ogg", "aac", "mp4"], r = 0, o = i.length; r < o; r++) { var n = i[r], s = t.canPlayType("audio/" + n); "no" !== s && "" !== s && e.push(n) } } catch (t) { } return e }, i.HTMLAudioPlugin = o }, { "./HTMLAudioAsset": 160, "./HTMLAudioPlayer": 162 }], 164: [function (t, e, i) { "use strict"; var r, a, o = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), n = (Object.defineProperty(i, "__esModule", { value: !0 }), i.ProxyAudioAsset = void 0, t("../../asset/AudioAsset")), s = t("../../utils/ExceptionFactory"), t = (a = n.AudioAsset, o(h, a), h.prototype.destroy = function () { this._handlerSet.unloadAudioAsset(this.id), a.prototype.destroy.call(this) }, h.prototype._load = function (e) { var i = this; this._handlerSet.loadAudioAsset({ id: this.id, assetPath: this.path, duration: this.duration, loop: this.loop, hint: this.hint }, function (t) { t ? e._onAssetError(i, s.ExceptionFactory.createAssetLoadError(t)) : e._onAssetLoad(i) }) }, h.prototype._assetPathFilter = function (t) { return t }, h); function h(t, e, i, r, o, n, s) { e = a.call(this, e, i, r, o, n, s) || this; return e._handlerSet = t, e } i.ProxyAudioAsset = t }, { "../../asset/AudioAsset": 124, "../../utils/ExceptionFactory": 172 }], 165: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.ProxyAudioPlayer = void 0, t("../AudioPlayer")), t = (o = t.AudioPlayer, n(s, o), s.prototype.changeVolume = function (t) { o.prototype.changeVolume.call(this, t), this._notifyVolumeToHandler() }, s.prototype._changeMuted = function (t) { o.prototype._changeMuted.call(this, t), this._notifyVolumeToHandler() }, s.prototype.play = function (t) { null != this._audioPlayerId && this.stop(), this._audioPlayerId = "ap".concat(s._audioPlayerIdCounter++), this._handlerSet.createAudioPlayer({ assetId: t.id, audioPlayerId: this._audioPlayerId, isPlaying: !0, volume: this._calculateVolume(), playbackRate: 1 }), o.prototype.play.call(this, t) }, s.prototype.stop = function () { null != this._audioPlayerId && (this._handlerSet.stopAudioPlayer(this._audioPlayerId), this._handlerSet.destroyAudioPlayer(this._audioPlayerId), this._audioPlayerId = null), o.prototype.stop.call(this) }, s.prototype.notifyMasterVolumeChanged = function () { this._notifyVolumeToHandler() }, s.prototype._notifyVolumeToHandler = function () { null != this._audioPlayerId && this._handlerSet.changeAudioVolume(this._audioPlayerId, this._calculateVolume()) }, s.prototype._calculateVolume = function () { return this._system._muted ? 0 : this.volume * this._system.volume * this._manager.getMasterVolume() }, s._audioPlayerIdCounter = 0, s); function s(t, e, i) { e = o.call(this, e) || this; return e._audioPlayerId = null, e._handlerSet = t, e._manager = i, e } i.ProxyAudioPlayer = t }, { "../AudioPlayer": 157 }], 166: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ProxyAudioPlugin = void 0; var s = t("./ProxyAudioAsset"), r = t("./ProxyAudioPlayer"); function o(t) { this.supportedFormats = [], this._handlerSet = t } o.isSupported = function () { return !0 }, o.prototype.createAsset = function (t, e, i, r, o, n) { return new s.ProxyAudioAsset(this._handlerSet, t, e, i, r, o, n) }, o.prototype.createPlayer = function (t, e) { return new r.ProxyAudioPlayer(this._handlerSet, t, e) }, i.ProxyAudioPlugin = o }, { "./ProxyAudioAsset": 164, "./ProxyAudioPlayer": 165 }], 167: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.WebAudioAsset = void 0, t("../../asset/AudioAsset")), h = t("../../PathUtil"), c = t("../../utils/ExceptionFactory"), u = t("../../utils/XHRLoader"), l = t("./WebAudioHelper"), t = (o = s.AudioAsset, n(a, o), a.prototype._load = function (e) { var i, r, o, n, s, t, a = this; null == this.path ? (this.data = null, setTimeout(function () { return e._onAssetLoad(a) }, 0)) : (i = function (t) { a.data = t, e._onAssetLoad(a) }, r = function () { e._onAssetError(a, c.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error")) }, o = function (t) { l.getAudioContext().decodeAudioData(t, i, r) }, n = new u.XHRLoader, s = function (t, i, r) { n.getArrayBuffer(t, function (t, e) { t ? r(t) : i(e) }) }, ".aac" === (0 <= (t = this.path.indexOf("?")) ? this.path.substring(0, t) : this.path).slice(-4) ? s(this.path, o, function (t) { var e = (0, h.addExtname)(a.originalPath, "mp4"); s(e, function (t) { a.path = e, o(t) }, r) }) : s(this.path, o, r)) }, a.prototype._assetPathFilter = function (t) { return -1 !== a.supportedFormats.indexOf("ogg") ? (0, h.addExtname)(t, "ogg") : -1 !== a.supportedFormats.indexOf("aac") ? (0, h.addExtname)(t, "aac") : null }, a.supportedFormats = [], a); function a() { return null !== o && o.apply(this, arguments) || this } i.WebAudioAsset = t }, { "../../PathUtil": 118, "../../asset/AudioAsset": 124, "../../utils/ExceptionFactory": 172, "../../utils/XHRLoader": 173, "./WebAudioHelper": 169 }], 168: [function (t, e, i) { "use strict"; var r, o = t("./WebAudioHelper"); function n() { o.getAudioContext().resume(), document.removeEventListener("keydown", n), document.removeEventListener("mousedown", n), document.removeEventListener("touchend", n) } (r || (r = {})).setupChromeMEIWorkaround = function () { var t, e, i = o.getAudioContext(); i && "function" != typeof i.resume || (e = o.createGainNode(i), (t = i.createOscillator()).type = "sawtooth", t.frequency.value = 440, t.connect(e), t.start(0), e = i.state, t.disconnect(), "running" !== e && (document.addEventListener("keydown", n, !0), document.addEventListener("mousedown", n, !0), document.addEventListener("touchend", n, !0))) }, e.exports = r }, { "./WebAudioHelper": 169 }], 169: [function (t, e, i) { "use strict"; var r, o, n = window.AudioContext || window.webkitAudioContext; (o = r = r || {}).getAudioContext = function () { window.__akashic__ || Object.defineProperty(window, "__akashic__", { value: {}, enumerable: !1, configurable: !1, writable: !1 }); var t = window.__akashic__.audioContext; return t instanceof n || (t = window.__akashic__.audioContext = new n, o._workAroundSafari()), t }, o.createGainNode = function (t) { return t.createGain ? t.createGain() : t.createGainNode() }, o.createBufferNode = function (t) { return (t = t.createBufferSource()).start || (t.start = t.noteOn, t.stop = t.noteOff), t }, o._workAroundSafari = function () { document.addEventListener("touchstart", function t() { document.removeEventListener("touchstart", t), o.getAudioContext().createBufferSource().start(0) }, !0) }, e.exports = r }, {}], 170: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), s = (Object.defineProperty(i, "__esModule", { value: !0 }), i.WebAudioPlayer = void 0, t("../AudioPlayer")), a = t("./WebAudioHelper"), t = (o = s.AudioPlayer, n(h, o), h.prototype.changeVolume = function (t) { o.prototype.changeVolume.call(this, t), this._gainNode.gain.value = this._calculateVolume() }, h.prototype._changeMuted = function (t) { o.prototype._changeMuted.call(this, t), this._gainNode.gain.value = this._calculateVolume() }, h.prototype.play = function (t) { var e; this.currentAudio && this.stop(), t.data ? ((e = a.createBufferNode(this._audioContext)).loop = t.loop, e.buffer = t.data, this._gainNode.gain.value = this._calculateVolume(), e.connect(this._gainNode), this._sourceNode = e, this._sourceNode.onended = this._endedEventHandler, this._sourceNode.start(0)) : this._dummyDurationWaitTimer = setTimeout(this._endedEventHandler, t.duration), o.prototype.play.call(this, t) }, h.prototype.stop = function () { this.currentAudio && (this._clearEndedEventHandler(), this._sourceNode && this._sourceNode.stop(0)), o.prototype.stop.call(this) }, h.prototype.notifyMasterVolumeChanged = function () { this._gainNode.gain.value = this._calculateVolume() }, h.prototype._onAudioEnded = function () { this._clearEndedEventHandler(), o.prototype.stop.call(this) }, h.prototype._clearEndedEventHandler = function () { this._sourceNode && (this._sourceNode.onended = null), null != this._dummyDurationWaitTimer && (clearTimeout(this._dummyDurationWaitTimer), this._dummyDurationWaitTimer = null) }, h.prototype._calculateVolume = function () { return this._system._muted ? 0 : this.volume * this._system.volume * this._manager.getMasterVolume() }, h); function h(t, e) { var i = o.call(this, t) || this; return i._audioContext = a.getAudioContext(), i._manager = e, i._gainNode = a.createGainNode(i._audioContext), i._gainNode.connect(i._audioContext.destination), i._sourceNode = void 0, i._dummyDurationWaitTimer = null, i._endedEventHandler = function () { i._onAudioEnded() }, i } i.WebAudioPlayer = t }, { "../AudioPlayer": 157, "./WebAudioHelper": 169 }], 171: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.WebAudioPlugin = void 0; var s = t("./WebAudioAsset"), r = t("./WebAudioAutoplayHelper"), o = t("./WebAudioPlayer"); function n() { this.supportedFormats = this._detectSupportedFormats(), r.setupChromeMEIWorkaround() } n.isSupported = function () { return "AudioContext" in window || "webkitAudioContext" in window }, Object.defineProperty(n.prototype, "supportedFormats", { get: function () { return this._supportedFormats }, set: function (t) { this._supportedFormats = t, s.WebAudioAsset.supportedFormats = t }, enumerable: !1, configurable: !0 }), n.prototype.createAsset = function (t, e, i, r, o, n) { return new s.WebAudioAsset(t, e, i, r, o, n) }, n.prototype.createPlayer = function (t, e) { return new o.WebAudioPlayer(t, e) }, n.prototype._detectSupportedFormats = function () { if (-1 !== navigator.userAgent.indexOf("Edge/")) return ["aac"]; var t = document.createElement("audio"), e = []; try { for (var i = ["ogg", "aac", "mp4"], r = 0, o = i.length; r < o; r++) { var n = i[r], s = t.canPlayType("audio/" + n); "no" !== s && "" !== s && e.push(n) } } catch (t) { } return e }, i.WebAudioPlugin = n }, { "./WebAudioAsset": 167, "./WebAudioAutoplayHelper": 168, "./WebAudioPlayer": 170 }], 172: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.ExceptionFactory = void 0, (i.ExceptionFactory || (i.ExceptionFactory = {})).createAssetLoadError = function (t, e, i) { return { name: "AssetLoadError", message: t, retriable: e = void 0 === e ? !0 : e, cause: i } } }, {}], 173: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.XHRLoader = void 0; var o = t("./ExceptionFactory"); function r(t) { this.timeout = (t = void 0 === t ? {} : t).timeout || 15e3 } r.prototype.get = function (t, e) { this._getRequestObject({ url: t, responseType: "text" }, e) }, r.prototype.getArrayBuffer = function (t, e) { this._getRequestObject({ url: t, responseType: "arraybuffer" }, e) }, r.prototype._getRequestObject = function (e, i) { var r = new XMLHttpRequest; r.open("GET", e.url, !0), r.responseType = e.responseType, r.timeout = this.timeout, r.addEventListener("timeout", function () { i(o.ExceptionFactory.createAssetLoadError("loading timeout")) }, !1), r.addEventListener("load", function () { var t; 200 <= r.status && r.status < 300 ? (t = "text" === e.responseType ? r.responseText : r.response, i(null, t)) : i(o.ExceptionFactory.createAssetLoadError("loading error. status: " + r.status)) }, !1), r.addEventListener("error", function () { i(o.ExceptionFactory.createAssetLoadError("loading error. status: " + r.status)) }, !1), r.send() }, i.XHRLoader = r }, { "./ExceptionFactory": 172 }], 174: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.Asset = void 0; var r = t("@akashic/trigger"); function o(t, e) { this.id = t, this.originalPath = e, this.path = this._assetPathFilter(e), this.onDestroyed = new r.Trigger } o.prototype.destroy = function () { this.onDestroyed.fire(this), this.id = void 0, this.originalPath = void 0, this.path = void 0, this.onDestroyed.destroy(), this.onDestroyed = void 0 }, o.prototype.destroyed = function () { return void 0 === this.id }, o.prototype.inUse = function () { return !1 }, o.prototype._assetPathFilter = function (t) { return t }, i.Asset = o }, { "@akashic/trigger": 223 }], 175: [function (t, e, i) { "use strict"; var r, s, o = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.AudioAsset = void 0, t("./Asset")), t = (s = t.Asset, o(n, s), n.prototype.play = function () { var t = this._system.createPlayer(); return t.play(this), this._lastPlayedPlayer = t }, n.prototype.stop = function () { for (var t = this._system.findPlayers(this), e = 0; e < t.length; ++e)t[e].stop() }, n.prototype.inUse = function () { return 0 < this._system.findPlayers(this).length }, n.prototype.destroy = function () { this._system && this.stop(), this.data = void 0, this._system = void 0, this._lastPlayedPlayer = void 0, s.prototype.destroy.call(this) }, n); function n(t, e, i, r, o, n) { t = s.call(this, t, e) || this; return t.type = "audio", t.duration = i, t.loop = o, t.hint = n, t._system = r, t.data = void 0, t } i.AudioAsset = t }, { "./Asset": 174 }], 176: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.AudioPlayer = void 0; var r = t("@akashic/trigger"); function o(t) { this.onPlay = new r.Trigger, this.onStop = new r.Trigger, this.played = this.onPlay, this.stopped = this.onStop, this.currentAudio = void 0, this.volume = t.volume, this._muted = t._muted, this._system = t } o.prototype.play = function (t) { this.currentAudio = t, this.onPlay.fire({ player: this, audio: t }) }, o.prototype.stop = function () { var t = this.currentAudio; t && (this.currentAudio = void 0, this.onStop.fire({ player: this, audio: t })) }, o.prototype.canHandleStopped = function () { return !0 }, o.prototype.changeVolume = function (t) { this.volume = t }, o.prototype._changeMuted = function (t) { this._muted = t }, o.prototype._notifyVolumeChanged = function () { this.changeVolume(this.volume) }, i.AudioPlayer = o }, { "@akashic/trigger": 223 }], 177: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.ScriptAsset = void 0, t("./Asset")), t = (o = t.Asset, n(s, o), s.prototype.destroy = function () { this.script = void 0, o.prototype.destroy.call(this) }, s); function s(t, e) { t = o.call(this, t, e) || this; return t.type = "script", t.script = void 0, t } i.ScriptAsset = t }, { "./Asset": 174 }], 178: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.TextAsset = void 0, t("./Asset")), t = (o = t.Asset, n(s, o), s.prototype.destroy = function () { this.data = void 0, o.prototype.destroy.call(this) }, s); function s(t, e) { t = o.call(this, t, e) || this; return t.type = "text", t.data = void 0, t } i.TextAsset = t }, { "./Asset": 174 }], 179: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 180: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.AssetLoadErrorType = void 0, (i = i.AssetLoadErrorType || (i.AssetLoadErrorType = {}))[i.Unspecified = 0] = "Unspecified", i[i.RetryLimitExceeded = 1] = "RetryLimitExceeded", i[i.NetworkError = 2] = "NetworkError", i[i.ClientError = 3] = "ClientError", i[i.ServerError = 4] = "ServerError" }, {}], 181: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 182: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 183: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 184: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 185: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 186: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 187: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 188: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 189: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 190: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 191: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 192: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 193: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 194: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 195: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 196: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 197: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 198: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.FontFamily = void 0, (i = i.FontFamily || (i.FontFamily = {}))[i.SansSerif = 0] = "SansSerif", i[i.Serif = 1] = "Serif", i[i.Monospace = 2] = "Monospace" }, {}], 199: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.FontWeight = void 0, (i = i.FontWeight || (i.FontWeight = {}))[i.Normal = 0] = "Normal", i[i.Bold = 1] = "Bold" }, {}], 200: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 201: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 202: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 203: [function (t, e, i) { "use strict"; var r = this && this.__createBinding || (Object.create ? function (t, e, i, r) { void 0 === r && (r = i); var o = Object.getOwnPropertyDescriptor(e, i); o && ("get" in o ? e.__esModule : !o.writable && !o.configurable) || (o = { enumerable: !0, get: function () { return e[i] } }), Object.defineProperty(t, r, o) } : function (t, e, i, r) { t[r = void 0 === r ? i : r] = e[i] }), o = this && this.__exportStar || function (t, e) { for (var i in t) "default" === i || Object.prototype.hasOwnProperty.call(e, i) || r(e, t, i) }; Object.defineProperty(i, "__esModule", { value: !0 }), o(t("./commons"), i), o(t("./errors"), i), o(t("./surface/CompositeOperation"), i), o(t("./surface/CompositeOperationString"), i), o(t("./surface/ImageData"), i), o(t("./surface/Renderer"), i), o(t("./surface/ShaderProgram"), i), o(t("./surface/ShaderUniform"), i), o(t("./surface/Surface"), i), o(t("./asset/audio/AudioAsset"), i), o(t("./asset/audio/AudioPlayer"), i), o(t("./asset/audio/AudioSystem"), i), o(t("./asset/audio/AudioAssetHint"), i), o(t("./asset/image/ImageAssetHint"), i), o(t("./asset/image/ImageAsset"), i), o(t("./asset/script/ScriptAsset"), i), o(t("./asset/script/Module"), i), o(t("./asset/script/ScriptAssetRuntimeValue"), i), o(t("./asset/text/TextAsset"), i), o(t("./asset/video/VideoPlayer"), i), o(t("./asset/video/VideoSystem"), i), o(t("./asset/video/VideoAsset"), i), o(t("./asset/vector-image/VectorImageAsset"), i), o(t("./asset/vector-image/VectorImageAssetHint"), i), o(t("./asset/Asset"), i), o(t("./asset/AssetLoadErrorType"), i), o(t("./font/FontWeightString"), i), o(t("./font/FontWeight"), i), o(t("./font/FontFamily"), i), o(t("./font/Glyph"), i), o(t("./font/GlyphFactory"), i), o(t("./platform/Looper"), i), o(t("./platform/OperationPluginView"), i), o(t("./platform/OperationPluginViewInfo"), i), o(t("./platform/Platform"), i), o(t("./platform/PlatformEventHandler"), i), o(t("./platform/PlatformPointEvent"), i), o(t("./platform/RendererRequirement"), i), o(t("./platform/ResourceFactory"), i) }, { "./asset/Asset": 179, "./asset/AssetLoadErrorType": 180, "./asset/audio/AudioAsset": 181, "./asset/audio/AudioAssetHint": 182, "./asset/audio/AudioPlayer": 183, "./asset/audio/AudioSystem": 184, "./asset/image/ImageAsset": 185, "./asset/image/ImageAssetHint": 186, "./asset/script/Module": 187, "./asset/script/ScriptAsset": 188, "./asset/script/ScriptAssetRuntimeValue": 189, "./asset/text/TextAsset": 190, "./asset/vector-image/VectorImageAsset": 191, "./asset/vector-image/VectorImageAssetHint": 192, "./asset/video/VideoAsset": 193, "./asset/video/VideoPlayer": 194, "./asset/video/VideoSystem": 195, "./commons": 196, "./errors": 197, "./font/FontFamily": 198, "./font/FontWeight": 199, "./font/FontWeightString": 200, "./font/Glyph": 201, "./font/GlyphFactory": 202, "./platform/Looper": 204, "./platform/OperationPluginView": 205, "./platform/OperationPluginViewInfo": 206, "./platform/Platform": 207, "./platform/PlatformEventHandler": 208, "./platform/PlatformPointEvent": 209, "./platform/RendererRequirement": 210, "./platform/ResourceFactory": 211, "./surface/CompositeOperation": 212, "./surface/CompositeOperationString": 213, "./surface/ImageData": 214, "./surface/Renderer": 215, "./surface/ShaderProgram": 216, "./surface/ShaderUniform": 217, "./surface/Surface": 218 }], 204: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 205: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 206: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 207: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 208: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 209: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 210: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 211: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 212: [function (t, e, i) { "use strict"; Object.defineProperty(i, "__esModule", { value: !0 }), i.CompositeOperation = void 0, (i = i.CompositeOperation || (i.CompositeOperation = {}))[i.SourceOver = 0] = "SourceOver", i[i.SourceAtop = 1] = "SourceAtop", i[i.Lighter = 2] = "Lighter", i[i.Copy = 3] = "Copy", i[i.ExperimentalSourceIn = 4] = "ExperimentalSourceIn", i[i.ExperimentalSourceOut = 5] = "ExperimentalSourceOut", i[i.ExperimentalDestinationAtop = 6] = "ExperimentalDestinationAtop", i[i.ExperimentalDestinationIn = 7] = "ExperimentalDestinationIn", i[i.DestinationOut = 8] = "DestinationOut", i[i.DestinationOver = 9] = "DestinationOver", i[i.Xor = 10] = "Xor" }, {}], 213: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 214: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 215: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 216: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 217: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 218: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 219: [function (t, e, i) { "use strict"; var r, o, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]) })(t, e) }, function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Class extends value " + String(e) + " is not a constructor or null"); function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), t = (Object.defineProperty(i, "__esModule", { value: !0 }), i.ChainTrigger = void 0, t("./Trigger")), t = (o = t.Trigger, n(s, o), s.prototype.add = function (t, e) { o.prototype.add.call(this, t, e), this._isActivated || (this.chain.add(this._onChainTriggerFired, this), this._isActivated = !0) }, s.prototype.addOnce = function (t, e) { o.prototype.addOnce.call(this, t, e), this._isActivated || (this.chain.add(this._onChainTriggerFired, this), this._isActivated = !0) }, s.prototype.remove = function (t, e) { o.prototype.remove.call(this, t, e), 0 === this.length && this._isActivated && (this.chain.remove(this._onChainTriggerFired, this), this._isActivated = !1) }, s.prototype.removeAll = function (t) { o.prototype.removeAll.call(this, t), 0 === this.length && this._isActivated && (this.chain.remove(this._onChainTriggerFired, this), this._isActivated = !1) }, s.prototype.destroy = function () { o.prototype.destroy.call(this), this.chain.remove(this._onChainTriggerFired, this), this.filter = null, this.filterOwner = null, this._isActivated = !1 }, s.prototype._onChainTriggerFired = function (t) { this.filter && !this.filter.call(this.filterOwner, t) || this.fire(t) }, s); function s(t, e, i) { var r = o.call(this) || this; return r.chain = t, r.filter = null != e ? e : null, r.filterOwner = i, r._isActivated = !1, r } i.ChainTrigger = t }, { "./Trigger": 221 }], 220: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 221: [function (t, e, i) { "use strict"; function r() { this._handlers = [], this.length = 0 } Object.defineProperty(i, "__esModule", { value: !0 }), i.Trigger = void 0, r.prototype.add = function (t, e) { "function" == typeof t ? this._handlers.push({ func: t, owner: e, once: !1, name: void 0 }) : "number" == typeof (e = t).index ? this._handlers.splice(e.index, 0, { func: e.func, owner: e.owner, once: !1, name: e.name }) : this._handlers.push({ func: e.func, owner: e.owner, once: !1, name: e.name }), this.length = this._handlers.length }, r.prototype.addOnce = function (t, e) { "function" == typeof t ? this._handlers.push({ func: t, owner: e, once: !0, name: void 0 }) : "number" == typeof (e = t).index ? this._handlers.splice(e.index, 0, { func: e.func, owner: e.owner, once: !0, name: e.name }) : this._handlers.push({ func: e.func, owner: e.owner, once: !0, name: e.name }), this.length = this._handlers.length }, r.prototype.handle = function (t, e, i) { this.add(e ? { owner: t, func: e, name: i } : { func: t }) }, r.prototype.fire = function (t) { if (this._handlers && this._handlers.length) { for (var e = this._handlers.concat(), i = 0; i < e.length; i++) { var r = e[i]; (r.func.call(r.owner, t) || r.once) && this._handlers && -1 !== (r = this._handlers.indexOf(r)) && this._handlers.splice(r, 1) } null != this._handlers && (this.length = this._handlers.length) } }, r.prototype.contains = function (t, e) { for (var i = "function" == typeof t ? { func: t, owner: e } : t, r = 0; r < this._handlers.length; r++)if (this._comparePartial(i, this._handlers[r])) return !0; return !1 }, r.prototype.remove = function (t, e) { for (var i = "function" == typeof t ? { func: t, owner: e } : t, r = 0; r < this._handlers.length; r++) { var o = this._handlers[r]; if (i.func === o.func && i.owner === o.owner && i.name === o.name) return this._handlers.splice(r, 1), void --this.length } }, r.prototype.removeAll = function (t) { var e = []; if (t) for (var i = 0; i < this._handlers.length; i++) { var r = this._handlers[i]; this._comparePartial(t, r) || e.push(r) } this._handlers = e, this.length = this._handlers.length }, r.prototype.destroy = function () { this._handlers = null, this.length = null }, r.prototype.destroyed = function () { return null === this._handlers }, r.prototype._comparePartial = function (t, e) { return (void 0 === t.func || t.func === e.func) && ((void 0 === t.owner || t.owner === e.owner) && (void 0 === t.name || t.name === e.name)) }, i.Trigger = r }, {}], 222: [function (t, e, i) { arguments[4][87][0].apply(i, arguments) }, { dup: 87 }], 223: [function (t, e, i) { "use strict"; var r = this && this.__createBinding || (Object.create ? function (t, e, i, r) { void 0 === r && (r = i); var o = Object.getOwnPropertyDescriptor(e, i); o && ("get" in o ? e.__esModule : !o.writable && !o.configurable) || (o = { enumerable: !0, get: function () { return e[i] } }), Object.defineProperty(t, r, o) } : function (t, e, i, r) { t[r = void 0 === r ? i : r] = e[i] }), o = this && this.__exportStar || function (t, e) { for (var i in t) "default" === i || Object.prototype.hasOwnProperty.call(e, i) || r(e, t, i) }; Object.defineProperty(i, "__esModule", { value: !0 }), o(t("./TriggerLike"), i), o(t("./ChainTriggerLike"), i), o(t("./Trigger"), i), o(t("./ChainTrigger"), i) }, { "./ChainTrigger": 219, "./ChainTriggerLike": 220, "./Trigger": 221, "./TriggerLike": 222 }], 224: [function (B, i, r) { !function (U, N) { !function () { var t, e; t = this, e = function () { "use strict"; function h(t) { return "function" == typeof t } var i = Array.isArray || function (t) { return "[object Array]" === Object.prototype.toString.call(t) }, r = 0, e = void 0, o = void 0, s = function (t, e) { l[r] = t, l[r + 1] = e, 2 === (r += 2) && (o ? o(d) : D()) }; var t = "undefined" != typeof window ? window : void 0, n = t || {}, n = n.MutationObserver || n.WebKitMutationObserver, a = "undefined" == typeof self && void 0 !== U && "[object process]" === {}.toString.call(U), c = "undefined" != typeof Uint8ClampedArray && "undefined" != typeof importScripts && "undefined" != typeof MessageChannel; function u() { var t = setTimeout; return function () { return t(d, 1) } } var l = new Array(1e3); function d() { for (var t = 0; t < r; t += 2)(0, l[t])(l[t + 1]), l[t] = void 0, l[t + 1] = void 0; r = 0 } function p() { try { var t = Function("return this")().require("vertx"); return void 0 !== (e = t.runOnLoop || t.runOnContext) ? function () { e(d) } : u() } catch (t) { return u() } } var f, _, g, D = void 0; function y(t, e) { var i, r = this, o = new this.constructor(A), n = (void 0 === o[v] && R(o), r._state); return n ? (i = arguments[n - 1], s(function () { return M(n, o, i, r._result) })) : k(r, o, t, e), o } function m(t) { var e; return t && "object" == typeof t && t.constructor === this ? t : (P(e = new this(A), t), e) } var D = a ? function () { return U.nextTick(d) } : n ? (_ = 0, a = new n(d), g = document.createTextNode(""), a.observe(g, { characterData: !0 }), function () { g.data = _ = ++_ % 2 }) : c ? ((f = new MessageChannel).port1.onmessage = d, function () { return f.port2.postMessage(0) }) : (void 0 === t && "function" == typeof B ? p : u)(), v = Math.random().toString(36).substring(2); function A() { } var T = void 0, S = 1, w = 2; function j(t, r, o) { s(function (e) { var i = !1, t = function (t, e, i, r) { try { t.call(e, i, r) } catch (t) { return t } }(o, r, function (t) { i || (i = !0, (r !== t ? P : b)(e, t)) }, function (t) { i || (i = !0, E(e, t)) }, e._label); !i && t && (i = !0, E(e, t)) }, t) } function x(t, e, i) { var r, o; e.constructor === t.constructor && i === y && e.constructor.resolve === m ? (r = t, (o = e)._state === S ? b(r, o._result) : o._state === w ? E(r, o._result) : k(o, void 0, function (t) { return P(r, t) }, function (t) { return E(r, t) })) : void 0 !== i && h(i) ? j(t, e, i) : b(t, e) } function P(e, t) { if (e === t) E(e, new TypeError("You cannot resolve a promise with itself")); else if (i = typeof t, null === t || "object" != i && "function" != i) b(e, t); else { i = void 0; try { i = t.then } catch (t) { return void E(e, t) } x(e, t, i) } var i } function G(t) { t._onerror && t._onerror(t._result), O(t) } function b(t, e) { t._state === T && (t._result = e, t._state = S, 0 !== t._subscribers.length && s(O, t)) } function E(t, e) { t._state === T && (t._state = w, t._result = e, s(G, t)) } function k(t, e, i, r) { var o = t._subscribers, n = o.length; t._onerror = null, o[n] = e, o[n + S] = i, o[n + w] = r, 0 === n && t._state && s(O, t) } function O(t) { var e = t._subscribers, i = t._state; if (0 !== e.length) { for (var r, o = void 0, n = t._result, s = 0; s < e.length; s += 3)r = e[s], o = e[s + i], r ? M(i, r, o, n) : o(n); t._subscribers.length = 0 } } function M(t, e, i, r) { var o = h(i), n = void 0, s = void 0, a = !0; if (o) { try { n = i(r) } catch (t) { a = !1, s = t } if (e === n) return void E(e, new TypeError("A promises callback cannot return that same promise.")) } else n = r; e._state === T && (o && a ? P(e, n) : !1 === a ? E(e, s) : t === S ? b(e, n) : t === w && E(e, n)) } var L = 0; function R(t) { t[v] = L++, t._state = void 0, t._result = void 0, t._subscribers = [] } C.prototype._enumerate = function (t) { for (var e = 0; this._state === T && e < t.length; e++)this._eachEntry(t[e], e) }, C.prototype._eachEntry = function (e, t) { var i = this._instanceConstructor, r = i.resolve; if (r === m) { var o, n = void 0, s = void 0, a = !1; try { n = e.then } catch (t) { a = !0, s = t } n === y && e._state !== T ? this._settledAt(e._state, t, e._result) : "function" != typeof n ? (this._remaining--, this._result[t] = e) : i === F ? (o = new i(A), a ? E(o, s) : x(o, e, n), this._willSettleAt(o, t)) : this._willSettleAt(new i(function (t) { return t(e) }), t) } else this._willSettleAt(r(e), t) }, C.prototype._settledAt = function (t, e, i) { var r = this.promise; r._state === T && (this._remaining--, t === w ? E(r, i) : this._result[e] = i), 0 === this._remaining && b(r, this._result) }, C.prototype._willSettleAt = function (t, e) { var i = this; k(t, void 0, function (t) { return i._settledAt(S, e, t) }, function (t) { return i._settledAt(w, e, t) }) }; var H = C; function C(t, e) { this._instanceConstructor = t, this.promise = new t(A), this.promise[v] || R(this.promise), i(e) ? (this.length = e.length, this._remaining = e.length, this._result = new Array(this.length), 0 !== this.length && (this.length = this.length || 0, this._enumerate(e), 0 !== this._remaining) || b(this.promise, this._result)) : E(this.promise, new Error("Array Methods must be provided an Array")) } I.prototype.catch = function (t) { return this.then(null, t) }, I.prototype.finally = function (e) { var i = this.constructor; return h(e) ? this.then(function (t) { return i.resolve(e()).then(function () { return t }) }, function (t) { return i.resolve(e()).then(function () { throw t }) }) : this.then(e, e) }; var F = I; function I(t) { if (this[v] = L++, this._result = this._state = void 0, this._subscribers = [], A !== t) { if ("function" != typeof t) throw new TypeError("You must pass a resolver function as the first argument to the promise constructor"); if (!(this instanceof I)) throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function."); var e = this; try { t(function (t) { P(e, t) }, function (t) { E(e, t) }) } catch (t) { E(e, t) } } } return F.prototype.then = y, F.all = function (t) { return new H(this, t).promise }, F.race = function (o) { var n = this; return i(o) ? new n(function (t, e) { for (var i = o.length, r = 0; r < i; r++)n.resolve(o[r]).then(t, e) }) : new n(function (t, e) { return e(new TypeError("You must pass an array to race.")) }) }, F.resolve = m, F.reject = function (t) { var e = new this(A); return E(e, t), e }, F._setScheduler = function (t) { o = t }, F._setAsap = function (t) { s = t }, F._asap = s, F.polyfill = function () { var t = void 0; if (void 0 !== N) t = N; else if ("undefined" != typeof self) t = self; else try { t = Function("return this")() } catch (t) { throw new Error("polyfill failed because global object is unavailable in this environment") } var e = t.Promise; if (e) { var i = null; try { i = Object.prototype.toString.call(e.resolve()) } catch (t) { } if ("[object Promise]" === i && !e.cast) return } t.Promise = F }, F.Promise = F }, "object" == typeof r && void 0 !== i ? i.exports = e() : t.ES6Promise = e() }.call(this) }.call(this, B("_process"), "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { _process: 1 }], 225: [function (t, e, i) { var r = t("@akashic/akashic-engine"); r.AudioAsset = t("@akashic/pdi-common-impl/lib/AudioAsset").AudioAsset, r.AudioPlayer = t("@akashic/pdi-common-impl/lib/AudioPlayer").AudioPlayer, r.ScriptAsset = t("@akashic/pdi-common-impl/lib/ScriptAsset").ScriptAsset, r.TextAsset = t("@akashic/pdi-common-impl/lib/TextAsset").TextAsset, e.exports = r }, { "@akashic/akashic-engine": 2, "@akashic/pdi-common-impl/lib/AudioAsset": 175, "@akashic/pdi-common-impl/lib/AudioPlayer": 176, "@akashic/pdi-common-impl/lib/ScriptAsset": 177, "@akashic/pdi-common-impl/lib/TextAsset": 178 }], 226: [function (t, e, i) { e.exports = { gameDriver: t("@akashic/game-driver"), akashicEngine: t("./akashicEngine"), pdiBrowser: "undefined" != typeof window ? t("@akashic/pdi-browser") : null } }, { "./akashicEngine": 225, "@akashic/game-driver": 95, "@akashic/pdi-browser": 114 }] }, {}, [226])(226) });

    window.engineFiles = engineFilesV3_5_0, window.g = engineFiles.akashicEngine, function () { window.require; window.require = function (i) { return "@akashic/akashic-engine" !== i ? this.call(this, i) : engineFiles.akashicEngine } }();

  </script>

  <script>
    if (!("optionProps" in window)) {
      window.optionProps = {};
    }
    window.optionProps.magnify = true

    window.g = require("@akashic/akashic-engine");
  </script>
  <script>
    if (!("gLocalAssetContainer" in window)) {
      window.gLocalAssetContainer = {};
    }

    if (!("__akashic__" in window)) {
      window.__akashic__ = {};
    }



    window.gLocalAssetContainer["game.json"] = "{%0A%09%22width%22: 1280,%0A%09%22height%22: 720,%0A%09%22fps%22: 30,%0A%09%22main%22: %22./script/main.js%22,%0A%09%22assets%22: {%0A%09%09%22fit%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/7532987ba2a85e1075f5%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 183,%0A%09%09%09%22virtualPath%22: %22audio/fit%22%0A%09%09},%0A%09%09%22fit2%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/cf488fea6256f0640207%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 154,%0A%09%09%09%22virtualPath%22: %22audio/fit2%22%0A%09%09},%0A%09%09%22voice_25%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/4192a0bd4e444a32efa3%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 1718,%0A%09%09%09%22virtualPath%22: %22audio/voice_25%22%0A%09%09},%0A%09%09%22voice_50%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/c7f6f0571775e21580bd%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 1238,%0A%09%09%09%22virtualPath%22: %22audio/voice_50%22%0A%09%09},%0A%09%09%22voice_75%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/be39fb42eb63aa3af3e1%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 1099,%0A%09%09%09%22virtualPath%22: %22audio/voice_75%22%0A%09%09},%0A%09%09%22voice_8888%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/e994fdd0b6c0f7412879%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 1408,%0A%09%09%09%22virtualPath%22: %22audio/voice_8888%22%0A%09%09},%0A%09%09%22voice_bottom%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/8d83d26ee43190305f13%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 2166,%0A%09%09%09%22virtualPath%22: %22audio/voice_bottom%22%0A%09%09},%0A%09%09%22voice_left%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/65535c6914a33c13348c%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 2272,%0A%09%09%09%22virtualPath%22: %22audio/voice_left%22%0A%09%09},%0A%09%09%22voice_outer%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/0f451a75025c5ad65e40%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 1856,%0A%09%09%09%22virtualPath%22: %22audio/voice_outer%22%0A%09%09},%0A%09%09%22voice_right%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/5293f460852a8644ea0e%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 2208,%0A%09%09%09%22virtualPath%22: %22audio/voice_right%22%0A%09%09},%0A%09%09%22voice_top%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/700d26abee073c684164%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 2176,%0A%09%09%09%22virtualPath%22: %22audio/voice_top%22%0A%09%09},%0A%09%09%22crown_0%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/5a03b7fdf64e4cb2f803.png%22,%0A%09%09%09%22width%22: 90,%0A%09%09%09%22height%22: 60,%0A%09%09%09%22virtualPath%22: %22image/crown_0.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22crown_1%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/52aa2a356969da05ac78.png%22,%0A%09%09%09%22width%22: 60,%0A%09%09%09%22height%22: 40,%0A%09%09%09%22virtualPath%22: %22image/crown_1.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22crown_2%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/13e63d9e28fbd4010848.png%22,%0A%09%09%09%22width%22: 60,%0A%09%09%09%22height%22: 40,%0A%09%09%09%22virtualPath%22: %22image/crown_2.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22crown_3%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/c4473a1b1d8315575fcd.png%22,%0A%09%09%09%22width%22: 60,%0A%09%09%09%22height%22: 40,%0A%09%09%09%22virtualPath%22: %22image/crown_3.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22infoBtn%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/bdd131be65363341e1c5.png%22,%0A%09%09%09%22width%22: 96,%0A%09%09%09%22height%22: 96,%0A%09%09%09%22virtualPath%22: %22image/infoBtn.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22joinBtn%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/ff05418007d426c6ef1c.png%22,%0A%09%09%09%22width%22: 192,%0A%09%09%09%22height%22: 108,%0A%09%09%09%22virtualPath%22: %22image/joinBtn.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22left%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/2b90a3693ba487cce32e.png%22,%0A%09%09%09%22width%22: 192,%0A%09%09%09%22height%22: 108,%0A%09%09%09%22virtualPath%22: %22image/left.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22playBtn%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/318e3a91bb516d041592.png%22,%0A%09%09%09%22width%22: 192,%0A%09%09%09%22height%22: 108,%0A%09%09%09%22virtualPath%22: %22image/playBtn.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22previewBtn%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/18fc0a3d171f3ea042e4.png%22,%0A%09%09%09%22width%22: 100,%0A%09%09%09%22height%22: 100,%0A%09%09%09%22virtualPath%22: %22image/previewBtn.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22result%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/555f0dd163279bc7dfc0.jpg%22,%0A%09%09%09%22width%22: 870,%0A%09%09%09%22height%22: 690,%0A%09%09%09%22virtualPath%22: %22image/result.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22resultBtn%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/b6678ec3f9d363baad9d.png%22,%0A%09%09%09%22width%22: 100,%0A%09%09%09%22height%22: 100,%0A%09%09%09%22virtualPath%22: %22image/resultBtn.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22right%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/df6b353e2a24394a3a16.png%22,%0A%09%09%09%22width%22: 192,%0A%09%09%09%22height%22: 108,%0A%09%09%09%22virtualPath%22: %22image/right.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22sanka_nin%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/a15f6b57aef38f335524.png%22,%0A%09%09%09%22width%22: 380,%0A%09%09%09%22height%22: 80,%0A%09%09%09%22virtualPath%22: %22image/sanka_nin.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22select_E%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/e70c729619a67cdc1085.png%22,%0A%09%09%09%22width%22: 380,%0A%09%09%09%22height%22: 80,%0A%09%09%09%22virtualPath%22: %22image/select_E.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22select_H%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/c94e2466f18b5b6bf391.png%22,%0A%09%09%09%22width%22: 380,%0A%09%09%09%22height%22: 80,%0A%09%09%09%22virtualPath%22: %22image/select_H.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22select_N%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/01dcaae1dc5d83a004cb.png%22,%0A%09%09%09%22width%22: 380,%0A%09%09%09%22height%22: 80,%0A%09%09%09%22virtualPath%22: %22image/select_N.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22setting%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/c2f2ff7b76dde1c2ff00.png%22,%0A%09%09%09%22width%22: 96,%0A%09%09%09%22height%22: 96,%0A%09%09%09%22virtualPath%22: %22image/setting.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22titleBtn%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/5d36463540f4f6eb88ac.png%22,%0A%09%09%09%22width%22: 291,%0A%09%09%09%22height%22: 108,%0A%09%09%09%22virtualPath%22: %22image/titleBtn.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22title_back%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/d9afd91c990237e5f382.png%22,%0A%09%09%09%22width%22: 380,%0A%09%09%09%22height%22: 80,%0A%09%09%09%22virtualPath%22: %22image/title_back.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22visibleBtn%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/260099ffddf560635baf.png%22,%0A%09%09%09%22width%22: 96,%0A%09%09%09%22height%22: 96,%0A%09%09%09%22virtualPath%22: %22image/visibleBtn.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22zoomIn%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/8f3e332fdf435939f3de.png%22,%0A%09%09%09%22width%22: 100,%0A%09%09%09%22height%22: 100,%0A%09%09%09%22virtualPath%22: %22image/zoomIn.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22zoomOut%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/65c9739d0fff418e9b6e.png%22,%0A%09%09%09%22width%22: 100,%0A%09%09%09%22height%22: 100,%0A%09%09%09%22virtualPath%22: %22image/zoomOut.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/!/00.png%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/f17d04027ff2582da8aa.png%22,%0A%09%09%09%22width%22: 300,%0A%09%09%09%22height%22: 300,%0A%09%09%09%22virtualPath%22: %22assets/!/00.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/!/01.png%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/a86239aa6c2cabc706bf.png%22,%0A%09%09%09%22width%22: 300,%0A%09%09%09%22height%22: 300,%0A%09%09%09%22virtualPath%22: %22assets/!/01.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/antelope.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/5a240eed1f02ad1d0869.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 780,%0A%09%09%09%22virtualPath%22: %22assets/antelope.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/architecture.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/2be7e1a2739aa16968f6.jpg%22,%0A%09%09%09%22width%22: 1920,%0A%09%09%09%22height%22: 1439,%0A%09%09%09%22virtualPath%22: %22assets/architecture.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/audience.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/ba46bf80b52c87607c24.jpg%22,%0A%09%09%09%22width%22: 1920,%0A%09%09%09%22height%22: 884,%0A%09%09%09%22virtualPath%22: %22assets/audience.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/beach.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/ec9f2afdecd4a9d03415.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 960,%0A%09%09%09%22virtualPath%22: %22assets/beach.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/cake.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/b37abb8131b66cb7c470.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 720,%0A%09%09%09%22virtualPath%22: %22assets/cake.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/cockpit.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/8b50c1f36b7e623cbdfd.jpg%22,%0A%09%09%09%22width%22: 1920,%0A%09%09%09%22height%22: 1209,%0A%09%09%09%22virtualPath%22: %22assets/cockpit.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/color-fan.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/9dd0955af52ebf3e024d.jpg%22,%0A%09%09%09%22width%22: 1920,%0A%09%09%09%22height%22: 1280,%0A%09%09%09%22virtualPath%22: %22assets/color-fan.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/duck.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/ba2759ada7f4ed78d11a.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 853,%0A%09%09%09%22virtualPath%22: %22assets/duck.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/excavators.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/354bb7373b0763babde1.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 416,%0A%09%09%09%22virtualPath%22: %22assets/excavators.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/firewood.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/166b9c1b7b018db8f2fe.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 853,%0A%09%09%09%22virtualPath%22: %22assets/firewood.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/fox.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/fcae74c7a81457d40cba.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 851,%0A%09%09%09%22virtualPath%22: %22assets/fox.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/frangipani.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/febc819056363411dad6.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 853,%0A%09%09%09%22virtualPath%22: %22assets/frangipani.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/japan.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/1d7cbd6ae210a0faf2b0.jpg%22,%0A%09%09%09%22width%22: 1920,%0A%09%09%09%22height%22: 1076,%0A%09%09%09%22virtualPath%22: %22assets/japan.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/latte-art.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/67e90fed2ba8c8024920.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 853,%0A%09%09%09%22virtualPath%22: %22assets/latte-art.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/living-room.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/35aeaf9c4e3b80177947.jpg%22,%0A%09%09%09%22width%22: 1920,%0A%09%09%09%22height%22: 1280,%0A%09%09%09%22virtualPath%22: %22assets/living-room.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/noodle-soup.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/c5607e3b5f8b682d9326.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 960,%0A%09%09%09%22virtualPath%22: %22assets/noodle-soup.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/paraglider.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/59ae0d82f67a71cc30cf.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 855,%0A%09%09%09%22virtualPath%22: %22assets/paraglider.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/skyscrapers.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/59416e9fb088d5f71308.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 853,%0A%09%09%09%22virtualPath%22: %22assets/skyscrapers.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/supreme.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/23e1478dc113ca83b66e.jpg%22,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 852,%0A%09%09%09%22virtualPath%22: %22assets/supreme.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22assets/watch.jpg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/9283dc929e2a4d258243.jpg%22,%0A%09%09%09%22width%22: 1920,%0A%09%09%09%22height%22: 1280,%0A%09%09%09%22virtualPath%22: %22assets/watch.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22Animation%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/44e053475e2865e06976.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Animation.js%22%0A%09%09},%0A%09%09%22CreateUserPazzle%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/74a8ee49e37186383a18.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/CreateUserPazzle.js%22%0A%09%09},%0A%09%09%22ErrorMessage%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/8a54c3cdd6282d4a3385.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/eoc/ErrorMessage.js%22%0A%09%09},%0A%09%09%22SceneEx%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/4f1cc726911c88c4a464.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/eoc/SceneEx.js%22%0A%09%09},%0A%09%09%22Server%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/e53946c8f6293a10bae1.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/eoc/Server.js%22%0A%09%09},%0A%09%09%22jigsaw%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/f880ac2098f944e3f006.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/events/jigsaw.js%22%0A%09%09},%0A%09%09%22piece%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/b1ec94ad80c056b69d44.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/events/piece.js%22%0A%09%09},%0A%09%09%22player%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/656b6b3dc658626ed8c3.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/events/player.js%22%0A%09%09},%0A%09%09%22userPazzle%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/5e7bf69ba87f4de14881.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/events/userPazzle.js%22%0A%09%09},%0A%09%09%22Jigsaw%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/0f2428d46985b4d70614.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Jigsaw.js%22%0A%09%09},%0A%09%09%22funcs%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/a50dbfd469ea67389fb6.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/lib/funcs.js%22%0A%09%09},%0A%09%09%22decoder%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/47ceff2b10db10ee0a5e.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/lib/jpeg/decoder.js%22%0A%09%09},%0A%09%09%22encoder%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/1ff28c8c6c7f4baab490.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/lib/jpeg/encoder.js%22%0A%09%09},%0A%09%09%22image%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/6a7f980f5e4939ea14dd.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/lib/jpeg/image.js%22%0A%09%09},%0A%09%09%22pixel%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/45824bcb83bc35bee11a.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/lib/jpeg/pixel.js%22%0A%09%09},%0A%09%09%22pieceCut%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/389763fa49ff8bd26557.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/lib/pieceCut.js%22%0A%09%09},%0A%09%09%22main%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/0d75bfc2cf044a49e7a9.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/main.js%22%0A%09%09},%0A%09%09%22AssetManager%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/09c6bcc9535fb9d2298f.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/AssetManager.js%22%0A%09%09},%0A%09%09%22BitmapImage%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/9eede47501e6c797bab3.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/BitmapImage.js%22%0A%09%09},%0A%09%09%22notice%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/f2ac1a4d2302de8d1a21.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/notice.js%22%0A%09%09},%0A%09%09%22NoticeCardCreats%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/67c0e1ad1b7afcc31560.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/NoticeCardCreats.js%22%0A%09%09},%0A%09%09%22Piece%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/54d91af777e5018b43ab.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/Piece.js%22%0A%09%09},%0A%09%09%22Player%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/de571e69434a2423abe2.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/Player.js%22%0A%09%09},%0A%09%09%22Slider%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/a8b6b09cc8ab45039303.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/Slider.js%22%0A%09%09},%0A%09%09%22StopWatch%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/1535cb76275ce17e2229.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/StopWatch.js%22%0A%09%09},%0A%09%09%22StrokeRect%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/527dabe03c1fac7a8bc9.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/models/StrokeRect.js%22%0A%09%09},%0A%09%09%22params%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/210eb0763bf5ed9671b4.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/params.js%22%0A%09%09},%0A%09%09%22PieceScene%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/f12a203281dab3cdb81b.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/PieceScene.js%22%0A%09%09},%0A%09%09%22PieceServer%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/de6d41dcb476a1bc3fe1.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/PieceServer.js%22%0A%09%09},%0A%09%09%22PlayingInfo%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/6bbaecd98ce3b00025d8.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/PlayingInfo.js%22%0A%09%09},%0A%09%09%22PlayingUI%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/1e5e948d426e48895fbd.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/PlayingUI.js%22%0A%09%09},%0A%09%09%22Preview%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/f4e33cdf64c2ed4d7481.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Preview.js%22%0A%09%09},%0A%09%09%22Result%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/41e04c4ccca323ef5d99.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Result.js%22%0A%09%09},%0A%09%09%22ScoreBoard%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/3acc954c21f49b47a282.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/ScoreBoard.js%22%0A%09%09},%0A%09%09%22Title%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/9cb8647f1a41e198350f.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Title.js%22%0A%09%09},%0A%09%09%22assets/!.txt%22: {%0A%09%09%09%22type%22: %22text%22,%0A%09%09%09%22path%22: %22files/b6215c828abe217e8569.txt%22,%0A%09%09%09%22virtualPath%22: %22assets/!.txt%22%0A%09%09},%0A%09%09%22player_ban%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/8c40c29fecb35645667f.png%22,%0A%09%09%09%22width%22: 96,%0A%09%09%09%22height%22: 96,%0A%09%09%09%22virtualPath%22: %22image/player_ban.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22a_e_z_0%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/Converter.js%22,%0A%09%09%09%22path%22: %22files/02b086419153ca8815d3.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_1%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/HoverPlugin.js%22,%0A%09%09%09%22path%22: %22files/4c08e5c8d37ce2ee6c7f.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_2%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/index.js%22,%0A%09%09%09%22path%22: %22files/e495008e90fbf9907b7d.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_3%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/DefaultRubyParser.js%22,%0A%09%09%09%22path%22: %22files/5ca3e0f76f4c8d5a4c2d.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_4%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/FragmentDrawInfo.js%22,%0A%09%09%09%22path%22: %22files/b3d7e16f3880a06f8cba.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_5%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/Label.js%22,%0A%09%09%09%22path%22: %22files/a9e42080a473e9994132.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_6%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/RubyParser.js%22,%0A%09%09%09%22path%22: %22files/ef280c38139b1cd8ade0.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_7%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/index.js%22,%0A%09%09%09%22path%22: %22files/62b1bd9a4502ffc92903.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_8%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/resolve-player-info/lib/FallbackDialog.js%22,%0A%09%09%09%22path%22: %22files/0bf49f6f44a9acbbb08a.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_9%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/resolve-player-info/lib/index.js%22,%0A%09%09%09%22path%22: %22files/1766cc962084c479743e.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_10%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/kamihubuki-js/lib/index.js%22,%0A%09%09%09%22path%22: %22files/12f996e5c9a264314118.js%22,%0A%09%09%09%22global%22: true%0A%09%09}%0A%09},%0A%09%22moduleMainScripts%22: {%0A%09%09%22@akashic-extension/akashic-label%22: %22node_modules/@akashic-extension/akashic-label/lib/index.js%22,%0A%09%09%22kamihubuki-js%22: %22node_modules/kamihubuki-js/lib/index.js%22,%0A%09%09%22@akashic-extension/akashic-hover-plugin%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/index.js%22,%0A%09%09%22@akashic-extension/resolve-player-info%22: %22node_modules/@akashic-extension/resolve-player-info/lib/index.js%22%0A%09},%0A%09%22environment%22: {%0A%09%09%22sandbox-runtime%22: %223%22,%0A%09%09%22niconico%22: {%0A%09%09%09%22supportedModes%22: [%0A%09%09%09%09%22multi_admission%22%0A%09%09%09]%0A%09%09},%0A%09%09%22atsumaru%22: {%0A%09%09%09%22supportedModes%22: [%0A%09%09%09%09%22multi%22%0A%09%09%09]%0A%09%09},%0A%09%09%22external%22: {%0A%09%09%09%22coeLimited%22: %220%22,%0A%09%09%09%22atsumaru%22: %220%22%0A%09%09}%0A%09},%0A%09%22globalScripts%22: []%0A}";



    window.gLocalAssetContainer["Animation"] = function (g) {
      !function (t, e) { Object.defineProperty(t, "__esModule", { value: !0 }), t.Animation = void 0; var a = e("kamihubuki-js"); function n(t) { this._confettiMabiku = 0, this.scene = t, this.display = new g.E({ scene: t }), this.animationg = !1, this._confittis = new Array } function o(t, e) { e = e - t + 1; return Math.floor(Math.random() * e) + t } n.prototype.start = function () { this.animationg = !0, this.scene.onUpdate.add(this.confettiAnimation, this) }, n.prototype.stop = function () { this.animationg = !1, this.scene.onUpdate.remove(this.confettiAnimation, this); for (var t = 0, e = this._confittis; t < e.length; t++) { var i = e[t]; i.destroyed() || i.destroy() } this._confittis = new Array }, n.prototype.confettiAnimation = function () { var t; g.game.isSkipping || this.animationg && (this._confettiMabiku = ++this._confettiMabiku % 3, 0 == this._confettiMabiku && (t = this.createConfetti(o(0, g.game.width), -5), t = this.createConfettiEntity(t, !0), this.display.append(t))) }, n.prototype.createConfetti = function (t, e) { var i = o(0, 100) / 100 * Math.PI, n = [{ angle: o(-100, 100) / 100 * (Math.PI / 2), size: 30, armAngle: 0, armLength: 1 }, { angle: o(-100, 100) / 100 * (Math.PI / 2), size: 30, armAngle: o(50, 100) / 100 * Math.PI, armLength: 1 }]; return new a.Confetti({ x: t, y: e, vx: 0, vy: 200, angle: i, fins: n, av: 0, M: .5, K: .02, I: 3, RD: .99 }) }, n.prototype.createConfettiEntity = function (t, e) { var i = new g.FilledRect({ scene: this.scene, width: 20, height: 10, x: t.x - 10, y: t.y - 5, local: !0, cssColor: n.colors[n.colorIndex] }); return this._confittis.push(i), n.colorIndex = (n.colorIndex + 1) % n.colors.length, i.onUpdate.add(function () { t.update(1 / g.game.fps, n.windX, n.windY, 0, 200), e ? (t.x < 0 || t.x > g.game.width || t.y > g.game.height) && i.destroy() : (t.x < 0 ? (t.x = 0, t.vx = .5 * Math.abs(t.vx)) : t.x > g.game.width && (t.x = g.game.width, t.vx = .5 * -Math.abs(t.vx)), t.y < -g.game.height ? (t.y = -g.game.height, t.vy = 0) : t.y > g.game.height && (t.y = g.game.height, t.vy = .5 * -Math.abs(t.vy))), i.x = t.x - 10, i.y = t.y - 5, i.angle = -t.angle / Math.PI * 180, i.modified() }), i }, n.windX = 0, n.windY = 0, n.colors = ["blue", "navy", "teal", "green", "lime", "aqua", "yellow", "red", "fuchsia", "olive", "purple", "maroon"], n.colorIndex = 0, t.Animation = n }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["CreateUserPazzle"] = function (g) {
      !function (e, i) { var a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var i, t = 1, n = arguments.length; t < n; t++)for (var a in i = arguments[t]) Object.prototype.hasOwnProperty.call(i, a) && (e[a] = i[a]); return e }).apply(this, arguments) }, h = (Object.defineProperty(e, "__esModule", { value: !0 }), e.CreatePuzzle = void 0, i("@akashic-extension/akashic-label")), d = i("./events/userPazzle"), o = i("./lib/funcs"), r = i("./lib/jpeg/decoder"), s = i("./models/BitmapImage"), p = i("./params"), c = i("./models/Slider"), l = i("./models/StrokeRect"), w = i("./lib/jpeg/encoder"); function t(i, e, t) { var h = this, n = (this.isEdit = !0, this.pieceSize = { width: 0, height: 0 }, this.matrix = { x: 0, y: 0 }, this.sum = 0, this.capacity = 0, this.puzzleSize = { width: 0, height: 0 }, this.puzzleOrigin = { x: 0, y: 0 }, this.scene = i, this.start = e, this.back = t, this.display = new g.E({ scene: i, width: g.game.width, height: g.game.height }), this.previewPanel = new g.FilledRect({ scene: i, parent: this.display, cssColor: "rgba(0,0,0)", width: 770, height: 460, x: 25, y: 35 }), o.createScrollLabel({ scene: i, parent: this.display, cssColor: "rgba(0,0,0,0.9)", width: 770, height: 460, x: 25, y: 35, touchable: !0 }, { scene: i, font: o.newFont("sans-serif", 35, "white"), text: "\n\n   ---- HELPHELP!----\n\n\n\n\n&\n\nPC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Q&A]\n\n\nQ.\n\nA.80x80\n\n   \n\n\nQ.\n\nA.\n\n   \n\n\nQ.\n\n   \n\nA.\n\n   \n\n   \n\n\nQ.\n\nA. 80KB \n\n  \n\n\nQ.\n\nA.\n\n\n", lineGap: -17, width: 0, x: 10 })); o.createFillLabel({ scene: i, parent: this.display, cssColor: "#00C24E", x: 840, y: 600, height: 100, width: 230, touchable: !0 }, { scene: i, font: o.newFont("sans-serif", 65, "white"), text: "HELP!", textAlign: "center", y: 5, width: 0 }).onPointDown.add(function () { n.visible() ? n.hide() : n.show() }), this.EditInfo(), p.GameParams.isOwner && (o.addDragDrop(function (e) { return h.onDragDrop(e) }), this.LiverOnlyUI()), i.addReceiveMethod(d.ChangePage.receive(this.ChangePage), this), i.addReceiveMethod(d.ShareImageStart.receive(function (e) { var e = e.param, t = e.width, n = e.height, e = e.segmentCount, a = new Array(e); i.addReceiveMethod(d.ShareImageData.receive(function (e) { var e = e.param, i = e.index, e = e.jpgByteChars; a[i] = e }), h), i.addReceiveMethod(d.ShareImageFinish.receive(function (e) { var i = a.reduce(function (e, i) { return e + i }, ""); h.ShareImage({ param: { width: t, height: n, jpgByteChars: i }, type: d.ShareImageFinish.TYPE }) }), h) }), this), i.addReceiveMethod(d.Edit.receive(this.Edit), this) } t.prototype.ChangePage = function (e) { o.removeDropFile(), this.display.destroy(), this.scene.removeReceiveMethod(d.ChangePage.receive(this.ChangePage), this), this.scene.removeReceiveMethod(d.Edit.receive(this.Edit), this), "T" == e.param.page ? this.back() : (this.preview.scale(1), this.preview.modified(), this.start({ scene: this.scene, level: -1, wakus: [].concat.apply([], this.scene.assetManager.wakus), pazzleID: -1, previewSrc: g.SpriteFactory.createSpriteFromE(this.scene, this.preview), difficulty: { count: this.sum, size: this.pieceSize, origin: this.puzzleOrigin } })) }, t.prototype.ShareImage = function (e) { p.GameParams.isOwner && (o.removeDropFile(), this.shareBtn.destroy(), this.SharedLiverOnlyUI(), !g.game.isSkipping) ? this.border.show() : this.CreateImage(e.param) }, t.prototype.CreateImage = function (e) { for (var i = this, t = (null != (a = this.previewPanel.children) && a.pop(), this.capacity = encodeURIComponent(e.jpgByteChars).replace(/%../g, "x").length, this.capacity = Math.floor(1.1 * this.capacity), []), n = 0; n < e.jpgByteChars.length; n++)t.push(e.jpgByteChars[n].charCodeAt(0)); var a = r.decode(new Uint8Array(t)), a = { data: Uint8ClampedArray.from(a.data), width: a.width, height: a.height }; this.preview = new s.BitmapImage({ scene: this.scene, parent: this.previewPanel, colorBuffer: a, width: a.width, height: a.height }), o.spriteSet(this.preview, this.previewPanel.width, this.previewPanel.height), this.border = new l.StrokeRect({ scene: this.scene, parent: this.preview, borderWidth: 4, cssColor: "red", height: 0, width: 0, touchable: p.GameParams.isOwner, hidden: p.GameParams.isOwner && !g.game.isSkipping }), this.border.onPointMove.add(function (e) { i.puzzleOrigin.x += e.prevDelta.x / i.preview.scaleX, i.puzzleOrigin.y += e.prevDelta.y / i.preview.scaleX, i.puzzleOrigin.x < 0 ? i.puzzleOrigin.x = 0 : i.puzzleOrigin.x > i.preview.width - i.puzzleSize.width && (i.puzzleOrigin.x = i.preview.width - i.puzzleSize.width), i.puzzleOrigin.y < 0 ? i.puzzleOrigin.y = 0 : i.puzzleOrigin.y > i.preview.height - i.puzzleSize.height && (i.puzzleOrigin.y = i.preview.height - i.puzzleSize.height), i.border.x = i.puzzleOrigin.x, i.border.y = i.puzzleOrigin.y, i.border.modified() }), this.border.onPointUp.add(function () { i.scene.send(new d.Edit({ type: "Origin", data: [i.puzzleOrigin.x, i.puzzleOrigin.y] })) }), this.EditInfoUpdate() }, t.prototype.Edit = function (e) { p.GameParams.isOwner && !g.game.isSkipping || ("Size" == e.param.type ? (this.pieceSize.width = e.param.data[0], this.pieceSize.height = e.param.data[1], this.EditInfoUpdate()) : p.GameParams.isServer || (this.puzzleOrigin = { x: e.param.data[0], y: e.param.data[1] }, this.border.x = this.puzzleOrigin.x, this.border.y = this.puzzleOrigin.y, this.border.modified())) }, t.prototype.EditInfoUpdate = function () { this.matrix.x = Math.floor(this.preview.width / this.pieceSize.width), this.matrix.y = Math.floor(this.preview.height / this.pieceSize.height), this.sum = this.matrix.x * this.matrix.y, this.puzzleSize.width = this.matrix.x * this.pieceSize.width, this.puzzleSize.height = this.matrix.y * this.pieceSize.height, this.puzzleOrigin.x = Math.floor((this.preview.width - this.puzzleSize.width) / 2), this.puzzleOrigin.y = Math.floor((this.preview.height - this.puzzleSize.height) / 2), this.pieceInfoLabel.text = "         --  --\n\n " + this.preview.width + " x " + this.preview.height + "\n\n " + this.capacity / 1e3 + " KB\n\n\n        --  --\n\n " + this.sum + " \n\n " + this.matrix.x + "    " + this.matrix.y + " \n\n " + this.pieceSize.width + " px   " + this.pieceSize.height + " px\n", this.pieceInfoLabel.invalidate(), p.GameParams.isServer && "atsumaru" != p.GameParams.operation || (this.border.x = this.puzzleOrigin.x, this.border.y = this.puzzleOrigin.y, this.border.width = this.puzzleSize.width, this.border.height = this.puzzleSize.height, this.border.modified()) }, t.prototype.EditInfo = function () { this.pieceSize = { width: 60, height: 60 }; var e = o.newFont("sans-serif", 38), i = new g.FilledRect({ scene: this.scene, parent: this.display, cssColor: "rgba(176,247,204,0.8)", width: 430, height: 360, x: 830, y: 35 }); this.pieceInfoLabel = new h.Label({ scene: this.scene, font: e, parent: i, text: "         --  --\n\n XXXX x XXXX\n\n XXX KB\n\n\n        --  --\n\n XXX \n\n XXX    XXX \n\n XX px   XX px\n", lineGap: -17, width: i.width, x: 10, y: 10 }) }, t.prototype.SharedLiverOnlyUI = function () { var i = this, e = this.scene, t = new g.FilledRect({ scene: e, parent: this.display, cssColor: "rgba(0,194,78,0.8)", height: 200, width: 600, x: 220, y: 500 }), n = o.newFont("sans-serif", 50), n = (new h.Label({ scene: e, parent: t, font: n, text: "      \n\n", lineGap: 10, x: 7, width: t.width }), { scene: e, parent: t, per: .125, min: 40, gripWidth: 25, width: 460, height: 60, x: 120 }), t = new c.Slider(a(a({}, n), { max: 200, y: 64 })), t = (t.onValueChange.add(function (e) { i.isEdit && (i.pieceSize.width = Math.floor(e), i.EditInfoUpdate()) }), t.onBarDown.add(function (e) { i.isEdit && i.scene.send(new d.Edit({ type: "Size", data: [Math.floor(e), i.pieceSize.height] })) }), t.onSliderUp.add(function (e) { i.isEdit && i.scene.send(new d.Edit({ type: "Size", data: [Math.floor(e), i.pieceSize.height] })) }), new c.Slider(a(a({}, n), { max: 200, y: 133 }))); t.onValueChange.add(function (e) { i.isEdit && (i.pieceSize.height = Math.floor(e), i.EditInfoUpdate()) }), t.onBarDown.add(function (e) { i.isEdit && i.scene.send(new d.Edit({ type: "Size", data: [i.pieceSize.width, Math.floor(e)] })) }), t.onSliderUp.add(function (e) { i.isEdit && i.scene.send(new d.Edit({ type: "Size", data: [i.pieceSize.width, Math.floor(e)] })) }), new g.Sprite({ scene: e, parent: this.display, src: e.asset.getImageById("playBtn"), x: 1080, y: 597, touchable: !0 }).onPointDown.add(function () { 2 <= i.matrix.x && 2 <= i.matrix.y && i.isEdit && (i.isEdit = !1, e.send(new d.ChangePage({ page: "S" }))) }) }, t.prototype.onDragDrop = function (e) { var a = this, i = (e.stopPropagation(), e.preventDefault(), new FileReader); i.readAsArrayBuffer(e.dataTransfer.files[0]), i.onload = function (e) { e = e.target.result; o.ConvertJpgImage(e).then(function (e) { for (var i = "", t = w.encode(e), n = 0; n < t.data.length; n++)i += String.fromCharCode(t.data[n]); a.dropData = { jpgByteChars: i, width: e.width, height: e.height }, a.CreateImage(a.dropData) }) } }, t.prototype.LiverOnlyUI = function () { var r = this, s = this.scene, e = new g.FilledRect({ scene: s, parent: this.display, cssColor: "#00C24E", height: 100, width: 160, x: 20, y: 500, touchable: !0 }); new h.Label({ scene: s, parent: e, font: o.newFont("sans-serif", 60, "white"), text: "", width: e.width, x: 20, y: 10 }), e.onPointDown.add(function () { g.game.isSkipping || s.send(new d.ChangePage({ page: "T" })) }), this.shareBtn = new g.FilledRect({ scene: s, parent: this.display, cssColor: "#00C24E", height: 100, width: 400, x: 250, y: 550, touchable: !0 }), new h.Label({ scene: s, parent: this.shareBtn, font: o.newFont("sans-serif", 50, "white"), text: " ", width: this.shareBtn.width, y: 15 }), this.shareBtn.onPointDown.add(function () { var i, t, n, a, h; g.game.isSkipping || null != r.dropData && 80 <= r.preview.width && 80 <= r.preview.height && (r.shareBtn.hide(), i = g.game.fps / 10, t = Math.ceil(r.dropData.jpgByteChars.length / 30720), a = n = 0, s.send(new d.ShareImageStart({ width: r.dropData.width, height: r.dropData.height, segmentCount: t })), s.onUpdate.add(h = function () { var e; ++a <= i || (a = 0, e = r.dropData.jpgByteChars.substring(30720 * n, 30720 * (n + 1)), s.send(new d.ShareImageData({ index: n, jpgByteChars: e })), ++n === t && (s.send(new d.ShareImageFinish({})), s.onUpdate.remove(h, r))) }, r)) }) }, e.CreatePuzzle = t }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["ErrorMessage"] = function (g) {
      !function (e) { function r(e) { this.param = e, this.type = r.TYPE } Object.defineProperty(e, "__esModule", { value: !0 }), e.ServerError = void 0, r.receive = function (e) { return { type: this.TYPE, event: e } }, r.TYPE = "ServerError", e.ServerError = r }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["SceneEx"] = function (g) {
      !function (e, t) { var o, n, r = this && this.__extends || (o = function (e, t) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } o(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }), i = this && this.__assign || function () { return (i = Object.assign || function (e) { for (var t, n = 1, o = arguments.length; n < o; n++)for (var r in t = arguments[n]) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]); return e }).apply(this, arguments) }, c = (Object.defineProperty(e, "__esModule", { value: !0 }), e.SceneEx = void 0, t("../params")), t = (n = g.Scene, r(a, n), a.prototype.send = function (e) { g.game.raiseEvent(new g.MessageEvent(e)) }, a.prototype.addReceiveMethod = function (e, t) { this.ReceiveEvent.push(i({ owner: t }, e)) }, a.prototype.removeReceiveMethod = function (e, t) { for (var n = 0; n < this.ReceiveEvent.length; n++) { var o = this.ReceiveEvent[n]; if (o.type === e.type && o.event === e.event && o.owner == t) return void this.ReceiveEvent.splice(n, 1) } }, a.prototype.receiveEvent = function (e) { null != e.data && this.receiveEventDo(e.data) }, a.prototype.receiveEventDo = function (e) { for (var t = 0; t < this.ReceiveEvent.length; t++) { var n = this.ReceiveEvent[t]; n.type == e.type && n.event.call(n.owner, e) } }, a); function a(e) { e = n.call(this, i({ local: "interpolate-local", tickGenerationMode: "manual" }, e)) || this; return e.ReceiveEvent = [], c.GameParams.isServer || e.onMessage.add(e.receiveEvent, e), e } e.SceneEx = t }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["Server"] = function (g) {
      !function (e, t) { var r = this && this.__spreadArrays || function () { for (var e = 0, t = 0, r = arguments.length; t < r; t++)e += arguments[t].length; for (var n = Array(e), s = 0, t = 0; t < r; t++)for (var o = arguments[t], i = 0, a = o.length; i < a; i++, s++)n[s] = o[i]; return n }, n = (Object.defineProperty(e, "__esModule", { value: !0 }), e.Server = void 0, t("./ErrorMessage")); function s(e) { this.ReceiveEvent = [], this.BroadcastBuffer = [], this.scene = e.scene, this.onEventFiltered_bound = this.onEventFiltered.bind(this), g.game.addEventFilter(this.onEventFiltered_bound), this.scene.onUpdate.add(this.update, this) } s.prototype.addReceiveMethod = function (e) { this.ReceiveEvent.push(e) }, s.prototype.removeReceiveMethod = function (e, t) { for (var r = 0; r < this.ReceiveEvent.length; r++) { var n = this.ReceiveEvent[r]; if (n.type === e && n.event === t) return void this.ReceiveEvent.splice(r, 1) } }, s.prototype.broadcast = function (e) { try { this.scene.receiveEventDo(e) } catch (e) { this.sendError("from: broadcast\nname: " + e.name + "\nmessage: " + e.message) } this.BroadcastBuffer.push(e) }, s.prototype.update = function () { try { var e, t; 0 != this.BroadcastBuffer.length && (e = this.BroadcastBuffer.map(function (e) { return new g.MessageEvent(e) }), t = new g.TimestampEvent(Math.floor(g.game.getCurrentTime()), null), g.game.raiseTick(r([t], e)), this.BroadcastBuffer.length = 0) } catch (e) { this.sendError("from: update\nname: " + e.name + "\nmessage: " + e.message) } }, s.prototype.onEventFiltered = function (e, t) { t.processNext; for (var r = [], n = 0; n < e.length; n++) { var s = e[n]; 32 === s[0] ? this.receiveEvent(s[3]) : r.push(s) } return r }, s.prototype.receiveEvent = function (e) { try { for (var t = 0; t < this.ReceiveEvent.length; t++) { var r = this.ReceiveEvent[t]; r.type == e.type && r.event(e) } } catch (e) { this.sendError("from: receiveEvent\nname: " + e.name + "\nmessage: " + e.message) } }, s.prototype.sendError = function (e) { console.log(e); var t = new g.TimestampEvent(Math.floor(g.game.getCurrentTime()), null); g.game.raiseTick([t, new g.MessageEvent(new n.ServerError({ message: e }))]) }, e.Server = s }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["jigsaw"] = function (g) {
      !function (e) { function t(e) { this.param = e, this.type = t.TYPE } function n(e) { this.param = e, this.type = n.TYPE } function i(e) { this.param = e, this.type = i.TYPE } function r(e) { this.param = e, this.type = r.TYPE } function a(e) { this.param = e, this.type = a.TYPE } Object.defineProperty(e, "__esModule", { value: !0 }), e.PazzleComplete = e.StartPazzle = e.UserPuzzle = e.ChangeDefficulty = e.ChangePazzle = void 0, t.receive = function (e) { return { type: this.TYPE, event: e } }, t.TYPE = "ChangePreview", e.ChangePazzle = t, n.receive = function (e) { return { type: this.TYPE, event: e } }, n.TYPE = "ChangeDefficulty", e.ChangeDefficulty = n, i.receive = function (e) { return { type: this.TYPE, event: e } }, i.TYPE = "UserPuzzle", e.UserPuzzle = i, r.receive = function (e) { return { type: this.TYPE, event: e } }, r.TYPE = "StartPazzle", e.StartPazzle = r, a.receive = function (e) { return { type: this.TYPE, event: e } }, a.TYPE = "ClearPazzle", e.PazzleComplete = a }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["piece"] = function (g) {
      !function (e) { function t(e) { this.param = e, this.type = t.TYPE } function i(e) { this.param = e, this.type = i.TYPE } Object.defineProperty(e, "__esModule", { value: !0 }), e.ConnectPiece = e.FitPiece = void 0, t.receive = function (e) { return { type: this.TYPE, event: e } }, t.TYPE = "FitPiece", e.FitPiece = t, i.receive = function (e) { return { type: this.TYPE, event: e } }, i.TYPE = "ConnectPiece", e.ConnectPiece = i }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["player"] = function (g) {
      !function (e) { function t(e) { this.param = e, this.type = t.TYPE } function i(e) { this.param = e, this.type = i.TYPE } function n(e) { this.param = e, this.type = n.TYPE } function P(e) { this.param = e, this.type = P.TYPE } function r(e) { this.param = e, this.type = r.TYPE } function c(e) { this.param = e, this.type = c.TYPE } Object.defineProperty(e, "__esModule", { value: !0 }), e.Ban = e.PutPiece = e.MovePiece = e.PickPiece = e.JoinRequest = e.JoinPlayer = void 0, t.receive = function (e) { return { type: this.TYPE, event: e } }, t.TYPE = "JoinPlayer", e.JoinPlayer = t, i.receive = function (e) { return { type: this.TYPE, event: e } }, i.TYPE = "JoinRequest", e.JoinRequest = i, n.receive = function (e) { return { type: this.TYPE, event: e } }, n.TYPE = "PickPiece", e.PickPiece = n, P.receive = function (e) { return { type: this.TYPE, event: e } }, P.TYPE = "MovePiece", e.MovePiece = P, r.receive = function (e) { return { type: this.TYPE, event: e } }, r.TYPE = "PutPiece", e.PutPiece = r, c.receive = function (e) { return { type: this.TYPE, event: e } }, c.TYPE = "Ban", e.Ban = c }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["userPazzle"] = function (g) {
      !function (e) { function t(e) { this.param = e, this.type = t.TYPE } function a(e) { this.param = e, this.type = a.TYPE } function i(e) { this.param = e, this.type = i.TYPE } function n(e) { this.param = e, this.type = n.TYPE } function r(e) { this.param = e, this.type = r.TYPE } Object.defineProperty(e, "__esModule", { value: !0 }), e.Edit = e.ShareImageFinish = e.ShareImageData = e.ShareImageStart = e.ChangePage = void 0, t.receive = function (e) { return { type: this.TYPE, event: e } }, t.TYPE = "ChangePage", e.ChangePage = t, a.receive = function (e) { return { type: this.TYPE, event: e } }, a.TYPE = "ShareImageStart", e.ShareImageStart = a, i.receive = function (e) { return { type: this.TYPE, event: e } }, i.TYPE = "ShareImageData", e.ShareImageData = i, n.receive = function (e) { return { type: this.TYPE, event: e } }, n.TYPE = "ShareImageFinish", e.ShareImageFinish = n, r.receive = function (e) { return { type: this.TYPE, event: e } }, r.TYPE = "Edit", e.Edit = r }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["Jigsaw"] = function (g) {
      !function (e, i) { Object.defineProperty(e, "__esModule", { value: !0 }), e.Jigsaw = void 0; var u = i("./models/Piece"), t = i("./models/Player"), y = i("./PlayingUI"), f = i("./params"), a = i("./Animation"), s = i("./ScoreBoard"), r = i("./models/notice"), v = i("./models/NoticeCardCreats"), o = i("./lib/funcs"), n = -100; function c(e) { this.jigsawState = "Title", this.players = [], this.isJoinWait = !1, this.me = void 0, this.fitPer = 0, this.noticeEvent = new g.Trigger, this.pieces = [], this.fitCount = 0, this.isAlignOuter = !1, this.margin = { width: 0, height: 0 }, this.nameFont = o.newFont("sans-serif", 72), this.scene = e.scene, this.noticeViewer = new r.NoticeViewer(this.scene, 5e3), this.camera = new g.Camera2D({ width: g.game.width, height: g.game.height, anchorX: null }), this.display = new g.E({ scene: this.scene }), "atsumaru" == f.GameParams.operation && (this.scoreBoard = new s.ScoreBoard(this.scene)) } Object.defineProperty(c.prototype, "cameraScale", { get: function () { return this.camera.scaleX }, enumerable: !1, configurable: !0 }), Object.defineProperty(c.prototype, "pieceLimit", { get: function () { return { x: this.pieceLayer.width, y: this.pieceLayer.height } }, enumerable: !1, configurable: !0 }), c.prototype.samePlayerID = function (i) { return this.players.find(function (e) { return e.playerID == i }) }, c.prototype.serverError = function (e) { console.log("SERVER ERROR!!\n" + e.message), this.noticeViewer.addNoticeCard(new v.ErrorNoticeCard(this.scene, e.message, this.scene.asset.getAudioById("voice_outer"))) }, c.prototype.startPazzle = function (e) { var i, t, a = this, s = (this.jigsawState = "Playing", "atsumaru" == f.GameParams.operation && this.scoreBoard.display.remove(), this.pazzleID = e.pazzleID, this.level = e.level, this.uiLayer = new y.PlayingUI(this.scene, e.title, e.preview), this.uiLayer.result.draw(this.players), this.background = new g.FilledRect({ scene: this.scene, parent: this.display, cssColor: this.uiLayer.colors[0], width: g.game.width, height: g.game.height, anchorX: null, touchable: !0 }), this.background.isMoveCamera = !0, e.preview), r = (this.preview = s, this.margin = { width: s.width, height: s.height }, this.pieceLayer = new g.E({ scene: this.scene, parent: this.display, width: 3 * s.width, height: 3 * s.height }), this.display.append(this.uiLayer.display), this.uiLayer.zoomIn = function () { return a.zoomBy(.9) }, this.uiLayer.zoomOut = function () { return a.zoomBy(1.1) }, this.uiLayer.colorChange = function (e) { a.background.cssColor = e, a.background.modified() }, this.uiLayer.hideDisplay = function () { r.show(), a.scene.onPointMoveCapture.remove(a.scene.moveCameraEvent, a.scene), a.scene.onPointDownCapture.remove(a.scene.checkPickPiece, a.scene), i = a.camera.scaleX, t = { x: a.camera.x, y: a.camera.y }, a.camera.scale(1), a.camera.moveTo(0, 0), a.camera.modified(), a.background.hide(), a.pieceLayer.hide(), a.uiLayer.display.hide() }, new g.FilledRect({ scene: this.scene, cssColor: "white", x: 1180, y: 630, width: 96, height: 96, opacity: .5, touchable: !0, hidden: !0 })); new g.Sprite({ scene: this.scene, parent: r, src: this.scene.asset.getImageById("visibleBtn") }), this.scene.append(r), r.onPointDown.add(function () { r.hide(), a.scene.onPointMoveCapture.add(a.scene.moveCameraEvent, a.scene), null == a.scene.joinBtn && a.scene.onPointDownCapture.add(a.scene.checkPickPiece, a.scene), a.camera.scale(i), a.camera.moveTo(t), a.camera.modified(), a.uiLayer.display.show(), a.pieceLayer.show(), a.background.show() }), this.board = new g.FilledRect({ scene: this.scene, parent: this.display, cssColor: "rgba(255,255,255,0.3)", width: s.width, height: s.height, x: this.margin.width, y: this.margin.height }), this.pieceLayer.append(this.board); for (var o = 0; o < e.cutInfo.length; o++) { var n = new u.Piece({ scene: this.scene, jigsaw: this, pieceID: o, createParam: e }); this.pieces.push(n), this.pieceLayer.append(n) } for (this.randomLineUp(), g.game.focusingCamera = this.camera, this.camera.scale(this.pieceLayer.width / (this.camera.width + .5)), this.camera.moveTo(s.width * this.camera.scaleX / 3, s.height * this.camera.scaleX / 3), this.cameraModified(), "atsumaru" == f.GameParams.operation && (this.uiLayer.display.append(this.scoreBoard.display), this.uiLayer.showScoreBoard = function () { a.scoreBoard.show(a.pazzleID + 1, a.level) }), this.uiLayer.display.append(this.noticeViewer.display), this.pieceCol = 2; 2 != this.pieces[this.pieceCol - 1].connects.length;)this.pieceCol++; this.pieceRow = this.pieces.length / this.pieceCol; var c = function () { for (var e = 0; e < a.pieceCol; e++)if (!a.pieces[e].isFit) return; for (e = 0; e < a.pieces.length; e += a.pieceCol)if (!a.pieces[e].isFit) return; for (e = a.pieceCol - 1; e < a.pieces.length; e += a.pieceCol)if (!a.pieces[e].isFit) return; for (e = 1; e <= a.pieceCol; e++)if (!a.pieces[a.pieces.length - e].isFit) return; a.isAlignOuter = !0, a.fitCount != a.pieces.length && a.noticeViewer.addNoticeCard(new v.NormalNoticeCard(a.scene, "", a.scene.asset.getAudioById("voice_outer"))), a.noticeEvent.remove(c, a), a.noticeEvent.remove(h, a), a.noticeEvent.remove(l, a), a.noticeEvent.remove(d, a), a.noticeEvent.remove(p, a) }, h = (this.noticeEvent.add(c, this), function () { if (!a.isAlignOuter) { for (var e = 0; e < a.pieceCol; e++)if (!a.pieces[e].isFit) return; a.noticeViewer.addNoticeCard(new v.NormalNoticeCard(a.scene, "", a.scene.asset.getAudioById("voice_top"))), a.noticeEvent.remove(h, a) } }), l = function () { if (!a.isAlignOuter) { for (var e = 0; e < a.pieces.length; e += a.pieceCol)if (!a.pieces[e].isFit) return; a.noticeViewer.addNoticeCard(new v.NormalNoticeCard(a.scene, "", a.scene.asset.getAudioById("voice_left"))), a.noticeEvent.remove(l, a) } }, d = function () { if (!a.isAlignOuter) { for (var e = a.pieceCol - 1; e < a.pieces.length; e += a.pieceCol)if (!a.pieces[e].isFit) return; a.noticeViewer.addNoticeCard(new v.NormalNoticeCard(a.scene, "", a.scene.asset.getAudioById("voice_right"))), a.noticeEvent.remove(d, a) } }, p = function () { if (!a.isAlignOuter) { for (var e = 1; e <= a.pieceCol; e++)if (!a.pieces[a.pieces.length - e].isFit) return; a.noticeViewer.addNoticeCard(new v.NormalNoticeCard(a.scene, "", a.scene.asset.getAudioById("voice_bottom"))), a.noticeEvent.remove(p, a) } }, m = (100 <= this.pieces.length && (this.noticeEvent.add(h, this), this.noticeEvent.add(l, this), this.noticeEvent.add(d, this), this.noticeEvent.add(p, this)), function () { var i; 25 <= a.fitPer && (a.noticeViewer.addNoticeCard(new v.NormalNoticeCard(a.scene, "", a.scene.asset.getAudioById("voice_25"))), a.noticeEvent.remove(m, a), a.noticeEvent.add(i = function () { var e; 50 <= a.fitPer && (a.noticeViewer.addNoticeCard(new v.NormalNoticeCard(a.scene, "", a.scene.asset.getAudioById("voice_50"))), a.noticeEvent.remove(i, a), a.noticeEvent.add(e = function () { 75 <= a.fitPer && (a.noticeViewer.addNoticeCard(new v.NormalNoticeCard(a.scene, "", a.scene.asset.getAudioById("voice_75"))), a.noticeEvent.remove(e, a)) }, a)) }, a)) }); this.noticeEvent.add(m, this) }, c.prototype.joinPlayer = function (e) { var i = new t.Player(e, null == (e = this.players[this.players.length - 1]) ? void 0 : e.rank), e = this.players.findIndex(function (e) { return e.SamePlayerID(i) }); -1 == e ? (this.players.push(i), i.playerID == g.game.selfId && this.isJoinWait && (this.isJoinWait = !1, this.me = i)) : (this.players[e].name = i.name, (i = this.players[e]).playerID == g.game.selfId && (this.isJoinWait ? (this.isJoinWait = !1, this.me = i) : this.me = void 0)), "Title" != this.jigsawState && this.uiLayer.result.draw(this.players) }, c.prototype.PickPiece = function (i) { var e = this.pieces.find(function (e) { return e.pieceID == i.pieceID }), t = this.players.find(function (e) { return e.playerID == i.playerID }); null == e || null == t || t.SamePlayerID(this.me) || (e.holder, e.holder = t, e.opacity = .4, e.touchable = !1, e.modified(), e.parent.append(e), f.GameParams.isOwner && f.GameParams.userBanMode && (null != e.nameLabel ? (e.nameLabel.x = e.x, e.nameLabel.y = e.y + n, e.nameLabel.modified(), e.nameLabel.text = e.holder.name, e.nameLabel.invalidate()) : e.nameLabel = new g.Label({ parent: e.parent, x: e.x, y: e.y + n, font: this.nameFont, scene: this.scene, text: t.name }))) }, c.prototype.MovePiece = function (i) { var e = this.pieces.find(function (e) { return e.pieceID == i.pieceID }), t = this.players.find(function (e) { return e.playerID == i.playerID }); null == e || null == t || t.SamePlayerID(this.me) || (null != e.holder && e.holder.SamePlayerID(this.me), e.holder = t, e.moveTo(i.pos), e.modified(), f.GameParams.isOwner && null != e.nameLabel && f.GameParams.userBanMode && (e.nameLabel.x = e.x, e.nameLabel.y = e.y + n, e.nameLabel.modified())) }, c.prototype.PutPiece = function (i) { var t = this.pieces.find(function (e) { return e.pieceID == i.pieceID }), e = this.players.find(function (e) { return e.playerID == i.playerID }); null != t && null != e && (t.holder = void 0, t.opacity = 1, t.touchable = !0, t.childPiece.forEach(function (e) { return e.opacity = 1 }), e.SamePlayerID(this.me) && null != t.holder || (null != t.holder && t.holder.SamePlayerID(this.me), t.moveTo(i.pos), t.modified(), f.GameParams.isOwner && null != (null == (e = t.nameLabel) ? void 0 : e.parent) && (t.nameLabel.x = t.x, t.nameLabel.y = t.y + n, t.nameLabel.modified(), this.scene.setTimeout(function () { var e; null == t.holder && null != (null == (e = t.nameLabel) ? void 0 : e.parent) && (t.nameLabel.remove(), t.nameLabel = void 0) }, 1e3)))) }, c.prototype.connectPiece = function (e) { for (var i = this.pieces[e.parentID], t = this.pieces[e.childID], a = i; a.parentPiece;)a = a.parentPiece; a.holder = void 0, a.childPiece.push(t), (t.parentPiece = a).append(t), t.moveTo(a.justPxBw(t)), t.modified(); for (var s = 0, r = t.childPiece.splice(0); s < r.length; s++) { var o = r[s]; a.childPiece.push(o), (o.parentPiece = a).append(o), o.moveTo(a.justPxBw(o)), o.modified() } this.scoreUp(e.playerID) }, c.prototype.fitPiece = function (e) { var i = this.pieces[e.pieceID]; i.isFit = !0, i.holder = void 0, i.touchable = !1, i.moveTo(this.margin.width + i.answer.x, this.margin.height + i.answer.y), i.modified(); for (var t = 0, a = i.childPiece; t < a.length; t++) { var s = a[t]; s.isFit = !0, s.touchable = !1 } i.parent.insertBefore(i, i.parent.children[1]), this.scoreUp(e.playerID) }, c.prototype.scoreUp = function (e) { (this.me && e == this.me.playerID ? f.GameParams.myFitSound : f.GameParams.otherFitSound).play(), this.fitCount++, this.samePlayerID(e).FitPiece(), this.scoreUpdate(), this.uiLayer.result.draw(this.players), this.fitPer = Math.floor(this.fitCount / this.pieces.length * 100), this.noticeEvent.fire() }, c.prototype.completed = function (e) { this.jigsawState = "Complete"; var i = new a.Animation(this.scene); this.uiLayer.display.append(i.display), i.start(), this.uiLayer.info.stopTimer(), this.scene.asset.getAudioById("voice_8888").play(), "nicolive" == f.GameParams.operation ? (this.uiLayer.result.draw(this.players, this.samePlayerID(e)), this.uiLayer.result.show()) : "atsumaru" == f.GameParams.operation && -1 != this.pazzleID && (i = this.uiLayer.info.time, e = 1e7 * -(4 - this.level) - 1e4 * i.h - 100 * i.m - i.s, window.RPGAtsumaru.scoreboards.setRecord(this.pazzleID + 1, e), this.scoreBoard.show(this.pazzleID + 1, this.level)) }, c.prototype.scoreUpdate = function () { this.players.sort(function (e, i) { return i.score - e.score }); for (var e = 999999, i = 0, t = 1, a = 0, s = this.players; a < s.length; a++) { var r = s[a]; r.score == e ? (r.rank = i, t++) : (i += t, r.rank = i, t = 1, e = r.score) } }, c.prototype.zoomBy = function (e) { .1 <= (e *= this.camera.scaleX) && this.camera.scale(e), this.cameraModified() }, c.prototype.moveCameraFromMouse = function (e) { var i, t = 100, a = 100, s = 0, r = 0; return e.x = Math.floor(e.x), e.y = Math.floor(e.y), e.x < t ? s += e.x <= 0 ? 20 : 20 * Math.pow(1 - e.x / t, 2) : (i = this.uiLayer.display.width - e.x) < t && (s -= i <= 0 ? 20 : 20 * Math.pow(1 - i / t, 2)), e.y < a ? r += e.y <= 0 ? 20 : 20 * Math.pow(1 - e.y / a, 2) : (i = this.uiLayer.display.height - e.y) < a && (r -= i <= 0 ? 20 : 20 * Math.pow(1 - i / a, 2)), 0 != s || 0 != r ? this.moveCamera({ x: s, y: r }) : { x: s, y: r } }, c.prototype.moveCamera = function (e) { var e = { x: -e.x * this.camera.scaleX, y: -e.y * this.camera.scaleY }, i = (this.camera.x += e.x, this.camera.y += e.y, this.camera.width / 2), t = this.camera.height / 2, a = this.camera.x + i, s = this.camera.y + t; return a < 0 || isNaN(a) ? this.camera.x = -i : a > this.pieceLayer.width && (this.camera.x = this.pieceLayer.width - i), s < 0 || isNaN(s) ? this.camera.y = -t : s > this.pieceLayer.height && (this.camera.y = this.pieceLayer.height - t), this.cameraModified(), e }, c.prototype.cameraModified = function () { this.camera.modified(), this.uiLayer.display.moveTo(this.camera.x, this.camera.y), this.uiLayer.display.scaleX = this.camera.scaleX, this.uiLayer.display.scaleY = this.camera.scaleY, this.uiLayer.display.modified(), this.background.moveTo(this.camera.x, this.camera.y), this.background.scaleX = this.camera.scaleX, this.background.scaleY = this.camera.scaleY, this.background.modified() }, c.prototype.randomLineUp = function () { for (var i = this, e = new Array(this.pieces.length), t = new Array(this.pieces.length), a = 0; a < e.length; a++)e[a] = a; for (a = 0; a < t.length; a++) { var s = Math.floor(g.game.random.generate() * e.length), r = e.splice(s, 1); t[a] = r[0] } function o() { var e = t.pop(); return null == e ? !(m = !1) : (i.pieces[e].moveTo({ x: d, y: p }), i.pieces[e].modified(), !1) } for (var n = 1.4 * this.pieces[0].width, c = 1.45 * this.pieces[0].height, h = Math.ceil(this.preview.width / n) + 1, l = Math.ceil(this.preview.height / c) + 2 + 1, d = this.margin.width - n / 2, p = this.margin.height - c - c / 2, m = !0; m;) { for (s = 0; s < h && !o(); s++)d += n; for (s = 0; s < l - 1 && !o(); s++)p += c; for (s = 0; s < h + 1 && !o(); s++)d -= n; for (s = 0; s < l && !o(); s++)p -= c; h += 2, l += 2 } }, e.Jigsaw = c }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["funcs"] = function (g) {
      !function (e, t) { var i = this && this.__assign || function () { return (i = Object.assign || function (e) { for (var t, n = 1, a = arguments.length; n < a; n++)for (var i in t = arguments[n]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }, r = (Object.defineProperty(e, "__esModule", { value: !0 }), e.createScrollLabel = e.createFillLabel = e.base64ToArrayBuffer = e.ConvertJpgImage = e.removeDropFile = e.addDragDrop = e.newFont = e.labelAutoReSizeH = e.spriteSet = e.labelAutoReSizeW = void 0, t("@akashic-extension/akashic-label")), o = t("./jpeg/image"); e.labelAutoReSizeW = function (e, t) { e.scale(1), e.invalidate(), (t /= e.width) < 1 && (e.scale(t), e.modified(), e.invalidate()) }, e.spriteSet = function (e, t, n) { e.x = 0, e.y = 0; var a = t / e.width, i = n / e.height; i < a ? (e.scale(i), e.x = (t - e.width * e.scaleX) / 2) : (e.scale(a), e.y = (n - e.height * e.scaleY) / 2), e.modified() }, e.labelAutoReSizeH = function (e, t, n) { for (e.invalidate(), e.width = t, e.modified(), e.invalidate(); n < e.height;)e.width *= 2, n *= 2, e.scale(e.scaleX / 2), e.modified(), e.invalidate() }, e.newFont = function (e, t, n) { return n = null == n ? "brack" : n, new g.DynamicFont({ game: g.game, fontFamily: e, size: t, fontColor: n }) }; var n = void 0; function a(e) { e.preventDefault(), e.stopPropagation(), e.dataTransfer.dropEffect = "copy" } e.addDragDrop = function (e) { null == n && (n = e, (e = document.getElementsByTagName("canvas")[0]).addEventListener("dragover", a), e.addEventListener("drop", n)) }, e.removeDropFile = function () { var e; null != n && ((e = document.getElementsByTagName("canvas")[0]).removeEventListener("dragover", a), e.removeEventListener("drop", n), n = void 0) }, e.ConvertJpgImage = function (e) { var t = new Blob([e], { type: "image/png" }); return new Promise(function (a, e) { createImageBitmap(t).then(function (e) { var t = document.createElement("canvas"), n = (t.width = e.width, t.height = e.height, t.getContext("2d")); n.drawImage(e, 0, 0), a(new o.Image(n.getImageData(0, 0, t.width, t.height))) }) }) }, e.base64ToArrayBuffer = function (e) { e = e.split(",")[1]; for (var t = window.atob(e), n = t.length, a = new Uint8Array(n), i = 0; i < n; i++)a[i] = t.charCodeAt(i); return a.buffer }, e.createFillLabel = function (e, t) { return e = new g.FilledRect(e), new r.Label(i(i({}, t), { parent: e, width: e.width - (null != (t = t.x) ? t : 0) })), e }, e.createScrollLabel = function (e, t) { var n = new g.Pane(e), e = new g.FilledRect(i(i({}, e), { parent: n, x: 0, y: 0, touchable: !0 })), a = new r.Label(i(i({}, t), { parent: n, width: n.width - (null != (t = t.x) ? t : 0) })); return e.onPointMove.add(function (e) { a.y += e.prevDelta.y, a.y < n.height - a.height && (a.y = n.height - a.height), 0 < a.y && (a.y = 0), a.modified() }), n } }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["decoder"] = function (g) {
      !function (e, r) { Object.defineProperty(e, "__esModule", { value: !0 }), e.decode = void 0; var o = r("./image"), a = function () { "use strict"; var N = new Int32Array([0, 1, 8, 16, 9, 2, 3, 10, 17, 24, 32, 25, 18, 11, 4, 5, 12, 19, 26, 33, 40, 48, 41, 34, 27, 20, 13, 6, 7, 14, 21, 28, 35, 42, 49, 56, 57, 50, 43, 36, 29, 22, 15, 23, 30, 37, 44, 51, 58, 59, 52, 45, 38, 31, 39, 46, 53, 60, 61, 54, 47, 55, 62, 63]), O = 4017, q = 799, M = 3406, z = 2276, j = 1567, H = 3784, S = 5793, G = 2896; function e() { } function R(r, n, e, o, a, f, l, s, h) { var t = e.mcusPerLine, M = e.progressive, z = n, i = 0, c = 0; function u() { if (0 < c) return i >> --c & 1; if (255 === (i = r[n++])) { var e = r[n++]; if (e) throw new Error("unexpected marker: " + (i << 8 | e).toString(16)) } return i >>> (c = 7) } function d(e) { for (var r, n = e; null !== (r = u());) { if ("number" == typeof (n = n[r])) return n; if ("object" != typeof n) throw new Error("invalid huffman sequence") } return null } function m(e) { for (var r = 0; 0 < e;) { var n = u(); if (null === n) return; r = r << 1 | n, e-- } return r } function v(e) { var r = m(e); return 1 << e - 1 <= r ? r : r + (-1 << e) + 1 } var p = 0; var b, w = 0; var k, g, y, P, x, X, A, T, C, j, L, E, H, D, S, I, U, Y = o.length, G = M ? 0 === f ? 0 === s ? function (e, r) { var n = 0 === (n = d(e.huffmanTableDC)) ? 0 : v(n) << h; r[0] = e.pred += n } : function (e, r) { r[0] |= u() << h } : 0 === s ? function (e, r) { if (0 < p) p--; else for (var n = f, o = l; n <= o;) { var a = d(e.huffmanTableAC), s = 15 & a, a = a >> 4; if (0 == s) { if (a < 15) { p = m(a) + (1 << a) - 1; break } n += 16 } else r[N[n += a]] = v(s) * (1 << h), n++ } } : function (e, r) { for (var n = f, o = l, a = 0; n <= o;) { var s = N[n], t = r[s] < 0 ? -1 : 1; switch (w) { case 0: var i = d(e.huffmanTableAC), c = 15 & i, a = i >> 4; if (0 == c) w = a < 15 ? (p = m(a) + (1 << a), 4) : (a = 16, 1); else { if (1 != c) throw new Error("invalid ACn encoding"); b = v(c), w = a ? 2 : 3 } continue; case 1: case 2: r[s] ? r[s] += (u() << h) * t : 0 === --a && (w = 2 == w ? 3 : 0); break; case 3: r[s] ? r[s] += (u() << h) * t : (r[s] = b << h, w = 0); break; case 4: r[s] && (r[s] += (u() << h) * t) }n++ } 4 === w && 0 === --p && (w = 0) } : function (e, r) { for (var n = 0 === (n = d(e.huffmanTableDC)) ? 0 : v(n), o = (r[0] = e.pred += n, 1); o < 64;) { var a = d(e.huffmanTableAC), s = 15 & a, a = a >> 4; if (0 == s) { if (a < 15) break; o += 16 } else r[N[o += a]] = v(s), o++ } }, O = 0, q = 1 == Y ? o[0].blocksPerLine * o[0].blocksPerColumn : t * e.mcusPerColumn; for (a = a || q; O < q;) { for (g = 0; g < Y; g++)o[g].pred = 0; if (p = 0, 1 == Y) for (k = o[0], x = 0; x < a; x++)S = G, U = void 0, U = (I = O) / (D = k).blocksPerLine | 0, I %= D.blocksPerLine, S(D, D.blocks[U][I]), O++; else for (x = 0; x < a; x++) { for (g = 0; g < Y; g++)for (A = (k = o[g]).h, T = k.v, y = 0; y < T; y++)for (P = 0; P < A; P++)j = G, E = y, H = P, E = ((L = O) / t | 0) * (C = k).v + E, L = L % t * C.h + H, j(C, C.blocks[E][L]); if (++O === q) break } if (c = 0, (X = r[n] << 8 | r[n + 1]) < 65280) throw new Error("marker was not found"); if (!(65488 <= X && X <= 65495)) break; n += 2 } return n - z } function Z(e, r) { var n = [], o = r.blocksPerLine, a = r.blocksPerColumn, s = o << 3, t = new Int32Array(64), i = new Uint8Array(64); for (var c = 0; c < a; c++) { var f = c << 3; for (Y = 0; Y < 8; Y++)n.push(new Uint8Array(s)); for (var l = 0; l < o; l++) { L = C = T = A = X = k = w = b = p = v = m = d = u = h = x = P = y = g = void 0; for (var h, u, d, m, v, p, b, w, k, g = r.blocks[c][l], y = i, P = t, x = r.quantizationTable, X = P, A = 0; A < 64; A++)X[A] = g[A] * x[A]; for (A = 0; A < 8; ++A) { var T = 8 * A; 0 == X[1 + T] && 0 == X[2 + T] && 0 == X[3 + T] && 0 == X[4 + T] && 0 == X[5 + T] && 0 == X[6 + T] && 0 == X[7 + T] ? (k = S * X[0 + T] + 512 >> 10, X[0 + T] = k, X[1 + T] = k, X[2 + T] = k, X[3 + T] = k, X[4 + T] = k, X[5 + T] = k, X[6 + T] = k, X[7 + T] = k) : (h = S * X[0 + T] + 128 >> 8, u = S * X[4 + T] + 128 >> 8, d = X[2 + T], m = X[6 + T], v = G * (X[1 + T] - X[7 + T]) + 128 >> 8, w = G * (X[1 + T] + X[7 + T]) + 128 >> 8, p = X[3 + T] << 4, b = X[5 + T] << 4, k = h - u + 1 >> 1, h = h + u + 1 >> 1, u = k, k = d * H + m * j + 128 >> 8, d = d * j - m * H + 128 >> 8, m = k, k = v - b + 1 >> 1, v = v + b + 1 >> 1, b = k, k = w + p + 1 >> 1, p = w - p + 1 >> 1, w = k, k = h - m + 1 >> 1, h = h + m + 1 >> 1, m = k, k = u - d + 1 >> 1, u = u + d + 1 >> 1, d = k, k = v * z + w * M + 2048 >> 12, v = v * M - w * z + 2048 >> 12, w = k, k = p * q + b * O + 2048 >> 12, p = p * O - b * q + 2048 >> 12, b = k, X[0 + T] = h + w, X[7 + T] = h - w, X[1 + T] = u + b, X[6 + T] = u - b, X[2 + T] = d + p, X[5 + T] = d - p, X[3 + T] = m + v, X[4 + T] = m - v) } for (A = 0; A < 8; ++A) { var C = A; 0 == X[8 + C] && 0 == X[16 + C] && 0 == X[24 + C] && 0 == X[32 + C] && 0 == X[40 + C] && 0 == X[48 + C] && 0 == X[56 + C] ? (k = S * P[A + 0] + 8192 >> 14, X[0 + C] = k, X[8 + C] = k, X[16 + C] = k, X[24 + C] = k, X[32 + C] = k, X[40 + C] = k, X[48 + C] = k, X[56 + C] = k) : (h = S * X[0 + C] + 2048 >> 12, u = S * X[32 + C] + 2048 >> 12, d = X[16 + C], m = X[48 + C], v = G * (X[8 + C] - X[56 + C]) + 2048 >> 12, w = G * (X[8 + C] + X[56 + C]) + 2048 >> 12, p = X[24 + C], b = X[40 + C], k = h - u + 1 >> 1, h = h + u + 1 >> 1, u = k, k = d * H + m * j + 2048 >> 12, d = d * j - m * H + 2048 >> 12, m = k, k = v - b + 1 >> 1, v = v + b + 1 >> 1, b = k, k = w + p + 1 >> 1, p = w - p + 1 >> 1, w = k, k = h - m + 1 >> 1, h = h + m + 1 >> 1, m = k, k = u - d + 1 >> 1, u = u + d + 1 >> 1, d = k, k = v * z + w * M + 2048 >> 12, v = v * M - w * z + 2048 >> 12, w = k, k = p * q + b * O + 2048 >> 12, p = p * O - b * q + 2048 >> 12, b = k, X[0 + C] = h + w, X[56 + C] = h - w, X[8 + C] = u + b, X[48 + C] = u - b, X[16 + C] = d + p, X[40 + C] = d - p, X[24 + C] = m + v, X[32 + C] = m - v) } for (A = 0; A < 64; ++A) { var L = 128 + (X[A] + 8 >> 4); y[A] = L < 0 ? 0 : 255 < L ? 255 : L } for (var E = 0, D = l << 3, I = 0; I < 8; I++)for (var U = n[f + I], Y = 0; Y < 8; Y++)U[D + Y] = i[E++] } } return n } function L(e) { return e < 0 ? 0 : 255 < e ? 255 : e } return e.prototype = { load: function (e) { }, parse: function (r) { var n = 0; function e() { var e = r[n] << 8 | r[n + 1]; return n += 2, e } var o, a, s = null, t = null, i = [], c = [], f = [], l = [], h = e(); if (65496 != h) throw new Error("SOI not found"); for (h = e(); 65497 != h;) { var u = void 0, d = void 0; switch (h) { case 65280: break; case 65504: case 65505: case 65506: case 65507: case 65508: case 65509: case 65510: case 65511: case 65512: case 65513: case 65514: case 65515: case 65516: case 65517: case 65518: case 65519: case 65534: void 0, O = void 0, O = e(), O = r.subarray(n, n + O - 2), n += O.length; 65504 === h && 74 === O[0] && 70 === O[1] && 73 === O[2] && 70 === O[3] && 0 === O[4] && (s = { version: { major: O[5], minor: O[6] }, densityUnits: O[7], xDensity: O[8] << 8 | O[9], yDensity: O[10] << 8 | O[11], thumbWidth: O[12], thumbHeight: O[13], thumbData: O.subarray(14, 14 + 3 * O[12] * O[13]) }), 65518 === h && 65 === O[0] && 100 === O[1] && 111 === O[2] && 98 === O[3] && 101 === O[4] && 0 === O[5] && (t = { version: O[6], flags0: O[7] << 8 | O[8], flags1: O[9] << 8 | O[10], transformCode: O[11] }); break; case 65499: for (var M = e() + n - 2; n < M;) { var m = r[n++], v = new Int32Array(64); if (m >> 4 == 0) for (d = 0; d < 64; d++)v[N[d]] = r[n++]; else { if (m >> 4 != 1) throw new Error("DQT: invalid table spec"); for (d = 0; d < 64; d++)v[N[d]] = e() } i[15 & m] = v } break; case 65472: case 65473: case 65474: e(), (o = {}).extended = 65473 === h, o.progressive = 65474 === h, o.precision = r[n++], o.scanLines = e(), o.samplesPerLine = e(), o.components = {}, o.componentsOrder = []; var z = r[n++]; for (u = 0; u < z; u++) { var p = r[n], j = r[n + 1] >> 4, H = 15 & r[n + 1], S = r[n + 2]; o.componentsOrder.push(p), o.components[p] = { h: j, v: H, quantizationIdx: S }, n += 3 } I = D = E = L = C = T = A = X = P = y = b = x = g = k = w = void 0; var b, w = o, k = 0, g = 0; for (b in w.components) w.components.hasOwnProperty(b) && (k < (x = w.components[b]).h && (k = x.h), g < x.v && (g = x.v)); var y = Math.ceil(w.samplesPerLine / 8 / k), P = Math.ceil(w.scanLines / 8 / g); for (b in w.components) if (w.components.hasOwnProperty(b)) { for (var x = w.components[b], X = Math.ceil(Math.ceil(w.samplesPerLine / 8) * x.h / k), A = Math.ceil(Math.ceil(w.scanLines / 8) * x.v / g), T = y * x.h, C = P * x.v, L = [], E = 0; E < C; E++) { for (var D = [], I = 0; I < T; I++)D.push(new Int32Array(64)); L.push(D) } x.blocksPerLine = X, x.blocksPerColumn = A, x.blocks = L } w.maxH = k, w.maxV = g, w.mcusPerLine = y, w.mcusPerColumn = P, c.push(o); break; case 65476: var G = e(); for (u = 2; u < G;) { var J = r[n++], V = new Uint8Array(16), U = 0; for (d = 0; d < 16; d++, n++)U += V[d] = r[n]; var _ = new Uint8Array(U); for (d = 0; d < U; d++, n++)_[d] = r[n]; u += 17 + U, (J >> 4 == 0 ? l : f)[15 & J] = function (e, r) { for (var n, o = 0, a = [], s = 16; 0 < s && !e[s - 1];)s--; a.push({ children: new Array, index: 0 }); for (var t, i = a[0], c = 0; c < s; c++) { for (n = 0; n < e[c]; n++) { for ((i = a.pop()).children[i.index] = r[o]; 0 < i.index;)i = a.pop(); for (i.index++, a.push(i); a.length <= c;)a.push(t = { children: [], index: 0 }), i.children[i.index] = t.children, i = t; o++ } c + 1 < s && (a.push(t = { children: [], index: 0 }), i.children[i.index] = t.children, i = t) } return a[0].children }(V, _) } break; case 65501: e(), a = e(); break; case 65498: e(); var Q = r[n++], W = [], Y = void 0; for (u = 0; u < Q; u++) { Y = o.components[r[n++]]; var B = r[n++]; Y.huffmanTableDC = l[B >> 4], Y.huffmanTableAC = f[15 & B], W.push(Y) } var O = r[n++], F = r[n++], K = r[n++], F = R(r, n, o, W, a, O, F, K >> 4, 15 & K); n += F; break; case 65535: 255 !== r[n] && n--; break; default: if (255 == r[n - 3] && 192 <= r[n - 2] && r[n - 2] <= 254) { n -= 3; break } throw new Error("unknown JPEG marker " + h.toString(16)) }h = e() } if (1 != c.length) throw new Error("only single frame JPEGs supported"); for (u = 0; u < c.length; u++) { var q = c[u].components; for (d in q) q[d].quantizationTable = i[q[d].quantizationIdx], delete q[d].quantizationIdx } this.width = o.samplesPerLine, this.height = o.scanLines, this.jfif = s, this.adobe = t, this.components = []; for (u = 0; u < o.componentsOrder.length; u++) { Y = o.components[o.componentsOrder[u]]; this.components.push({ lines: Z(0, Y), scaleX: Y.h / o.maxH, scaleY: Y.v / o.maxV }) } }, getData: function (e, r) { var n, o, a, s, t, i, c, f, l, h, u, d, m, v, p, b, w, k, g, y, P, x = this.width / e, X = this.height / r, A = 0, T = e * r * this.components.length, C = new Uint8Array(T); switch (this.components.length) { case 1: for (n = this.components[0], h = 0; h < r; h++)for (t = n.lines[0 | h * n.scaleY * X], l = 0; l < e; l++)u = t[0 | l * n.scaleX * x], C[A++] = u; break; case 2: for (n = this.components[0], o = this.components[1], h = 0; h < r; h++)for (t = n.lines[0 | h * n.scaleY * X], i = o.lines[0 | h * o.scaleY * X], l = 0; l < e; l++)u = t[0 | l * n.scaleX * x], C[A++] = u, u = i[0 | l * o.scaleX * x], C[A++] = u; break; case 3: for (P = !0, this.adobe && this.adobe.transformCode ? P = !0 : void 0 !== this.colorTransform && (P = !!this.colorTransform), n = this.components[0], o = this.components[1], a = this.components[2], h = 0; h < r; h++)for (t = n.lines[0 | h * n.scaleY * X], i = o.lines[0 | h * o.scaleY * X], c = a.lines[0 | h * a.scaleY * X], l = 0; l < e; l++)y = P ? (u = t[0 | l * n.scaleX * x], d = i[0 | l * o.scaleX * x], k = L(u + 1.402 * ((m = c[0 | l * a.scaleX * x]) - 128)), g = L(u - .3441363 * (d - 128) - .71413636 * (m - 128)), L(u + 1.772 * (d - 128))) : (k = t[0 | l * n.scaleX * x], g = i[0 | l * o.scaleX * x], c[0 | l * a.scaleX * x]), C[A++] = k, C[A++] = g, C[A++] = y; break; case 4: if (!this.adobe) throw new Error("Unsupported color mode (4 components)"); for (P = !1, this.adobe && this.adobe.transformCode ? P = !0 : void 0 !== this.colorTransform && (P = !!this.colorTransform), n = this.components[0], o = this.components[1], a = this.components[2], s = this.components[3], h = 0; h < r; h++)for (t = n.lines[0 | h * n.scaleY * X], i = o.lines[0 | h * o.scaleY * X], c = a.lines[0 | h * a.scaleY * X], f = s.lines[0 | h * s.scaleY * X], l = 0; l < e; l++)P ? (u = t[0 | l * n.scaleX * x], d = i[0 | l * o.scaleX * x], m = c[0 | l * a.scaleX * x], v = f[0 | l * s.scaleX * x], p = 255 - L(u + 1.402 * (m - 128)), b = 255 - L(u - .3441363 * (d - 128) - .71413636 * (m - 128)), w = 255 - L(u + 1.772 * (d - 128))) : (p = t[0 | l * n.scaleX * x], b = i[0 | l * o.scaleX * x], w = c[0 | l * a.scaleX * x], v = f[0 | l * s.scaleX * x]), C[A++] = 255 - p, C[A++] = 255 - b, C[A++] = 255 - w, C[A++] = 255 - v; break; default: throw new Error("Unsupported color mode") }return C }, copyToImageData: function (e) { var r, n, o, a, s, t, i, c, f = e.width, l = e.height, h = e.data, u = this.getData(f, l), d = 0, m = 0; switch (this.components.length) { case 1: for (n = 0; n < l; n++)for (r = 0; r < f; r++)o = u[d++], h[m++] = o, h[m++] = o, h[m++] = o, h[m++] = 255; break; case 3: for (n = 0; n < l; n++)for (r = 0; r < f; r++)t = u[d++], i = u[d++], c = u[d++], h[m++] = t, h[m++] = i, h[m++] = c, h[m++] = 255; break; case 4: for (n = 0; n < l; n++)for (r = 0; r < f; r++)a = u[d++], s = u[d++], o = u[d++], t = 255 - L(a * (1 - (a = u[d++]) / 255) + a), i = 255 - L(s * (1 - a / 255) + a), c = 255 - L(o * (1 - a / 255) + a), h[m++] = t, h[m++] = i, h[m++] = c, h[m++] = 255; break; default: throw new Error("Unsupported color mode") } } }, e }(); e.decode = function (e, r) { void 0 === r && (r = !0); var e = new Uint8Array(e), n = new a, e = (n.parse(e), n.colorTransform = r, new o.Image); return e.height = n.height, e.width = n.width, e.data = new Uint8Array(n.width * n.height * 4), n.copyToImageData(e), e } }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["encoder"] = function (g) {
      !function (r, a) { Object.defineProperty(r, "__esModule", { value: !0 }), r.encode = void 0; var e = a("./image"); function n(r) { var q, x, I, N, h, c = Math.floor, O = new Array(64), P = new Array(64), S = new Array(64), U = new Array(64), A = new Array(65535), g = new Array(65535), k = new Array(64), l = new Array(64), z = [], B = 0, D = 7, E = new Array(64), F = new Array(64), G = new Array(64), u = new Array(256), H = new Array(2048), m = [0, 1, 5, 6, 14, 15, 27, 28, 2, 4, 7, 13, 16, 26, 29, 42, 3, 8, 12, 17, 25, 30, 41, 43, 9, 11, 18, 24, 31, 40, 44, 53, 10, 19, 23, 32, 39, 45, 52, 54, 20, 22, 33, 38, 46, 51, 55, 60, 21, 34, 37, 47, 50, 56, 59, 61, 35, 36, 48, 49, 57, 58, 62, 63], J = [0, 0, 1, 5, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0], T = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], V = [0, 0, 2, 1, 3, 3, 2, 4, 3, 5, 5, 4, 4, 0, 0, 1, 125], W = [1, 2, 3, 0, 4, 17, 5, 18, 33, 49, 65, 6, 19, 81, 97, 7, 34, 113, 20, 50, 129, 145, 161, 8, 35, 66, 177, 193, 21, 82, 209, 240, 36, 51, 98, 114, 130, 9, 10, 22, 23, 24, 25, 26, 37, 38, 39, 40, 41, 42, 52, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250], X = [0, 0, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0], Y = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], Z = [0, 0, 2, 1, 2, 4, 4, 3, 4, 7, 5, 4, 4, 0, 1, 2, 119], $ = [0, 1, 2, 3, 17, 4, 5, 33, 49, 6, 18, 65, 81, 7, 97, 113, 19, 34, 50, 129, 8, 20, 66, 145, 161, 177, 193, 9, 35, 51, 82, 240, 21, 98, 114, 209, 10, 22, 36, 52, 225, 37, 241, 23, 24, 25, 26, 38, 39, 40, 41, 42, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 130, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 226, 227, 228, 229, 230, 231, 232, 233, 234, 242, 243, 244, 245, 246, 247, 248, 249, 250]; function a(r, a) { for (var o = 0, e = 0, n = new Array, f = 1; f <= 16; f++) { for (var v = 1; v <= r[f]; v++)n[a[e]] = [], n[a[e]][0] = o, n[a[e]][1] = f, e++, o++; o *= 2 } return n } function K(r) { for (var a = r[0], o = r[1] - 1; 0 <= o;)a & 1 << o && (B |= 1 << D), o--, --D < 0 && (255 === B ? (L(255), L(0)) : L(B), D = 7, B = 0) } function L(r) { z.push(r) } function Q(r) { L(r >> 8 & 255), L(255 & r) } function R(r, a, o, e, n) { for (var f, v = n[0], t = n[240], i = function (r, a) { for (var o, e = 0, n = 0; n < 8; ++n) { var f, v = r[e], t = r[e + 1], i = r[e + 2], u = r[e + 3], d = r[e + 4], w = r[e + 5], h = r[e + 6], c = v + (f = r[e + 7]), y = v - f, A = t + h, g = t - h, l = i + w, m = i - w, s = u + d, p = u - d, M = c + s, c = c - s, s = A + l, A = A - l, l = (r[e] = M + s, r[e + 4] = M - s, .707106781 * (A + c)), s = (r[e + 2] = c + l, r[e + 6] = c - l, .382683433 * ((M = p + m) - (A = g + y))), c = .5411961 * M + s, l = 1.306562965 * A + s, p = .707106781 * (m + g), M = y + p, A = y - p; r[e + 5] = A + c, r[e + 3] = A - c, r[e + 1] = M + l, r[e + 7] = M - l, e += 8 } for (n = e = 0; n < 8; ++n) { v = r[e], t = r[e + 8], i = r[e + 16], u = r[e + 24], d = r[e + 32], w = r[e + 40], h = r[e + 48]; var _ = v + (f = r[e + 56]), C = v - f, b = t + h, j = t - h, q = i + w, x = i - w, I = u + d, N = u - d, O = _ + I, _ = _ - I, I = b + q, b = b - q, q = (r[e] = O + I, r[e + 32] = O - I, .707106781 * (b + _)), I = (r[e + 16] = _ + q, r[e + 48] = _ - q, .382683433 * ((O = N + x) - (b = j + C))), _ = .5411961 * O + I, q = 1.306562965 * b + I, N = .707106781 * (x + j), O = C + N, b = C - N; r[e + 40] = b + _, r[e + 24] = b - _, r[e + 8] = O + q, r[e + 56] = O - q, e++ } for (n = 0; n < 64; ++n)o = r[n] * a[n], k[n] = 0 < o ? .5 + o | 0 : o - .5 | 0; return k }(r, a), u = 0; u < 64; ++u)l[m[u]] = i[u]; for (var r = l[0] - o, d = (o = l[0], 0 == r ? K(e[0]) : (K(e[g[f = 32767 + r]]), K(A[f])), 63); 0 < d && 0 === l[d]; d--); if (0 === d) K(v); else { for (var w = 1; w <= d;) { for (var h = w; 0 === l[w] && w <= d; ++w); h = w - h; if (16 <= h) { for (var c = h >> 4, y = 1; y <= c; ++y)K(t); h &= 15 } f = 32767 + l[w], K(n[(h << 4) + g[f]]), K(A[f]), w++ } 63 !== d && K(v) } return o } function r1(r) { if (h !== (r = 100 < (r = r <= 0 ? 1 : r) ? 100 : r)) { for (var a = r < 50 ? Math.floor(5e3 / r) : Math.floor(200 - 2 * r), o = [16, 11, 10, 16, 24, 40, 51, 61, 12, 12, 14, 19, 26, 58, 60, 55, 14, 13, 16, 24, 40, 57, 69, 56, 14, 17, 22, 29, 51, 87, 80, 62, 18, 22, 37, 56, 68, 109, 103, 77, 24, 35, 55, 64, 81, 104, 113, 92, 49, 64, 78, 87, 103, 121, 120, 101, 72, 92, 95, 98, 112, 100, 103, 99], e = 0; e < 64; e++) { var n = c((o[e] * a + 50) / 100); n < 1 ? n = 1 : 255 < n && (n = 255), O[m[e]] = n } for (var f = [17, 18, 24, 47, 99, 99, 99, 99, 18, 21, 26, 66, 99, 99, 99, 99, 24, 26, 56, 99, 99, 99, 99, 99, 47, 66, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99], v = 0; v < 64; v++) { var t = c((f[v] * a + 50) / 100); t < 1 ? t = 1 : 255 < t && (t = 255), P[m[v]] = t } for (var i = [1, 1.387039845, 1.306562965, 1.175875602, 1, .785694958, .5411961, .275899379], u = 0, d = 0; d < 8; d++)for (var w = 0; w < 8; w++)S[u] = 1 / (O[m[u]] * i[d] * i[w] * 8), U[u] = 1 / (P[m[u]] * i[d] * i[w] * 8), u++; h = r } } this.encode = function (r, a) { a && r1(a), z = new Array, B = 0, D = 7, Q(65496), Q(65504), Q(16), L(74), L(70), L(73), L(70), L(0), L(1), L(1), L(0), Q(1), Q(1), L(0), L(0), Q(65499), Q(132), L(0); for (var o = 0; o < 64; o++)L(O[o]); L(1); for (var e = 0; e < 64; e++)L(P[e]); a = r.width, _ = r.height, Q(65472), Q(17), L(8), Q(_), Q(a), L(3), L(1), L(17), L(0), L(2), L(17), L(1), L(3), L(17), L(1), Q(65476), Q(418), L(0); for (var n = 0; n < 16; n++)L(J[n + 1]); for (var f = 0; f <= 11; f++)L(T[f]); L(16); for (var v = 0; v < 16; v++)L(V[v + 1]); for (var t = 0; t <= 161; t++)L(W[t]); L(1); for (var i = 0; i < 16; i++)L(X[i + 1]); for (var u = 0; u <= 11; u++)L(Y[u]); L(17); for (var d = 0; d < 16; d++)L(Z[d + 1]); for (var w = 0; w <= 161; w++)L($[w]); Q(65498), Q(12), L(3), L(1), L(0), L(2), L(17), L(3), L(17), L(0), L(63), L(0); for (var h, c, y, A, g, l, m = 0, s = 0, p = 0, M = (B = 0, D = 7, this.encode.displayName = "_encode_", r.data), _ = r.width, C = r.height, b = 4 * _, j = 0; j < C;) { for (h = 0; h < b;) { for (c = b * j + h, l = 0; l < 64; l++)y = c + (g = l >> 3) * b + (A = 4 * (7 & l)), C <= j + g && (y -= b * (j + 1 + g - C)), b <= h + A && (y -= h + A - b + 4), g = M[y++], A = M[y++], y = M[y], E[l] = (H[g] + H[A + 256 >> 0] + H[y + 512 >> 0] >> 16) - 128, F[l] = (H[g + 768 >> 0] + H[A + 1024 >> 0] + H[y + 1280 >> 0] >> 16) - 128, G[l] = (H[g + 1280 >> 0] + H[A + 1536 >> 0] + H[y + 1792 >> 0] >> 16) - 128; m = R(E, S, m, q, I), s = R(F, U, s, x, N), p = R(G, U, p, x, N), h += 32 } j += 8 } return 0 <= D && ((a = [])[1] = D + 1, a[0] = (1 << D + 1) - 1, K(a)), Q(65497), new Uint8Array(z) }, r = r || 50; for (var d = String.fromCharCode, o = 0; o < 256; o++)u[o] = d(o); q = a(J, T), x = a(X, Y), I = a(V, W), N = a(Z, $); for (var e = 1, n = 2, f = 1; f <= 15; f++) { for (var v = e; v < n; v++)g[32767 + v] = f, A[32767 + v] = [], A[32767 + v][1] = f, A[32767 + v][0] = v; for (var t = -(n - 1); t <= -e; t++)g[32767 + t] = f, A[32767 + t] = [], A[32767 + t][1] = f, A[32767 + t][0] = n - 1 + t; e <<= 1, n <<= 1 } for (var i = 0; i < 256; i++)H[i] = 19595 * i, H[i + 256 >> 0] = 38470 * i, H[i + 512 >> 0] = 7471 * i + 32768, H[i + 768 >> 0] = -11059 * i, H[i + 1024 >> 0] = -21709 * i, H[i + 1280 >> 0] = 32768 * i + 8421375, H[i + 1536 >> 0] = -27439 * i, H[i + 1792 >> 0] = -5329 * i; r1(r) } r.encode = function (r, a) { var a = new n(a = void 0 === a ? 50 : a).encode(r, a), o = new e.Image; return o.data = a, o.width = r.width, o.height = r.height, o } }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["image"] = function (g) {
      !function (t) { function i(t) { null != t && (this.width = t.width, this.height = t.height, this.data = new Uint8Array(t.data)) } Object.defineProperty(t, "__esModule", { value: !0 }), t.Image = void 0, i.prototype.getPixel = function (t, i) { t += i * this.width; return { r: this.data[4 * t], g: this.data[4 * t + 1], b: this.data[4 * t + 2], a: this.data[4 * t + 3] } }, i.prototype.setPixel = function (t, i, a) { t += i * this.width; this.data[4 * t] = a.r, this.data[4 * t + 1] = a.g, this.data[4 * t + 2] = a.b, this.data[4 * t + 3] = a.a }, t.Image = i }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["pixel"] = function (g) {
      !function (e) { Object.defineProperty(e, "__esModule", { value: !0 }), e.Pixel = void 0, e.Pixel = function () { } }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["pieceCut"] = function (g) {
      !function (e) { Object.defineProperty(e, "__esModule", { value: !0 }), e.pieceCut = void 0, e.pieceCut = function (d) { function e(e) { return e % a != 0 } function i(e) { return e % a != a - 1 } function t(e) { return e < a * (o - 1) } for (var w = d.scene, h = d.previewSrc, r = d.difficulty, n = h.width - r.origin.x, s = h.height - r.origin.y, a = (n = { width: n - n % r.size.width, height: s - s % r.size.height }).width / r.size.width, o = n.height / r.size.height, c = r.size.width / 4, y = r.size.height / 4, u = o * a, x = new Array(u), p = new Array(u), z = new Array(u), l = 0; l < u; l++)p[l] = new Array; for (var s = new g.Sprite({ scene: w, src: h.src, srcX: r.origin.x, srcY: r.origin.y, width: n.width, height: n.height }), f = new g.E({ scene: w }), v = new g.Sprite({ scene: w, src: h.src }), m = { x: 0, y: 0 }, S = 0; S < o; S++) { for (var M = m.x = 0; M < a; M++) { var k = S * a + M, A = { x: M * r.size.width, y: S * r.size.height }, F = { width: r.size.width, height: r.size.height }, I = (a <= k && (A.y -= y, F.height += y, p[k].push(k - a)), e(k) && (A.x -= c, F.width += c, p[k].push(k - 1)), i(k) && (F.width += c, p[k].push(k + 1)), t(k) && (F.height += y, p[k].push(k + a)), P = void 0, m), P = F; P = new g.Pane({ scene: w, width: Math.ceil(P.width), height: Math.ceil(P.height), x: I.x, y: I.y }), v.x = -A.x - r.origin.x, v.y = -A.y - r.origin.y, v.modified(), P.append(v), f.append(g.SpriteFactory.createSpriteFromE(w, P)), m.x += F.width } m.y += F.height } for (var j = d.wakus.length / 2, E = new Array(2 * a * o), l = 0; l < E.length; l++)E[l] = Math.floor(g.game.random.generate() * j * 2); function C(e, i, t) { var h, r = 0 == t || 180 == t ? (h = D, O) : (h = O, D), n = d.wakus[i].width * h, s = d.wakus[i].height * r, i = new g.Sprite({ scene: w, src: d.wakus[i], scaleX: h, scaleY: r, angle: t, compositeOperation: "destination-out" }); 0 == t ? (i.x = e.x, i.y = e.y) : 180 == t ? (i.x = e.x + n, i.y = e.y + s) : 90 == t ? (i.x = e.x + s, i.y = e.y) : -90 == t && (i.x = e.x, i.y = e.y + n), i.x = Math.ceil(i.x), i.y = Math.ceil(i.y), i.modified(), f.append(i) } var D = (r.size.width + 2 * c) / d.wakus[0].width, O = (r.size.height + 2 * y) / d.wakus[0].height; for (m.y = -y, S = 0; S < o; S++) { m.x = -c; for (M = 0; M < a; M++) { var X, Y = { x: M * (r.size.width + 2 * c), y: S * (r.size.height + 2 * y) }, _ = { width: r.size.width, height: r.size.height }, k = S * a + M, b = 2 * a * Math.floor(k / a) + k % a; a <= k && (C(m, X = E[b - a], 0), X % 2 == 0 && (Y.y -= y, _.height += y)), e(k) && (C(m, X = E[b - 1], -90), X % 2 == 0 && (Y.x -= c, _.width += c)), i(k) && (C(m, X = (E[b] + 1) % 2, 90), X % 2 == 0 && (_.width += c)), t(k) && (C(m, X = (E[b + a] + 1) % 2, 180), X % 2 == 0 && (_.height += y)), x[k] = { x: Y.x - 2 * c * M, y: Y.y - 2 * y * S }, z[k] = { x: Y.x, y: Y.y, width: _.width + 1, height: _.height + 1 }, m.x += r.size.width + 2 * c } m.y += r.size.height + 2 * y } return (n = new g.Pane({ scene: w, width: (a - 1) * (r.size.width + 2 * c) + r.size.width + 2, height: (o - 1) * (r.size.height + 2 * y) + r.size.height + 2 })).append(f), h = g.SpriteFactory.createSpriteFromE(w, n), { pazzleID: d.pazzleID, level: d.level, title: "", preview: s, piecesSrc: h, answerPos: x, connectIds: p, cutInfo: z } } }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["main"] = function (g) {
      !function (e, a) { var n = e("./PieceScene"), t = e("./params"), r = e("./PieceServer"); function i() { var e = new n.PieceScene({ game: g.game, assetIds: ["joinBtn", "playBtn", "left", "right", "setting", "zoomIn", "zoomOut", "previewBtn", "titleBtn", "infoBtn", "visibleBtn", "player_ban", "result", "resultBtn", "crown_0", "crown_1", "crown_2", "crown_3", "select_E", "select_N", "select_H", "sanka_nin", "title_back", "fit", "fit2", "voice_top", "voice_left", "voice_right", "voice_bottom", "voice_outer", "voice_25", "voice_50", "voice_75", "voice_8888"], assetPaths: ["/assets/**/*"] }); return t.GameParams.setAsset(e), t.GameParams.isServer && (g.game.vars.server = new r.PieceServer({ scene: e })), e } a.exports = function (e) { var a; t.GameParams.init(), "atsumaru" == t.GameParams.operation ? (t.GameParams.liverId = g.game.selfId, g.game.pushScene(i())) : (a = new g.Scene({ game: g.game }), g.game.onJoin.addOnce(function (e) { t.GameParams.liverId = e.player.id, g.game.replaceScene(i()) }), g.game.pushScene(a)) } }((g.module.exports, g.module.require), g.module, (g.filename, g.dirname));
    };



    window.gLocalAssetContainer["AssetManager"] = function (g) {
      !function (e, s) { Object.defineProperty(e, "__esModule", { value: !0 }), e.AssetManager = void 0; var i = s("../params"); function t(e) { var s = (this.scene = e).asset.getText(i.Asset.ASSET_SETTING_TXT).data.split("\r\n"); this.wakus = []; for (var t = 0; t < +s[0]; t++)this.wakus.push([this.scene.asset.getImage(i.Asset.WKAU_DIR + "/" + t + "0.png"), this.scene.asset.getImage(i.Asset.WKAU_DIR + "/" + t + "1.png")]); this.assets = []; for (t = 0; t < +s[1]; t++)this.assets.push(this.createPazzleAsset(t, s)) } function a(e) { e = e.split(","); return { count: +e[0], size: { width: +e[1], height: +e[2] }, origin: { x: +e[3], y: +e[4] } } } t.prototype.createPazzleAsset = function (e, s) { var t = 4 * e, n = s[2 + t].split(" "); return { pazzleId: e, title: n[0], preview: new g.Sprite({ scene: this.scene, src: this.scene.asset.getImage(i.Asset.ASSET_DIR + "/" + n[1] + ".jpg") }), difficulty: [a(s[3 + t]), a(s[4 + t]), a(s[5 + t])] } }, t.prototype.createWaku = function (e) { return [new g.Sprite({ scene: this.scene, src: this.scene.asset.getImage(i.Asset.WKAU_DIR + "/" + e + "0.png") }), new g.Sprite({ scene: this.scene, src: this.scene.asset.getImage(i.Asset.WKAU_DIR + "/" + e + "1.png") })] }, e.AssetManager = t }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["BitmapImage"] = function (g) {
      !function (e) { var a, r, t = this && this.__extends || (a = function (e, t) { return (a = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function r() { this.constructor = e } a(e, t), e.prototype = null === t ? Object.create(t) : (r.prototype = t.prototype, new r) }), t = (Object.defineProperty(e, "__esModule", { value: !0 }), e.BitmapImage = void 0, r = g.E, t(o, r), o.prototype.renderSelf = function (e, t) { var r, a = null == (r = this.imageData) ? void 0 : r.data; if (null != a) { for (var o = 0; o < a.length; o++)a[o] = this.colorBuffer.data[o]; return this.backSurface.renderer()._putImageData(this.imageData, 0, 0), e.save(), e.drawImage(this.backSurface, 0, 0, this.backSurface.width, this.backSurface.height, 0, 0), e.restore(), !0 } }, o); function o(e) { var t = r.call(this, e) || this; return t.backSurface = g.game.resourceFactory.createSurface(t.width, t.height), t.imageData = t.backSurface.renderer()._getImageData(0, 0, t.width, t.height), t.colorBuffer = e.colorBuffer, t } e.BitmapImage = t }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["notice"] = function (g) {
      !function (e) { function t(t, i) { this._noticeCards = [], i < 0 && (i = 0), this._scene = t, this.displayTime = i, this.display = new g.E({ scene: t, width: g.game.width, height: g.game.height }) } Object.defineProperty(e, "__esModule", { value: !0 }), e.NoticeViewer = e.NoticeCardState = void 0, e.NoticeCardState = { Waiting: "waiting", Opening: "opening", Displaying: "displaying", Closing: "closing", EndOfDisplay: "endOfDisplay" }, Object.defineProperty(t.prototype, "isStoping", { get: function () { return this._isStoping }, enumerable: !1, configurable: !0 }), t.prototype.addNoticeCard = function (t) { var i = this; this._noticeCards.push(t), t.onOpened = function () { return i.openedCard(t) }, t.onClosed = function () { return i.closedCard(t) }, this._noticeCards.every(function (t) { return t.state === e.NoticeCardState.Waiting }) && this.openNoticeCard() }, t.prototype.openNoticeCard = function () { var t = this._noticeCards.find(function (t) { return t.state === e.NoticeCardState.Waiting }); null != t && this.openCard(t) }, t.prototype.stop = function () { var i = this; this._isStoping || (this._isStoping = !0, this._noticeCards.forEach(function (t) { t.state === e.NoticeCardState.Displaying && i.closeCard(t) })) }, t.prototype.resume = function () { this._isStoping && (this._isStoping = !1, this.openNoticeCard()) }, t.prototype.openedCard = function (t) { var i = this; this._scene.setTimeout(function () { i.closeCard(t) }, this.displayTime, this) }, t.prototype.closedCard = function (i) { var t = this._noticeCards.findIndex(function (t) { return t === i }); -1 !== t && (this.display.remove(i.display), this._noticeCards.splice(t, 1), this._isStoping || 0 === this._noticeCards.length || this.openNoticeCard()) }, t.prototype.openCard = function (t) { t.state === e.NoticeCardState.Waiting && (this.display.append(t.display), t.open()) }, t.prototype.closeCard = function (t) { t.state === e.NoticeCardState.Displaying && t.close() }, e.NoticeViewer = t }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["NoticeCardCreats"] = function (g) {
      !function (t, e) { var s, i = this && this.__extends || (s = function (t, e) { return (s = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) e.hasOwnProperty(i) && (t[i] = e[i]) })(t, e) }, function (t, e) { function i() { this.constructor = t } s(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), n = (Object.defineProperty(t, "__esModule", { value: !0 }), t.ErrorNoticeCard = t.NormalNoticeCard = t.NoticeCardTemplate = void 0, e("@akashic-extension/akashic-label")), o = e("../lib/funcs"), a = e("./notice"), e = (Object.defineProperty(r.prototype, "state", { get: function () { return this._state }, enumerable: !1, configurable: !0 }), r.prototype.open = function () { this._state = a.NoticeCardState.Opening, this._scene.onUpdate.add(this.displaying, this) }, r.prototype.close = function () { this._state = a.NoticeCardState.Closing, this._scene.onUpdate.add(this.closing, this) }, r.prototype.displaying = function () { var t; this.makeVisible(), this.complateVisible() && (this._state = a.NoticeCardState.Displaying, this._scene.onUpdate.remove(this.displaying, this), null != (t = this._audio) && t.play(), this.onOpened()) }, r.prototype.closing = function () { this.makeHide(), this.complateHide() && (this._state = a.NoticeCardState.EndOfDisplay, this._scene.onUpdate.remove(this.closing, this), this.onClosed()) }, r); function r(t, e, i) { this._state = a.NoticeCardState.Waiting, this._scene = t, this._audio = i, this.setDisplay(e) } t.NoticeCardTemplate = e; i(h, p = e), h.prototype.setDisplay = function (t) { this.font = o.newFont("sans-serif", 40), this.display = new g.FilledRect({ scene: this._scene, cssColor: "rgba(255,255,255,0.5)", x: -310, y: 10, width: 300, height: 70 }), new n.Label({ scene: this._scene, parent: this.display, x: 10, y: 10, width: 270, font: this.font, widthAutoAdjust: !0, lineBreak: !1, text: t }) }, h.prototype.makeVisible = function () { this.display.x += this.cardMoveSpeed, this.display.modified() }, h.prototype.makeHide = function () { this.display.x -= this.cardMoveSpeed, this.display.modified() }, h.prototype.complateVisible = function () { return this.display.x > this.displayMargin }, h.prototype.complateHide = function () { return this.display.x < -this.display.width - this.displayMargin }; var p, d = h; function h() { var t = null !== p && p.apply(this, arguments) || this; return t.font = o.newFont("sans-serif", 40), t.cardMoveSpeed = 15, t.displayMargin = 30, t } t.NormalNoticeCard = d; i(c, l = e), c.prototype.setDisplay = function (t) { this.font = o.newFont("sans-serif", 40, "red"), this.display = new g.FilledRect({ scene: this._scene, parent: this.display, cssColor: "rgba(255,255,0,0.8)", x: 100, y: -410, width: 1100, height: 180 }), new n.Label({ scene: this._scene, parent: this.display, x: 10, y: 10, width: 1100, font: this.font, widthAutoAdjust: !0, lineBreak: !1, text: "" }), new n.Label({ scene: this._scene, parent: this.display, x: 10, y: 60, width: 1100, font: o.newFont("sans-serif", 25), widthAutoAdjust: !0, lineBreak: !1, text: t + "\n@mujurin_2525" }) }, c.prototype.makeVisible = function () { this.display.y += this.cardMoveSpeed, this.display.modified() }, c.prototype.makeHide = function () { this.display.y -= this.cardMoveSpeed, this.display.modified() }, c.prototype.complateVisible = function () { return this.display.y > this.displayMargin }, c.prototype.complateHide = function () { return this.display.y < -this.display.height - this.displayMargin }; var l, d = c; function c() { var t = null !== l && l.apply(this, arguments) || this; return t.font = o.newFont("sans-serif", 40, "red"), t.cardMoveSpeed = 15, t.displayMargin = 10, t } t.ErrorNoticeCard = d }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["Piece"] = function (g) {
      !function (e) { var r, i, t = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i]) })(e, t) }, function (e, t) { function i() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (i.prototype = t.prototype, new i) }), o = this && this.__assign || function () { return (o = Object.assign || function (e) { for (var t, i = 1, r = arguments.length; i < r; i++)for (var o in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, o) && (e[o] = t[o]); return e }).apply(this, arguments) }, t = (Object.defineProperty(e, "__esModule", { value: !0 }), e.Piece = void 0, i = g.Sprite, t(n, i), Object.defineProperty(n.prototype, "position", { get: function () { var e, t; return null == this.parent.isFit ? { x: this.x, y: this.y } : (e = this.parent.justPxBw(this), { x: (t = this.parent.position).x + e.x, y: t.y + e.y }) }, enumerable: !1, configurable: !0 }), Object.defineProperty(n.prototype, "sceneEx", { get: function () { return this.scene }, enumerable: !1, configurable: !0 }), n.prototype.moveBy = function (e, t) { i.prototype.moveBy.call(this, e, t), this.limitCheck() }, n.prototype.moveTo = function (e, t) { "number" == typeof e ? i.prototype.moveTo.call(this, e, t) : i.prototype.moveTo.call(this, e), this.parentPiece || this.limitCheck() }, n.prototype.limitCheck = function () { this.x < 0 ? this.x = 0 : this.x > this.jigsaw.pieceLimit.x && (this.x = this.jigsaw.pieceLimit.x), this.y < 0 ? this.y = 0 : this.y > this.jigsaw.pieceLimit.y && (this.y = this.jigsaw.pieceLimit.y) }, n.prototype.justPxBw = function (e) { return { x: e.answer.x - this.answer.x, y: e.answer.y - this.answer.y } }, n); function n(e) { var t = i.call(this, o({ src: e.createParam.piecesSrc.src, srcX: e.createParam.cutInfo[e.pieceID].x, srcY: e.createParam.cutInfo[e.pieceID].y, width: e.createParam.cutInfo[e.pieceID].width, height: +e.createParam.cutInfo[e.pieceID].height, touchable: !0 }, e)) || this; return t.parentPiece = void 0, t.childPiece = [], t.isFit = !1, t.holder = void 0, t.jigsaw = e.jigsaw, t.pieceID = e.pieceID, t.connects = e.createParam.connectIds[t.pieceID], t.answer = e.createParam.answerPos[t.pieceID], t } e.Piece = t }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["Player"] = function (g) {
      !function (e) { function r(e, r) { this.score = 0, this.ban = !1, this.playerID = e.playerID, this.name = e.name, this.rank = null != r ? r : 1 } Object.defineProperty(e, "__esModule", { value: !0 }), e.Player = void 0, r.prototype.FitPiece = function () { this.score++ }, r.prototype.SamePlayerID = function (e) { return !!e && this.playerID == e.playerID }, e.Player = r }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["Slider"] = function (g) {
      !function (i) { var h = this && this.__assign || function () { return (h = Object.assign || function (i) { for (var e, t = 1, r = arguments.length; t < r; t++)for (var n in e = arguments[t]) Object.prototype.hasOwnProperty.call(e, n) && (i[n] = e[n]); return i }).apply(this, arguments) }, e = (Object.defineProperty(i, "__esModule", { value: !0 }), i.Slider = void 0, t.prototype.gripMoveBy = function (i) { this.grip.x += i, this.grip.x < 0 ? (this.grip.x = 0, this.per = 0) : this.grip.x > this.display.width ? (this.grip.x = this.display.width, this.per = 1) : this.per = this.grip.x / this.display.width, this.grip.modified(), this.value = (this.max - this.min) * Math.pow(this.per, this.quadratic) + this.min }, t); function t(i) { var e = this, t = (this.onBarDown = new g.Trigger, this.onSliderMove = new g.Trigger, this.onSliderUp = new g.Trigger, this.onValueChange = new g.Trigger, new g.E(h(h({}, i), { touchable: !1 }))), r = (this.display = t).scene, n = (this.per = null != (n = i.per) ? n : 0, this.min = null != (n = i.min) ? n : 0, this.max = i.max, this.quadratic = null != (n = i.quadratic) ? n : 1, new g.FilledRect({ scene: r, parent: t, anchorY: .5, cssColor: "rgba(255,255,255,0.8)", y: i.height / 2, width: t.width, height: t.height / 2, touchable: !0 })); t.append(n), this.grip = new g.FilledRect({ scene: r, parent: t, anchorX: .5, cssColor: "rgba(0,0,0,0.8)", x: t.width * this.per, width: null != (r = i.gripWidth) ? r : 50, height: t.height, touchable: !0 }), t.append(this.grip), n.onPointDown.add(function (i) { i.point.x < e.grip.x ? (e.per = e.per - .1, e.per < 0 && (e.per = 0)) : (e.per = e.per + .1, 1 < e.per && (e.per = 1)), e.grip.x = t.width * e.per, e.grip.modified(), e.value = (e.max - e.min) * e.per + e.min, e.onBarDown.fire(e.value), e.onValueChange.fire(e.value) }), this.grip.onPointMove.add(function (i) { e.gripMoveBy(i.prevDelta.x), e.onSliderMove.fire(e.value), e.onValueChange.fire(e.value) }), this.grip.onPointUp.add(function (i) { e.onSliderUp.fire(e.value) }) } i.Slider = e }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["StopWatch"] = function (g) {
      !function (e) { function t(e) { this.stopTime = void 0, this.scene = e } Object.defineProperty(e, "__esModule", { value: !0 }), e.StopWatch = void 0, Object.defineProperty(t.prototype, "ElapsedTime", { get: function () { var e; return Math.floor(((null != (e = this.stopTime) ? e : g.game.getCurrentTime()) - this.startTime) / 1e3) }, enumerable: !1, configurable: !0 }), Object.defineProperty(t.prototype, "ElapsedTime_HMS", { get: function () { var e = this.ElapsedTime; return { h: Math.floor(e / 3600), m: Math.floor(e / 60) % 60, s: e % 60 } }, enumerable: !1, configurable: !0 }), t.prototype.start = function () { this.startTime = g.game.getCurrentTime(), this.stopTime = void 0 }, t.prototype.stop = function () { this.stopTime = g.game.getCurrentTime() }, e.StopWatch = t }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["StrokeRect"] = function (g) {
      !function (t) { var i, r, e = this && this.__extends || (i = function (t, e) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var r in e) e.hasOwnProperty(r) && (t[r] = e[r]) })(t, e) }, function (t, e) { function r() { this.constructor = t } i(t, e), t.prototype = null === e ? Object.create(e) : (r.prototype = e.prototype, new r) }), e = (Object.defineProperty(t, "__esModule", { value: !0 }), t.StrokeRect = void 0, r = g.FilledRect, e(o, r), o.prototype.renderSelf = function (t) { var e = this.borderWidth / 2, r = -e, i = -e, o = this.width + this.borderWidth, h = this.height + this.borderWidth; return t.fillRect(r, i, o, this.borderWidth, this.cssColor), t.fillRect(this.width - e, i, this.borderWidth, h, this.cssColor), t.fillRect(r, this.height - e, o, this.borderWidth, this.cssColor), t.fillRect(r, i, this.borderWidth, h, this.cssColor), !0 }, o); function o(t) { var e = r.call(this, t) || this; return e.borderWidth = t.borderWidth, e } t.StrokeRect = e }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["params"] = function (g) {
      !function (e) { function t() { } Object.defineProperty(e, "__esModule", { value: !0 }), e.GameParams = e.Asset = void 0, e.Asset = { ASSET_DIR: "/assets", ASSET_SETTING_TXT: "/assets/!.txt", WKAU_DIR: "/assets/!" }, Object.defineProperty(t, "isOwner", { get: function () { return true || this.liverId == g.game.selfId }, enumerable: !1, configurable: !0 }), Object.defineProperty(t, "isServer", { get: function () { return t._isServer }, enumerable: !1, configurable: !0 }), Object.defineProperty(t, "operation", { get: function () { return this._operation }, enumerable: !1, configurable: !0 }), Object.defineProperty(t, "myFitSound", { get: function () { return this._myFitSound }, enumerable: !1, configurable: !0 }), Object.defineProperty(t, "otherFitSound", { get: function () { return this._otherFitSound }, enumerable: !1, configurable: !0 }), Object.defineProperty(t, "userBanMode", { get: function () { return this._userBanMode }, enumerable: !1, configurable: !0 }), t.banModeChange = function () { this._userBanMode = !this._userBanMode }, t.init = function () { "undefined" == typeof window ? this._isServer = !0 : true || void 0 !== window.RPGAtsumaru ? (this._isServer = !0, this._operation = "atsumaru") : this._operation = "nicolive" }, t.setAsset = function (e) { var t = this; e.onLoad.addOnce(function () { t._myFitSound = e.asset.getAudioById("fit"), t._otherFitSound = e.asset.getAudioById("fit2") }) }, t._isServer = !1, t._userBanMode = !1, e.GameParams = t }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["PieceScene"] = function (g) {
      !function (e, i) { var s, t, a = this && this.__extends || (s = function (e, i) { return (s = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, i) { e.__proto__ = i } || function (e, i) { for (var t in i) i.hasOwnProperty(t) && (e[t] = i[t]) })(e, i) }, function (e, i) { function t() { this.constructor = e } s(e, i), e.prototype = null === i ? Object.create(i) : (t.prototype = i.prototype, new t) }), o = this && this.__assign || function () { return (o = Object.assign || function (e) { for (var i, t = 1, s = arguments.length; t < s; t++)for (var a in i = arguments[t]) Object.prototype.hasOwnProperty.call(i, a) && (e[a] = i[a]); return e }).apply(this, arguments) }, n = (Object.defineProperty(e, "__esModule", { value: !0 }), e.PieceScene = void 0, i("./eoc/SceneEx")), c = i("./events/jigsaw"), r = i("./Jigsaw"), h = i("./lib/pieceCut"), p = i("./models/AssetManager"), l = i("./events/player"), P = i("./Title"), d = i("./events/player"), m = i("./events/piece"), v = i("@akashic-extension/resolve-player-info"), u = i("./params"), y = i("./eoc/ErrorMessage"), f = i("./CreateUserPazzle"), i = (t = n.SceneEx, a(w, t), w.prototype.onLoaded = function () { var t = this, s = (this.assetManager = new p.AssetManager(this), this.title = new P.Title({ scene: this, assetManager: this.assetManager, changePazzleCallback: function (e) { g.game.isSkipping || t.send(new c.ChangePazzle({ isRight: e })) }, changeDifficultyCallback: function (e) { g.game.isSkipping || t.send(new c.ChangeDefficulty({ dif: e })) }, startJigsawCallback: function () { var e; g.game.isSkipping || (t.title.isUserPuzzle ? t.send(new c.UserPuzzle(void 0)) : (e = t.assetManager.assets[t.title.selectPzlID].difficulty[t.title.selectDifID].size).width > e.height ? t.send(new c.StartPazzle(e.width / 5)) : t.send(new c.StartPazzle(e.height / 5))) } }), this.jigsaw = new r.Jigsaw({ scene: this }), this.append(this.title.display), "nicolive" == u.GameParams.operation ? (this.joinBtn = new g.Sprite({ scene: this, parent: this, src: this.asset.getImageById("joinBtn"), x: 10, y: 602, touchable: !0 }), this.joinBtn.onPointDown.add(function () { g.game.isSkipping || t.jigsaw.isJoinWait || (v.resolvePlayerInfo({ limitSeconds: 30 }, function (e, i) { i && i.name && (t.joinBtn.destroy(), t.joinBtn = void 0, t.send(new l.JoinRequest({ playerID: g.game.selfId, name: i.name })), t.onPointDownCapture.add(t.checkPickPiece, t)) }), t.jigsaw.isJoinWait = !0) }, this)) : "atsumaru" == u.GameParams.operation && (this.jigsaw.isJoinWait = !0, v.resolvePlayerInfo({ limitSeconds: 30 }, function (e, i) { i && i.name && (t.send(new l.JoinRequest({ playerID: g.game.selfId, name: i.name })), t.onPointDownCapture.add(t.checkPickPiece, t)) }), this.append(this.jigsaw.scoreBoard.display)), this.addReceiveMethod(d.JoinPlayer.receive(function (e) { t.jigsaw.joinPlayer(e.param), "Title" == t.jigsaw.jigsawState && t.title.joinPlayer(t.jigsaw.players.length) })), this.addReceiveMethod(l.PickPiece.receive(function (e) { return t.jigsaw.PickPiece(e.param) })), this.addReceiveMethod(l.MovePiece.receive(function (e) { return t.jigsaw.MovePiece(e.param) })), this.addReceiveMethod(l.PutPiece.receive(function (e) { return t.jigsaw.PutPiece(e.param) })), this.addReceiveMethod(c.ChangePazzle.receive(function (e) { return t.title.changePazzle(e.param.isRight) })), this.addReceiveMethod(c.ChangeDefficulty.receive(function (e) { return t.title.changeDefficulty(e.param.dif) })), c.StartPazzle.receive(function () { return t.pazzleStart() })); this.addReceiveMethod(s, this), this.addReceiveMethod(c.UserPuzzle.receive(function (e) { t.removeReceiveMethod(s, t), t.append(t.title.joinCnt), t.title.display.hide(); var i = new f.CreatePuzzle(t, function (e) { t.title.display.append(t.title.joinCnt); var i = e.difficulty.size; i.width > i.height ? t.send(new c.StartPazzle(i.width / 5)) : t.send(new c.StartPazzle(i.height / 5)), t.pazzleStart(e) }, function () { t.title.display.append(t.title.joinCnt), t.title.display.show(), t.addReceiveMethod(s, t) }); t.append(i.display) })) }, w.prototype.pazzleStart = function (e) { var i, t = this; "Title" == this.jigsaw.jigsawState && (null != e ? this.jigsaw.startPazzle(o(o({}, h.pieceCut(e)), { title: "" })) : (i = this.assetManager.assets[this.title.selectPzlID], this.jigsaw.startPazzle(o(o({}, h.pieceCut(null != e ? e : { scene: this, pazzleID: this.title.selectPzlID, level: this.title.selectDifID + 1, wakus: [].concat.apply([], this.assetManager.wakus), previewSrc: i.preview, difficulty: i.difficulty[this.title.selectDifID] })), { title: i.title }))), this.remove(this.title.display), this.append(this.jigsaw.display), this.joinBtn && this.jigsaw.uiLayer.display.append(this.joinBtn), this.onPointMoveCapture.add(this.moveCameraEvent, this), this.addReceiveMethod(m.ConnectPiece.receive(function (e) { return t.jigsaw.connectPiece(e.param) })), this.addReceiveMethod(m.FitPiece.receive(function (e) { return t.jigsaw.fitPiece(e.param) })), this.addReceiveMethod(c.PazzleComplete.receive(function (e) { return t.jigsaw.completed(e.param) })), this.addReceiveMethod(y.ServerError.receive(function (e) { return t.jigsaw.serverError(e.param) })), this.addReceiveMethod(l.Ban.receive(function (e) { var i = t.jigsaw.samePlayerID(e.param.playerID); null != i && (i.ban = e.param.ban, i.playerID === g.game.selfId && t.send(new l.PutPiece({ pieceID: t.movePiece.pieceID, playerID: t.jigsaw.me.playerID, pos: t.movePiece.position })), t.jigsaw.uiLayer.result.draw(t.jigsaw.players)) }))) }, w.prototype.moveCameraEvent = function (e) { var i = e.target; null != i && ("boolean" == typeof i.isMoveCamera || null != this.joinBtn && null != i.pieceID) && this.jigsaw.moveCamera(e.prevDelta) }, Object.defineProperty(w.prototype, "movePiece", { get: function () { var e; return null != (e = this.pickPiece.parentPiece) ? e : this.pickPiece }, enumerable: !1, configurable: !0 }), w.prototype.checkPickPiece = function (e) { g.game.isSkipping || "number" != typeof this.pointerID && null != this.jigsaw.me && (this.pickPiece = e.target, null == this.pickPiece || "number" != typeof this.pickPiece.pieceID ? this.pickPiece = void 0 : null != this.pickPiece.holder || "nicolive" == u.GameParams.operation && g.game.getCurrentTime() - this.lastPutTime < 100 || (this.pointerID = e.pointerId, this.pickPoint = { x: this.movePiece.x, y: this.movePiece.y }, this.movePiece.holder = this.jigsaw.me, this.jigsaw.me.ban || this.send(new l.PickPiece({ pieceID: this.movePiece.pieceID, playerID: this.jigsaw.me.playerID })), this.movePiece.parent.append(this.movePiece), this.movePiece.modified(), this.mousePoint = this.jigsaw.uiLayer.display.globalToLocal(this.pickPiece.localToGlobal(e.point)), this.onPointMoveCapture.add(this.checkMovePiece, this), this.onPointUpCapture.add(this.checkPutPiece, this), this.onUpdate.add(this.moveCameraFromPiece, this))) }, w.prototype.checkMovePiece = function (e) { g.game.isSkipping || this.pointerID != e.pointerId || 0 == e.prevDelta.x && 0 == e.prevDelta.y || this.pickPiece && this.jigsaw.me.SamePlayerID(this.movePiece.holder) && (this.lastPutTime = g.game.getCurrentTime(), this.movePiece.moveTo(this.pickPoint.x + e.startDelta.x * this.jigsaw.cameraScale, this.pickPoint.y + e.startDelta.y * this.jigsaw.cameraScale), this.movePiece.parent.append(this.movePiece), this.movePiece.modified(), this.mousePoint.x += e.prevDelta.x, this.mousePoint.y += e.prevDelta.y) }, w.prototype.checkPutPiece = function (e) { g.game.isSkipping || this.pointerID == e.pointerId && this.pickPiece && this.jigsaw.me.SamePlayerID(this.movePiece.holder) && (this.lastPutTime = g.game.getCurrentTime(), this.movePiece.moveBy(e.prevDelta.x, e.prevDelta.y), this.movePiece.holder = void 0, this.send(new l.PutPiece({ pieceID: this.movePiece.pieceID, playerID: this.jigsaw.me.playerID, pos: this.movePiece.position })), this.pickPiece = void 0, this.mousePoint = void 0, this.onUpdate.remove(this.moveCameraFromPiece, this), this.onPointMoveCapture.remove(this.checkMovePiece, this), this.onPointUpCapture.remove(this.checkPutPiece, this), this.pointerID = void 0) }, w.prototype.moveCameraFromPiece = function () { var e; null != this.pickPiece && (this.movePiece.holder && this.movePiece.holder.SamePlayerID(this.jigsaw.me) && !this.movePiece.parentPiece ? (0 == (e = this.jigsaw.moveCameraFromMouse(this.mousePoint)).x && 0 == e.y || (this.movePiece.moveBy(e.x, e.y), this.pickPoint.x += e.x, this.pickPoint.y += e.y), this.beforePiecePos.x == this.movePiece.x && this.beforePiecePos.y == this.movePiece.y || (this.movePiece.modified(), this.beforePiecePos = { x: this.movePiece.x, y: this.movePiece.y }, this.pieceMoveCnt-- <= 0 && (this.pieceMoveCnt = this.pieceMoveWait, this.jigsaw.me.ban || this.send(new l.MovePiece({ pieceID: this.movePiece.pieceID, playerID: this.jigsaw.me.playerID, pos: this.movePiece.position }))))) : (this.pieceMoveCnt = 0, this.send(new l.PutPiece({ pieceID: this.movePiece.pieceID, playerID: this.jigsaw.me.playerID, pos: this.movePiece.position })), this.movePiece.holder = void 0, this.pickPiece = void 0, this.mousePoint = void 0, this.onUpdate.remove(this.moveCameraFromPiece, this), this.onPointMoveCapture.remove(this.checkMovePiece, this), this.onPointUpCapture.remove(this.checkPutPiece, this), this.pointerID = void 0)) }, w); function w(e) { e = t.call(this, e) || this; return e.pieceMoveWait = 3, e.pieceMoveCnt = 0, e.beforePiecePos = { x: -1, y: -1 }, e.pointerID = void 0, e.lastPutTime = 0, e.onLoad.addOnce(e.onLoaded, e), e } e.PieceScene = i }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["PieceServer"] = function (g) {
      !function (e, t) { var r, a, i = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var a in t) t.hasOwnProperty(a) && (e[a] = t[a]) })(e, t) }, function (e, t) { function a() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (a.prototype = t.prototype, new a) }), n = (Object.defineProperty(e, "__esModule", { value: !0 }), e.PieceServer = void 0, t("./eoc/Server")), c = t("./events/piece"), o = t("./events/player"), p = t("./events/jigsaw"), s = t("./params"), l = t("./events/userPazzle"), t = (a = n.Server, i(d, a), Object.defineProperty(d.prototype, "jigsaw", { get: function () { return this.scene.jigsaw }, enumerable: !1, configurable: !0 }), d.prototype.fitBoard = function (e) { var t = e.position; return Math.abs(t.x - e.answer.x - this.jigsaw.margin.width) < this.permission && Math.abs(t.y - e.answer.y - this.jigsaw.margin.height) < this.permission }, d.prototype.connectPieceAll = function (e) { for (var t = 0, a = e.childPiece; t < a.length; t++) { var r = a[t], r = this.connectPieceNext(r); if (r) return r } return this.connectPieceNext(e) }, d.prototype.connectPieceNext = function (e) { for (var t = 0, a = e.connects; t < a.length; t++) { var r = a[t], r = this.connectPiece(e, this.jigsaw.pieces[r]); if (null != r) return r } }, d.prototype.connectPiece = function (e, t) { var a; if ((null == e.parentPiece || e.parentPiece.pieceID != t.pieceID && (null == t.parentPiece || e.pieceID != t.parentPiece.pieceID && e.parentPiece.pieceID != t.parentPiece.pieceID)) && (null == t.parentPiece || e.pieceID != t.parentPiece.pieceID) && !(null != e.holder || null != t.holder || null != (a = e.parentPiece) && a.holder || null != (a = t.parentPiece) && a.holder) && !e.isFit && !t.isFit && this.isConnect(e, t)) return { parent: e = null != e.parentPiece ? e.parentPiece : e, child: t = null != t.parentPiece ? t.parentPiece : t } }, d.prototype.isConnect = function (e, t) { var a = e.justPxBw(t), e = e.position, t = t.position; return Math.abs(t.x - e.x - a.x) <= this.permission && Math.abs(t.y - e.y - a.y) <= this.permission }, d); function d(e) { var r = a.call(this, e) || this; return r.holdPieceTime = 30, r.holdEvents = {}, r.scene.onUpdate.add(function () { return r.update() }, r), r.addReceiveMethod(o.JoinRequest.receive(function (e) { r.broadcast(new o.JoinPlayer({ playerID: e.param.playerID, name: e.param.name })) })), r.addReceiveMethod(o.PickPiece.receive(function (e) { var t, a = r.jigsaw.pieces[e.param.pieceID]; null == a || null != a.parentPiece || a.isFit || (t = r.jigsaw.samePlayerID(e.param.playerID), (a.holder || !t || t.ban) && "atsumaru" != s.GameParams.operation || (r.broadcast(e), r.holdEvents[e.param.playerID] = r.scene.setTimeout(function () { r.scene.send(new o.PutPiece({ pieceID: e.param.pieceID, playerID: e.param.playerID, pos: { x: a.x, y: a.y } })) }, 1e3 * r.holdPieceTime, r))) })), r.addReceiveMethod(o.MovePiece.receive(function (e) { var t = r.jigsaw.pieces[e.param.pieceID]; null == t || null != t.parentPiece || t.isFit || t.holder && !t.holder.ban && t.holder.playerID == e.param.playerID && r.broadcast(e) })), r.addReceiveMethod(o.PutPiece.receive(function (e) { var t, a = r.holdEvents[e.param.playerID], a = (null == a || a.destroyed() || (r.scene.clearTimeout(a), delete r.holdEvents[e.param.playerID]), r.jigsaw.pieces[e.param.pieceID]); null == a || null != a.parentPiece || a.isFit || (a.holder && r.jigsaw.samePlayerID(e.param.playerID) || "atsumaru" == s.GameParams.operation) && (r.broadcast(e), (t = r.connectPieceAll(a)) ? (t.parent.pieceID > t.child.pieceID && (t = { parent: t.child, child: t.parent }), r.broadcast(new c.ConnectPiece({ parentID: t.parent.pieceID, childID: t.child.pieceID, playerID: e.param.playerID }))) : r.fitBoard(a) && r.broadcast(new c.FitPiece({ pieceID: a.pieceID, playerID: e.param.playerID })), r.jigsaw.fitCount == r.jigsaw.pieces.length && r.broadcast(new p.PazzleComplete(e.param.playerID))) })), r.addReceiveMethod(p.ChangePazzle.receive(function (e) { return r.broadcast(e) })), r.addReceiveMethod(p.ChangeDefficulty.receive(function (e) { return r.broadcast(e) })), r.addReceiveMethod(p.UserPuzzle.receive(function (e) { return r.broadcast(e) })), r.addReceiveMethod(p.StartPazzle.receive(function (e) { r.permission = e.param, r.broadcast(e) })), r.addReceiveMethod(l.ChangePage.receive(function (e) { return r.broadcast(e) })), r.addReceiveMethod(l.ShareImageStart.receive(function (e) { return r.broadcast(e) })), r.addReceiveMethod(l.ShareImageData.receive(function (e) { return r.broadcast(e) })), r.addReceiveMethod(l.ShareImageFinish.receive(function (e) { return r.broadcast(e) })), r.addReceiveMethod(l.Edit.receive(function (e) { return r.broadcast(e) })), r.addReceiveMethod(o.Ban.receive(function (e) { return r.broadcast(e) })), r } e.PieceServer = t }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["PlayingInfo"] = function (g) {
      !function (e, t) { Object.defineProperty(e, "__esModule", { value: !0 }), e.PlayingInfo = void 0; var c = t("@akashic-extension/akashic-label"), p = t("./lib/funcs"), _ = t("./models/StopWatch"); function i(t, e) { for (var n = this, e = (this._scoreLength = 5, this._scoreHeight = 40, this.jigsaw = t.jigsaw, this.display = new g.FilledRect({ scene: t, cssColor: "rgba(255,255,255,0.5)", width: 300, height: 410, x: 950, y: 10 }), this.stopWatch = new _.StopWatch(t), this.stopWatch.start(), new c.Label({ scene: t, parent: this.display, font: p.newFont("sans-serif", 40), text: e, widthAutoAdjust: !0, lineBreak: !1, width: 280, height: 40, x: 150, y: 30, anchorX: .5, anchorY: .5 })), a = (p.labelAutoReSizeW(e, 270), this._pieceFont = p.newFont("sans-serif", 30), this._pieceLabel = new c.Label({ scene: t, parent: this.display, font: this._pieceFont, text: "0%0/0", textAlign: "right", width: 290, height: 40, x: 0, y: 80 }), this._pieceChange = function (e) { n._pieceLabel.text = e, n._pieceLabel.invalidate() }, this._timeFont = p.newFont("sans-serif", 30), this._timeLabel = new c.Label({ scene: t, parent: this.display, font: this._timeFont, text: "00", textAlign: "right", width: 270, height: 40, x: 10, y: 120 }), this._timeChange = function (e) { n._timeLabel.text = e, n._timeLabel.invalidate() }, this._nameLabels = new Array(this._scoreLength), this._scoreChanges = new Array(this._scoreLength), this._scoreLength = 5, this._scoreFont = p.newFont("sans-serif", 30), this), i = 0; i < this._scoreLength; i++)!function (e) { var i = new c.Label({ scene: t, parent: a.display, font: a._scoreFont, text: "", width: 200, height: 170, x: 10, y: 160 + e * a._scoreHeight }), s = (a._nameLabels[e] = i, new c.Label({ scene: t, parent: a.display, font: a._scoreFont, text: "", textAlign: "right", width: 60, height: 170, x: 210, y: a._nameLabels[e].y })); a._scoreChanges[e] = function (e, t) { i.text = e, i.scale(1), p.labelAutoReSizeH(i, 200, n._scoreHeight), s.text = t + "", s.invalidate() } }(i); this._myFont = p.newFont("sans-serif", 30, "#7345ff"), this._myLabel = new c.Label({ scene: t, parent: this.display, font: this._myFont, text: "", width: 200, x: 10, y: this._nameLabels[this._scoreLength - 1].y + this._scoreHeight }), p.labelAutoReSizeH(this._myLabel, 200, this._scoreHeight); function s() { r++ == g.game.fps && (r = 0, n.update()) } function h() { var e = Math.floor(n.stopWatch.ElapsedTime / 60) % 60; 3 <= e - l && (l = e, n.update()) } var o = new c.Label({ scene: t, parent: this.display, font: this._myFont, text: "", textAlign: "right", width: 60, x: 210, y: this._nameLabels[this._scoreLength - 1].y + this._scoreHeight }), r = (this._myChange = function (e, t) { e != n._myLabel.text && (n._myLabel.text = e, n._myLabel.scale(1), p.labelAutoReSizeH(n._myLabel, 200, n._scoreHeight)), o.text = t + "", o.invalidate() }, 0), l = 0; g.game.isSkipping ? t.onUpdate.add(h) : t.onUpdate.add(s), g.game.onSkipChange.add(function (e) { e ? (t.onUpdate.remove(s), t.onUpdate.add(h)) : (t.onUpdate.remove(h), t.onUpdate.add(s)) }) } i.prototype.stopTimer = function () { this.stopWatch.stop() }, Object.defineProperty(i.prototype, "time", { get: function () { return this.stopWatch.ElapsedTime_HMS }, enumerable: !1, configurable: !0 }), i.prototype.update = function () { if (this.display.visible()) { var e = this.jigsaw.fitCount, t = this.jigsaw.pieces.length, i = this.jigsaw.fitPer, s = this.time; this._pieceChange(i + "" + ("000" + e).slice(-(t + "").length) + "/" + t), s.h < 1 ? this._timeChange(s.m + "" + s.s + "") : this._timeChange(s.h + "" + s.m + "" + s.s + ""); for (var n = 0; n < this._scoreLength; n++) { var a = this.jigsaw.players[n]; if (null == a) break; this._scoreChanges[n](a.name, a.score) } this.jigsaw.me && this._myChange(this.jigsaw.me.name, this.jigsaw.me.score) } }, e.PlayingInfo = i }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["PlayingUI"] = function (g) {
      !function (e, t) { Object.defineProperty(e, "__esModule", { value: !0 }), e.PlayingUI = void 0; var x = t("@akashic-extension/akashic-label"), P = t("./lib/funcs"), C = t("./params"), b = t("./PlayingInfo"), v = t("./Preview"), D = t("./Result"); function i(e, t, i) { var n, s = this, o = (this.colors = ["#0087CC", "#A900CC", "#CC4300", "#22CC00", "#3D738E", "#813D8E", "#8E583D", "#4A8E3D", "rgba(0,0,0,0)"], this.selectColor = 0, this.scene = e, this.display = new g.E({ scene: e, width: g.game.width, height: g.game.height, anchorX: null }), new b.PlayingInfo(e, t)), a = (this.info = o, this.display.append(o.display), new v.Preview(e, i)), t = (this.display.append(a.display), this.result = new D.Result(e), this.display.append(this.result.display), 1180), i = 440, r = 90, c = this.createUI({ w: 70, h: 70, x: t, y: i, src: "setting", a: .7 }), h = this.createUI({ w: 70, h: 70, x: t -= r, y: i, src: "visibleBtn", a: !0 }), l = this.createUI({ w: 70, h: 70, x: t -= r, y: i, src: "resultBtn", a: !0 }), t = 1180, d = this.createUI({ w: 70, h: 70, x: t, y: i += 90, src: "infoBtn", a: !0 }), p = this.createUI({ w: 70, h: 70, x: t -= r, y: i, src: "previewBtn", a: !0 }), w = this.createUI({ w: 70, h: 70, x: t -= r, y: i, src: 1, a: !0 }), y = this.createUI({ w: 70, h: 70, x: t = 1180, y: i += 90, src: "zoomIn" }), u = this.createUI({ w: 70, h: 70, x: t -= r, y: i, src: "zoomOut" }), f = (C.GameParams.isOwner && ((n = this.createUI({ w: 70, h: 70, x: t -= r, y: i, src: "player_ban", a: !0 })).opacity = .7, n.modified()), c.onPointDown.add(function () { var e = .7 == c.opacity; c.opacity = e ? 1 : .7, c.modified(), e ? (d.show(), l.show(), h.show(), p.show(), w.show(), null != n && n.show()) : (d.hide(), l.hide(), h.hide(), p.hide(), w.hide(), null != n && n.hide()) }), d.onPointDown.add(function () { o.display.visible() ? o.display.hide() : o.display.show() }), l.onPointDown.add(function () { "nicolive" == C.GameParams.operation ? s.result.display.visible() ? s.result.hide() : s.result.show() : s.showScoreBoard() }), h.onPointDown.add(function (e) { 1 == e.pointerId && s.hideDisplay() }), p.onPointDown.add(function () { a.display.visible() ? a.display.hide() : a.display.show() }), w.onPointDown.add(function () { s.selectColor++, s.selectColor == s.colors.length && (s.selectColor = 0), w.children[0].cssColor = s.colors[(s.selectColor + 1) % s.colors.length], w.children[0].modified(), s.colorChange(s.colors[s.selectColor]) }), y.onPointDown.add(function () { return s.zoomIn() }), u.onPointDown.add(function () { return s.zoomOut() }), null != n && n.onPointDown.add(function () { C.GameParams.banModeChange(), C.GameParams.userBanMode ? n.opacity = 1 : n.opacity = .7, n.modified() }), new g.FilledRect({ scene: e, parent: this.display, cssColor: "rgba(255,255,255,0.5)", width: 300, height: C.GameParams.isOwner ? 480 : 410, x: 10, y: 10, touchable: !0 })), m = 3, I = (this.createTipInfo(f, "setting", t = 5, i = 5, "", t + 43, i + 7), this.createTipInfo(f, "visibleBtn", t, i += 50, "\n", t + 43, i), this.createTipInfo(f, "resultBtn", t, i += 50, "", t + 43, i + 7), this.createTipInfo(f, "infoBtn", t, i += 50, "", t + 43, i + 7), this.createTipInfo(f, "previewBtn", t, i += 50, "\n", t + 43, i), this.createTipInfo(f, void 0, t, i += 50, "", t + 43, i + 7), i += 50, C.GameParams.isOwner && (this.createTipInfo(f, "player_ban", t, i, "BAN\n\nBAN", t + 43, i), i += 70), this.createTipInfo(f, "zoomIn", t, i, "", t + 43, i + 7), this.createTipInfo(f, "zoomOut", t, i += 50, "", t + 43, i + 7), i += 50, new x.Label({ scene: e, parent: f, font: P.newFont("sans-serif", 28, "green"), text: m + " \n", textAlign: "right", x: 155, y: f.height - 70, width: 140 })); f.onPointDown.add(function () { 0 == --m ? f.destroy() : (I.text = m + " \n", I.invalidate()) }) } i.prototype.createTipInfo = function (e, t, i, n, s, o, a) { var r = P.newFont("sans-serif", 20); null != t ? new g.Sprite({ scene: this.scene, parent: e, src: this.scene.asset.getImageById(t), x: i, y: n, scaleX: .4, scaleY: .4 }) : new g.FilledRect({ scene: this.scene, parent: e, cssColor: this.colors[1], x: i, y: n, width: 38.4, height: 38.4 }), new x.Label({ scene: this.scene, parent: e, font: r, text: s, x: o, y: a, width: 250 }) }, i.prototype.createUI = function (e) { var t = new g.FilledRect({ scene: this.scene, parent: this.display, cssColor: "rgba(255,255,255,0.3)", width: e.w, height: e.h, x: e.x, y: e.y, touchable: !0, opacity: "number" == typeof e.a ? e.a : 1, hidden: "boolean" == typeof e.a }); return "string" == typeof e.src ? new g.Sprite({ scene: this.scene, parent: t, src: this.scene.asset.getImageById(e.src), anchorX: .5, anchorY: .5, x: e.w / 2, y: e.h / 2, scaleX: .7, scaleY: .7 }) : new g.FilledRect({ scene: this.scene, parent: t, cssColor: this.colors[e.src], anchorX: .5, anchorY: .5, x: e.w / 2, y: e.h / 2, width: 70, height: 70 }), t }, e.PlayingUI = i }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["Preview"] = function (g) {
      !function (e, i) { Object.defineProperty(e, "__esModule", { value: !0 }), e.Preview = void 0; var l = i("./lib/funcs"), s = i("./models/Slider"); e.Preview = function (e, h) { function d() { var e, i; h.x > n.x ? h.x = n.x : (e = h.scaleX / a, i = n.x + t.width - t.width * e, h.x < i && (h.x = i)), h.y > n.y ? h.y = n.y : (e = h.scaleX / a, i = n.y + t.height - t.height * e, h.y < i && (h.y = i)) } this.display = new g.E({ scene: e, width: g.game.width, height: g.game.height, hidden: !0 }); var i = new g.FilledRect({ scene: e, parent: this.display, cssColor: "rgba(0,0,0,0.5)", width: 860, height: 540, x: 55, y: 37, local: !0, touchable: !0 }), a = (new g.Pane({ scene: e, parent: i, width: i.width, height: i.height }).append(h), l.spriteSet(h, i.width, i.height), h.scaleX), t = { width: h.width * a, height: h.height * a }, n = { x: (i.width - t.width) / 2, y: (i.height - t.height) / 2 }; i.onPointMove.add(function (e) { h.moveBy(e.prevDelta.x, e.prevDelta.y), d(), h.modified() }), new s.Slider({ scene: e, parent: this.display, width: 300, height: 100, x: 330, y: 600, min: a, max: 10, quadratic: 2 }).onValueChange.add(function (e) { var i = h.scaleX - e, t = h.scaleX / a; h.x += ((-h.x + n.x) / h.scaleX + h.width / t / 2) * i, h.y += ((-h.y + n.y) / h.scaleX + h.height / t / 2) * i, h.scale(e), d(), h.modified() }) } }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["Result"] = function (g) {
      !function (e, n) { Object.defineProperty(e, "__esModule", { value: !0 }), e.Result = void 0; var p = n("@akashic-extension/akashic-label"), i = n("./events/player"), m = n("./lib/funcs"), b = n("./params"); function a(e) { var n, a, t = this; this.scene = e, this.display = new g.Sprite({ scene: e, src: e.asset.getImageById("result"), x: 50, y: 10, hidden: !0 }), this.rankPane = new g.Pane({ scene: e, width: 780, height: 365, x: 45, y: 180, parent: this.display, touchable: !0 }), this.rankingView = new g.E({ scene: e, width: this.rankPane.width, height: 0, parent: this.rankPane }), this.lastPlayerFont = m.newFont("sans-serif", 50, "#23664B"), this.rankingNameFont = m.newFont("sans-serif", 36), this.banPlayerNameFont = m.newFont("sans-serif", 36, "red"), this.myRankingNameFont = m.newFont("sans-serif", 36, "blue"), this.rankCrowns = new Array, this.rankRanks = new Array, this.rankNames = new Array, this.rankScores = new Array, new g.Sprite({ scene: e, parent: this.display, src: e.asset.getImageById("crown_0"), x: 55, y: 90 }), this.lastPlayerName = new p.Label({ scene: e, parent: this.display, font: this.lastPlayerFont, text: "", widthAutoAdjust: !0, lineBreak: !1, width: 640, x: 170, y: 90 }), this.rankPane.onPointMove.add(function (e) { t.rankingView.y += e.prevDelta.y, t.rankingView.y < t.rankPane.height - t.rankingView.height && (t.rankingView.y = t.rankPane.height - t.rankingView.height), 0 < t.rankingView.y && (t.rankingView.y = 0), t.rankingView.modified() }), b.GameParams.isOwner && (new p.Label({ scene: this.scene, parent: this.display, font: this.rankingNameFont, text: "BANON\n", x: 200, y: 580, width: 900 }), this.banView = new g.FilledRect({ scene: this.scene, parent: this.display, cssColor: "#aaad", height: 200, width: 800, x: 35, y: 300, hidden: !0 }), this.banUserLabel = new g.Label({ scene: this.scene, parent: this.banView, font: this.rankingNameFont, x: 20, y: 30, text: "xxxx " }), n = new g.FilledRect({ scene: this.scene, parent: this.banView, cssColor: "#f00a", width: 100, height: 60, x: 150, y: 100, touchable: !0 }), new g.Label({ scene: this.scene, parent: n, font: this.rankingNameFont, text: "", x: 5, y: 10 }), a = new g.FilledRect({ scene: this.scene, parent: this.banView, cssColor: "#f00a", width: 120, height: 60, x: 300, y: 100, touchable: !0 }), new g.Label({ scene: this.scene, parent: a, font: this.rankingNameFont, text: "", x: 5, y: 10 }), a.onPointDown.add(function () { return t.banView.hide() }), n.onPointDown.add(function () { e.send(new i.Ban({ ban: !t.selectBanPlayer.ban, playerID: t.selectBanPlayer.playerID })), t.banView.hide(), t.selectBanPlayer = void 0 })) } a.prototype.show = function () { this.display.show(), this.lastPlayers ? this.draw(this.lastPlayers, this.lastPlayer) : (this.rankingView.y = 0, this.rankingView.modified()) }, a.prototype.hide = function () { this.display.hide() }, a.prototype.draw = function (s, e) { var r = this; if (this.display.visible()) { this.lastPlayers = void 0, this.lastPlayer = void 0; for (var n = 0; n < this.rankCrowns.length; n++)this.rankCrowns[n].destroy(); for (n = 0; n < this.rankRanks.length; n++)this.rankRanks[n].destroy(), this.rankNames[n].destroy(), this.rankScores[n].destroy(); this.rankCrowns = new Array, this.rankRanks = new Array, this.rankNames = new Array, this.rankScores = new Array; var h = 57, l = 50, o = 113, w = 520, d = l + o + 20, y = 150, c = d + w + 10; if (this.rankingView.height = h * s.length, e && (this.lastPlayerName.text = e.name, m.labelAutoReSizeW(this.lastPlayerName, 640)), this.rankingView.children) for (n = this.rankingView.children.length - 1; 0 <= n; n--)this.rankingView.remove(this.rankingView.children[n]); for (var k = this, n = 0; n < s.length; n++)!function (e) { var n = s[e], a = (0 < n.score && n.rank <= 3 && (a = new g.Sprite({ scene: k.scene, parent: k.rankingView, src: k.scene.asset.getImageById("crown_" + n.rank), x: 5, y: h * e }), k.rankCrowns.push(a)), n.playerID == g.game.selfId ? k.myRankingNameFont : n.ban ? k.banPlayerNameFont : k.rankingNameFont), t = new p.Label({ scene: k.scene, parent: k.rankingView, font: a, text: n.rank + "", textAlign: "right", x: l, y: h * e, width: o }), i = new p.Label({ scene: k.scene, parent: k.rankingView, font: a, text: n.name, widthAutoAdjust: !0, lineBreak: !1, x: d, y: h * e, width: w }), a = (m.labelAutoReSizeW(i, w), new p.Label({ scene: k.scene, parent: k.rankingView, font: a, text: n.score + "", lineBreak: !1, x: c, y: h * e, width: y })); k.rankRanks.push(t), k.rankNames.push(i), k.rankScores.push(a), b.GameParams.isOwner && (i.touchable = !0, i.onPointDown.add(function () { var e; b.GameParams.userBanMode && (e = (r.selectBanPlayer = n) === r.scene.jigsaw.me ? "" : n.name, n.ban ? r.banUserLabel.text = e + " " : r.banUserLabel.text = e + " ", r.banUserLabel.invalidate(), r.banView.show()) })) }(n) } else this.lastPlayers = s, this.lastPlayer = e }, e.Result = a }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["ScoreBoard"] = function (g) {
      !function (e, n) { Object.defineProperty(e, "__esModule", { value: !0 }), e.ScoreBoard = void 0; var h = n("@akashic-extension/akashic-label"), l = n("./lib/funcs"); function i(e) { var n = this, i = (this.level = 1, this.scene = e, this.display = new g.FilledRect({ scene: e, cssColor: "rgb(82,243,176)", x: 50, y: 10, width: 870, height: 690, hidden: !0, touchable: !0 }), this.rankPane = new g.Pane({ scene: e, width: 820, height: 550, x: 20, y: 20, parent: this.display, touchable: !0 }), this.rankingView = new g.FilledRect({ scene: e, parent: this.rankPane, cssColor: "rgb(204,242,227)", width: this.rankPane.width, height: this.rankPane.height }), this.rankingFont = l.newFont("sans-serif", 34), this.myRankingFont = l.newFont("sans-serif", 34, "blue"), this.rankPane.onPointMove.add(function (e) { n.rankingView.y += e.prevDelta.y, n.rankingView.y < n.rankPane.height - n.rankingView.height && (n.rankingView.y = n.rankPane.height - n.rankingView.height), 0 < n.rankingView.y && (n.rankingView.y = 0), n.rankingView.modified() }), new g.FilledRect({ scene: e, parent: this.display, cssColor: "rgb(0,194,78)", height: 86, width: 210, x: 640, y: 588, touchable: !0 })), t = (new h.Label({ scene: e, parent: i, font: l.newFont("sans-serif", 60, "white"), text: "", x: 17, y: 5, width: 200 }), i.onPointDown.add(function () { return n.hide() }), this.levelT = new h.Label({ scene: e, parent: this.display, font: l.newFont("sans-serif", 60), text: " " + this.level, x: 10, y: i.y, width: 400 }), new g.Sprite({ scene: e, parent: this.display, src: e.asset.getImageById("left"), x: 300, y: i.y, scaleX: .8, scaleY: .8, touchable: !0 })), e = new g.Sprite({ scene: e, parent: this.display, src: e.asset.getImageById("right"), x: t.x + 170, y: i.y, scaleX: .8, scaleY: .8, touchable: !0 }); t.onPointDown.add(function () { n.level--, 0 == n.level && (n.level = 3), n.draw(n.ranks) }), e.onPointDown.add(function () { n.level++, 4 == n.level && (n.level = 1), n.draw(n.ranks) }) } i.prototype.show = function (e, n) { var i = this; -1 != (this.level = n) && (this.display.show(), window.RPGAtsumaru.scoreboards.getRecords(e).then(function (e) { e = e.ranking; i.draw(e) })) }, i.prototype.hide = function () { this.display.hide() }, i.prototype.draw = function (e) { this.levelT.text = " " + this.level, this.levelT.invalidate(), this.ranks = e; if (this.rankingView.children) for (var n = this.rankingView.children.length - 1; 0 <= n; n--)this.rankingView.remove(this.rankingView.children[n]); for (var i = 0, t = void 0, n = 0; n < e.length; n++) { var s, a = e[n], r = this.convertScore(a.score); null != r && (null == t && (t = a.rank - 1), new h.Label({ scene: this.scene, parent: this.rankingView, font: a.userId + "" == g.game.selfId ? this.myRankingFont : this.rankingFont, text: a.rank - t + "", textAlign: "right", x: 0, y: 46 * i, width: 113 }), s = new h.Label({ scene: this.scene, parent: this.rankingView, font: a.userId + "" == g.game.selfId ? this.myRankingFont : this.rankingFont, text: a.userName, widthAutoAdjust: !0, lineBreak: !1, x: 133, y: 46 * i, width: 480 }), l.labelAutoReSizeW(s, 480), new h.Label({ scene: this.scene, parent: this.rankingView, font: a.userId + "" == g.game.selfId ? this.myRankingFont : this.rankingFont, text: r, lineBreak: !1, x: 623, y: 46 * i, width: 150 }), i++) } this.rankingView.height = 12 < i ? 46 * i : this.rankPane.height }, i.prototype.convertScore = function (e) { var e = e + "", n = e.slice(1, 2); if (n == 4 - this.level + "") return e.slice(2, 5) + ":" + e.slice(5, 7) + ":" + e.slice(7, 9) }, e.ScoreBoard = i }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["Title"] = function (g) {
      !function (e, t) { Object.defineProperty(e, "__esModule", { value: !0 }), e.Title = void 0; var c = t("@akashic-extension/akashic-label"), r = t("./lib/funcs"), a = t("./params"); function i(e) { var t = this, i = (this.selectDifID = 0, e.scene), e = (this.scene = i, this.assetManager = e.assetManager, this.changePazzleCallback = e.changePazzleCallback, this.changeDifficultyCallback = e.changeDifficultyCallback, this.startJigsawCallback = e.startJigsawCallback, this.fontN = new g.DynamicFont({ game: g.game, fontFamily: "sans-serif", fontWeight: "bold", size: 50 }), this.fontB = new g.DynamicFont({ game: g.game, fontFamily: "sans-serif", fontWeight: "bold", size: 50, strokeColor: "white", strokeWidth: 5 }), this.display = new g.E({ scene: i }), this.preview = new g.FilledRect({ scene: i, parent: this.display, cssColor: "rgba(0,0,0)", width: 770, height: 460, x: 25, y: 35 }), this.info = new g.E({ scene: i, width: 380, height: 460, x: 850, y: 35, parent: this.display }), new g.Sprite({ scene: i, parent: this.info, src: i.asset.getImageById("title_back") })), e = (new c.Label({ scene: i, parent: e, width: 360, font: this.fontN, text: "", widthAutoAdjust: !0, lineBreak: !1, anchorX: .5, anchorY: .5, x: .5 * e.width, y: .5 * e.height }), new g.Sprite({ scene: i, parent: this.info, src: i.asset.getImageById("select_E"), y: e.y + 100, touchable: !0 })), n = new g.Sprite({ scene: i, parent: this.info, src: i.asset.getImageById("select_N"), y: e.y + 100, opacity: .6, touchable: !0 }), s = new g.Sprite({ scene: i, parent: this.info, src: i.asset.getImageById("select_H"), y: n.y + 100, opacity: .6, touchable: !0 }); new c.Label({ scene: i, parent: e, width: 170, font: this.fontN, fontSize: 40, text: "50", textAlign: "right", anchorY: .5, x: 150, y: .5 * e.height - 5 }), new c.Label({ scene: i, parent: n, width: 170, font: this.fontN, fontSize: 40, text: "100", textAlign: "right", lineBreak: !1, anchorY: .5, x: 150, y: .5 * e.height - 5 }), new c.Label({ scene: i, parent: s, width: 170, font: this.fontN, fontSize: 40, text: "200", textAlign: "right", lineBreak: !1, anchorY: .5, x: 150, y: .5 * n.height - 5 }), this.dif_Entitys = [e, n, s], a.GameParams.isOwner && (e.onPointDown.add(function () { 0 != t.selectDifID && t.changeDifficultyCallback(0) }), n.onPointDown.add(function () { 1 != t.selectDifID && t.changeDifficultyCallback(1) }), s.onPointDown.add(function () { 2 != t.selectDifID && t.changeDifficultyCallback(2) })), this.joinCnt = new g.Sprite({ scene: i, parent: this.display, src: i.asset.getImageById("sanka_nin"), x: 850, y: 435 }), new c.Label({ scene: i, parent: this.joinCnt, width: 380, font: this.fontN, fontSize: 50, text: "0", textAlign: "center", lineBreak: !1, anchorY: .5, y: .5 * this.joinCnt.height - 5 }); new c.Label({ scene: i, parent: this.display, font: this.fontB, width: 1e3, height: 30, text: "v 12.2    \n", fontSize: 30, x: 230, y: 650 }), "atsumaru" == a.GameParams.operation && (e = new g.FilledRect({ scene: i, parent: this.display, cssColor: "#00C24E", x: 10, y: 602, width: 192, height: 108, touchable: !0 }), new c.Label({ scene: i, parent: e, font: r.newFont("sans-serif", 36, "#fff"), text: "", textAlign: "center", anchorY: .5, y: 54, width: 192 }), e.onPointDown.add(function () { i.jigsaw.scoreBoard.display.visible() ? i.jigsaw.scoreBoard.hide() : i.jigsaw.scoreBoard.show(t.selectPzlID + 1, t.selectDifID + 1) })), a.GameParams.isOwner && (n = new g.Sprite({ scene: i, parent: this.display, src: i.asset.getImageById("left"), x: 250, y: 540, touchable: !0 }), s = new g.Sprite({ scene: i, parent: this.display, src: i.asset.getImageById("right"), x: 500, y: 540, touchable: !0 }), e = new g.Sprite({ scene: i, parent: this.display, src: i.asset.getImageById("playBtn"), x: 950, y: 540, touchable: !0 }), n.onPointDown.add(function () { return t.changePazzleCallback(!1) }), s.onPointDown.add(function () { return t.changePazzleCallback(!0) }), e.onPointDown.add(function () { return t.startJigsawCallback() })), this.selectPzlID = -1, this.changePazzle(!0) } Object.defineProperty(i.prototype, "isUserPuzzle", { get: function () { return this.selectPzlID == this.assetManager.assets.length }, enumerable: !1, configurable: !0 }), i.prototype.changeDefficulty = function (e) { this.selectDifID = e; var t = this.dif_Entitys[0], i = this.dif_Entitys[1], n = this.dif_Entitys[2]; t.opacity = 0 == e ? 1 : .6, t.modified(), i.opacity = 1 == e ? 1 : .6, i.modified(), n.opacity = 2 == e ? 1 : .6, n.modified() }, i.prototype.joinPlayer = function (e) { this.joinCnt.children[0].text = e + "", this.joinCnt.children[0].invalidate() }, i.prototype.changePazzle = function (e) { var t, i, n, s, a, h = this.assetManager, l = h.assets.length; this.selectPzlID += e ? 1 : -1, -1 == this.selectPzlID || this.selectPzlID == l ? this.selectPzlID = l : this.selectPzlID == l + 1 ? this.selectPzlID = 0 : this.selectPzlID = (this.selectPzlID + l) % l, this.isUserPuzzle ? (this.preview.remove(this.preview.children[0]), e = new g.E({ scene: this.scene }), new c.Label({ scene: this.scene, parent: e, font: r.newFont("sans-serif", 90, "white"), text: " ", y: 100, width: this.preview.width }), new c.Label({ scene: this.scene, parent: e, font: r.newFont("sans-serif", 50, "white"), text: "PC\n\n    \n     ", y: 200, width: this.preview.width }), this.preview.append(e), (i = (t = this.info.children)[0].children[0]).text = "", r.labelAutoReSizeW(i, 360), n = t[1].children[0], s = t[2].children[0], a = t[3].children[0], n.text = "???", s.text = "???", a.text = "???") : (l = h.assets[this.selectPzlID], this.preview.children && this.preview.remove(this.preview.children[0]), this.preview.append(l.preview), r.spriteSet(l.preview, this.preview.width, this.preview.height), (i = (t = this.info.children)[0].children[0]).text = l.title, r.labelAutoReSizeW(i, 360), n = t[1].children[0], s = t[2].children[0], a = t[3].children[0], n.text = l.difficulty[0].count + "", s.text = l.difficulty[1].count + "", a.text = l.difficulty[2].count + ""), n.invalidate(), s.invalidate(), a.invalidate() }, e.Title = i }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_0"] = function (g) {
      !function (e) { "use strict"; function r() { } Object.defineProperty(e, "__esModule", { value: !0 }), r.asHoverable = function (e, r) { return e.hoverable = !0, e.touchable = !0, e.hovered = e.hovered || new g.Trigger, e.unhovered = e.unhovered || new g.Trigger, r && r.cursor && (e.cursor = r.cursor), e }, r.asUnhoverable = function (e) { return delete e.hoverable, e.hovered && !e.hovered.destroyed() && (e.hovered.destroy(), delete e.hovered), e.unhovered && !e.unhovered.destroyed() && (e.unhovered.fire(), e.unhovered.destroy(), delete e.unhovered), e }, e.Converter = r }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_1"] = function (g) {
      !function (e, o) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); i.isSupported = function () { return "undefined" != typeof document && "function" == typeof document.addEventListener }, i.prototype.start = function () { return this.view.addEventListener("mousemove", this._onMouseMove_bound, !1), this.view.addEventListener("mouseout", this._onMouseOut_bound, !1), !0 }, i.prototype.stop = function () { this.view.removeEventListener("mousemove", this._onMouseMove_bound, !1), this.view.removeEventListener("mouseout", this._onMouseOut_bound, !1) }, i.prototype._onMouseMove = function (e) { var o, t, i = this.game.scene(); i && (t = (o = this.view.getBoundingClientRect()).left + window.pageXOffset, o = o.top + window.pageYOffset, t = e.pageX - t, e = e.pageY - o, o = { x: 1, y: 1 }, t = { x: t / (o = this._getScale ? this._getScale() : o).x, y: e / o.y }, (e = i.findPointSourceByPoint(t).target) && e.hoverable ? (e !== this.beforeHover && (this.beforeHover && this.beforeHover.hoverable && this._onUnhovered(e), this._onHovered(e)), this.beforeHover = e) : this.beforeHover && this._onUnhovered(this.beforeHover)) }, i.prototype._onHovered = function (e) { e.hoverable && (this.view.style.cursor = e.cursor || this._cursor, this._showTooltip && e.title && this.view.setAttribute("title", e.title), e.hovered.fire()) }, i.prototype._onUnhovered = function (e) { this.view.style.cursor = "auto", this.beforeHover && this.beforeHover.unhovered && (this.beforeHover.unhovered.fire(), this._showTooltip && this.view.removeAttribute("title")), this.beforeHover = null }, i.prototype._onMouseOut = function () { this.beforeHover && this._onUnhovered(this.beforeHover) }; var t = i; function i(e, o, t) { void 0 === t && (t = {}), this.game = e, this.view = o.view, this.beforeHover = null, this.operationTrigger = new g.Trigger, this._cursor = t.cursor || "pointer", this._showTooltip = !!t.showTooltip, this._getScale = o.getScale ? function () { return o.getScale() } : null, this._onMouseMove_bound = this._onMouseMove.bind(this), this._onMouseOut_bound = this._onMouseOut.bind(this) } e.HoverPlugin = t, o.exports = t }(g.module.exports, (g.module.require, g.module), (g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_2"] = function (g) {
      !function (e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); r = r("./Converter"); e.Converter = r.Converter }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_3"] = function (g) {
      !function (e) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }), e.parse = void 0, e.parse = function (e) { for (var r = /^((?:[^\\{]|\\+.)*?)({(?:[^\\}]|\\+.)*?})([\s\S]*)/, a = []; 0 < e.length;) { var t = e.match(r); if (null === t) { a.push(e.replace(/\\{/g, "{").replace(/\\}/g, "}")); break } var p = t[1], l = t[2], t = (e = t[3], 0 < p.length && a.push(p.replace(/\\{/g, "{").replace(/\\}/g, "}")), JSON.parse(l.replace(/\\/g, "\\\\"))); if (!t.hasOwnProperty("rt") || !t.hasOwnProperty("rb")) throw g.ExceptionFactory.createTypeMismatchError("parse", "RubyFragment"); t.rt = t.rt.replace(/\\{/g, "{").replace(/\\}/g, "}"), t.rb = t.rb.replace(/\\{/g, "{").replace(/\\}/g, "}"), t.text = l, a.push(t) } return a } }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_4"] = function (g) {
      !function (t) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.RubyFragmentDrawInfo = t.StringDrawInfo = void 0; function i(t, i, e, r, n, h) { this.text = t.text, this.fragment = t, this.width = i, this.rbWidth = e, this.rtWidth = r, this.glyphs = n, this.rubyGlyphs = h } t.StringDrawInfo = function (t, i, e) { this.text = t, this.width = i, this.glyphs = e }; t.RubyFragmentDrawInfo = i }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_5"] = function (g) {
      !function (t, e) { "use strict"; var r, i, n = this && this.__extends || (r = function (t, e) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var i in e) e.hasOwnProperty(i) && (t[i] = e[i]) })(t, e) }, function (t, e) { function i() { this.constructor = t } r(t, e), t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype, new i) }), c = t("./RubyParser"), l = t("./FragmentDrawInfo"), o = t("./DefaultRubyParser"), t = (i = g.CacheableE, n(s, i), s.prototype.invalidate = function () { this._invalidateSelf(), i.prototype.invalidate.call(this) }, s.prototype.renderCache = function (t) { if (this.rubyEnabled || 0 !== this.fontSize) { t.save(); for (var e = 0, i = 0; i < this._lines.length; ++i)0 < this._lines[i].width && 0 < this._lines[i].height && t.drawImage(this._lines[i].surface, 0, 0, this._lines[i].width, this._lines[i].height, this._offsetX(this._lines[i].width), e), e += this._lines[i].height + this.lineGap; this.textColor && (t.setCompositeOperation("source-atop"), t.fillRect(0, 0, this._lineBreakWidth, this.height, this.textColor)), t.restore() } }, s.prototype.destroy = function () { this._destroyLines(), i.prototype.destroy.call(this) }, s.prototype.calculateCacheSize = function () { return { width: Math.ceil(this._lines.reduce(function (t, e) { return Math.max(t, e.width) }, this.width)), height: this.height } }, Object.defineProperty(s.prototype, "lineCount", { get: function () { return this._lines.length }, enumerable: !1, configurable: !0 }), s.prototype._offsetX = function (t) { switch (this.textAlign) { case "left": case g.TextAlign.Left: return 0; case "right": case g.TextAlign.Right: return this._lineBreakWidth - t; case "center": case g.TextAlign.Center: return (this._lineBreakWidth - t) / 2; default: return 0 } }, s.prototype._destroyLines = function () { for (var t = 0; t < this._lines.length; t++)this._lines[t].surface && !this._lines[t].surface.destroyed() && this._lines[t].surface.destroy(); this._lines = void 0 }, s.prototype._invalidateSelf = function () { if (this.fontSize < 0) throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: fontSize must not be negative."); if (this.lineGap < -1 * this.fontSize) throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: lineGap must be greater than -1 * fontSize."); this._beforeWidth !== this.width && (this._lineBreakWidth = this.width), (this._beforeText !== this.text || this._beforeFontSize !== this.fontSize || this._beforeFont !== this.font || this._beforeLineBreak !== this.lineBreak || this._beforeWidth !== this.width && !0 === this._beforeLineBreak || this._beforeTextAlign !== this.textAlign || this._beforeRubyEnabled !== this.rubyEnabled || this._beforeFixLineGap !== this.fixLineGap || this._beforeTrimMarginTop !== this.trimMarginTop || this._beforeWidthAutoAdjust !== this.widthAutoAdjust || this._isDifferentRubyOptions(this._beforeRubyOptions, this.rubyOptions)) && this._updateLines(), this.widthAutoAdjust && (this.width = Math.ceil(this._lines.reduce(function (t, e) { return Math.max(t, e.width) }, 0))); for (var t = this.lineGap * (this._lines.length - 1), e = 0; e < this._lines.length; e++)t += this._lines[e].height; this.height = t, this._beforeText = this.text, this._beforeTextAlign = this.textAlign, this._beforeFontSize = this.fontSize, this._beforeLineBreak = this.lineBreak, this._beforeFont = this.font, this._beforeWidth = this.width, this._beforeRubyEnabled = this.rubyEnabled, this._beforeFixLineGap = this.fixLineGap, this._beforeTrimMarginTop = this.trimMarginTop, this._beforeWidthAutoAdjust = this.widthAutoAdjust, this._beforeRubyOptions.rubyFontSize = this.rubyOptions.rubyFontSize, this._beforeRubyOptions.rubyFont = this.rubyOptions.rubyFont, this._beforeRubyOptions.rubyGap = this.rubyOptions.rubyGap, this._beforeRubyOptions.rubyAlign = this.rubyOptions.rubyAlign }, s.prototype._updateLines = function () { for (var t = this.rubyEnabled ? this.rubyParser(this.text.replace(/\r\n|\n/g, "\r")) : [this.text], t = c.flatmap(t, function (t) { return "string" != typeof t ? t : t.replace(/\r\n|\n/g, "\r").match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g) || [] }), e = this._divideToLines(t), i = [], r = this._beforeFontSize === this.fontSize && this._beforeFont === this.font && !this._isDifferentRubyOptions(this._beforeRubyOptions, this.rubyOptions), n = 0; n < e.length; n++) { var o = e[n], s = this._lines[n]; r && void 0 !== s && o.sourceText === s.sourceText && o.width === s.width && o.height === s.height ? i.push(s) : (s && s.surface && !s.surface.destroyed() && s.surface.destroy(), this._drawLineInfoSurface(o), i.push(o)) } for (n = i.length; n < this._lines.length; n++)(s = this._lines[n]).surface && !s.surface.destroyed() && s.surface.destroy(); this._lines = i }, s.prototype._drawLineInfoSurface = function (t) { for (var e = t.fragmentDrawInfoArray, i = this._calcRubyHeightInfo(e), r = this.scene.game.resourceFactory.createSurface(Math.ceil(t.width), Math.ceil(t.height)), n = r.renderer(), o = (n.begin(), n.save(), i.hasRubyFragmentDrawInfo || this.fixLineGap ? this.rubyOptions.rubyGap + i.maxRubyGlyphHeightWithOffsetY : 0), s = t.minMinusOffsetY, h = 0; h < e.length; h++) { var a = e[h]; a instanceof l.RubyFragmentDrawInfo ? this._drawRubyFragmentDrawInfo(n, a, o - s, -i.minRubyMinusOffsetY) : a instanceof l.StringDrawInfo && this._drawStringGlyphs(n, this.font, a.glyphs, this.fontSize, 0, o - s, 0), n.translate(a.width, 0) } n.restore(), n.end(), t.surface = r }, s.prototype._drawStringGlyphs = function (t, e, i, r, n, o, s) { void 0 === s && (s = 0), t.save(), t.translate(n, o); for (var h = 0; h < i.length; h++) { var a = i[h], u = r / e.size, f = a.advanceWidth * u; (a.isSurfaceValid || (a = this._createGlyph(a.code, e))) && (t.save(), t.transform([u, 0, 0, u, 0, 0]), 0 < a.width && 0 < a.height && t.drawImage(a.surface, a.x, a.y, a.width, a.height, a.offsetX, a.offsetY), t.restore(), t.translate(f + s, 0)) } t.restore() }, s.prototype._drawRubyFragmentDrawInfo = function (t, e, i, r) { var n, o, s, h, a = e.fragment, u = ("rubyFontSize" in a ? a : this.rubyOptions).rubyFontSize, f = ("rubyAlign" in a ? a : this.rubyOptions).rubyAlign, a = ("rubyFont" in a ? a : this.rubyOptions).rubyFont, y = e.rtWidth > e.rbWidth, l = e.width, b = e.rtWidth, p = e.rbWidth; switch (f) { case c.RubyAlign.Center: h = s = 0, n = y ? 0 : (l - b) / 2, o = y ? (l - p) / 2 : 0; break; case c.RubyAlign.SpaceAround: s = 0 < e.rubyGlyphs.length ? (l - b) / e.rubyGlyphs.length : 0, h = 0, n = y ? 0 : s / 2, o = y ? (l - p) / 2 : 0; break; default: throw g.ExceptionFactory.createAssertionError("Label#_drawRubyFragmentDrawInfo: unknown rubyAlign.") }this._drawStringGlyphs(t, this.font, e.glyphs, this.fontSize, o, i, h), this._drawStringGlyphs(t, a, e.rubyGlyphs, u, n, r, s) }, s.prototype._calcRubyHeightInfo = function (t) { for (var e, i = this.rubyOptions.rubyFontSize, r = 0, n = this.rubyOptions.rubyGap, o = !1, s = 0, h = 0; h < t.length; h++) { var a, u, f, y = t[h]; y instanceof l.RubyFragmentDrawInfo && ((u = y.fragment).rubyFontSize > i && (i = u.rubyFontSize), u.rubyGap > n && (n = u.rubyGap), a = (u.rubyFontSize || this.rubyOptions.rubyFontSize) / (u.rubyFont ? u : this.rubyOptions).rubyFont.size, f = Math.max.apply(Math, y.rubyGlyphs.map(function (t) { return 0 < t.offsetY ? t.height + t.offsetY : t.height })), y = Math.min.apply(Math, y.rubyGlyphs.map(function (t) { return 0 < t.offsetY ? t.offsetY : 0 })), r < f * a && (r = f * a), u = u.rubyFont || this.rubyOptions.rubyFont, u = this._calcStandardOffsetY(u), s < (f = (f - Math.min(y, u)) * a) && (s = f, e = Math.min(y, u) * a), o = !0) } return { maxRubyFontSize: i, maxRubyGlyphHeightWithOffsetY: r = 0 === r ? this.rubyOptions.rubyFontSize : r, minRubyMinusOffsetY: this.trimMarginTop ? e : 0, maxRubyGap: n, hasRubyFragmentDrawInfo: o } }, s.prototype._divideToLines = function (t) { for (var e = { resultLines: [], currentStringDrawInfo: new l.StringDrawInfo("", 0, []), currentLineInfo: { sourceText: "", fragmentDrawInfoArray: [], width: 0, height: 0, minMinusOffsetY: 0, surface: void 0 }, reservedLineBreakPosition: null }, i = 0; i < t.length; i++)this._addFragmentToState(e, t, i); return this._flushCurrentStringDrawInfo(e), this._feedLine(e), e.resultLines }, s.prototype._addFragmentToState = function (t, e, i) { var r, n, o = e[i]; null !== t.reservedLineBreakPosition && t.reservedLineBreakPosition--, 0 === t.reservedLineBreakPosition && (this._flushCurrentStringDrawInfo(t), this._feedLine(t), t.reservedLineBreakPosition = null), "string" == typeof o && "\r" === o ? (this._flushCurrentStringDrawInfo(t), this._feedLine(t)) : "string" == typeof o ? (r = g.Util.charCodeAt(o, 0)) && (r = this._createGlyph(r, this.font)) && (n = this.fontSize / this.font.size, n = r.advanceWidth * n, this._needBreakLine(t, n) && this._breakLine(t, e, i), t.currentStringDrawInfo.width += n, t.currentStringDrawInfo.glyphs.push(r), t.currentStringDrawInfo.text += o) : (n = this._createRubyFragmentDrawInfo(o)).width <= 0 || (this._flushCurrentStringDrawInfo(t), this._needBreakLine(t, n.width) && this._breakLine(t, e, i), t.currentLineInfo.width += n.width, t.currentLineInfo.fragmentDrawInfoArray.push(n), t.currentLineInfo.sourceText += o.text) }, s.prototype._createStringGlyph = function (t, e) { for (var i = [], r = 0; r < t.length; r++) { var n = g.Util.charCodeAt(t, r); n && ((n = this._createGlyph(n, e)) && i.push(n)) } return i }, s.prototype._createGlyph = function (t, e) { e = e.glyphForCharacter(t); return e || (t = 4294901760 & t ? String.fromCharCode((4294901760 & t) >>> 16, 65535 & t) : String.fromCharCode(t), console.warn("Label#_invalidateSelf(): failed to get a glyph for '" + t + "' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")), e }, s.prototype._createRubyFragmentDrawInfo = function (t) { var e = this._createStringGlyph(t.rb, this.font), i = this._createStringGlyph(t.rt, this.rubyOptions.rubyFont), r = ("rubyFont" in t ? t : this.rubyOptions).rubyFont, n = ("rubyFontSize" in t ? t : this.rubyOptions).rubyFontSize, o = this.fontSize / this.font.size, n = n / r.size, r = 0 < e.length ? e.map(function (t) { return t.advanceWidth }).reduce(function (t, e) { return t + e }) * o : 0, o = 0 < i.length ? i.map(function (t) { return t.advanceWidth }).reduce(function (t, e) { return t + e }) * n : 0; return new l.RubyFragmentDrawInfo(t, o < r ? r : o, r, o, e, i) }, s.prototype._flushCurrentStringDrawInfo = function (t) { 0 < t.currentStringDrawInfo.width && (t.currentLineInfo.fragmentDrawInfoArray.push(t.currentStringDrawInfo), t.currentLineInfo.width += t.currentStringDrawInfo.width, t.currentLineInfo.sourceText += t.currentStringDrawInfo.text), t.currentStringDrawInfo = new l.StringDrawInfo("", 0, []) }, s.prototype._feedLine = function (t) { var e = this.fontSize / this.font.size, i = 1 / 0, r = 0, n = 0, o = (t.currentLineInfo.fragmentDrawInfoArray.forEach(function (t) { t.glyphs.forEach(function (t) { r > t.offsetY && (r = t.offsetY), i > t.offsetY && (i = t.offsetY); t = 0 < t.offsetY ? t.height + t.offsetY : t.height; n < t && (n = t) }) }), r *= e, n = 0 < t.currentLineInfo.fragmentDrawInfoArray.length ? n * e - r : this.fontSize, n = Math.ceil(n), this._calcRubyHeightInfo(t.currentLineInfo.fragmentDrawInfoArray)); t.currentLineInfo.height = o.hasRubyFragmentDrawInfo || this.fixLineGap ? n + o.maxRubyGlyphHeightWithOffsetY + o.maxRubyGap : n, t.currentLineInfo.minMinusOffsetY = r, this.trimMarginTop && (o = Math.min(i, this._calcStandardOffsetY(this.font)) * e, t.currentLineInfo.height -= o, t.currentLineInfo.minMinusOffsetY += o), t.resultLines.push(t.currentLineInfo), t.currentLineInfo = { sourceText: "", fragmentDrawInfoArray: [], width: 0, height: 0, minMinusOffsetY: 0, surface: void 0 } }, s.prototype._needBreakLine = function (t, e) { return this.lineBreak && 0 < e && null === t.reservedLineBreakPosition && t.currentLineInfo.width + t.currentStringDrawInfo.width + e > this._lineBreakWidth && 0 < t.currentLineInfo.width + t.currentStringDrawInfo.width }, s.prototype._isDifferentRubyOptions = function (t, e) { return t.rubyFontSize !== e.rubyFontSize || t.rubyFont !== e.rubyFont || t.rubyGap !== e.rubyGap || t.rubyAlign !== e.rubyAlign }, s.prototype._calcStandardOffsetY = function (t) { return t.glyphForCharacter("M".charCodeAt(0)).offsetY }, s.prototype._breakLine = function (t, e, i) { if (this.lineBreakRule) { var r = this.lineBreakRule(e, i) - i; if (0 === r) this._flushCurrentStringDrawInfo(t), this._feedLine(t); else if (0 < r) t.reservedLineBreakPosition = r; else { this._flushCurrentStringDrawInfo(t); for (var n = []; r < 0;) { var o, s, h, a = t.currentLineInfo.fragmentDrawInfoArray, u = a[a.length - 1]; u instanceof l.RubyFragmentDrawInfo ? (r++, n.push(u), a.pop()) : -r >= u.text.length ? (r += u.text.length, n.push(u), a.pop()) : (a = u.glyphs.splice(r), o = this.fontSize / this.font.size, s = a.reduce(function (t, e) { return e.advanceWidth * o + t }, 0), u.width -= s, h = u.text.substring(u.text.length + r), u.text = u.text.substring(0, u.text.length + r), n.push(new l.StringDrawInfo(h, s, a)), r = 0) } var f = 0, y = "", e = (n.forEach(function (t) { f += t.width, y += t.text }), t.currentLineInfo.width -= f, t.currentLineInfo.sourceText); t.currentLineInfo.sourceText = e.substr(0, e.length - y.length), this._feedLine(t), t.currentLineInfo.fragmentDrawInfoArray = n, t.currentLineInfo.width = f, t.currentLineInfo.sourceText = y } } else this._flushCurrentStringDrawInfo(t), this._feedLine(t) }, s); function s(t) { var e = i.call(this, t) || this; return e.text = t.text, e.font = t.font, e.fontSize = t.fontSize || t.font.size, e._lineBreakWidth = t.width, e.lineBreak = !("lineBreak" in t) || t.lineBreak, e.lineGap = t.lineGap || 0, e.textAlign = "textAlign" in t ? t.textAlign : "left", e.textColor = t.textColor, e.trimMarginTop = "trimMarginTop" in t && t.trimMarginTop, e.widthAutoAdjust = "widthAutoAdjust" in t && t.widthAutoAdjust, e.rubyEnabled = !("rubyEnabled" in t) || t.rubyEnabled, e.fixLineGap = "fixLineGap" in t && t.fixLineGap, e.rubyParser = "rubyParser" in t ? t.rubyParser : o.parse, e.lineBreakRule = "lineBreakRule" in t ? t.lineBreakRule : void 0, t.rubyOptions || (t.rubyOptions = {}), e.rubyOptions = t.rubyOptions, e.rubyOptions.rubyFontSize = "rubyFontSize" in t.rubyOptions ? t.rubyOptions.rubyFontSize : t.fontSize / 2, e.rubyOptions.rubyFont = "rubyFont" in t.rubyOptions ? t.rubyOptions.rubyFont : e.font, e.rubyOptions.rubyGap = "rubyGap" in t.rubyOptions ? t.rubyOptions.rubyGap : 0, e.rubyOptions.rubyAlign = "rubyAlign" in t.rubyOptions ? t.rubyOptions.rubyAlign : c.RubyAlign.SpaceAround, e._lines = [], e._beforeText = void 0, e._beforeTextAlign = void 0, e._beforeFontSize = void 0, e._beforeLineBreak = void 0, e._beforeFont = void 0, e._beforeWidth = void 0, e._beforeRubyEnabled = void 0, e._beforeFixLineGap = void 0, e._beforeTrimMarginTop = void 0, e._beforeWidthAutoAdjust = void 0, e._beforeRubyOptions = {}, e._invalidateSelf(), e } e.exports = t }((g.module.exports, g.module.require), g.module, (g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_6"] = function (g) {
      !function (e) { "use strict"; var r; Object.defineProperty(e, "__esModule", { value: !0 }), e.flatmap = e.RubyAlign = void 0, (r = e.RubyAlign || (e.RubyAlign = {}))[r.Center = 0] = "Center", r[r.SpaceAround = 1] = "SpaceAround", e.flatmap = function (e, r) { return Array.prototype.concat.apply([], e.map(r)) } }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_7"] = function (g) {
      !function (e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }), e.defaultRubyParser = e.RubyAlign = void 0, e.Label = r("./Label"), e.FragmentDrawInfo = r("./FragmentDrawInfo"), e.RubyParser = r("./RubyParser"), e.RubyAlign = e.RubyParser.RubyAlign; r = r("./DefaultRubyParser"); e.defaultRubyParser = r.parse }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_8"] = function (g) {
      !function (e, t) { "use strict"; var k = this && this.__assign || function () { return (k = Object.assign || function (e) { for (var t, n = 1, i = arguments.length; n < i; n++)for (var a in t = arguments[n]) Object.prototype.hasOwnProperty.call(t, a) && (e[a] = t[a]); return e }).apply(this, arguments) }, F = (Object.defineProperty(e, "__esModule", { value: !0 }), e.FallbackDialog = void 0, t("@akashic-extension/akashic-hover-plugin")), H = t("@akashic-extension/akashic-hover-plugin/lib/HoverPlugin"); function I(e, t, n, i, a) { for (var o = n - i | 0; o <= Math.ceil(n + i); ++o) { var r = i * Math.cos(Math.asin((n - o) / i)); e.fillRect(t - r, o, 2 * r, 1, a) } } function U(e, t, n) { e = g.game.resourceFactory.createSurface(Math.ceil(e), Math.ceil(t)), t = e.renderer(); return t.begin(), n(t), t.end(), e } function D(i, a) { var o = new g.Trigger, e = 1e3 / g.game.fps, r = 0, s = 0, c = a[0], d = !1; function t(e) { (s += e) > c.duration && ((d = ++r >= a.length) ? (s = c.duration, i.scene.onUpdate.addOnce(o.fire, o)) : (s -= c.duration, c = a[r])); var e = Math.min(1, s / c.duration), t = c.scale, n = c.opacity; return t && (i.scaleX = i.scaleY = t[0] + (t[1] - t[0]) * e), n && (i.opacity = n[0] + (n[1] - n[0]) * e), i.modified(), d } return t(0), i.onUpdate.add(function () { return t(e) }), o } function L(e) { var t, n, i, a, o, r, s, c, d, u, l, h, p, f, m, P, b, v, y, w, O, _, x, S, E, C, R = this; function M(e) { return new g.Label(k({ scene: b, font: p, local: !0, textAlign: g.TextAlign.Center, widthAutoAdjust: !1 }, e)) } this.onEnd = new g.Trigger, this.isHoverPluginStarted = !1, this.timer = null, L.isSupported() && (O = (t = g.game).width, v = t.height, n = O / 1280, i = Math.round(32 * n), a = Math.round(28 * n), c = 360 * n, u = "#4a8de1", l = "#fff", h = 960 * n | 0, y = (o = 80 * n) + 1.3 * i * 2 + (r = 32 * n) + (a + 1.3 * a) + (s = 42 * n) + (d = 82 * n) + 72 * n | 0, p = new g.DynamicFont({ game: g.game, fontFamily: g.FontFamily.SansSerif, size: i, fontWeight: g.FontWeight.Bold, fontColor: "#252525" }), E = -2 & Math.ceil(32 * n), f = E / 2, w = U(E, E, function (e) { I(e, f, f, f, l) }), m = U(E, E, function (e) { I(e, f, f, f, u) }), P = U(E, E, function (e) { I(e, f, f, f, u), I(e, f, f, 12 * n, l) }), b = this.scene = t.scene(), E = this.bgRect = new g.FilledRect({ scene: b, local: !0, width: O, height: v, cssColor: "rgba(0, 0, 0, 0.5)", touchable: !0 }), O = 0, (v = this.dialogPane = new g.Pane({ scene: b, local: !0, width: h, height: y, anchorX: .5, anchorY: .5, x: t.width / 2 | 0, y: t.height / 2 | 0, backgroundImage: w, backgroundEffector: new g.NinePatchSurfaceEffector(t, w.width / 2 - 1), parent: E })).append(M({ x: y = 80 * n | 0, y: O += o + .3 * i | 0, text: "", fontSize: i, width: w = 800 * n | 0 })), v.append(M({ x: y, y: O += 1.3 * i | 0, text: "" + e + "", fontSize: i, width: w })), v.append(M({ x: y, y: O += i + r | 0, text: "", fontSize: a, width: w })), v.append(M({ x: y, y: O += 1.3 * a | 0, text: "", fontSize: a, width: w })), O += a + s | 0, _ = new g.Pane({ scene: b, local: !0, width: c, height: d, x: h / 2, y: O + d / 2, anchorX: .5, anchorY: .5, backgroundImage: P, backgroundEffector: new g.NinePatchSurfaceEffector(t, P.width / 2 - 1), parent: b, touchable: !0 }), v.append(_), x = this.buttonLabel = M({ x: 0, y: (d - i) / 2 - 5 * n, text: "OK (15)", fontSize: i, width: c, textColor: u }), _.append(x), S = function () { _.backgroundImage = m, _.invalidate(), x.textColor = l, x.invalidate() }, E = F.Converter.asHoverable(_), C = !1, E.hovered.add(function () { S(), C || (C = !0, D(_, [{ duration: 16, scale: [1, .9] }, { duration: 16, scale: [.9, 1.1] }, { duration: 33, scale: [1.1, 1] }]).add(function () { return C = !1 })) }), E.unhovered.add(function () { _.backgroundImage = P, _.invalidate(), x.textColor = u, x.invalidate() }), _.onPointDown.add(S), _.onPointUp.add(function () { R.end() }), t.operationPluginManager.plugins[L.HOVER_PLUGIN_OPCODE] || t.operationPluginManager.register(H, L.HOVER_PLUGIN_OPCODE)) } L.isSupported = function () { return "undefined" != typeof window && .4 <= g.game.height / g.game.width && H.isSupported() }, L.prototype.start = function (e) { var t = this, n = g.game, i = this.scene; n.scene() === i && (n.onSceneChange.add(this._disablePluginOnSceneChange, this), n.operationPluginManager.start(L.HOVER_PLUGIN_OPCODE), this.isHoverPluginStarted = !0, D(this.dialogPane, [{ duration: 100, scale: [.5, 1.1], opacity: [.5, 1] }, { duration: 100, scale: [1.1, 1], opacity: [1, 1] }]), i.append(this.bgRect), i.onUpdate.add(this._assureFrontmost, this), this.timer = i.setInterval(function () { --e, t.buttonLabel.text = "OK (" + e + ")", t.buttonLabel.invalidate(), e <= 0 && t.end() }, 1e3)) }, L.prototype.end = function () { var t = this; this.timer && (this.scene.clearInterval(this.timer), this.timer = null), this.scene.onUpdate.remove(this._assureFrontmost, this), this.isHoverPluginStarted && (g.game.operationPluginManager.stop(L.HOVER_PLUGIN_OPCODE), this.isHoverPluginStarted = !1), D(this.dialogPane, [{ duration: 100, opacity: [1, 0], scale: [1, .8] }]), D(this.bgRect, [{ duration: 100, opacity: [1, 0] }]).add(function () { var e = t.onEnd; t.onEnd = null, t.bgRect.destroy(), t.bgRect = null, t.dialogPane = null, t.scene = null, e.fire() }) }, L.prototype._disablePluginOnSceneChange = function (e) { if (e !== this.scene) return g.game.operationPluginManager.stop(L.HOVER_PLUGIN_OPCODE), !0 }, L.prototype._assureFrontmost = function () { g.game._pushPostTickTask(this._doAssureFrontmost, this) }, L.prototype._doAssureFrontmost = function () { var e = this.scene; e && g.game.scene() !== e || e.children[e.children.length - 1] !== this.bgRect && (this.bgRect.remove(), e.append(this.bgRect)) }, L.HOVER_PLUGIN_OPCODE = -1e3, e.FallbackDialog = L }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_9"] = function (g) {
      !function (e, n) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }), e.resolvePlayerInfo = void 0; var r = n("./FallbackDialog"), a = "undefined" != typeof window ? window.RPGAtsumaru : void 0; function o() { return "" + (1e3 * Math.random() | 0) } var l = [{ isSupported: function () { return !!(a && a.user && a.user.getSelfInformation) }, resolve: function (e, n) { a.user.getSelfInformation().then(function (e) { n(null, { name: e.name, userData: { accepted: !0, premium: e.isPremium } }) }, function (e) { n(e, null) }) } }, { isSupported: function () { var e = g.game.external.coeLimited; return !!(e && e.startLocalSession && e.exitLocalSession) }, resolve: function (e, n) { var a = g.game.playId + "__player-info-resolver", t = g.game.scene(), r = t.setTimeout(function () { n(r = null, { name: null, userData: { accepted: !1, premium: !1 } }), g.game.external.coeLimited.exitLocalSession(a, { needsResult: !0 }) }, 1e3 * (e + 2)); g.game.external.coeLimited.startLocalSession({ sessionId: a, applicationName: "player-info-resolver", localEvents: [[32, 0, ":akashic", { type: "start", parameters: { limitSeconds: e } }]], messageHandler: function (e) { null != r && (t.clearTimeout(r), n(null, e.result)) } }) } }, { isSupported: function () { var e = g.game.external.atsumaru; return !(!e || !e.getSelfInformationProto) }, resolve: function (e, a) { g.game.external.atsumaru.getSelfInformationProto({ callback: function (e, n) { null != e ? a(new Error(e), null) : n && n.login ? a(null, { name: n.name, userData: { accepted: !0, premium: n.premium } }) : a(null, { name: o(), userData: { accepted: !1, premium: !1 } }) } }) } }, { isSupported: r.FallbackDialog.isSupported, resolve: function (e, n) { var a = o(), t = new r.FallbackDialog(a); t.start(e), t.onEnd.addOnce(function () { n(null, { name: a, userData: { accepted: !1, premium: !1 } }) }) } }, { isSupported: function () { return !0 }, resolve: function (e, n) { n(null, { name: "", userData: { accepted: !1, premium: !1, unnamed: !0 } }) } }], u = !1; e.resolvePlayerInfo = function (a, t) { if (u) null != t && t(new Error("Last processing has not yet been completed."), null); else { var n = function (e, n) { u = !1, null != t && t(e, n), e || (e = n.name, n = n.userData, !a || !a.raises || n && n.unnamed || g.game.raiseEvent(new g.PlayerInfoEvent({ id: g.game.selfId, name: e, userData: n }))) }, e = a && a.limitSeconds ? a.limitSeconds : 15, r = function (e, n) { for (var a = 0; a < e.length; ++a)if (n(e[a])) return e[a] }(l, function (e) { return e.isSupported() }); try { u = !0, r.resolve(e, n) } catch (e) { n(e) } } } }(g.module.exports, g.module.require, (g.module, g.filename, g.dirname));
    };



    window.gLocalAssetContainer["a_e_z_10"] = function (g) {
      !function (t) { "use strict"; function i(t) { this.x = t.x, this.y = t.y, this.vx = t.vx, this.vy = t.vy, this.av = t.av, this.angle = t.angle, this.M = t.M, this.K = t.K, this.I = t.I, this.RD = t.RD, this.fins = t.fins } Object.defineProperty(t, "__esModule", { value: !0 }), i.prototype.update = function (t, i, s, h, e) { var a = this.calcFinForce(t, this.fins), i = (i + a.fx - this.vx * this.K) / this.M + h, h = (s + a.fy - this.vy * this.K) / this.M + e, s = (this.vx += i * t, this.vy += h * t, this.x += this.vx * t, this.y += this.vy * t, a.tau / this.I); this.av += s * t, this.av *= this.RD, this.angle += this.av * t }, i.prototype.calcFinForce = function (t, i) { for (var s = 0, h = 0, e = 0, a = 0; a < i.length; a++) { var n = i[a], v = this.angle + n.armAngle, r = Math.cos(v), v = Math.sin(v), o = this.angle + n.armAngle + n.angle, g = Math.cos(o), o = Math.sin(o), l = this.vx - v * this.av * n.armLength, f = this.vy + r * this.av * n.armLength, l = g * (-l * this.K * n.size) + o * (-f * this.K * n.size), f = l * g, g = l * o, l = (s += (r * g - v * f) * n.armLength, r * f + v * g); h += l * r, e += l * v } return { tau: s, fx: h, fy: e } }, t.Confetti = i }(g.module.exports, (g.module.require, g.module, g.filename, g.dirname));
    };




  </script>

  <script>

    window.addEventListener("load", function () { var e, n = "sandboxDummyPlayId", o = engineFiles.pdiBrowser, t = engineFiles.gameDriver, i = new t.MemoryAmflowClient({ playId: n }), a = (!0 !== window.__akashic__.autoSendEventName && "string" != typeof window.__akashic__.autoSendEventName || (e = window.__akashic__.sandboxConfigFunc(), !0 === (a = window.__akashic__.autoSendEventName) && (a = e.autoSendEventName || e.autoSendEvents), e && a && e.events && e.events[a] && e.events[a].forEach(function (e) { i.sendEvent(e) })), e = "file:" !== location.protocol ? [o.WebAudioPlugin, o.HTMLAudioPlugin] : [o.HTMLAudioPlugin], document.getElementById("container")), r = new o.Platform({ amflow: i, containerView: a, audioPlugins: e, disablePreventDefault: !0 }); function d(e) { var n, o, t, i; r.containerController && (n = window.innerWidth || document.documentElement.clientWidth, o = window.innerHeight || document.documentElement.clientHeight, i = Math.min(n / e.width, o / e.height), t = Math.floor(e.width * i), e = Math.floor(e.height * i), r.containerController.changeScale(i, i), i = { x: Math.floor((n - t) / 2), y: Math.floor((o - e) / 2) }, r.containerController.inputHandlerLayer.setOffset(i)) } a.addEventListener("touchstart", function (e) { e.preventDefault() }), r.loadGameConfiguration = function (e, n) { try { var o = window.gLocalAssetContainer["game.json"], o = decodeURIComponent(o); n(null, JSON.parse(o)) } catch (e) { n(e, null) } }, r._resourceFactory.createScriptAsset = function (e, n) { return new LocalScriptAssetV3(e, n) }, "undefined" != typeof LocalTextAssetV3 && (r._resourceFactory.createTextAsset = function (e, n) { return new LocalTextAssetV3(e, n) }), (driver = new t.GameDriver({ platform: r, player: { id: "9999", name: "sandbox-player" }, errorHandler: function (e) { console.log("ERRORHANDLER:", e) } })).gameCreatedTrigger.add(function (e) { window.optionProps.magnify && (d(e), window.addEventListener("resize", function () { d(e) })) }), driver.initialize({ configurationUrl: "game.json", assetBase: "./", driverConfiguration: { playId: n, playToken: "dummyToken", executionMode: t.ExecutionMode.Active }, loopConfiguration: { loopMode: t.LoopMode.Realtime } }, function (e) { if (e) throw e; try { var n; "undefined" != typeof window && window.RPGAtsumaru && (n = window.RPGAtsumaru.volume.getCurrentValue(), r.setMasterVolume(n), window.RPGAtsumaru.volume.changed.subscribe(function (e) { r.setMasterVolume(e) }), window.RPGAtsumaru.screenshot.setScreenshotHandler(function () { var e = r.getPrimarySurface().canvas.toDataURL("image/png"); return Promise.resolve(e) })) } catch (e) { console.error(e) } driver.startGame() }) });

    window.g = require("@akashic/akashic-engine"), "gLocalAssetContainer" in window || (window.gLocalAssetContainer = {}), "__akashic__" in window || (window.__akashic__ = {});

    var LocalScriptAssetV3 = function () { function t(t, o) { this.type = "script", this.id = t, this.originalPath = o, this.path = this._assetPathFilter(o), this.onDestroyed = new g.Trigger, this.func = window.gLocalAssetContainer[t] } return t.prototype.destroy = function () { this.onDestroyed.fire(this), this.id = void 0, this.originalPath = void 0, this.path = void 0, this.onDestroyed.destroy(), this.onDestroyed = void 0 }, t.prototype.destroyed = function () { return void 0 === this.id }, t.prototype.inUse = function () { return !1 }, t.prototype.execute = function (t) { return this.func(t), t.module.exports }, t.prototype._load = function (t) { var o = this; void 0 !== this.func ? setTimeout(function () { t._onAssetLoad(o) }, 0) : setTimeout(function () { t._onAssetError(o, g.ExceptionFactory.createAssetLoadError("can not load script asset")) }, 0) }, t.prototype._assetPathFilter = function (t) { return t }, t }();

  </script>

  <style type="text/css">
    * {
      margin: 0;
      border: 0;
      padding: 0;
    }

    html {
      width: 100%;
      height: 100%;
    }

    body {
      overflow: hidden;
      width: 100%;
      height: 100%;
    }

    #container {
      margin: 0px;
      padding: 0px;
      overflow: hidden;
      touch-action: none;
      width: 100%;
      height: 100%;

      /* iOS: body */
      position: absolute;
    }

    #container canvas {
      background-size: contain;
    }
  </style>



</head>

<body>
  <div id="container">
  </div>
</body>

</html>