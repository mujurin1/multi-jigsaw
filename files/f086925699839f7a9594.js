function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).aez_bundle_main=e()}(function(){return function n(r,a,s){function o(t,e){if(!a[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(h)return h(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=a[t]={exports:{}},r[t][0].call(i.exports,function(e){return o(r[t][1][e]||e)},i,i.exports,n,r,a,s)}return a[t].exports}for(var h="function"==typeof require&&require,e=0;e<s.length;e++)o(s[e]);return o}({1:[function(e,t,i){"use strict";function n(){}Object.defineProperty(i,"__esModule",{value:!0}),n.asHoverable=function(e,t){return e.hoverable=!0,e.touchable=!0,e.hovered=e.hovered||new g.Trigger,e.unhovered=e.unhovered||new g.Trigger,t&&t.cursor&&(e.cursor=t.cursor),e},n.asUnhoverable=function(e){return delete e.hoverable,e.hovered&&!e.hovered.destroyed()&&(e.hovered.destroy(),delete e.hovered),e.unhovered&&!e.unhovered.destroyed()&&(e.unhovered.fire(),e.unhovered.destroy(),delete e.unhovered),e},i.Converter=n},{}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});r.isSupported=function(){return"undefined"!=typeof document&&"function"==typeof document.addEventListener},r.prototype.start=function(){return this.view.addEventListener("mousemove",this._onMouseMove_bound,!1),this.view.addEventListener("mouseout",this._onMouseOut_bound,!1),!0},r.prototype.stop=function(){this.view.removeEventListener("mousemove",this._onMouseMove_bound,!1),this.view.removeEventListener("mouseout",this._onMouseOut_bound,!1)},r.prototype._onMouseMove=function(e){var t,i,n=this.game.scene();n&&(i=(t=this.view.getBoundingClientRect()).left+window.pageXOffset,t=t.top+window.pageYOffset,i=e.pageX-i,e=e.pageY-t,t={x:1,y:1},i={x:i/(t=this._getScale?this._getScale():t).x,y:e/t.y},(e=n.findPointSourceByPoint(i).target)&&e.hoverable?(e!==this.beforeHover&&(this.beforeHover&&this.beforeHover.hoverable&&this._onUnhovered(e),this._onHovered(e)),this.beforeHover=e):this.beforeHover&&this._onUnhovered(this.beforeHover))},r.prototype._onHovered=function(e){e.hoverable&&(this.view.style.cursor=e.cursor||this._cursor,this._showTooltip&&e.title&&this.view.setAttribute("title",e.title),e.hovered.fire())},r.prototype._onUnhovered=function(e){this.view.style.cursor="auto",this.beforeHover&&this.beforeHover.unhovered&&(this.beforeHover.unhovered.fire(),this._showTooltip&&this.view.removeAttribute("title")),this.beforeHover=null},r.prototype._onMouseOut=function(){this.beforeHover&&this._onUnhovered(this.beforeHover)};var n=r;function r(e,t,i){void 0===i&&(i={}),this.game=e,this.view=t.view,this.beforeHover=null,this.operationTrigger=new g.Trigger,this._cursor=i.cursor||"pointer",this._showTooltip=!!i.showTooltip,this._getScale=t.getScale?function(){return t.getScale()}:null,this._onMouseMove_bound=this._onMouseMove.bind(this),this._onMouseOut_bound=this._onMouseOut.bind(this)}i.HoverPlugin=n,t.exports=n},{}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});e=e("./Converter");i.Converter=e.Converter},{"./Converter":1}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.parse=void 0,i.parse=function(e){for(var t=/^((?:[^\\{]|\\+.)*?)({(?:[^\\}]|\\+.)*?})([\s\S]*)/,i=[];0<e.length;){var n=e.match(t);if(null===n){i.push(e.replace(/\\{/g,"{").replace(/\\}/g,"}"));break}var r=n[1],a=n[2],n=(e=n[3],0<r.length&&i.push(r.replace(/\\{/g,"{").replace(/\\}/g,"}")),JSON.parse(a.replace(/\\/g,"\\\\")));if(!n.hasOwnProperty("rt")||!n.hasOwnProperty("rb"))throw g.ExceptionFactory.createTypeMismatchError("parse","RubyFragment");n.rt=n.rt.replace(/\\{/g,"{").replace(/\\}/g,"}"),n.rb=n.rb.replace(/\\{/g,"{").replace(/\\}/g,"}"),n.text=a,i.push(n)}return i}},{}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RubyFragmentDrawInfo=i.StringDrawInfo=void 0;function n(e,t,i,n,r,a){this.text=e.text,this.fragment=e,this.width=t,this.rbWidth=i,this.rtWidth=n,this.glyphs=r,this.rubyGlyphs=a}i.StringDrawInfo=function(e,t,i){this.text=e,this.width=t,this.glyphs=i};i.RubyFragmentDrawInfo=n},{}],6:[function(e,t,i){"use strict";var n,r,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),y=e("./RubyParser"),p=e("./FragmentDrawInfo"),s=e("./DefaultRubyParser"),e=(r=g.CacheableE,a(o,r),o.prototype.invalidate=function(){this._invalidateSelf(),r.prototype.invalidate.call(this)},o.prototype.renderCache=function(e){if(this.rubyEnabled||0!==this.fontSize){e.save();for(var t=0,i=0;i<this._lines.length;++i)0<this._lines[i].width&&0<this._lines[i].height&&e.drawImage(this._lines[i].surface,0,0,this._lines[i].width,this._lines[i].height,this._offsetX(this._lines[i].width),t),t+=this._lines[i].height+this.lineGap;this.textColor&&(e.setCompositeOperation("source-atop"),e.fillRect(0,0,this._lineBreakWidth,this.height,this.textColor)),e.restore()}},o.prototype.destroy=function(){this._destroyLines(),r.prototype.destroy.call(this)},o.prototype.calculateCacheSize=function(){return{width:Math.ceil(this._lines.reduce(function(e,t){return Math.max(e,t.width)},this.width)),height:this.height}},Object.defineProperty(o.prototype,"lineCount",{get:function(){return this._lines.length},enumerable:!1,configurable:!0}),o.prototype._offsetX=function(e){switch(this.textAlign){case"left":case g.TextAlign.Left:return 0;case"right":case g.TextAlign.Right:return this._lineBreakWidth-e;case"center":case g.TextAlign.Center:return(this._lineBreakWidth-e)/2;default:return 0}},o.prototype._destroyLines=function(){for(var e=0;e<this._lines.length;e++)this._lines[e].surface&&!this._lines[e].surface.destroyed()&&this._lines[e].surface.destroy();this._lines=void 0},o.prototype._invalidateSelf=function(){if(this.fontSize<0)throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: fontSize must not be negative.");if(this.lineGap<-1*this.fontSize)throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: lineGap must be greater than -1 * fontSize.");this._beforeWidth!==this.width&&(this._lineBreakWidth=this.width),(this._beforeText!==this.text||this._beforeFontSize!==this.fontSize||this._beforeFont!==this.font||this._beforeLineBreak!==this.lineBreak||this._beforeWidth!==this.width&&!0===this._beforeLineBreak||this._beforeTextAlign!==this.textAlign||this._beforeRubyEnabled!==this.rubyEnabled||this._beforeFixLineGap!==this.fixLineGap||this._beforeTrimMarginTop!==this.trimMarginTop||this._beforeWidthAutoAdjust!==this.widthAutoAdjust||this._isDifferentRubyOptions(this._beforeRubyOptions,this.rubyOptions))&&this._updateLines(),this.widthAutoAdjust&&(this.width=Math.ceil(this._lines.reduce(function(e,t){return Math.max(e,t.width)},0)));for(var e=this.lineGap*(this._lines.length-1),t=0;t<this._lines.length;t++)e+=this._lines[t].height;this.height=e,this._beforeText=this.text,this._beforeTextAlign=this.textAlign,this._beforeFontSize=this.fontSize,this._beforeLineBreak=this.lineBreak,this._beforeFont=this.font,this._beforeWidth=this.width,this._beforeRubyEnabled=this.rubyEnabled,this._beforeFixLineGap=this.fixLineGap,this._beforeTrimMarginTop=this.trimMarginTop,this._beforeWidthAutoAdjust=this.widthAutoAdjust,this._beforeRubyOptions.rubyFontSize=this.rubyOptions.rubyFontSize,this._beforeRubyOptions.rubyFont=this.rubyOptions.rubyFont,this._beforeRubyOptions.rubyGap=this.rubyOptions.rubyGap,this._beforeRubyOptions.rubyAlign=this.rubyOptions.rubyAlign},o.prototype._updateLines=function(){for(var e=this.rubyEnabled?this.rubyParser(this.text.replace(/\r\n|\n/g,"\r")):[this.text],e=y.flatmap(e,function(e){return"string"!=typeof e?e:e.replace(/\r\n|\n/g,"\r").match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[]}),t=this._divideToLines(e),i=[],n=this._beforeFontSize===this.fontSize&&this._beforeFont===this.font&&!this._isDifferentRubyOptions(this._beforeRubyOptions,this.rubyOptions),r=0;r<t.length;r++){var a=t[r],s=this._lines[r];n&&void 0!==s&&a.sourceText===s.sourceText&&a.width===s.width&&a.height===s.height?i.push(s):(s&&s.surface&&!s.surface.destroyed()&&s.surface.destroy(),this._drawLineInfoSurface(a),i.push(a))}for(r=i.length;r<this._lines.length;r++)(s=this._lines[r]).surface&&!s.surface.destroyed()&&s.surface.destroy();this._lines=i},o.prototype._drawLineInfoSurface=function(e){for(var t=e.fragmentDrawInfoArray,i=this._calcRubyHeightInfo(t),n=this.scene.game.resourceFactory.createSurface(Math.ceil(e.width),Math.ceil(e.height)),r=n.renderer(),a=(r.begin(),r.save(),i.hasRubyFragmentDrawInfo||this.fixLineGap?this.rubyOptions.rubyGap+i.maxRubyGlyphHeightWithOffsetY:0),s=e.minMinusOffsetY,o=0;o<t.length;o++){var h=t[o];h instanceof p.RubyFragmentDrawInfo?this._drawRubyFragmentDrawInfo(r,h,a-s,-i.minRubyMinusOffsetY):h instanceof p.StringDrawInfo&&this._drawStringGlyphs(r,this.font,h.glyphs,this.fontSize,0,a-s,0),r.translate(h.width,0)}r.restore(),r.end(),e.surface=n},o.prototype._drawStringGlyphs=function(e,t,i,n,r,a,s){void 0===s&&(s=0),e.save(),e.translate(r,a);for(var o=0;o<i.length;o++){var h=i[o],c=n/t.size,l=h.advanceWidth*c;(h.isSurfaceValid||(h=this._createGlyph(h.code,t)))&&(e.save(),e.transform([c,0,0,c,0,0]),0<h.width&&0<h.height&&e.drawImage(h.surface,h.x,h.y,h.width,h.height,h.offsetX,h.offsetY),e.restore(),e.translate(l+s,0))}e.restore()},o.prototype._drawRubyFragmentDrawInfo=function(e,t,i,n){var r,a,s,o,h=t.fragment,c=("rubyFontSize"in h?h:this.rubyOptions).rubyFontSize,l=("rubyAlign"in h?h:this.rubyOptions).rubyAlign,h=("rubyFont"in h?h:this.rubyOptions).rubyFont,d=t.rtWidth>t.rbWidth,p=t.width,u=t.rtWidth,f=t.rbWidth;switch(l){case y.RubyAlign.Center:o=s=0,r=d?0:(p-u)/2,a=d?(p-f)/2:0;break;case y.RubyAlign.SpaceAround:s=0<t.rubyGlyphs.length?(p-u)/t.rubyGlyphs.length:0,o=0,r=d?0:s/2,a=d?(p-f)/2:0;break;default:throw g.ExceptionFactory.createAssertionError("Label#_drawRubyFragmentDrawInfo: unknown rubyAlign.")}this._drawStringGlyphs(e,this.font,t.glyphs,this.fontSize,a,i,o),this._drawStringGlyphs(e,h,t.rubyGlyphs,c,r,n,s)},o.prototype._calcRubyHeightInfo=function(e){for(var t,i=this.rubyOptions.rubyFontSize,n=0,r=this.rubyOptions.rubyGap,a=!1,s=0,o=0;o<e.length;o++){var h,c,l,d=e[o];d instanceof p.RubyFragmentDrawInfo&&((c=d.fragment).rubyFontSize>i&&(i=c.rubyFontSize),c.rubyGap>r&&(r=c.rubyGap),h=(c.rubyFontSize||this.rubyOptions.rubyFontSize)/(c.rubyFont?c:this.rubyOptions).rubyFont.size,l=Math.max.apply(Math,d.rubyGlyphs.map(function(e){return 0<e.offsetY?e.height+e.offsetY:e.height})),d=Math.min.apply(Math,d.rubyGlyphs.map(function(e){return 0<e.offsetY?e.offsetY:0})),n<l*h&&(n=l*h),c=c.rubyFont||this.rubyOptions.rubyFont,c=this._calcStandardOffsetY(c),s<(l=(l-Math.min(d,c))*h)&&(s=l,t=Math.min(d,c)*h),a=!0)}return{maxRubyFontSize:i,maxRubyGlyphHeightWithOffsetY:n=0===n?this.rubyOptions.rubyFontSize:n,minRubyMinusOffsetY:this.trimMarginTop?t:0,maxRubyGap:r,hasRubyFragmentDrawInfo:a}},o.prototype._divideToLines=function(e){for(var t={resultLines:[],currentStringDrawInfo:new p.StringDrawInfo("",0,[]),currentLineInfo:{sourceText:"",fragmentDrawInfoArray:[],width:0,height:0,minMinusOffsetY:0,surface:void 0},reservedLineBreakPosition:null},i=0;i<e.length;i++)this._addFragmentToState(t,e,i);return this._flushCurrentStringDrawInfo(t),this._feedLine(t),t.resultLines},o.prototype._addFragmentToState=function(e,t,i){var n,r,a=t[i];null!==e.reservedLineBreakPosition&&e.reservedLineBreakPosition--,0===e.reservedLineBreakPosition&&(this._flushCurrentStringDrawInfo(e),this._feedLine(e),e.reservedLineBreakPosition=null),"string"==typeof a&&"\r"===a?(this._flushCurrentStringDrawInfo(e),this._feedLine(e)):"string"==typeof a?(n=g.Util.charCodeAt(a,0))&&(n=this._createGlyph(n,this.font))&&(r=this.fontSize/this.font.size,r=n.advanceWidth*r,this._needBreakLine(e,r)&&this._breakLine(e,t,i),e.currentStringDrawInfo.width+=r,e.currentStringDrawInfo.glyphs.push(n),e.currentStringDrawInfo.text+=a):(r=this._createRubyFragmentDrawInfo(a)).width<=0||(this._flushCurrentStringDrawInfo(e),this._needBreakLine(e,r.width)&&this._breakLine(e,t,i),e.currentLineInfo.width+=r.width,e.currentLineInfo.fragmentDrawInfoArray.push(r),e.currentLineInfo.sourceText+=a.text)},o.prototype._createStringGlyph=function(e,t){for(var i=[],n=0;n<e.length;n++){var r=g.Util.charCodeAt(e,n);r&&((r=this._createGlyph(r,t))&&i.push(r))}return i},o.prototype._createGlyph=function(e,t){t=t.glyphForCharacter(e);return t||(e=4294901760&e?String.fromCharCode((4294901760&e)>>>16,65535&e):String.fromCharCode(e),console.warn("Label#_invalidateSelf(): failed to get a glyph for '"+e+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")),t},o.prototype._createRubyFragmentDrawInfo=function(e){var t=this._createStringGlyph(e.rb,this.font),i=this._createStringGlyph(e.rt,this.rubyOptions.rubyFont),n=("rubyFont"in e?e:this.rubyOptions).rubyFont,r=("rubyFontSize"in e?e:this.rubyOptions).rubyFontSize,a=this.fontSize/this.font.size,r=r/n.size,n=0<t.length?t.map(function(e){return e.advanceWidth}).reduce(function(e,t){return e+t})*a:0,a=0<i.length?i.map(function(e){return e.advanceWidth}).reduce(function(e,t){return e+t})*r:0;return new p.RubyFragmentDrawInfo(e,a<n?n:a,n,a,t,i)},o.prototype._flushCurrentStringDrawInfo=function(e){0<e.currentStringDrawInfo.width&&(e.currentLineInfo.fragmentDrawInfoArray.push(e.currentStringDrawInfo),e.currentLineInfo.width+=e.currentStringDrawInfo.width,e.currentLineInfo.sourceText+=e.currentStringDrawInfo.text),e.currentStringDrawInfo=new p.StringDrawInfo("",0,[])},o.prototype._feedLine=function(e){var t=this.fontSize/this.font.size,i=1/0,n=0,r=0,a=(e.currentLineInfo.fragmentDrawInfoArray.forEach(function(e){e.glyphs.forEach(function(e){n>e.offsetY&&(n=e.offsetY),i>e.offsetY&&(i=e.offsetY);e=0<e.offsetY?e.height+e.offsetY:e.height;r<e&&(r=e)})}),n*=t,r=0<e.currentLineInfo.fragmentDrawInfoArray.length?r*t-n:this.fontSize,r=Math.ceil(r),this._calcRubyHeightInfo(e.currentLineInfo.fragmentDrawInfoArray));e.currentLineInfo.height=a.hasRubyFragmentDrawInfo||this.fixLineGap?r+a.maxRubyGlyphHeightWithOffsetY+a.maxRubyGap:r,e.currentLineInfo.minMinusOffsetY=n,this.trimMarginTop&&(a=Math.min(i,this._calcStandardOffsetY(this.font))*t,e.currentLineInfo.height-=a,e.currentLineInfo.minMinusOffsetY+=a),e.resultLines.push(e.currentLineInfo),e.currentLineInfo={sourceText:"",fragmentDrawInfoArray:[],width:0,height:0,minMinusOffsetY:0,surface:void 0}},o.prototype._needBreakLine=function(e,t){return this.lineBreak&&0<t&&null===e.reservedLineBreakPosition&&e.currentLineInfo.width+e.currentStringDrawInfo.width+t>this._lineBreakWidth&&0<e.currentLineInfo.width+e.currentStringDrawInfo.width},o.prototype._isDifferentRubyOptions=function(e,t){return e.rubyFontSize!==t.rubyFontSize||e.rubyFont!==t.rubyFont||e.rubyGap!==t.rubyGap||e.rubyAlign!==t.rubyAlign},o.prototype._calcStandardOffsetY=function(e){return e.glyphForCharacter("M".charCodeAt(0)).offsetY},o.prototype._breakLine=function(e,t,i){if(this.lineBreakRule){var n=this.lineBreakRule(t,i)-i;if(0===n)this._flushCurrentStringDrawInfo(e),this._feedLine(e);else if(0<n)e.reservedLineBreakPosition=n;else{this._flushCurrentStringDrawInfo(e);for(var r=[];n<0;){var a,s,o,h=e.currentLineInfo.fragmentDrawInfoArray,c=h[h.length-1];c instanceof p.RubyFragmentDrawInfo?(n++,r.push(c),h.pop()):-n>=c.text.length?(n+=c.text.length,r.push(c),h.pop()):(h=c.glyphs.splice(n),a=this.fontSize/this.font.size,s=h.reduce(function(e,t){return t.advanceWidth*a+e},0),c.width-=s,o=c.text.substring(c.text.length+n),c.text=c.text.substring(0,c.text.length+n),r.push(new p.StringDrawInfo(o,s,h)),n=0)}var l=0,d="",t=(r.forEach(function(e){l+=e.width,d+=e.text}),e.currentLineInfo.width-=l,e.currentLineInfo.sourceText);e.currentLineInfo.sourceText=t.substr(0,t.length-d.length),this._feedLine(e),e.currentLineInfo.fragmentDrawInfoArray=r,e.currentLineInfo.width=l,e.currentLineInfo.sourceText=d}}else this._flushCurrentStringDrawInfo(e),this._feedLine(e)},o);function o(e){var t=r.call(this,e)||this;return t.text=e.text,t.font=e.font,t.fontSize=e.fontSize||e.font.size,t._lineBreakWidth=e.width,t.lineBreak=!("lineBreak"in e)||e.lineBreak,t.lineGap=e.lineGap||0,t.textAlign="textAlign"in e?e.textAlign:"left",t.textColor=e.textColor,t.trimMarginTop="trimMarginTop"in e&&e.trimMarginTop,t.widthAutoAdjust="widthAutoAdjust"in e&&e.widthAutoAdjust,t.rubyEnabled=!("rubyEnabled"in e)||e.rubyEnabled,t.fixLineGap="fixLineGap"in e&&e.fixLineGap,t.rubyParser="rubyParser"in e?e.rubyParser:s.parse,t.lineBreakRule="lineBreakRule"in e?e.lineBreakRule:void 0,e.rubyOptions||(e.rubyOptions={}),t.rubyOptions=e.rubyOptions,t.rubyOptions.rubyFontSize="rubyFontSize"in e.rubyOptions?e.rubyOptions.rubyFontSize:e.fontSize/2,t.rubyOptions.rubyFont="rubyFont"in e.rubyOptions?e.rubyOptions.rubyFont:t.font,t.rubyOptions.rubyGap="rubyGap"in e.rubyOptions?e.rubyOptions.rubyGap:0,t.rubyOptions.rubyAlign="rubyAlign"in e.rubyOptions?e.rubyOptions.rubyAlign:y.RubyAlign.SpaceAround,t._lines=[],t._beforeText=void 0,t._beforeTextAlign=void 0,t._beforeFontSize=void 0,t._beforeLineBreak=void 0,t._beforeFont=void 0,t._beforeWidth=void 0,t._beforeRubyEnabled=void 0,t._beforeFixLineGap=void 0,t._beforeTrimMarginTop=void 0,t._beforeWidthAutoAdjust=void 0,t._beforeRubyOptions={},t._invalidateSelf(),t}t.exports=e},{"./DefaultRubyParser":4,"./FragmentDrawInfo":5,"./RubyParser":7}],7:[function(e,t,i){"use strict";var n;Object.defineProperty(i,"__esModule",{value:!0}),i.flatmap=i.RubyAlign=void 0,(n=i.RubyAlign||(i.RubyAlign={}))[n.Center=0]="Center",n[n.SpaceAround=1]="SpaceAround",i.flatmap=function(e,t){return Array.prototype.concat.apply([],e.map(t))}},{}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.defaultRubyParser=i.RubyAlign=void 0,i.Label=e("./Label"),i.FragmentDrawInfo=e("./FragmentDrawInfo"),i.RubyParser=e("./RubyParser"),i.RubyAlign=i.RubyParser.RubyAlign;e=e("./DefaultRubyParser");i.defaultRubyParser=e.parse},{"./DefaultRubyParser":4,"./FragmentDrawInfo":5,"./Label":6,"./RubyParser":7}],9:[function(e,t,i){"use strict";var M=this&&this.__assign||function(){return(M=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},E=(Object.defineProperty(i,"__esModule",{value:!0}),i.FallbackDialog=void 0,e("@akashic-extension/akashic-hover-plugin")),O=e("@akashic-extension/akashic-hover-plugin/lib/HoverPlugin");function L(e,t,i,n,r){for(var a=i-n|0;a<=Math.ceil(i+n);++a){var s=n*Math.cos(Math.asin((i-a)/n));e.fillRect(t-s,a,2*s,1,r)}}function F(e,t,i){e=g.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(t)),t=e.renderer();return t.begin(),i(t),t.end(),e}function A(n,r){var a=new g.Trigger,e=1e3/g.game.fps,s=0,o=0,h=r[0],c=!1;function t(e){(o+=e)>h.duration&&((c=++s>=r.length)?(o=h.duration,n.scene.onUpdate.addOnce(a.fire,a)):(o-=h.duration,h=r[s]));var e=Math.min(1,o/h.duration),t=h.scale,i=h.opacity;return t&&(n.scaleX=n.scaleY=t[0]+(t[1]-t[0])*e),i&&(n.opacity=i[0]+(i[1]-i[0])*e),n.modified(),c}return t(0),n.onUpdate.add(function(){return t(e)}),a}function j(e){var t,i,n,r,a,s,o,h,c,l,d,p,u,f,y,m,v,w,b,P,x,_,I,S,D,k,C=this;function z(e){return new g.Label(M({scene:v,font:u,local:!0,textAlign:g.TextAlign.Center,widthAutoAdjust:!1},e))}this.onEnd=new g.Trigger,this.isHoverPluginStarted=!1,this.timer=null,j.isSupported()&&(x=(t=g.game).width,w=t.height,i=x/1280,n=Math.round(32*i),r=Math.round(28*i),h=360*i,l="#4a8de1",d="#fff",p=960*i|0,b=(a=80*i)+1.3*n*2+(s=32*i)+(r+1.3*r)+(o=42*i)+(c=82*i)+72*i|0,u=new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.SansSerif,size:n,fontWeight:g.FontWeight.Bold,fontColor:"#252525"}),D=-2&Math.ceil(32*i),f=D/2,P=F(D,D,function(e){L(e,f,f,f,d)}),y=F(D,D,function(e){L(e,f,f,f,l)}),m=F(D,D,function(e){L(e,f,f,f,l),L(e,f,f,12*i,d)}),v=this.scene=t.scene(),D=this.bgRect=new g.FilledRect({scene:v,local:!0,width:x,height:w,cssColor:"rgba(0, 0, 0, 0.5)",touchable:!0}),x=0,(w=this.dialogPane=new g.Pane({scene:v,local:!0,width:p,height:b,anchorX:.5,anchorY:.5,x:t.width/2|0,y:t.height/2|0,backgroundImage:P,backgroundEffector:new g.NinePatchSurfaceEffector(t,P.width/2-1),parent:D})).append(z({x:b=80*i|0,y:x+=a+.3*n|0,text:"このコンテンツは名前を利用します。",fontSize:n,width:P=800*i|0})),w.append(z({x:b,y:x+=1.3*n|0,text:"あなたは「"+e+"」です。",fontSize:n,width:P})),w.append(z({x:b,y:x+=n+s|0,text:"ユーザ名で参加するには、",fontSize:r,width:P})),w.append(z({x:b,y:x+=1.3*r|0,text:"最新のニコニコ生放送アプリに更新してください。",fontSize:r,width:P})),x+=r+o|0,_=new g.Pane({scene:v,local:!0,width:h,height:c,x:p/2,y:x+c/2,anchorX:.5,anchorY:.5,backgroundImage:m,backgroundEffector:new g.NinePatchSurfaceEffector(t,m.width/2-1),parent:v,touchable:!0}),w.append(_),I=this.buttonLabel=z({x:0,y:(c-n)/2-5*i,text:"OK (15)",fontSize:n,width:h,textColor:l}),_.append(I),S=function(){_.backgroundImage=y,_.invalidate(),I.textColor=d,I.invalidate()},D=E.Converter.asHoverable(_),k=!1,D.hovered.add(function(){S(),k||(k=!0,A(_,[{duration:16,scale:[1,.9]},{duration:16,scale:[.9,1.1]},{duration:33,scale:[1.1,1]}]).add(function(){return k=!1}))}),D.unhovered.add(function(){_.backgroundImage=m,_.invalidate(),I.textColor=l,I.invalidate()}),_.onPointDown.add(S),_.onPointUp.add(function(){C.end()}),t.operationPluginManager.plugins[j.HOVER_PLUGIN_OPCODE]||t.operationPluginManager.register(O,j.HOVER_PLUGIN_OPCODE))}j.isSupported=function(){return"undefined"!=typeof window&&.4<=g.game.height/g.game.width&&O.isSupported()},j.prototype.start=function(e){var t=this,i=g.game,n=this.scene;i.scene()===n&&(i.onSceneChange.add(this._disablePluginOnSceneChange,this),i.operationPluginManager.start(j.HOVER_PLUGIN_OPCODE),this.isHoverPluginStarted=!0,A(this.dialogPane,[{duration:100,scale:[.5,1.1],opacity:[.5,1]},{duration:100,scale:[1.1,1],opacity:[1,1]}]),n.append(this.bgRect),n.onUpdate.add(this._assureFrontmost,this),this.timer=n.setInterval(function(){--e,t.buttonLabel.text="OK ("+e+")",t.buttonLabel.invalidate(),e<=0&&t.end()},1e3))},j.prototype.end=function(){var t=this;this.timer&&(this.scene.clearInterval(this.timer),this.timer=null),this.scene.onUpdate.remove(this._assureFrontmost,this),this.isHoverPluginStarted&&(g.game.operationPluginManager.stop(j.HOVER_PLUGIN_OPCODE),this.isHoverPluginStarted=!1),A(this.dialogPane,[{duration:100,opacity:[1,0],scale:[1,.8]}]),A(this.bgRect,[{duration:100,opacity:[1,0]}]).add(function(){var e=t.onEnd;t.onEnd=null,t.bgRect.destroy(),t.bgRect=null,t.dialogPane=null,t.scene=null,e.fire()})},j.prototype._disablePluginOnSceneChange=function(e){if(e!==this.scene)return g.game.operationPluginManager.stop(j.HOVER_PLUGIN_OPCODE),!0},j.prototype._assureFrontmost=function(){g.game._pushPostTickTask(this._doAssureFrontmost,this)},j.prototype._doAssureFrontmost=function(){var e=this.scene;e&&g.game.scene()!==e||e.children[e.children.length-1]!==this.bgRect&&(this.bgRect.remove(),e.append(this.bgRect))},j.HOVER_PLUGIN_OPCODE=-1e3,i.FallbackDialog=j},{"@akashic-extension/akashic-hover-plugin":3,"@akashic-extension/akashic-hover-plugin/lib/HoverPlugin":2}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.resolvePlayerInfo=void 0;var r=e("./FallbackDialog"),n="undefined"!=typeof window?window.RPGAtsumaru:void 0;function a(){return"ゲスト"+(1e3*Math.random()|0)}var s=[{isSupported:function(){return!!(n&&n.user&&n.user.getSelfInformation)},resolve:function(e,t){n.user.getSelfInformation().then(function(e){t(null,{name:e.name,userData:{accepted:!0,premium:e.isPremium}})},function(e){t(e,null)})}},{isSupported:function(){var e=g.game.external.coeLimited;return!!(e&&e.startLocalSession&&e.exitLocalSession)},resolve:function(e,t){var i=g.game.playId+"__player-info-resolver",n=g.game.scene(),r=n.setTimeout(function(){t(r=null,{name:null,userData:{accepted:!1,premium:!1}}),g.game.external.coeLimited.exitLocalSession(i,{needsResult:!0})},1e3*(e+2));g.game.external.coeLimited.startLocalSession({sessionId:i,applicationName:"player-info-resolver",localEvents:[[32,0,":akashic",{type:"start",parameters:{limitSeconds:e}}]],messageHandler:function(e){null!=r&&(n.clearTimeout(r),t(null,e.result))}})}},{isSupported:function(){var e=g.game.external.atsumaru;return!(!e||!e.getSelfInformationProto)},resolve:function(e,i){g.game.external.atsumaru.getSelfInformationProto({callback:function(e,t){null!=e?i(new Error(e),null):t&&t.login?i(null,{name:t.name,userData:{accepted:!0,premium:t.premium}}):i(null,{name:a(),userData:{accepted:!1,premium:!1}})}})}},{isSupported:r.FallbackDialog.isSupported,resolve:function(e,t){var i=a(),n=new r.FallbackDialog(i);n.start(e),n.onEnd.addOnce(function(){t(null,{name:i,userData:{accepted:!1,premium:!1}})})}},{isSupported:function(){return!0},resolve:function(e,t){t(null,{name:"",userData:{accepted:!1,premium:!1,unnamed:!0}})}}],o=!1;i.resolvePlayerInfo=function(i,n){if(o)null!=n&&n(new Error("Last processing has not yet been completed."),null);else{var t=function(e,t){o=!1,null!=n&&n(e,t),e||(e=t.name,t=t.userData,!i||!i.raises||t&&t.unnamed||g.game.raiseEvent(new g.PlayerInfoEvent({id:g.game.selfId,name:e,userData:t})))},e=i&&i.limitSeconds?i.limitSeconds:15,r=function(e,t){for(var i=0;i<e.length;++i)if(t(e[i]))return e[i]}(s,function(e){return e.isSupported()});try{o=!0,r.resolve(e,t)}catch(e){t(e)}}}},{"./FallbackDialog":9}],11:[function(e,t,i){"use strict";function n(e){this.x=e.x,this.y=e.y,this.vx=e.vx,this.vy=e.vy,this.av=e.av,this.angle=e.angle,this.M=e.M,this.K=e.K,this.I=e.I,this.RD=e.RD,this.fins=e.fins}Object.defineProperty(i,"__esModule",{value:!0}),n.prototype.update=function(e,t,i,n,r){var a=this.calcFinForce(e,this.fins),t=(t+a.fx-this.vx*this.K)/this.M+n,n=(i+a.fy-this.vy*this.K)/this.M+r,i=(this.vx+=t*e,this.vy+=n*e,this.x+=this.vx*e,this.y+=this.vy*e,a.tau/this.I);this.av+=i*e,this.av*=this.RD,this.angle+=this.av*e},n.prototype.calcFinForce=function(e,t){for(var i=0,n=0,r=0,a=0;a<t.length;a++){var s=t[a],o=this.angle+s.armAngle,h=Math.cos(o),o=Math.sin(o),c=this.angle+s.armAngle+s.angle,l=Math.cos(c),c=Math.sin(c),d=this.vx-o*this.av*s.armLength,p=this.vy+h*this.av*s.armLength,d=l*(-d*this.K*s.size)+c*(-p*this.K*s.size),p=d*l,l=d*c,d=(i+=(h*l-o*p)*s.armLength,h*p+o*l);n+=d*h,r+=d*o}return{tau:i,fx:n,fy:r}},i.Confetti=n},{}],12:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Animation=void 0;var r=e("kamihubuki-js");function n(e){this._confettiMabiku=0,this.scene=e,this.display=new g.E({scene:e}),this.animationg=!1,this._confittis=new Array}function a(e,t){t=t-e+1;return Math.floor(Math.random()*t)+e}n.prototype.start=function(){this.animationg=!0,this.scene.onUpdate.add(this.confettiAnimation,this)},n.prototype.stop=function(){this.animationg=!1,this.scene.onUpdate.remove(this.confettiAnimation,this);for(var e=0,t=this._confittis;e<t.length;e++){var i=t[e];i.destroyed()||i.destroy()}this._confittis=new Array},n.prototype.confettiAnimation=function(){var e;g.game.isSkipping||this.animationg&&(this._confettiMabiku=++this._confettiMabiku%3,0==this._confettiMabiku&&(e=this.createConfetti(a(0,g.game.width),-5),e=this.createConfettiEntity(e,!0),this.display.append(e)))},n.prototype.createConfetti=function(e,t){var i=a(0,100)/100*Math.PI,n=[{angle:a(-100,100)/100*(Math.PI/2),size:30,armAngle:0,armLength:1},{angle:a(-100,100)/100*(Math.PI/2),size:30,armAngle:a(50,100)/100*Math.PI,armLength:1}];return new r.Confetti({x:e,y:t,vx:0,vy:200,angle:i,fins:n,av:0,M:.5,K:.02,I:3,RD:.99})},n.prototype.createConfettiEntity=function(e,t){var i=new g.FilledRect({scene:this.scene,width:20,height:10,x:e.x-10,y:e.y-5,local:!0,cssColor:n.colors[n.colorIndex]});return this._confittis.push(i),n.colorIndex=(n.colorIndex+1)%n.colors.length,i.onUpdate.add(function(){e.update(1/g.game.fps,n.windX,n.windY,0,200),t?(e.x<0||e.x>g.game.width||e.y>g.game.height)&&i.destroy():(e.x<0?(e.x=0,e.vx=.5*Math.abs(e.vx)):e.x>g.game.width&&(e.x=g.game.width,e.vx=.5*-Math.abs(e.vx)),e.y<-g.game.height?(e.y=-g.game.height,e.vy=0):e.y>g.game.height&&(e.y=g.game.height,e.vy=.5*-Math.abs(e.vy))),i.x=e.x-10,i.y=e.y-5,i.angle=-e.angle/Math.PI*180,i.modified()}),i},n.windX=0,n.windY=0,n.colors=["blue","navy","teal","green","lime","aqua","yellow","red","fuchsia","olive","purple","maroon"],n.colorIndex=0,i.Animation=n},{"kamihubuki-js":11}],13:[function(e,t,i){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=(Object.defineProperty(i,"__esModule",{value:!0}),i.CreatePuzzle=void 0,e("@akashic-extension/akashic-label")),h=e("./events/userPazzle"),c=e("./lib/funcs"),s=e("./lib/jpeg/decoder"),o=e("./models/BitmapImage"),l=e("./params"),d=e("./models/Slider"),p=e("./models/StrokeRect"),u=e("./lib/jpeg/encoder");function n(t,e,i){var a=this,n=(this.isEdit=!0,this.pieceSize={width:0,height:0},this.matrix={x:0,y:0},this.sum=0,this.capacity=0,this.puzzleSize={width:0,height:0},this.puzzleOrigin={x:0,y:0},this.scene=t,this.start=e,this.back=i,this.display=new g.E({scene:t,width:g.game.width,height:g.game.height}),this.previewPanel=new g.FilledRect({scene:t,parent:this.display,cssColor:"rgba(0,0,0)",width:770,height:460,x:25,y:35}),c.createScrollLabel({scene:t,parent:this.display,cssColor:"rgba(0,0,0,0.9)",width:770,height:460,x:25,y:35,touchable:!0},{scene:t,font:c.newFont("sans-serif",35,"white"),text:"\n\n   ---- HELP（HELP!ボタンで閉じます）----\n\n\n\n\nここに画像をドラッグ&ドロップしてください\n\n（生主のみ可能です。PCからのみ可能です）\n\n\n\n「この画像にする」ボタンで画像を送信します\n\n送信後にピース分割数を決めれます\n\n（右上に書いている容量分通信します）\n\n\n\n赤い枠線は、実際にパズルになる領域です\n\nドラッグで移動できます\n\n\n\n一度送信した後に画像を変える場合は\n\nゲームを貼り直した方が良いです\n\n（前の画像分無駄に重くなってしまうため）\n\n\n\nゲーム開始後およそ２分間（非同期中）\n\n・ピースをはめることが出来ません\n\n・操作が他人と共有されません\n\n\n\n\n\n[よくありそうなQ&A]\n\n\nQ.この画像にするボタンが反応しません\n\nA.画像は　80x80　以上にして下さい\n\n   それでも動かないなら、少し待って下さい\n\n\nQ.開始ボタンが反応しません\n\nA.パズルは　２行２列　以上にして下さい\n\n   それでも動かないなら、少し待って下さい\n\n\nQ.他の人はピースを動かしているのに\n\n   自分はピースを動かせません\n\nA.画像送信後の非同期中に参加をすると\n\n   稀に参加出来ないことがあるようです\n\n   リロードして参加しなおして下さい\n\n\nQ.ゲーム開始後すぐ動かないのが嫌だ\n\nA.画像容量が 80KB 以下ならすぐ動くかも\n\n  （容量はあくまで目安なので）\n\n\nQ.スマホではできませんか？\n\nA.出来ません。ごめんなさい。\n\n\n",lineGap:-17,width:0,x:10}));c.createFillLabel({scene:t,parent:this.display,cssColor:"#00C24E",x:840,y:600,height:100,width:230,touchable:!0},{scene:t,font:c.newFont("sans-serif",65,"white"),text:"HELP!",textAlign:"center",y:5,width:0}).onPointDown.add(function(){n.visible()?n.hide():n.show()}),this.EditInfo(),l.GameParams.isOwner&&(c.addDragDrop(function(e){return a.onDragDrop(e)}),this.LiverOnlyUI()),t.addReceiveMethod(h.ChangePage.receive(this.ChangePage),this),t.addReceiveMethod(h.ShareImageStart.receive(function(e){var e=e.param,i=e.width,n=e.height,e=e.segmentCount,r=new Array(e);t.addReceiveMethod(h.ShareImageData.receive(function(e){var e=e.param,t=e.index,e=e.jpgByteChars;r[t]=e}),a),t.addReceiveMethod(h.ShareImageFinish.receive(function(e){var t=r.reduce(function(e,t){return e+t},"");a.ShareImage({param:{width:i,height:n,jpgByteChars:t},type:h.ShareImageFinish.TYPE})}),a)}),this),t.addReceiveMethod(h.Edit.receive(this.Edit),this)}n.prototype.ChangePage=function(e){c.removeDropFile(),this.display.destroy(),this.scene.removeReceiveMethod(h.ChangePage.receive(this.ChangePage),this),this.scene.removeReceiveMethod(h.Edit.receive(this.Edit),this),"T"==e.param.page?this.back():(this.preview.scale(1),this.preview.modified(),this.start({scene:this.scene,level:-1,wakus:[].concat.apply([],this.scene.assetManager.wakus),pazzleID:-1,previewSrc:g.SpriteFactory.createSpriteFromE(this.scene,this.preview),difficulty:{count:this.sum,size:this.pieceSize,origin:this.puzzleOrigin}}))},n.prototype.ShareImage=function(e){l.GameParams.isOwner&&(c.removeDropFile(),this.shareBtn.destroy(),this.SharedLiverOnlyUI(),!g.game.isSkipping)?this.border.show():this.CreateImage(e.param)},n.prototype.CreateImage=function(e){for(var t=this,i=(null!=(r=this.previewPanel.children)&&r.pop(),this.capacity=encodeURIComponent(e.jpgByteChars).replace(/%../g,"x").length,this.capacity=Math.floor(1.1*this.capacity),[]),n=0;n<e.jpgByteChars.length;n++)i.push(e.jpgByteChars[n].charCodeAt(0));var r=s.decode(new Uint8Array(i)),r={data:Uint8ClampedArray.from(r.data),width:r.width,height:r.height};this.preview=new o.BitmapImage({scene:this.scene,parent:this.previewPanel,colorBuffer:r,width:r.width,height:r.height}),c.spriteSet(this.preview,this.previewPanel.width,this.previewPanel.height),this.border=new p.StrokeRect({scene:this.scene,parent:this.preview,borderWidth:4,cssColor:"red",height:0,width:0,touchable:l.GameParams.isOwner,hidden:l.GameParams.isOwner&&!g.game.isSkipping}),this.border.onPointMove.add(function(e){t.puzzleOrigin.x+=e.prevDelta.x/t.preview.scaleX,t.puzzleOrigin.y+=e.prevDelta.y/t.preview.scaleX,t.puzzleOrigin.x<0?t.puzzleOrigin.x=0:t.puzzleOrigin.x>t.preview.width-t.puzzleSize.width&&(t.puzzleOrigin.x=t.preview.width-t.puzzleSize.width),t.puzzleOrigin.y<0?t.puzzleOrigin.y=0:t.puzzleOrigin.y>t.preview.height-t.puzzleSize.height&&(t.puzzleOrigin.y=t.preview.height-t.puzzleSize.height),t.border.x=t.puzzleOrigin.x,t.border.y=t.puzzleOrigin.y,t.border.modified()}),this.border.onPointUp.add(function(){t.scene.send(new h.Edit({type:"Origin",data:[t.puzzleOrigin.x,t.puzzleOrigin.y]}))}),this.EditInfoUpdate()},n.prototype.Edit=function(e){l.GameParams.isOwner&&!g.game.isSkipping||("Size"==e.param.type?(this.pieceSize.width=e.param.data[0],this.pieceSize.height=e.param.data[1],this.EditInfoUpdate()):l.GameParams.isServer||(this.puzzleOrigin={x:e.param.data[0],y:e.param.data[1]},this.border.x=this.puzzleOrigin.x,this.border.y=this.puzzleOrigin.y,this.border.modified()))},n.prototype.EditInfoUpdate=function(){this.matrix.x=Math.floor(this.preview.width/this.pieceSize.width),this.matrix.y=Math.floor(this.preview.height/this.pieceSize.height),this.sum=this.matrix.x*this.matrix.y,this.puzzleSize.width=this.matrix.x*this.pieceSize.width,this.puzzleSize.height=this.matrix.y*this.pieceSize.height,this.puzzleOrigin.x=Math.floor((this.preview.width-this.puzzleSize.width)/2),this.puzzleOrigin.y=Math.floor((this.preview.height-this.puzzleSize.height)/2),this.pieceInfoLabel.text="         -- 画像 --\n\nサイズ "+this.preview.width+" x "+this.preview.height+"\n\n容量 "+this.capacity/1e3+" KB\n\n\n        -- ピース --\n\n合計 "+this.sum+" 枚\n\n行 "+this.matrix.x+" 枚  列 "+this.matrix.y+" 枚\n\n横 "+this.pieceSize.width+" px  縦 "+this.pieceSize.height+" px\n",this.pieceInfoLabel.invalidate(),l.GameParams.isServer&&"atsumaru"!=l.GameParams.operation||(this.border.x=this.puzzleOrigin.x,this.border.y=this.puzzleOrigin.y,this.border.width=this.puzzleSize.width,this.border.height=this.puzzleSize.height,this.border.modified())},n.prototype.EditInfo=function(){this.pieceSize={width:60,height:60};var e=c.newFont("sans-serif",38),t=new g.FilledRect({scene:this.scene,parent:this.display,cssColor:"rgba(176,247,204,0.8)",width:430,height:360,x:830,y:35});this.pieceInfoLabel=new a.Label({scene:this.scene,font:e,parent:t,text:"         -- 画像 --\n\nサイズ XXXX x XXXX\n\n容量 XXX KB\n\n\n        -- ピース --\n\n合計 XXX 枚\n\n行 XXX 枚  列 XXX 枚\n\n横 XX px  縦 XX px\n",lineGap:-17,width:t.width,x:10,y:10})},n.prototype.SharedLiverOnlyUI=function(){var t=this,e=this.scene,i=new g.FilledRect({scene:e,parent:this.display,cssColor:"rgba(0,194,78,0.8)",height:200,width:600,x:220,y:500}),n=c.newFont("sans-serif",50),n=(new a.Label({scene:e,parent:i,font:n,text:"      ピースサイズ変更\n横幅\n縦幅",lineGap:10,x:7,width:i.width}),{scene:e,parent:i,per:.125,min:40,gripWidth:25,width:460,height:60,x:120}),i=new d.Slider(r(r({},n),{max:200,y:64})),i=(i.onValueChange.add(function(e){t.isEdit&&(t.pieceSize.width=Math.floor(e),t.EditInfoUpdate())}),i.onBarDown.add(function(e){t.isEdit&&t.scene.send(new h.Edit({type:"Size",data:[Math.floor(e),t.pieceSize.height]}))}),i.onSliderUp.add(function(e){t.isEdit&&t.scene.send(new h.Edit({type:"Size",data:[Math.floor(e),t.pieceSize.height]}))}),new d.Slider(r(r({},n),{max:200,y:133})));i.onValueChange.add(function(e){t.isEdit&&(t.pieceSize.height=Math.floor(e),t.EditInfoUpdate())}),i.onBarDown.add(function(e){t.isEdit&&t.scene.send(new h.Edit({type:"Size",data:[t.pieceSize.width,Math.floor(e)]}))}),i.onSliderUp.add(function(e){t.isEdit&&t.scene.send(new h.Edit({type:"Size",data:[t.pieceSize.width,Math.floor(e)]}))}),new g.Sprite({scene:e,parent:this.display,src:e.asset.getImageById("playBtn"),x:1080,y:597,touchable:!0}).onPointDown.add(function(){2<=t.matrix.x&&2<=t.matrix.y&&t.isEdit&&(t.isEdit=!1,e.send(new h.ChangePage({page:"S"})))})},n.prototype.onDragDrop=function(e){var r=this,t=(e.stopPropagation(),e.preventDefault(),new FileReader);t.readAsArrayBuffer(e.dataTransfer.files[0]),t.onload=function(e){e=e.target.result;c.ConvertJpgImage(e).then(function(e){for(var t="",i=u.encode(e),n=0;n<i.data.length;n++)t+=String.fromCharCode(i.data[n]);r.dropData={jpgByteChars:t,width:e.width,height:e.height},r.CreateImage(r.dropData)})}},n.prototype.LiverOnlyUI=function(){var s=this,o=this.scene,e=new g.FilledRect({scene:o,parent:this.display,cssColor:"#00C24E",height:100,width:160,x:20,y:500,touchable:!0});new a.Label({scene:o,parent:e,font:c.newFont("sans-serif",60,"white"),text:"戻る",width:e.width,x:20,y:10}),e.onPointDown.add(function(){g.game.isSkipping||o.send(new h.ChangePage({page:"T"}))}),this.shareBtn=new g.FilledRect({scene:o,parent:this.display,cssColor:"#00C24E",height:100,width:400,x:250,y:550,touchable:!0}),new a.Label({scene:o,parent:this.shareBtn,font:c.newFont("sans-serif",50,"white"),text:" この画像にする",width:this.shareBtn.width,y:15}),this.shareBtn.onPointDown.add(function(){var i,n,r,a;g.game.isSkipping||null!=s.dropData&&80<=s.preview.width&&80<=s.preview.height&&(s.shareBtn.hide(),i=g.game.fps/10,n=Math.ceil(s.dropData.jpgByteChars.length/30720),a=r=0,o.send(new h.ShareImageStart({width:s.dropData.width,height:s.dropData.height,segmentCount:n})),o.onUpdate.add(function e(){var t;++a<=i||(a=0,t=s.dropData.jpgByteChars.substring(30720*r,30720*(r+1)),o.send(new h.ShareImageData({index:r,jpgByteChars:t})),++r===n&&(o.send(new h.ShareImageFinish({})),o.onUpdate.remove(e,s)))},s))})},i.CreatePuzzle=n},{"./events/userPazzle":29,"./lib/funcs":30,"./lib/jpeg/decoder":31,"./lib/jpeg/encoder":32,"./models/BitmapImage":37,"./models/Slider":41,"./models/StrokeRect":43,"./params":45,"@akashic-extension/akashic-label":8}],14:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Jigsaw=void 0;var u=e("./models/Piece"),n=e("./models/Player"),f=e("./PlayingUI"),y=e("./params"),r=e("./Animation"),a=e("./ScoreBoard"),s=e("./models/notice"),m=e("./models/NoticeCardCreats"),o=e("./lib/funcs");function h(e){this.jigsawState="Title",this.players=[],this.isJoinWait=!1,this.me=void 0,this.fitPer=0,this.noticeEvent=new g.Trigger,this.pieces=[],this.fitCount=0,this.isAlignOuter=!1,this.margin={width:0,height:0},this.nameFont=o.newFont("sans-serif",72),this.scene=e.scene,this.noticeViewer=new s.NoticeViewer(this.scene,5e3),this.camera=new g.Camera2D({width:g.game.width,height:g.game.height,anchorX:null}),this.display=new g.E({scene:this.scene}),"atsumaru"==y.GameParams.operation&&(this.scoreBoard=new a.ScoreBoard(this.scene))}Object.defineProperty(h.prototype,"cameraScale",{get:function(){return this.camera.scaleX},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"pieceLimit",{get:function(){return{x:this.pieceLayer.width,y:this.pieceLayer.height}},enumerable:!1,configurable:!0}),h.prototype.samePlayerID=function(t){return this.players.find(function(e){return e.playerID==t})},h.prototype.serverError=function(e){console.log("SERVER ERROR!!\n"+e.message),this.noticeViewer.addNoticeCard(new m.ErrorNoticeCard(this.scene,e.message,this.scene.asset.getAudioById("voice_outer")))},h.prototype.startPazzle=function(e){var t,i,n=this,r=(this.jigsawState="Playing","atsumaru"==y.GameParams.operation&&this.scoreBoard.display.remove(),this.pazzleID=e.pazzleID,this.level=e.level,this.uiLayer=new f.PlayingUI(this.scene,e.title,e.preview),this.uiLayer.result.draw(this.players),this.background=new g.FilledRect({scene:this.scene,parent:this.display,cssColor:this.uiLayer.colors[0],width:g.game.width,height:g.game.height,anchorX:null,touchable:!0}),this.background.isMoveCamera=!0,e.preview),a=(this.preview=r,this.margin={width:r.width,height:r.height},this.pieceLayer=new g.E({scene:this.scene,parent:this.display,width:3*r.width,height:3*r.height}),this.display.append(this.uiLayer.display),this.uiLayer.zoomIn=function(){return n.zoomBy(.9)},this.uiLayer.zoomOut=function(){return n.zoomBy(1.1)},this.uiLayer.colorChange=function(e){n.background.cssColor=e,n.background.modified()},this.uiLayer.hideDisplay=function(){a.show(),n.scene.onPointMoveCapture.remove(n.scene.moveCameraEvent,n.scene),n.scene.onPointDownCapture.remove(n.scene.checkPickPiece,n.scene),t=n.camera.scaleX,i={x:n.camera.x,y:n.camera.y},n.camera.scale(1),n.camera.moveTo(0,0),n.camera.modified(),n.background.hide(),n.pieceLayer.hide(),n.uiLayer.display.hide()},new g.FilledRect({scene:this.scene,cssColor:"white",x:1180,y:630,width:96,height:96,opacity:.5,touchable:!0,hidden:!0}));new g.Sprite({scene:this.scene,parent:a,src:this.scene.asset.getImageById("visibleBtn")}),this.scene.append(a),a.onPointDown.add(function(){a.hide(),n.scene.onPointMoveCapture.add(n.scene.moveCameraEvent,n.scene),null==n.scene.joinBtn&&n.scene.onPointDownCapture.add(n.scene.checkPickPiece,n.scene),n.camera.scale(t),n.camera.moveTo(i),n.camera.modified(),n.uiLayer.display.show(),n.pieceLayer.show(),n.background.show()}),this.board=new g.FilledRect({scene:this.scene,parent:this.display,cssColor:"rgba(255,255,255,0.3)",width:r.width,height:r.height,x:this.margin.width,y:this.margin.height}),this.pieceLayer.append(this.board);for(var s=0;s<e.cutInfo.length;s++){var o=new u.Piece({scene:this.scene,jigsaw:this,pieceID:s,createParam:e});this.pieces.push(o),this.pieceLayer.append(o)}for(this.randomLineUp(),g.game.focusingCamera=this.camera,this.camera.scale(this.pieceLayer.width/(this.camera.width+.5)),this.camera.moveTo(r.width*this.camera.scaleX/3,r.height*this.camera.scaleX/3),this.cameraModified(),"atsumaru"==y.GameParams.operation&&(this.uiLayer.display.append(this.scoreBoard.display),this.uiLayer.showScoreBoard=function(){n.scoreBoard.show(n.pazzleID+1,n.level)}),this.uiLayer.display.append(this.noticeViewer.display),this.pieceCol=2;2!=this.pieces[this.pieceCol-1].connects.length;)this.pieceCol++;this.pieceRow=this.pieces.length/this.pieceCol;function h(){25<=n.fitPer&&(n.noticeViewer.addNoticeCard(new m.NormalNoticeCard(n.scene,"２５％完成！",n.scene.asset.getAudioById("voice_25"))),n.noticeEvent.remove(h,n),n.noticeEvent.add(function e(){50<=n.fitPer&&(n.noticeViewer.addNoticeCard(new m.NormalNoticeCard(n.scene,"５０％完成！",n.scene.asset.getAudioById("voice_50"))),n.noticeEvent.remove(e,n),n.noticeEvent.add(function e(){75<=n.fitPer&&(n.noticeViewer.addNoticeCard(new m.NormalNoticeCard(n.scene,"７５％完成！",n.scene.asset.getAudioById("voice_75"))),n.noticeEvent.remove(e,n))},n))},n))}this.noticeEvent.add(function e(){for(var t=0;t<n.pieceCol;t++)if(!n.pieces[t].isFit)return;for(t=0;t<n.pieces.length;t+=n.pieceCol)if(!n.pieces[t].isFit)return;for(t=n.pieceCol-1;t<n.pieces.length;t+=n.pieceCol)if(!n.pieces[t].isFit)return;for(t=1;t<=n.pieceCol;t++)if(!n.pieces[n.pieces.length-t].isFit)return;n.isAlignOuter=!0,n.fitCount!=n.pieces.length&&n.noticeViewer.addNoticeCard(new m.NormalNoticeCard(n.scene,"外周完成！",n.scene.asset.getAudioById("voice_outer"))),n.noticeEvent.remove(e,n),n.noticeEvent.remove(c,n),n.noticeEvent.remove(l,n),n.noticeEvent.remove(d,n),n.noticeEvent.remove(p,n)},this);var c=function e(){if(!n.isAlignOuter){for(var t=0;t<n.pieceCol;t++)if(!n.pieces[t].isFit)return;n.noticeViewer.addNoticeCard(new m.NormalNoticeCard(n.scene,"上端完成！",n.scene.asset.getAudioById("voice_top"))),n.noticeEvent.remove(e,n)}},l=function e(){if(!n.isAlignOuter){for(var t=0;t<n.pieces.length;t+=n.pieceCol)if(!n.pieces[t].isFit)return;n.noticeViewer.addNoticeCard(new m.NormalNoticeCard(n.scene,"左端完成！",n.scene.asset.getAudioById("voice_left"))),n.noticeEvent.remove(e,n)}},d=function e(){if(!n.isAlignOuter){for(var t=n.pieceCol-1;t<n.pieces.length;t+=n.pieceCol)if(!n.pieces[t].isFit)return;n.noticeViewer.addNoticeCard(new m.NormalNoticeCard(n.scene,"右端完成！",n.scene.asset.getAudioById("voice_right"))),n.noticeEvent.remove(e,n)}},p=function e(){if(!n.isAlignOuter){for(var t=1;t<=n.pieceCol;t++)if(!n.pieces[n.pieces.length-t].isFit)return;n.noticeViewer.addNoticeCard(new m.NormalNoticeCard(n.scene,"下端完成！",n.scene.asset.getAudioById("voice_bottom"))),n.noticeEvent.remove(e,n)}};100<=this.pieces.length&&(this.noticeEvent.add(c,this),this.noticeEvent.add(l,this),this.noticeEvent.add(d,this),this.noticeEvent.add(p,this));this.noticeEvent.add(h,this)},h.prototype.joinPlayer=function(e){var t=new n.Player(e,null==(e=this.players[this.players.length-1])?void 0:e.rank),e=this.players.findIndex(function(e){return e.SamePlayerID(t)});-1==e?(this.players.push(t),t.playerID==g.game.selfId&&this.isJoinWait&&(this.isJoinWait=!1,this.me=t)):(this.players[e].name=t.name,(t=this.players[e]).playerID==g.game.selfId&&(this.isJoinWait?(this.isJoinWait=!1,this.me=t):this.me=void 0)),"Title"!=this.jigsawState&&this.uiLayer.result.draw(this.players)},h.prototype.PickPiece=function(t){var e=this.pieces.find(function(e){return e.pieceID==t.pieceID}),i=this.players.find(function(e){return e.playerID==t.playerID});null==e||null==i||i.SamePlayerID(this.me)||(e.holder,e.holder=i,e.opacity=.4,e.touchable=!1,e.modified(),e.parent.append(e),y.GameParams.isOwner&&y.GameParams.userBanMode&&(null!=e.nameLabel?(e.nameLabel.x=e.x,e.nameLabel.y=e.y+-100,e.nameLabel.modified(),e.nameLabel.text=e.holder.name,e.nameLabel.invalidate()):e.nameLabel=new g.Label({parent:e.parent,x:e.x,y:e.y+-100,font:this.nameFont,scene:this.scene,text:i.name})))},h.prototype.MovePiece=function(t){var e=this.pieces.find(function(e){return e.pieceID==t.pieceID}),i=this.players.find(function(e){return e.playerID==t.playerID});null==e||null==i||i.SamePlayerID(this.me)||(null!=e.holder&&e.holder.SamePlayerID(this.me),e.holder=i,e.moveTo(t.pos),e.modified(),y.GameParams.isOwner&&null!=e.nameLabel&&y.GameParams.userBanMode&&(e.nameLabel.x=e.x,e.nameLabel.y=e.y+-100,e.nameLabel.modified()))},h.prototype.PutPiece=function(t){var i=this.pieces.find(function(e){return e.pieceID==t.pieceID}),e=this.players.find(function(e){return e.playerID==t.playerID});null!=i&&null!=e&&(i.holder=void 0,i.opacity=1,i.touchable=!0,i.childPiece.forEach(function(e){return e.opacity=1}),e.SamePlayerID(this.me)&&null!=i.holder||(null!=i.holder&&i.holder.SamePlayerID(this.me),i.moveTo(t.pos),i.modified(),y.GameParams.isOwner&&null!=(null==(e=i.nameLabel)?void 0:e.parent)&&(i.nameLabel.x=i.x,i.nameLabel.y=i.y+-100,i.nameLabel.modified(),this.scene.setTimeout(function(){var e;null==i.holder&&null!=(null==(e=i.nameLabel)?void 0:e.parent)&&(i.nameLabel.remove(),i.nameLabel=void 0)},1e3))))},h.prototype.connectPiece=function(e){for(var t=this.pieces[e.parentID],i=this.pieces[e.childID],n=t;n.parentPiece;)n=n.parentPiece;n.holder=void 0,n.childPiece.push(i),(i.parentPiece=n).append(i),i.moveTo(n.justPxBw(i)),i.modified();for(var r=0,a=i.childPiece.splice(0);r<a.length;r++){var s=a[r];n.childPiece.push(s),(s.parentPiece=n).append(s),s.moveTo(n.justPxBw(s)),s.modified()}this.scoreUp(e.playerID)},h.prototype.fitPiece=function(e){var t=this.pieces[e.pieceID];t.isFit=!0,t.holder=void 0,t.touchable=!1,t.moveTo(this.margin.width+t.answer.x,this.margin.height+t.answer.y),t.modified();for(var i=0,n=t.childPiece;i<n.length;i++){var r=n[i];r.isFit=!0,r.touchable=!1}t.parent.insertBefore(t,t.parent.children[1]),this.scoreUp(e.playerID)},h.prototype.scoreUp=function(e){(this.me&&e==this.me.playerID?y.GameParams.myFitSound:y.GameParams.otherFitSound).play(),this.fitCount++,this.samePlayerID(e).FitPiece(),this.scoreUpdate(),this.uiLayer.result.draw(this.players),this.fitPer=Math.floor(this.fitCount/this.pieces.length*100),this.noticeEvent.fire()},h.prototype.completed=function(e){this.jigsawState="Complete";var t=new r.Animation(this.scene);this.uiLayer.display.append(t.display),t.start(),this.uiLayer.info.stopTimer(),this.scene.asset.getAudioById("voice_8888").play(),"nicolive"==y.GameParams.operation?(this.uiLayer.result.draw(this.players,this.samePlayerID(e)),this.uiLayer.result.show()):"atsumaru"==y.GameParams.operation&&-1!=this.pazzleID&&(t=this.uiLayer.info.time,e=1e7*-(4-this.level)-1e4*t.h-100*t.m-t.s,window.RPGAtsumaru.scoreboards.setRecord(this.pazzleID+1,e),this.scoreBoard.show(this.pazzleID+1,this.level))},h.prototype.scoreUpdate=function(){this.players.sort(function(e,t){return t.score-e.score});for(var e=999999,t=0,i=1,n=0,r=this.players;n<r.length;n++){var a=r[n];a.score==e?(a.rank=t,i++):(t+=i,a.rank=t,i=1,e=a.score)}},h.prototype.zoomBy=function(e){.1<=(e*=this.camera.scaleX)&&this.camera.scale(e),this.cameraModified()},h.prototype.moveCameraFromMouse=function(e){var t,i=100,n=100,r=0,a=0;return e.x=Math.floor(e.x),e.y=Math.floor(e.y),e.x<i?r+=e.x<=0?20:20*Math.pow(1-e.x/i,2):(t=this.uiLayer.display.width-e.x)<i&&(r-=t<=0?20:20*Math.pow(1-t/i,2)),e.y<n?a+=e.y<=0?20:20*Math.pow(1-e.y/n,2):(t=this.uiLayer.display.height-e.y)<n&&(a-=t<=0?20:20*Math.pow(1-t/n,2)),0!=r||0!=a?this.moveCamera({x:r,y:a}):{x:r,y:a}},h.prototype.moveCamera=function(e){var e={x:-e.x*this.camera.scaleX,y:-e.y*this.camera.scaleY},t=(this.camera.x+=e.x,this.camera.y+=e.y,this.camera.width/2),i=this.camera.height/2,n=this.camera.x+t,r=this.camera.y+i;return n<0||isNaN(n)?this.camera.x=-t:n>this.pieceLayer.width&&(this.camera.x=this.pieceLayer.width-t),r<0||isNaN(r)?this.camera.y=-i:r>this.pieceLayer.height&&(this.camera.y=this.pieceLayer.height-i),this.cameraModified(),e},h.prototype.cameraModified=function(){this.camera.modified(),this.uiLayer.display.moveTo(this.camera.x,this.camera.y),this.uiLayer.display.scaleX=this.camera.scaleX,this.uiLayer.display.scaleY=this.camera.scaleY,this.uiLayer.display.modified(),this.background.moveTo(this.camera.x,this.camera.y),this.background.scaleX=this.camera.scaleX,this.background.scaleY=this.camera.scaleY,this.background.modified()},h.prototype.randomLineUp=function(){for(var t=this,e=new Array(this.pieces.length),i=new Array(this.pieces.length),n=0;n<e.length;n++)e[n]=n;for(n=0;n<i.length;n++){var r=Math.floor(g.game.random.generate()*e.length),a=e.splice(r,1);i[n]=a[0]}function s(){var e=i.pop();return null==e?!(u=!1):(t.pieces[e].moveTo({x:d,y:p}),t.pieces[e].modified(),!1)}for(var o=1.4*this.pieces[0].width,h=1.45*this.pieces[0].height,c=Math.ceil(this.preview.width/o)+1,l=Math.ceil(this.preview.height/h)+2+1,d=this.margin.width-o/2,p=this.margin.height-h-h/2,u=!0;u;){for(r=0;r<c&&!s();r++)d+=o;for(r=0;r<l-1&&!s();r++)p+=h;for(r=0;r<c+1&&!s();r++)d-=o;for(r=0;r<l&&!s();r++)p-=h;c+=2,l+=2}},i.Jigsaw=h},{"./Animation":12,"./PlayingUI":18,"./ScoreBoard":21,"./lib/funcs":30,"./models/NoticeCardCreats":38,"./models/Piece":39,"./models/Player":40,"./models/notice":44,"./params":45}],15:[function(e,t,i){var n,r,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=(Object.defineProperty(i,"__esModule",{value:!0}),i.PieceScene=void 0,e("./eoc/SceneEx")),h=e("./events/jigsaw"),c=e("./Jigsaw"),l=e("./lib/pieceCut"),d=e("./models/AssetManager"),p=e("./events/player"),u=e("./Title"),f=e("./events/player"),y=e("./events/piece"),m=e("@akashic-extension/resolve-player-info"),v=e("./params"),w=e("./eoc/ErrorMessage"),b=e("./CreateUserPazzle"),e=(r=o.SceneEx,a(P,r),P.prototype.onLoaded=function(){var i=this,n=(this.assetManager=new d.AssetManager(this),this.title=new u.Title({scene:this,assetManager:this.assetManager,changePazzleCallback:function(e){g.game.isSkipping||i.send(new h.ChangePazzle({isRight:e}))},changeDifficultyCallback:function(e){g.game.isSkipping||i.send(new h.ChangeDefficulty({dif:e}))},startJigsawCallback:function(){var e;g.game.isSkipping||(i.title.isUserPuzzle?i.send(new h.UserPuzzle(void 0)):(e=i.assetManager.assets[i.title.selectPzlID].difficulty[i.title.selectDifID].size).width>e.height?i.send(new h.StartPazzle(e.width/5)):i.send(new h.StartPazzle(e.height/5)))}}),this.jigsaw=new c.Jigsaw({scene:this}),this.append(this.title.display),"nicolive"==v.GameParams.operation?(this.joinBtn=new g.Sprite({scene:this,parent:this,src:this.asset.getImageById("joinBtn"),x:10,y:602,touchable:!0}),this.joinBtn.onPointDown.add(function(){g.game.isSkipping||i.jigsaw.isJoinWait||(m.resolvePlayerInfo({limitSeconds:30},function(e,t){t&&t.name&&(i.joinBtn.destroy(),i.joinBtn=void 0,i.send(new p.JoinRequest({playerID:g.game.selfId,name:t.name})),i.onPointDownCapture.add(i.checkPickPiece,i))}),i.jigsaw.isJoinWait=!0)},this)):"atsumaru"==v.GameParams.operation&&(this.jigsaw.isJoinWait=!0,m.resolvePlayerInfo({limitSeconds:30},function(e,t){t&&t.name&&(i.send(new p.JoinRequest({playerID:g.game.selfId,name:t.name})),i.onPointDownCapture.add(i.checkPickPiece,i))}),this.append(this.jigsaw.scoreBoard.display)),this.addReceiveMethod(f.JoinPlayer.receive(function(e){i.jigsaw.joinPlayer(e.param),"Title"==i.jigsaw.jigsawState&&i.title.joinPlayer(i.jigsaw.players.length)})),this.addReceiveMethod(p.PickPiece.receive(function(e){return i.jigsaw.PickPiece(e.param)})),this.addReceiveMethod(p.MovePiece.receive(function(e){return i.jigsaw.MovePiece(e.param)})),this.addReceiveMethod(p.PutPiece.receive(function(e){return i.jigsaw.PutPiece(e.param)})),this.addReceiveMethod(h.ChangePazzle.receive(function(e){return i.title.changePazzle(e.param.isRight)})),this.addReceiveMethod(h.ChangeDefficulty.receive(function(e){return i.title.changeDefficulty(e.param.dif)})),h.StartPazzle.receive(function(){return i.pazzleStart()}));this.addReceiveMethod(n,this),this.addReceiveMethod(h.UserPuzzle.receive(function(e){i.removeReceiveMethod(n,i),i.append(i.title.joinCnt),i.title.display.hide();var t=new b.CreatePuzzle(i,function(e){i.title.display.append(i.title.joinCnt);var t=e.difficulty.size;t.width>t.height?i.send(new h.StartPazzle(t.width/5)):i.send(new h.StartPazzle(t.height/5)),i.pazzleStart(e)},function(){i.title.display.append(i.title.joinCnt),i.title.display.show(),i.addReceiveMethod(n,i)});i.append(t.display)}))},P.prototype.pazzleStart=function(e){var t,i=this;"Title"==this.jigsaw.jigsawState&&(null!=e?this.jigsaw.startPazzle(s(s({},l.pieceCut(e)),{title:"ユーザー投稿画像"})):(t=this.assetManager.assets[this.title.selectPzlID],this.jigsaw.startPazzle(s(s({},l.pieceCut(null!=e?e:{scene:this,pazzleID:this.title.selectPzlID,level:this.title.selectDifID+1,wakus:[].concat.apply([],this.assetManager.wakus),previewSrc:t.preview,difficulty:t.difficulty[this.title.selectDifID]})),{title:t.title}))),this.remove(this.title.display),this.append(this.jigsaw.display),this.joinBtn&&this.jigsaw.uiLayer.display.append(this.joinBtn),this.onPointMoveCapture.add(this.moveCameraEvent,this),this.addReceiveMethod(y.ConnectPiece.receive(function(e){return i.jigsaw.connectPiece(e.param)})),this.addReceiveMethod(y.FitPiece.receive(function(e){return i.jigsaw.fitPiece(e.param)})),this.addReceiveMethod(h.PazzleComplete.receive(function(e){return i.jigsaw.completed(e.param)})),this.addReceiveMethod(w.ServerError.receive(function(e){return i.jigsaw.serverError(e.param)})),this.addReceiveMethod(p.Ban.receive(function(e){var t=i.jigsaw.samePlayerID(e.param.playerID);null!=t&&(t.ban=e.param.ban,t.playerID===g.game.selfId&&i.send(new p.PutPiece({pieceID:i.movePiece.pieceID,playerID:i.jigsaw.me.playerID,pos:i.movePiece.position})),i.jigsaw.uiLayer.result.draw(i.jigsaw.players))})))},P.prototype.moveCameraEvent=function(e){var t=e.target;null!=t&&("boolean"==typeof t.isMoveCamera||null!=this.joinBtn&&null!=t.pieceID)&&this.jigsaw.moveCamera(e.prevDelta)},Object.defineProperty(P.prototype,"movePiece",{get:function(){var e;return null!=(e=this.pickPiece.parentPiece)?e:this.pickPiece},enumerable:!1,configurable:!0}),P.prototype.checkPickPiece=function(e){g.game.isSkipping||"number"!=typeof this.pointerID&&null!=this.jigsaw.me&&(this.pickPiece=e.target,null==this.pickPiece||"number"!=typeof this.pickPiece.pieceID?this.pickPiece=void 0:null!=this.pickPiece.holder||"nicolive"==v.GameParams.operation&&g.game.getCurrentTime()-this.lastPutTime<100||(this.pointerID=e.pointerId,this.pickPoint={x:this.movePiece.x,y:this.movePiece.y},this.movePiece.holder=this.jigsaw.me,this.jigsaw.me.ban||this.send(new p.PickPiece({pieceID:this.movePiece.pieceID,playerID:this.jigsaw.me.playerID})),this.movePiece.parent.append(this.movePiece),this.movePiece.modified(),this.mousePoint=this.jigsaw.uiLayer.display.globalToLocal(this.pickPiece.localToGlobal(e.point)),this.onPointMoveCapture.add(this.checkMovePiece,this),this.onPointUpCapture.add(this.checkPutPiece,this),this.onUpdate.add(this.moveCameraFromPiece,this)))},P.prototype.checkMovePiece=function(e){g.game.isSkipping||this.pointerID!=e.pointerId||0==e.prevDelta.x&&0==e.prevDelta.y||this.pickPiece&&this.jigsaw.me.SamePlayerID(this.movePiece.holder)&&(this.lastPutTime=g.game.getCurrentTime(),this.movePiece.moveTo(this.pickPoint.x+e.startDelta.x*this.jigsaw.cameraScale,this.pickPoint.y+e.startDelta.y*this.jigsaw.cameraScale),this.movePiece.parent.append(this.movePiece),this.movePiece.modified(),this.mousePoint.x+=e.prevDelta.x,this.mousePoint.y+=e.prevDelta.y)},P.prototype.checkPutPiece=function(e){g.game.isSkipping||this.pointerID==e.pointerId&&this.pickPiece&&this.jigsaw.me.SamePlayerID(this.movePiece.holder)&&(this.lastPutTime=g.game.getCurrentTime(),this.movePiece.moveBy(e.prevDelta.x,e.prevDelta.y),this.movePiece.holder=void 0,this.send(new p.PutPiece({pieceID:this.movePiece.pieceID,playerID:this.jigsaw.me.playerID,pos:this.movePiece.position})),this.pickPiece=void 0,this.mousePoint=void 0,this.onUpdate.remove(this.moveCameraFromPiece,this),this.onPointMoveCapture.remove(this.checkMovePiece,this),this.onPointUpCapture.remove(this.checkPutPiece,this),this.pointerID=void 0)},P.prototype.moveCameraFromPiece=function(){var e;null!=this.pickPiece&&(this.movePiece.holder&&this.movePiece.holder.SamePlayerID(this.jigsaw.me)&&!this.movePiece.parentPiece?(0==(e=this.jigsaw.moveCameraFromMouse(this.mousePoint)).x&&0==e.y||(this.movePiece.moveBy(e.x,e.y),this.pickPoint.x+=e.x,this.pickPoint.y+=e.y),this.beforePiecePos.x==this.movePiece.x&&this.beforePiecePos.y==this.movePiece.y||(this.movePiece.modified(),this.beforePiecePos={x:this.movePiece.x,y:this.movePiece.y},this.pieceMoveCnt--<=0&&(this.pieceMoveCnt=this.pieceMoveWait,this.jigsaw.me.ban||this.send(new p.MovePiece({pieceID:this.movePiece.pieceID,playerID:this.jigsaw.me.playerID,pos:this.movePiece.position}))))):(this.pieceMoveCnt=0,this.send(new p.PutPiece({pieceID:this.movePiece.pieceID,playerID:this.jigsaw.me.playerID,pos:this.movePiece.position})),this.movePiece.holder=void 0,this.pickPiece=void 0,this.mousePoint=void 0,this.onUpdate.remove(this.moveCameraFromPiece,this),this.onPointMoveCapture.remove(this.checkMovePiece,this),this.onPointUpCapture.remove(this.checkPutPiece,this),this.pointerID=void 0))},P);function P(e){e=r.call(this,e)||this;return e.pieceMoveWait=3,e.pieceMoveCnt=0,e.beforePiecePos={x:-1,y:-1},e.pointerID=void 0,e.lastPutTime=0,e.onLoad.addOnce(e.onLoaded,e),e}i.PieceScene=e},{"./CreateUserPazzle":13,"./Jigsaw":14,"./Title":22,"./eoc/ErrorMessage":23,"./eoc/SceneEx":24,"./events/jigsaw":26,"./events/piece":27,"./events/player":28,"./lib/pieceCut":34,"./models/AssetManager":36,"./params":45,"@akashic-extension/resolve-player-info":10}],16:[function(e,t,i){var n,r,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.PieceServer=void 0,e("./eoc/Server")),o=e("./events/piece"),h=e("./events/player"),c=e("./events/jigsaw"),l=e("./params"),d=e("./events/userPazzle"),e=(r=s.Server,a(p,r),Object.defineProperty(p.prototype,"jigsaw",{get:function(){return this.scene.jigsaw},enumerable:!1,configurable:!0}),p.prototype.fitBoard=function(e){var t=e.position;return Math.abs(t.x-e.answer.x-this.jigsaw.margin.width)<this.permission&&Math.abs(t.y-e.answer.y-this.jigsaw.margin.height)<this.permission},p.prototype.connectPieceAll=function(e){for(var t=0,i=e.childPiece;t<i.length;t++){var n=i[t],n=this.connectPieceNext(n);if(n)return n}return this.connectPieceNext(e)},p.prototype.connectPieceNext=function(e){for(var t=0,i=e.connects;t<i.length;t++){var n=i[t],n=this.connectPiece(e,this.jigsaw.pieces[n]);if(null!=n)return n}},p.prototype.connectPiece=function(e,t){var i;if((null==e.parentPiece||e.parentPiece.pieceID!=t.pieceID&&(null==t.parentPiece||e.pieceID!=t.parentPiece.pieceID&&e.parentPiece.pieceID!=t.parentPiece.pieceID))&&(null==t.parentPiece||e.pieceID!=t.parentPiece.pieceID)&&!(null!=e.holder||null!=t.holder||null!=(i=e.parentPiece)&&i.holder||null!=(i=t.parentPiece)&&i.holder)&&!e.isFit&&!t.isFit&&this.isConnect(e,t))return{parent:e=null!=e.parentPiece?e.parentPiece:e,child:t=null!=t.parentPiece?t.parentPiece:t}},p.prototype.isConnect=function(e,t){var i=e.justPxBw(t),e=e.position,t=t.position;return Math.abs(t.x-e.x-i.x)<=this.permission&&Math.abs(t.y-e.y-i.y)<=this.permission},p);function p(e){var n=r.call(this,e)||this;return n.holdPieceTime=30,n.holdEvents={},n.scene.onUpdate.add(function(){return n.update()},n),n.addReceiveMethod(h.JoinRequest.receive(function(e){n.broadcast(new h.JoinPlayer({playerID:e.param.playerID,name:e.param.name}))})),n.addReceiveMethod(h.PickPiece.receive(function(e){var t,i=n.jigsaw.pieces[e.param.pieceID];null==i||null!=i.parentPiece||i.isFit||(t=n.jigsaw.samePlayerID(e.param.playerID),(i.holder||!t||t.ban)&&"atsumaru"!=l.GameParams.operation||(n.broadcast(e),n.holdEvents[e.param.playerID]=n.scene.setTimeout(function(){n.scene.send(new h.PutPiece({pieceID:e.param.pieceID,playerID:e.param.playerID,pos:{x:i.x,y:i.y}}))},1e3*n.holdPieceTime,n)))})),n.addReceiveMethod(h.MovePiece.receive(function(e){var t=n.jigsaw.pieces[e.param.pieceID];null==t||null!=t.parentPiece||t.isFit||t.holder&&!t.holder.ban&&t.holder.playerID==e.param.playerID&&n.broadcast(e)})),n.addReceiveMethod(h.PutPiece.receive(function(e){var t,i=n.holdEvents[e.param.playerID],i=(null==i||i.destroyed()||(n.scene.clearTimeout(i),delete n.holdEvents[e.param.playerID]),n.jigsaw.pieces[e.param.pieceID]);null==i||null!=i.parentPiece||i.isFit||(i.holder&&n.jigsaw.samePlayerID(e.param.playerID)||"atsumaru"==l.GameParams.operation)&&(n.broadcast(e),(t=n.connectPieceAll(i))?(t.parent.pieceID>t.child.pieceID&&(t={parent:t.child,child:t.parent}),n.broadcast(new o.ConnectPiece({parentID:t.parent.pieceID,childID:t.child.pieceID,playerID:e.param.playerID}))):n.fitBoard(i)&&n.broadcast(new o.FitPiece({pieceID:i.pieceID,playerID:e.param.playerID})),n.jigsaw.fitCount==n.jigsaw.pieces.length&&n.broadcast(new c.PazzleComplete(e.param.playerID)))})),n.addReceiveMethod(c.ChangePazzle.receive(function(e){return n.broadcast(e)})),n.addReceiveMethod(c.ChangeDefficulty.receive(function(e){return n.broadcast(e)})),n.addReceiveMethod(c.UserPuzzle.receive(function(e){return n.broadcast(e)})),n.addReceiveMethod(c.StartPazzle.receive(function(e){n.permission=e.param,n.broadcast(e)})),n.addReceiveMethod(d.ChangePage.receive(function(e){return n.broadcast(e)})),n.addReceiveMethod(d.ShareImageStart.receive(function(e){return n.broadcast(e)})),n.addReceiveMethod(d.ShareImageData.receive(function(e){return n.broadcast(e)})),n.addReceiveMethod(d.ShareImageFinish.receive(function(e){return n.broadcast(e)})),n.addReceiveMethod(d.Edit.receive(function(e){return n.broadcast(e)})),n.addReceiveMethod(h.Ban.receive(function(e){return n.broadcast(e)})),n}i.PieceServer=e},{"./eoc/Server":25,"./events/jigsaw":26,"./events/piece":27,"./events/player":28,"./events/userPazzle":29,"./params":45}],17:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.PlayingInfo=void 0;var l=e("@akashic-extension/akashic-label"),d=e("./lib/funcs"),p=e("./models/StopWatch");function n(t,e){for(var r=this,e=(this._scoreLength=5,this._scoreHeight=40,this.jigsaw=t.jigsaw,this.display=new g.FilledRect({scene:t,cssColor:"rgba(255,255,255,0.5)",width:300,height:410,x:950,y:10}),this.stopWatch=new p.StopWatch(t),this.stopWatch.start(),new l.Label({scene:t,parent:this.display,font:d.newFont("sans-serif",40),text:e,widthAutoAdjust:!0,lineBreak:!1,width:280,height:40,x:150,y:30,anchorX:.5,anchorY:.5})),a=(d.labelAutoReSizeW(e,270),this._pieceFont=d.newFont("sans-serif",30),this._pieceLabel=new l.Label({scene:t,parent:this.display,font:this._pieceFont,text:"0%　0/0",textAlign:"right",width:290,height:40,x:0,y:80}),this._pieceChange=function(e){r._pieceLabel.text=e,r._pieceLabel.invalidate()},this._timeFont=d.newFont("sans-serif",30),this._timeLabel=new l.Label({scene:t,parent:this.display,font:this._timeFont,text:"0分0秒",textAlign:"right",width:270,height:40,x:10,y:120}),this._timeChange=function(e){r._timeLabel.text=e,r._timeLabel.invalidate()},this._nameLabels=new Array(this._scoreLength),this._scoreChanges=new Array(this._scoreLength),this._scoreLength=5,this._scoreFont=d.newFont("sans-serif",30),this),i=0;i<this._scoreLength;i++)!function(e){var i=new l.Label({scene:t,parent:a.display,font:a._scoreFont,text:"",width:200,height:170,x:10,y:160+e*a._scoreHeight}),n=(a._nameLabels[e]=i,new l.Label({scene:t,parent:a.display,font:a._scoreFont,text:"",textAlign:"right",width:60,height:170,x:210,y:a._nameLabels[e].y}));a._scoreChanges[e]=function(e,t){i.text=e,i.scale(1),d.labelAutoReSizeH(i,200,r._scoreHeight),n.text=t+"",n.invalidate()}}(i);this._myFont=d.newFont("sans-serif",30,"#7345ff"),this._myLabel=new l.Label({scene:t,parent:this.display,font:this._myFont,text:"",width:200,x:10,y:this._nameLabels[this._scoreLength-1].y+this._scoreHeight}),d.labelAutoReSizeH(this._myLabel,200,this._scoreHeight);function n(){h++==g.game.fps&&(h=0,r.update())}function s(){var e=Math.floor(r.stopWatch.ElapsedTime/60)%60;3<=e-c&&(c=e,r.update())}var o=new l.Label({scene:t,parent:this.display,font:this._myFont,text:"",textAlign:"right",width:60,x:210,y:this._nameLabels[this._scoreLength-1].y+this._scoreHeight}),h=(this._myChange=function(e,t){e!=r._myLabel.text&&(r._myLabel.text=e,r._myLabel.scale(1),d.labelAutoReSizeH(r._myLabel,200,r._scoreHeight)),o.text=t+"",o.invalidate()},0),c=0;g.game.isSkipping?t.onUpdate.add(s):t.onUpdate.add(n),g.game.onSkipChange.add(function(e){e?(t.onUpdate.remove(n),t.onUpdate.add(s)):(t.onUpdate.remove(s),t.onUpdate.add(n))})}n.prototype.stopTimer=function(){this.stopWatch.stop()},Object.defineProperty(n.prototype,"time",{get:function(){return this.stopWatch.ElapsedTime_HMS},enumerable:!1,configurable:!0}),n.prototype.update=function(){if(this.display.visible()){var e=this.jigsaw.fitCount,t=this.jigsaw.pieces.length,i=this.jigsaw.fitPer,n=this.time;this._pieceChange(i+"％　"+("000"+e).slice(-(t+"").length)+"/"+t),n.h<1?this._timeChange(n.m+"分"+n.s+"秒"):this._timeChange(n.h+"時"+n.m+"分"+n.s+"秒");for(var r=0;r<this._scoreLength;r++){var a=this.jigsaw.players[r];if(null==a)break;this._scoreChanges[r](a.name,a.score)}this.jigsaw.me&&this._myChange(this.jigsaw.me.name,this.jigsaw.me.score)}},i.PlayingInfo=n},{"./lib/funcs":30,"./models/StopWatch":42,"@akashic-extension/akashic-label":8}],18:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.PlayingUI=void 0;var w=e("@akashic-extension/akashic-label"),b=e("./lib/funcs"),P=e("./params"),x=e("./PlayingInfo"),_=e("./Preview"),I=e("./Result");function n(e,t,i){var n,r=this,a=(this.colors=["#0087CC","#A900CC","#CC4300","#22CC00","#3D738E","#813D8E","#8E583D","#4A8E3D","rgba(0,0,0,0)"],this.selectColor=0,this.scene=e,this.display=new g.E({scene:e,width:g.game.width,height:g.game.height,anchorX:null}),new x.PlayingInfo(e,t)),s=(this.info=a,this.display.append(a.display),new _.Preview(e,i)),t=(this.display.append(s.display),this.result=new I.Result(e),this.display.append(this.result.display),1180),i=440,o=this.createUI({w:70,h:70,x:t,y:i,src:"setting",a:.7}),h=this.createUI({w:70,h:70,x:t-=90,y:i,src:"visibleBtn",a:!0}),c=this.createUI({w:70,h:70,x:t-=90,y:i,src:"resultBtn",a:!0}),t=1180,l=this.createUI({w:70,h:70,x:t,y:i+=90,src:"infoBtn",a:!0}),d=this.createUI({w:70,h:70,x:t-=90,y:i,src:"previewBtn",a:!0}),p=this.createUI({w:70,h:70,x:t-=90,y:i,src:1,a:!0}),u=this.createUI({w:70,h:70,x:t=1180,y:i+=90,src:"zoomIn"}),f=this.createUI({w:70,h:70,x:t-=90,y:i,src:"zoomOut"}),y=(P.GameParams.isOwner&&((n=this.createUI({w:70,h:70,x:t-=90,y:i,src:"player_ban",a:!0})).opacity=.7,n.modified()),o.onPointDown.add(function(){var e=.7==o.opacity;o.opacity=e?1:.7,o.modified(),e?(l.show(),c.show(),h.show(),d.show(),p.show(),null!=n&&n.show()):(l.hide(),c.hide(),h.hide(),d.hide(),p.hide(),null!=n&&n.hide())}),l.onPointDown.add(function(){a.display.visible()?a.display.hide():a.display.show()}),c.onPointDown.add(function(){"nicolive"==P.GameParams.operation?r.result.display.visible()?r.result.hide():r.result.show():r.showScoreBoard()}),h.onPointDown.add(function(e){1==e.pointerId&&r.hideDisplay()}),d.onPointDown.add(function(){s.display.visible()?s.display.hide():s.display.show()}),p.onPointDown.add(function(){r.selectColor++,r.selectColor==r.colors.length&&(r.selectColor=0),p.children[0].cssColor=r.colors[(r.selectColor+1)%r.colors.length],p.children[0].modified(),r.colorChange(r.colors[r.selectColor])}),u.onPointDown.add(function(){return r.zoomIn()}),f.onPointDown.add(function(){return r.zoomOut()}),null!=n&&n.onPointDown.add(function(){P.GameParams.banModeChange(),P.GameParams.userBanMode?n.opacity=1:n.opacity=.7,n.modified()}),new g.FilledRect({scene:e,parent:this.display,cssColor:"rgba(255,255,255,0.5)",width:300,height:P.GameParams.isOwner?480:410,x:10,y:10,touchable:!0})),m=3,v=(this.createTipInfo(y,"setting",t=5,i=5,"各種ボタンの表示・非表示",t+43,i+7),this.createTipInfo(y,"visibleBtn",t,i+=50,"パズルの非表示\n右下に再表示ボタンがある",t+43,i),this.createTipInfo(y,"resultBtn",t,i+=50,"ランキングの表示・非表示",t+43,i+7),this.createTipInfo(y,"infoBtn",t,i+=50,"パズル情報の表示・非表示",t+43,i+7),this.createTipInfo(y,"previewBtn",t,i+=50,"完成画像の表示・非表示\n下に拡大率変更スライダー",t+43,i),this.createTipInfo(y,void 0,t,i+=50,"背景色変更（８色）",t+43,i+7),i+=50,P.GameParams.isOwner&&(this.createTipInfo(y,"player_ban",t,i,"BANモードの切り替え\nピース操作ユーザーの表示\nBANはランキング画面から",t+43,i),i+=70),this.createTipInfo(y,"zoomIn",t,i,"画面の拡大",t+43,i+7),this.createTipInfo(y,"zoomOut",t,i+=50,"画面の縮小",t+43,i+7),i+=50,new w.Label({scene:e,parent:y,font:b.newFont("sans-serif",28,"green"),text:m+" クリック\nで消えます",textAlign:"right",x:155,y:y.height-70,width:140}));y.onPointDown.add(function(){0==--m?y.destroy():(v.text=m+" クリック\nで消えます",v.invalidate())})}n.prototype.createTipInfo=function(e,t,i,n,r,a,s){var o=b.newFont("sans-serif",20);null!=t?new g.Sprite({scene:this.scene,parent:e,src:this.scene.asset.getImageById(t),x:i,y:n,scaleX:.4,scaleY:.4}):new g.FilledRect({scene:this.scene,parent:e,cssColor:this.colors[1],x:i,y:n,width:38.4,height:38.4}),new w.Label({scene:this.scene,parent:e,font:o,text:r,x:a,y:s,width:250})},n.prototype.createUI=function(e){var t=new g.FilledRect({scene:this.scene,parent:this.display,cssColor:"rgba(255,255,255,0.3)",width:e.w,height:e.h,x:e.x,y:e.y,touchable:!0,opacity:"number"==typeof e.a?e.a:1,hidden:"boolean"==typeof e.a});return"string"==typeof e.src?new g.Sprite({scene:this.scene,parent:t,src:this.scene.asset.getImageById(e.src),anchorX:.5,anchorY:.5,x:e.w/2,y:e.h/2,scaleX:.7,scaleY:.7}):new g.FilledRect({scene:this.scene,parent:t,cssColor:this.colors[e.src],anchorX:.5,anchorY:.5,x:e.w/2,y:e.h/2,width:70,height:70}),t},i.PlayingUI=n},{"./PlayingInfo":17,"./Preview":19,"./Result":20,"./lib/funcs":30,"./params":45,"@akashic-extension/akashic-label":8}],19:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Preview=void 0;var o=e("./lib/funcs"),h=e("./models/Slider");i.Preview=function(e,n){function r(){var e,t;n.x>s.x?n.x=s.x:(e=n.scaleX/a,t=s.x+i.width-i.width*e,n.x<t&&(n.x=t)),n.y>s.y?n.y=s.y:(e=n.scaleX/a,t=s.y+i.height-i.height*e,n.y<t&&(n.y=t))}this.display=new g.E({scene:e,width:g.game.width,height:g.game.height,hidden:!0});var t=new g.FilledRect({scene:e,parent:this.display,cssColor:"rgba(0,0,0,0.5)",width:860,height:540,x:55,y:37,local:!0,touchable:!0}),a=(new g.Pane({scene:e,parent:t,width:t.width,height:t.height}).append(n),o.spriteSet(n,t.width,t.height),n.scaleX),i={width:n.width*a,height:n.height*a},s={x:(t.width-i.width)/2,y:(t.height-i.height)/2};t.onPointMove.add(function(e){n.moveBy(e.prevDelta.x,e.prevDelta.y),r(),n.modified()}),new h.Slider({scene:e,parent:this.display,width:300,height:100,x:330,y:600,min:a,max:10,quadratic:2}).onValueChange.add(function(e){var t=n.scaleX-e,i=n.scaleX/a;n.x+=((-n.x+s.x)/n.scaleX+n.width/i/2)*t,n.y+=((-n.y+s.y)/n.scaleX+n.height/i/2)*t,n.scale(e),r(),n.modified()})}},{"./lib/funcs":30,"./models/Slider":41}],20:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Result=void 0;var y=e("@akashic-extension/akashic-label"),r=e("./events/player"),m=e("./lib/funcs"),v=e("./params");function n(e){var t,i,n=this;this.scene=e,this.display=new g.Sprite({scene:e,src:e.asset.getImageById("result"),x:50,y:10,hidden:!0}),this.rankPane=new g.Pane({scene:e,width:780,height:365,x:45,y:180,parent:this.display,touchable:!0}),this.rankingView=new g.E({scene:e,width:this.rankPane.width,height:0,parent:this.rankPane}),this.lastPlayerFont=m.newFont("sans-serif",50,"#23664B"),this.rankingNameFont=m.newFont("sans-serif",36),this.banPlayerNameFont=m.newFont("sans-serif",36,"red"),this.myRankingNameFont=m.newFont("sans-serif",36,"blue"),this.rankCrowns=new Array,this.rankRanks=new Array,this.rankNames=new Array,this.rankScores=new Array,new g.Sprite({scene:e,parent:this.display,src:e.asset.getImageById("crown_0"),x:55,y:90}),this.lastPlayerName=new y.Label({scene:e,parent:this.display,font:this.lastPlayerFont,text:"",widthAutoAdjust:!0,lineBreak:!1,width:640,x:170,y:90}),this.rankPane.onPointMove.add(function(e){n.rankingView.y+=e.prevDelta.y,n.rankingView.y<n.rankPane.height-n.rankingView.height&&(n.rankingView.y=n.rankPane.height-n.rankingView.height),0<n.rankingView.y&&(n.rankingView.y=0),n.rankingView.modified()}),v.GameParams.isOwner&&(new y.Label({scene:this.scene,parent:this.display,font:this.rankingNameFont,text:"BANモードがONの時にプレイヤー名を\nタッチするとその人をバン出来ます",x:200,y:580,width:900}),this.banView=new g.FilledRect({scene:this.scene,parent:this.display,cssColor:"#aaad",height:200,width:800,x:35,y:300,hidden:!0}),this.banUserLabel=new g.Label({scene:this.scene,parent:this.banView,font:this.rankingNameFont,x:20,y:30,text:"xxxx を本当にバンしますか？"}),t=new g.FilledRect({scene:this.scene,parent:this.banView,cssColor:"#f00a",width:100,height:60,x:150,y:100,touchable:!0}),new g.Label({scene:this.scene,parent:t,font:this.rankingNameFont,text:"はい",x:5,y:10}),i=new g.FilledRect({scene:this.scene,parent:this.banView,cssColor:"#f00a",width:120,height:60,x:300,y:100,touchable:!0}),new g.Label({scene:this.scene,parent:i,font:this.rankingNameFont,text:"いいえ",x:5,y:10}),i.onPointDown.add(function(){return n.banView.hide()}),t.onPointDown.add(function(){e.send(new r.Ban({ban:!n.selectBanPlayer.ban,playerID:n.selectBanPlayer.playerID})),n.banView.hide(),n.selectBanPlayer=void 0}))}n.prototype.show=function(){this.display.show(),this.lastPlayers?this.draw(this.lastPlayers,this.lastPlayer):(this.rankingView.y=0,this.rankingView.modified())},n.prototype.hide=function(){this.display.hide()},n.prototype.draw=function(a,e){var s=this;if(this.display.visible()){this.lastPlayers=void 0,this.lastPlayer=void 0;for(var t=0;t<this.rankCrowns.length;t++)this.rankCrowns[t].destroy();for(t=0;t<this.rankRanks.length;t++)this.rankRanks[t].destroy(),this.rankNames[t].destroy(),this.rankScores[t].destroy();this.rankCrowns=new Array,this.rankRanks=new Array,this.rankNames=new Array,this.rankScores=new Array;var o=57,h=50,c=113,l=520,d=h+c+20,p=150,u=d+l+10;if(this.rankingView.height=o*a.length,e&&(this.lastPlayerName.text=e.name,m.labelAutoReSizeW(this.lastPlayerName,640)),this.rankingView.children)for(t=this.rankingView.children.length-1;0<=t;t--)this.rankingView.remove(this.rankingView.children[t]);for(var f=this,t=0;t<a.length;t++)!function(e){var t=a[e],i=(0<t.score&&t.rank<=3&&(i=new g.Sprite({scene:f.scene,parent:f.rankingView,src:f.scene.asset.getImageById("crown_"+t.rank),x:5,y:o*e}),f.rankCrowns.push(i)),t.playerID==g.game.selfId?f.myRankingNameFont:t.ban?f.banPlayerNameFont:f.rankingNameFont),n=new y.Label({scene:f.scene,parent:f.rankingView,font:i,text:t.rank+"位",textAlign:"right",x:h,y:o*e,width:c}),r=new y.Label({scene:f.scene,parent:f.rankingView,font:i,text:t.name,widthAutoAdjust:!0,lineBreak:!1,x:d,y:o*e,width:l}),i=(m.labelAutoReSizeW(r,l),new y.Label({scene:f.scene,parent:f.rankingView,font:i,text:t.score+"",lineBreak:!1,x:u,y:o*e,width:p}));f.rankRanks.push(n),f.rankNames.push(r),f.rankScores.push(i),v.GameParams.isOwner&&(r.touchable=!0,r.onPointDown.add(function(){var e;v.GameParams.userBanMode&&(e=(s.selectBanPlayer=t)===s.scene.jigsaw.me?"あなた":t.name,t.ban?s.banUserLabel.text=e+" のバンを解除しますか？":s.banUserLabel.text=e+" を本当にバンしますか？",s.banUserLabel.invalidate(),s.banView.show())}))}(t)}else this.lastPlayers=a,this.lastPlayer=e},i.Result=n},{"./events/player":28,"./lib/funcs":30,"./params":45,"@akashic-extension/akashic-label":8}],21:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ScoreBoard=void 0;var o=e("@akashic-extension/akashic-label"),h=e("./lib/funcs");function n(e){var t=this,i=(this.level=1,this.scene=e,this.display=new g.FilledRect({scene:e,cssColor:"rgb(82,243,176)",x:50,y:10,width:870,height:690,hidden:!0,touchable:!0}),this.rankPane=new g.Pane({scene:e,width:820,height:550,x:20,y:20,parent:this.display,touchable:!0}),this.rankingView=new g.FilledRect({scene:e,parent:this.rankPane,cssColor:"rgb(204,242,227)",width:this.rankPane.width,height:this.rankPane.height}),this.rankingFont=h.newFont("sans-serif",34),this.myRankingFont=h.newFont("sans-serif",34,"blue"),this.rankPane.onPointMove.add(function(e){t.rankingView.y+=e.prevDelta.y,t.rankingView.y<t.rankPane.height-t.rankingView.height&&(t.rankingView.y=t.rankPane.height-t.rankingView.height),0<t.rankingView.y&&(t.rankingView.y=0),t.rankingView.modified()}),new g.FilledRect({scene:e,parent:this.display,cssColor:"rgb(0,194,78)",height:86,width:210,x:640,y:588,touchable:!0})),n=(new o.Label({scene:e,parent:i,font:h.newFont("sans-serif",60,"white"),text:"閉じる",x:17,y:5,width:200}),i.onPointDown.add(function(){return t.hide()}),this.levelT=new o.Label({scene:e,parent:this.display,font:h.newFont("sans-serif",60),text:"レベル "+this.level,x:10,y:i.y,width:400}),new g.Sprite({scene:e,parent:this.display,src:e.asset.getImageById("left"),x:300,y:i.y,scaleX:.8,scaleY:.8,touchable:!0})),e=new g.Sprite({scene:e,parent:this.display,src:e.asset.getImageById("right"),x:n.x+170,y:i.y,scaleX:.8,scaleY:.8,touchable:!0});n.onPointDown.add(function(){t.level--,0==t.level&&(t.level=3),t.draw(t.ranks)}),e.onPointDown.add(function(){t.level++,4==t.level&&(t.level=1),t.draw(t.ranks)})}n.prototype.show=function(e,t){var i=this;-1!=(this.level=t)&&(this.display.show(),window.RPGAtsumaru.scoreboards.getRecords(e).then(function(e){e=e.ranking;i.draw(e)}))},n.prototype.hide=function(){this.display.hide()},n.prototype.draw=function(e){this.levelT.text="レベル "+this.level,this.levelT.invalidate(),this.ranks=e;if(this.rankingView.children)for(var t=this.rankingView.children.length-1;0<=t;t--)this.rankingView.remove(this.rankingView.children[t]);for(var i=0,n=void 0,t=0;t<e.length;t++){var r,a=e[t],s=this.convertScore(a.score);null!=s&&(null==n&&(n=a.rank-1),new o.Label({scene:this.scene,parent:this.rankingView,font:a.userId+""==g.game.selfId?this.myRankingFont:this.rankingFont,text:a.rank-n+"位",textAlign:"right",x:0,y:46*i,width:113}),r=new o.Label({scene:this.scene,parent:this.rankingView,font:a.userId+""==g.game.selfId?this.myRankingFont:this.rankingFont,text:a.userName,widthAutoAdjust:!0,lineBreak:!1,x:133,y:46*i,width:480}),h.labelAutoReSizeW(r,480),new o.Label({scene:this.scene,parent:this.rankingView,font:a.userId+""==g.game.selfId?this.myRankingFont:this.rankingFont,text:s,lineBreak:!1,x:623,y:46*i,width:150}),i++)}this.rankingView.height=12<i?46*i:this.rankPane.height},n.prototype.convertScore=function(e){var e=e+"",t=e.slice(1,2);if(t==4-this.level+"")return e.slice(2,5)+":"+e.slice(5,7)+":"+e.slice(7,9)},i.ScoreBoard=n},{"./lib/funcs":30,"@akashic-extension/akashic-label":8}],22:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Title=void 0;var h=e("@akashic-extension/akashic-label"),c=e("./lib/funcs"),a=e("./params");function n(e){var t=this,i=(this.selectDifID=0,e.scene),e=(this.scene=i,this.assetManager=e.assetManager,this.changePazzleCallback=e.changePazzleCallback,this.changeDifficultyCallback=e.changeDifficultyCallback,this.startJigsawCallback=e.startJigsawCallback,this.fontN=new g.DynamicFont({game:g.game,fontFamily:"sans-serif",fontWeight:"bold",size:50}),this.fontB=new g.DynamicFont({game:g.game,fontFamily:"sans-serif",fontWeight:"bold",size:50,strokeColor:"white",strokeWidth:5}),this.display=new g.E({scene:i}),this.preview=new g.FilledRect({scene:i,parent:this.display,cssColor:"rgba(0,0,0)",width:770,height:460,x:25,y:35}),this.info=new g.E({scene:i,width:380,height:460,x:850,y:35,parent:this.display}),new g.Sprite({scene:i,parent:this.info,src:i.asset.getImageById("title_back")})),e=(new h.Label({scene:i,parent:e,width:360,font:this.fontN,text:"たいとる",widthAutoAdjust:!0,lineBreak:!1,anchorX:.5,anchorY:.5,x:.5*e.width,y:.5*e.height}),new g.Sprite({scene:i,parent:this.info,src:i.asset.getImageById("select_E"),y:e.y+100,touchable:!0})),n=new g.Sprite({scene:i,parent:this.info,src:i.asset.getImageById("select_N"),y:e.y+100,opacity:.6,touchable:!0}),r=new g.Sprite({scene:i,parent:this.info,src:i.asset.getImageById("select_H"),y:n.y+100,opacity:.6,touchable:!0});new h.Label({scene:i,parent:e,width:170,font:this.fontN,fontSize:40,text:"50",textAlign:"right",anchorY:.5,x:150,y:.5*e.height-5}),new h.Label({scene:i,parent:n,width:170,font:this.fontN,fontSize:40,text:"100",textAlign:"right",lineBreak:!1,anchorY:.5,x:150,y:.5*e.height-5}),new h.Label({scene:i,parent:r,width:170,font:this.fontN,fontSize:40,text:"200",textAlign:"right",lineBreak:!1,anchorY:.5,x:150,y:.5*n.height-5}),this.dif_Entitys=[e,n,r],a.GameParams.isOwner&&(e.onPointDown.add(function(){0!=t.selectDifID&&t.changeDifficultyCallback(0)}),n.onPointDown.add(function(){1!=t.selectDifID&&t.changeDifficultyCallback(1)}),r.onPointDown.add(function(){2!=t.selectDifID&&t.changeDifficultyCallback(2)})),this.joinCnt=new g.Sprite({scene:i,parent:this.display,src:i.asset.getImageById("sanka_nin"),x:850,y:435}),new h.Label({scene:i,parent:this.joinCnt,width:380,font:this.fontN,fontSize:50,text:"0",textAlign:"center",lineBreak:!1,anchorY:.5,y:.5*this.joinCnt.height-5});new h.Label({scene:i,parent:this.display,font:this.fontB,width:1e3,height:30,text:"v 12.2    ユーザー投稿パズル機能を修正\n２分間の待ち時間が無くなりました",fontSize:30,x:230,y:650}),"atsumaru"==a.GameParams.operation&&(e=new g.FilledRect({scene:i,parent:this.display,cssColor:"#00C24E",x:10,y:602,width:192,height:108,touchable:!0}),new h.Label({scene:i,parent:e,font:c.newFont("sans-serif",36,"#fff"),text:"ランキング",textAlign:"center",anchorY:.5,y:54,width:192}),e.onPointDown.add(function(){i.jigsaw.scoreBoard.display.visible()?i.jigsaw.scoreBoard.hide():i.jigsaw.scoreBoard.show(t.selectPzlID+1,t.selectDifID+1)})),a.GameParams.isOwner&&(n=new g.Sprite({scene:i,parent:this.display,src:i.asset.getImageById("left"),x:250,y:540,touchable:!0}),r=new g.Sprite({scene:i,parent:this.display,src:i.asset.getImageById("right"),x:500,y:540,touchable:!0}),e=new g.Sprite({scene:i,parent:this.display,src:i.asset.getImageById("playBtn"),x:950,y:540,touchable:!0}),n.onPointDown.add(function(){return t.changePazzleCallback(!1)}),r.onPointDown.add(function(){return t.changePazzleCallback(!0)}),e.onPointDown.add(function(){return t.startJigsawCallback()})),this.selectPzlID=-1,this.changePazzle(!0)}Object.defineProperty(n.prototype,"isUserPuzzle",{get:function(){return this.selectPzlID==this.assetManager.assets.length},enumerable:!1,configurable:!0}),n.prototype.changeDefficulty=function(e){this.selectDifID=e;var t=this.dif_Entitys[0],i=this.dif_Entitys[1],n=this.dif_Entitys[2];t.opacity=0==e?1:.6,t.modified(),i.opacity=1==e?1:.6,i.modified(),n.opacity=2==e?1:.6,n.modified()},n.prototype.joinPlayer=function(e){this.joinCnt.children[0].text=e+"",this.joinCnt.children[0].invalidate()},n.prototype.changePazzle=function(e){var t,i,n,r,a,s=this.assetManager,o=s.assets.length;this.selectPzlID+=e?1:-1,-1==this.selectPzlID||this.selectPzlID==o?this.selectPzlID=o:this.selectPzlID==o+1?this.selectPzlID=0:this.selectPzlID=(this.selectPzlID+o)%o,this.isUserPuzzle?(this.preview.remove(this.preview.children[0]),e=new g.E({scene:this.scene}),new h.Label({scene:this.scene,parent:e,font:c.newFont("sans-serif",90,"white"),text:" 好きな画像で遊ぶ",y:100,width:this.preview.width}),new h.Label({scene:this.scene,parent:e,font:c.newFont("sans-serif",50,"white"),text:"（生主がPCの時のみ遊べます）\n\n    「開始」ボタンを押すと\n     別ページに移動します",y:200,width:this.preview.width}),this.preview.append(e),(i=(t=this.info.children)[0].children[0]).text="ユーザー投稿画像",c.labelAutoReSizeW(i,360),n=t[1].children[0],r=t[2].children[0],a=t[3].children[0],n.text="???",r.text="???",a.text="???"):(o=s.assets[this.selectPzlID],this.preview.children&&this.preview.remove(this.preview.children[0]),this.preview.append(o.preview),c.spriteSet(o.preview,this.preview.width,this.preview.height),(i=(t=this.info.children)[0].children[0]).text=o.title,c.labelAutoReSizeW(i,360),n=t[1].children[0],r=t[2].children[0],a=t[3].children[0],n.text=o.difficulty[0].count+"",r.text=o.difficulty[1].count+"",a.text=o.difficulty[2].count+""),n.invalidate(),r.invalidate(),a.invalidate()},i.Title=n},{"./lib/funcs":30,"./params":45,"@akashic-extension/akashic-label":8}],23:[function(e,t,i){function n(e){this.param=e,this.type=n.TYPE}Object.defineProperty(i,"__esModule",{value:!0}),i.ServerError=void 0,n.receive=function(e){return{type:this.TYPE,event:e}},n.TYPE="ServerError",i.ServerError=n},{}],24:[function(e,t,i){var n,r,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=(Object.defineProperty(i,"__esModule",{value:!0}),i.SceneEx=void 0,e("../params")),e=(r=g.Scene,a(h,r),h.prototype.send=function(e){g.game.raiseEvent(new g.MessageEvent(e))},h.prototype.addReceiveMethod=function(e,t){this.ReceiveEvent.push(s({owner:t},e))},h.prototype.removeReceiveMethod=function(e,t){for(var i=0;i<this.ReceiveEvent.length;i++){var n=this.ReceiveEvent[i];if(n.type===e.type&&n.event===e.event&&n.owner==t)return void this.ReceiveEvent.splice(i,1)}},h.prototype.receiveEvent=function(e){null!=e.data&&this.receiveEventDo(e.data)},h.prototype.receiveEventDo=function(e){for(var t=0;t<this.ReceiveEvent.length;t++){var i=this.ReceiveEvent[t];i.type==e.type&&i.event.call(i.owner,e)}},h);function h(e){e=r.call(this,s({local:"interpolate-local",tickGenerationMode:"manual"},e))||this;return e.ReceiveEvent=[],o.GameParams.isServer||e.onMessage.add(e.receiveEvent,e),e}i.SceneEx=e},{"../params":45}],25:[function(e,t,i){var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var a=arguments[t],s=0,o=a.length;s<o;s++,r++)n[r]=a[s];return n},r=(Object.defineProperty(i,"__esModule",{value:!0}),i.Server=void 0,e("./ErrorMessage"));function a(e){this.ReceiveEvent=[],this.BroadcastBuffer=[],this.scene=e.scene,this.onEventFiltered_bound=this.onEventFiltered.bind(this),g.game.addEventFilter(this.onEventFiltered_bound),this.scene.onUpdate.add(this.update,this)}a.prototype.addReceiveMethod=function(e){this.ReceiveEvent.push(e)},a.prototype.removeReceiveMethod=function(e,t){for(var i=0;i<this.ReceiveEvent.length;i++){var n=this.ReceiveEvent[i];if(n.type===e&&n.event===t)return void this.ReceiveEvent.splice(i,1)}},a.prototype.broadcast=function(e){try{this.scene.receiveEventDo(e)}catch(e){this.sendError("from: broadcast\nname: "+e.name+"\nmessage: "+e.message)}this.BroadcastBuffer.push(e)},a.prototype.update=function(){try{var e,t;0!=this.BroadcastBuffer.length&&(e=this.BroadcastBuffer.map(function(e){return new g.MessageEvent(e)}),t=new g.TimestampEvent(Math.floor(g.game.getCurrentTime()),null),g.game.raiseTick(n([t],e)),this.BroadcastBuffer.length=0)}catch(e){this.sendError("from: update\nname: "+e.name+"\nmessage: "+e.message)}},a.prototype.onEventFiltered=function(e,t){t.processNext;for(var i=[],n=0;n<e.length;n++){var r=e[n];32===r[0]?this.receiveEvent(r[3]):i.push(r)}return i},a.prototype.receiveEvent=function(e){try{for(var t=0;t<this.ReceiveEvent.length;t++){var i=this.ReceiveEvent[t];i.type==e.type&&i.event(e)}}catch(e){this.sendError("from: receiveEvent\nname: "+e.name+"\nmessage: "+e.message)}},a.prototype.sendError=function(e){console.log(e);var t=new g.TimestampEvent(Math.floor(g.game.getCurrentTime()),null);g.game.raiseTick([t,new g.MessageEvent(new r.ServerError({message:e}))])},i.Server=a},{"./ErrorMessage":23}],26:[function(e,t,i){function n(e){this.param=e,this.type=n.TYPE}function r(e){this.param=e,this.type=r.TYPE}function a(e){this.param=e,this.type=a.TYPE}function s(e){this.param=e,this.type=s.TYPE}function o(e){this.param=e,this.type=o.TYPE}Object.defineProperty(i,"__esModule",{value:!0}),i.PazzleComplete=i.StartPazzle=i.UserPuzzle=i.ChangeDefficulty=i.ChangePazzle=void 0,n.receive=function(e){return{type:this.TYPE,event:e}},n.TYPE="ChangePreview",i.ChangePazzle=n,r.receive=function(e){return{type:this.TYPE,event:e}},r.TYPE="ChangeDefficulty",i.ChangeDefficulty=r,a.receive=function(e){return{type:this.TYPE,event:e}},a.TYPE="UserPuzzle",i.UserPuzzle=a,s.receive=function(e){return{type:this.TYPE,event:e}},s.TYPE="StartPazzle",i.StartPazzle=s,o.receive=function(e){return{type:this.TYPE,event:e}},o.TYPE="ClearPazzle",i.PazzleComplete=o},{}],27:[function(e,t,i){function n(e){this.param=e,this.type=n.TYPE}function r(e){this.param=e,this.type=r.TYPE}Object.defineProperty(i,"__esModule",{value:!0}),i.ConnectPiece=i.FitPiece=void 0,n.receive=function(e){return{type:this.TYPE,event:e}},n.TYPE="FitPiece",i.FitPiece=n,r.receive=function(e){return{type:this.TYPE,event:e}},r.TYPE="ConnectPiece",i.ConnectPiece=r},{}],28:[function(e,t,i){function n(e){this.param=e,this.type=n.TYPE}function r(e){this.param=e,this.type=r.TYPE}function a(e){this.param=e,this.type=a.TYPE}function s(e){this.param=e,this.type=s.TYPE}function o(e){this.param=e,this.type=o.TYPE}function h(e){this.param=e,this.type=h.TYPE}Object.defineProperty(i,"__esModule",{value:!0}),i.Ban=i.PutPiece=i.MovePiece=i.PickPiece=i.JoinRequest=i.JoinPlayer=void 0,n.receive=function(e){return{type:this.TYPE,event:e}},n.TYPE="JoinPlayer",i.JoinPlayer=n,r.receive=function(e){return{type:this.TYPE,event:e}},r.TYPE="JoinRequest",i.JoinRequest=r,a.receive=function(e){return{type:this.TYPE,event:e}},a.TYPE="PickPiece",i.PickPiece=a,s.receive=function(e){return{type:this.TYPE,event:e}},s.TYPE="MovePiece",i.MovePiece=s,o.receive=function(e){return{type:this.TYPE,event:e}},o.TYPE="PutPiece",i.PutPiece=o,h.receive=function(e){return{type:this.TYPE,event:e}},h.TYPE="Ban",i.Ban=h},{}],29:[function(e,t,i){function n(e){this.param=e,this.type=n.TYPE}function r(e){this.param=e,this.type=r.TYPE}function a(e){this.param=e,this.type=a.TYPE}function s(e){this.param=e,this.type=s.TYPE}function o(e){this.param=e,this.type=o.TYPE}Object.defineProperty(i,"__esModule",{value:!0}),i.Edit=i.ShareImageFinish=i.ShareImageData=i.ShareImageStart=i.ChangePage=void 0,n.receive=function(e){return{type:this.TYPE,event:e}},n.TYPE="ChangePage",i.ChangePage=n,r.receive=function(e){return{type:this.TYPE,event:e}},r.TYPE="ShareImageStart",i.ShareImageStart=r,a.receive=function(e){return{type:this.TYPE,event:e}},a.TYPE="ShareImageData",i.ShareImageData=a,s.receive=function(e){return{type:this.TYPE,event:e}},s.TYPE="ShareImageFinish",i.ShareImageFinish=s,o.receive=function(e){return{type:this.TYPE,event:e}},o.TYPE="Edit",i.Edit=o},{}],30:[function(e,t,i){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=(Object.defineProperty(i,"__esModule",{value:!0}),i.createScrollLabel=i.createFillLabel=i.base64ToArrayBuffer=i.ConvertJpgImage=i.removeDropFile=i.addDragDrop=i.newFont=i.labelAutoReSizeH=i.spriteSet=i.labelAutoReSizeW=void 0,e("@akashic-extension/akashic-label")),s=e("./jpeg/image");i.labelAutoReSizeW=function(e,t){e.scale(1),e.invalidate(),(t/=e.width)<1&&(e.scale(t),e.modified(),e.invalidate())},i.spriteSet=function(e,t,i){e.x=0,e.y=0;var n=t/e.width,r=i/e.height;r<n?(e.scale(r),e.x=(t-e.width*e.scaleX)/2):(e.scale(n),e.y=(i-e.height*e.scaleY)/2),e.modified()},i.labelAutoReSizeH=function(e,t,i){for(e.invalidate(),e.width=t,e.modified(),e.invalidate();i<e.height;)e.width*=2,i*=2,e.scale(e.scaleX/2),e.modified(),e.invalidate()},i.newFont=function(e,t,i){return i=null==i?"brack":i,new g.DynamicFont({game:g.game,fontFamily:e,size:t,fontColor:i})};var n=void 0;function o(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"}i.addDragDrop=function(e){null==n&&(n=e,(e=document.getElementsByTagName("canvas")[0]).addEventListener("dragover",o),e.addEventListener("drop",n))},i.removeDropFile=function(){var e;null!=n&&((e=document.getElementsByTagName("canvas")[0]).removeEventListener("dragover",o),e.removeEventListener("drop",n),n=void 0)},i.ConvertJpgImage=function(e){var t=new Blob([e],{type:"image/png"});return new Promise(function(n,e){createImageBitmap(t).then(function(e){var t=document.createElement("canvas"),i=(t.width=e.width,t.height=e.height,t.getContext("2d"));i.drawImage(e,0,0),n(new s.Image(i.getImageData(0,0,t.width,t.height)))})})},i.base64ToArrayBuffer=function(e){e=e.split(",")[1];for(var t=window.atob(e),i=t.length,n=new Uint8Array(i),r=0;r<i;r++)n[r]=t.charCodeAt(r);return n.buffer},i.createFillLabel=function(e,t){return e=new g.FilledRect(e),new a.Label(r(r({},t),{parent:e,width:e.width-(null!=(t=t.x)?t:0)})),e},i.createScrollLabel=function(e,t){var i=new g.Pane(e),e=new g.FilledRect(r(r({},e),{parent:i,x:0,y:0,touchable:!0})),n=new a.Label(r(r({},t),{parent:i,width:i.width-(null!=(t=t.x)?t:0)}));return e.onPointMove.add(function(e){n.y+=e.prevDelta.y,n.y<i.height-n.height&&(n.y=i.height-n.height),0<n.y&&(n.y=0),n.modified()}),i}},{"./jpeg/image":33,"@akashic-extension/akashic-label":8}],31:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.decode=void 0;var n=e("./image"),r=function(){"use strict";var K=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),F=5793;function e(){}function Q(t,i,e,n,r,c,l,a,d){var s=e.mcusPerLine,j=e.progressive,R=i,o=0,h=0;function p(){if(0<h)return o>>--h&1;if(255===(o=t[i++])){var e=t[i++];if(e)throw new Error("unexpected marker: "+(o<<8|e).toString(16))}return o>>>(h=7)}function u(e){for(var t,i=e;null!==(t=p());){if("number"==typeof(i=i[t]))return i;if("object"!==_typeof(i))throw new Error("invalid huffman sequence")}return null}function f(e){for(var t=0;0<e;){var i=p();if(null===i)return;t=t<<1|i,e--}return t}function g(e){var t=f(e);return 1<<e-1<=t?t:t+(-1<<e)+1}var y=0;var m,v=0;var w,b,P,x,_,I,S,D,k,T,C,z,B,M,Y,E,O,L=n.length,U=j?0===c?0===a?function(e,t){var i=0===(i=u(e.huffmanTableDC))?0:g(i)<<d;t[0]=e.pred+=i}:function(e,t){t[0]|=p()<<d}:0===a?function(e,t){if(0<y)y--;else for(var i=c,n=l;i<=n;){var r=u(e.huffmanTableAC),a=15&r,r=r>>4;if(0==a){if(r<15){y=f(r)+(1<<r)-1;break}i+=16}else t[K[i+=r]]=g(a)*(1<<d),i++}}:function(e,t){for(var i=c,n=l,r=0;i<=n;){var a=K[i],s=t[a]<0?-1:1;switch(v){case 0:var o=u(e.huffmanTableAC),h=15&o,r=o>>4;if(0==h)v=r<15?(y=f(r)+(1<<r),4):(r=16,1);else{if(1!=h)throw new Error("invalid ACn encoding");m=g(h),v=r?2:3}continue;case 1:case 2:t[a]?t[a]+=(p()<<d)*s:0===--r&&(v=2==v?3:0);break;case 3:t[a]?t[a]+=(p()<<d)*s:(t[a]=m<<d,v=0);break;case 4:t[a]&&(t[a]+=(p()<<d)*s)}i++}4===v&&0===--y&&(v=0)}:function(e,t){for(var i=0===(i=u(e.huffmanTableDC))?0:g(i),n=(t[0]=e.pred+=i,1);n<64;){var r=u(e.huffmanTableAC),a=15&r,r=r>>4;if(0==a){if(r<15)break;n+=16}else t[K[n+=r]]=g(a),n++}},F=0,A=1==L?n[0].blocksPerLine*n[0].blocksPerColumn:s*e.mcusPerColumn;for(r=r||A;F<A;){for(b=0;b<L;b++)n[b].pred=0;if(y=0,1==L)for(w=n[0],_=0;_<r;_++)Y=U,O=void 0,O=(E=F)/(M=w).blocksPerLine|0,E%=M.blocksPerLine,Y(M,M.blocks[O][E]),F++;else for(_=0;_<r;_++){for(b=0;b<L;b++)for(S=(w=n[b]).h,D=w.v,P=0;P<D;P++)for(x=0;x<S;x++)T=U,z=P,B=x,z=((C=F)/s|0)*(k=w).v+z,C=C%s*k.h+B,T(k,k.blocks[z][C]);if(++F===A)break}if(h=0,(I=t[i]<<8|t[i+1])<65280)throw new Error("marker was not found");if(!(65488<=I&&I<=65495))break;i+=2}return i-R}function Z(e,t){var i=[],n=t.blocksPerLine,r=t.blocksPerColumn,a=n<<3,s=new Int32Array(64),o=new Uint8Array(64);for(var h=0;h<r;h++){var c=h<<3;for(L=0;L<8;L++)i.push(new Uint8Array(a));for(var l=0;l<n;l++){C=k=D=S=I=w=v=m=y=g=f=u=p=d=_=x=P=b=void 0;for(var d,p,u,f,g,y,m,v,w,b=t.blocks[h][l],P=o,x=s,_=t.quantizationTable,I=x,S=0;S<64;S++)I[S]=b[S]*_[S];for(S=0;S<8;++S){var D=8*S;0==I[1+D]&&0==I[2+D]&&0==I[3+D]&&0==I[4+D]&&0==I[5+D]&&0==I[6+D]&&0==I[7+D]?(w=F*I[0+D]+512>>10,I[0+D]=w,I[1+D]=w,I[2+D]=w,I[3+D]=w,I[4+D]=w,I[5+D]=w,I[6+D]=w,I[7+D]=w):(d=F*I[0+D]+128>>8,p=F*I[4+D]+128>>8,u=I[2+D],f=I[6+D],g=2896*(I[1+D]-I[7+D])+128>>8,v=2896*(I[1+D]+I[7+D])+128>>8,y=I[3+D]<<4,w=d-p+1>>1,d=d+p+1>>1,p=w,w=3784*u+1567*f+128>>8,u=1567*u-3784*f+128>>8,f=w,w=g-(m=I[5+D]<<4)+1>>1,g=g+m+1>>1,m=w,w=v+y+1>>1,y=v-y+1>>1,v=w,w=d-f+1>>1,d=d+f+1>>1,f=w,w=p-u+1>>1,p=p+u+1>>1,u=w,w=2276*g+3406*v+2048>>12,g=3406*g-2276*v+2048>>12,v=w,w=799*y+4017*m+2048>>12,y=4017*y-799*m+2048>>12,m=w,I[0+D]=d+v,I[7+D]=d-v,I[1+D]=p+m,I[6+D]=p-m,I[2+D]=u+y,I[5+D]=u-y,I[3+D]=f+g,I[4+D]=f-g)}for(S=0;S<8;++S){var k=S;0==I[8+k]&&0==I[16+k]&&0==I[24+k]&&0==I[32+k]&&0==I[40+k]&&0==I[48+k]&&0==I[56+k]?(w=F*x[S+0]+8192>>14,I[0+k]=w,I[8+k]=w,I[16+k]=w,I[24+k]=w,I[32+k]=w,I[40+k]=w,I[48+k]=w,I[56+k]=w):(d=F*I[0+k]+2048>>12,p=F*I[32+k]+2048>>12,u=I[16+k],f=I[48+k],g=2896*(I[8+k]-I[56+k])+2048>>12,v=2896*(I[8+k]+I[56+k])+2048>>12,y=I[24+k],w=d-p+1>>1,d=d+p+1>>1,p=w,w=3784*u+1567*f+2048>>12,u=1567*u-3784*f+2048>>12,f=w,w=g-(m=I[40+k])+1>>1,g=g+m+1>>1,m=w,w=v+y+1>>1,y=v-y+1>>1,v=w,w=d-f+1>>1,d=d+f+1>>1,f=w,w=p-u+1>>1,p=p+u+1>>1,u=w,w=2276*g+3406*v+2048>>12,g=3406*g-2276*v+2048>>12,v=w,w=799*y+4017*m+2048>>12,y=4017*y-799*m+2048>>12,m=w,I[0+k]=d+v,I[56+k]=d-v,I[8+k]=p+m,I[48+k]=p-m,I[16+k]=u+y,I[40+k]=u-y,I[24+k]=f+g,I[32+k]=f-g)}for(S=0;S<64;++S){var C=128+(I[S]+8>>4);P[S]=C<0?0:255<C?255:C}for(var z=0,M=l<<3,E=0;E<8;E++)for(var O=i[c+E],L=0;L<8;L++)O[M+L]=o[z++]}}return i}function C(e){return e<0?0:255<e?255:e}return e.prototype={load:function(e){},parse:function(t){var i=0;function e(){var e=t[i]<<8|t[i+1];return i+=2,e}var n,r,a=null,s=null,o=[],h=[],c=[],l=[],d=e();if(65496!=d)throw new Error("SOI not found");for(d=e();65497!=d;){var p=void 0,u=void 0;switch(d){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:void 0,F=void 0,F=e(),F=t.subarray(i,i+F-2),i+=F.length;65504===d&&74===F[0]&&70===F[1]&&73===F[2]&&70===F[3]&&0===F[4]&&(a={version:{major:F[5],minor:F[6]},densityUnits:F[7],xDensity:F[8]<<8|F[9],yDensity:F[10]<<8|F[11],thumbWidth:F[12],thumbHeight:F[13],thumbData:F.subarray(14,14+3*F[12]*F[13])}),65518===d&&65===F[0]&&100===F[1]&&111===F[2]&&98===F[3]&&101===F[4]&&0===F[5]&&(s={version:F[6],flags0:F[7]<<8|F[8],flags1:F[9]<<8|F[10],transformCode:F[11]});break;case 65499:for(var j=e()+i-2;i<j;){var f=t[i++],g=new Int32Array(64);if(f>>4==0)for(u=0;u<64;u++)g[K[u]]=t[i++];else{if(f>>4!=1)throw new Error("DQT: invalid table spec");for(u=0;u<64;u++)g[K[u]]=e()}o[15&f]=g}break;case 65472:case 65473:case 65474:e(),(n={}).extended=65473===d,n.progressive=65474===d,n.precision=t[i++],n.scanLines=e(),n.samplesPerLine=e(),n.components={},n.componentsOrder=[];var R=t[i++];for(p=0;p<R;p++){var y=t[i],T=t[i+1]>>4,B=15&t[i+1],Y=t[i+2];n.componentsOrder.push(y),n.components[y]={h:T,v:B,quantizationIdx:Y},i+=3}E=M=z=C=k=D=S=I=x=P=m=_=b=w=v=void 0;var m,v=n,w=0,b=0;for(m in v.components)v.components.hasOwnProperty(m)&&(w<(_=v.components[m]).h&&(w=_.h),b<_.v&&(b=_.v));var P=Math.ceil(v.samplesPerLine/8/w),x=Math.ceil(v.scanLines/8/b);for(m in v.components)if(v.components.hasOwnProperty(m)){for(var _=v.components[m],I=Math.ceil(Math.ceil(v.samplesPerLine/8)*_.h/w),S=Math.ceil(Math.ceil(v.scanLines/8)*_.v/b),D=P*_.h,k=x*_.v,C=[],z=0;z<k;z++){for(var M=[],E=0;E<D;E++)M.push(new Int32Array(64));C.push(M)}_.blocksPerLine=I,_.blocksPerColumn=S,_.blocks=C}v.maxH=w,v.maxV=b,v.mcusPerLine=P,v.mcusPerColumn=x,h.push(n);break;case 65476:var U=e();for(p=2;p<U;){var G=t[i++],N=new Uint8Array(16),O=0;for(u=0;u<16;u++,i++)O+=N[u]=t[i];var X=new Uint8Array(O);for(u=0;u<O;u++,i++)X[u]=t[i];p+=17+O,(G>>4==0?l:c)[15&G]=function(e,t){for(var i,n=0,r=[],a=16;0<a&&!e[a-1];)a--;r.push({children:new Array,index:0});for(var s,o=r[0],h=0;h<a;h++){for(i=0;i<e[h];i++){for((o=r.pop()).children[o.index]=t[n];0<o.index;)o=r.pop();for(o.index++,r.push(o);r.length<=h;)r.push(s={children:[],index:0}),o.children[o.index]=s.children,o=s;n++}h+1<a&&(r.push(s={children:[],index:0}),o.children[o.index]=s.children,o=s)}return r[0].children}(N,X)}break;case 65501:e(),r=e();break;case 65498:e();var W=t[i++],V=[],L=void 0;for(p=0;p<W;p++){L=n.components[t[i++]];var H=t[i++];L.huffmanTableDC=l[H>>4],L.huffmanTableAC=c[15&H],V.push(L)}var F=t[i++],J=t[i++],q=t[i++],J=Q(t,i,n,V,r,F,J,q>>4,15&q);i+=J;break;case 65535:255!==t[i]&&i--;break;default:if(255==t[i-3]&&192<=t[i-2]&&t[i-2]<=254){i-=3;break}throw new Error("unknown JPEG marker "+d.toString(16))}d=e()}if(1!=h.length)throw new Error("only single frame JPEGs supported");for(p=0;p<h.length;p++){var A=h[p].components;for(u in A)A[u].quantizationTable=o[A[u].quantizationIdx],delete A[u].quantizationIdx}this.width=n.samplesPerLine,this.height=n.scanLines,this.jfif=a,this.adobe=s,this.components=[];for(p=0;p<n.componentsOrder.length;p++){L=n.components[n.componentsOrder[p]];this.components.push({lines:Z(0,L),scaleX:L.h/n.maxH,scaleY:L.v/n.maxV})}},getData:function(e,t){var i,n,r,a,s,o,h,c,l,d,p,u,f,g,y,m,v,w,b,P,x,_=this.width/e,I=this.height/t,S=0,D=e*t*this.components.length,k=new Uint8Array(D);switch(this.components.length){case 1:for(i=this.components[0],d=0;d<t;d++)for(s=i.lines[0|d*i.scaleY*I],l=0;l<e;l++)p=s[0|l*i.scaleX*_],k[S++]=p;break;case 2:for(i=this.components[0],n=this.components[1],d=0;d<t;d++)for(s=i.lines[0|d*i.scaleY*I],o=n.lines[0|d*n.scaleY*I],l=0;l<e;l++)p=s[0|l*i.scaleX*_],k[S++]=p,p=o[0|l*n.scaleX*_],k[S++]=p;break;case 3:for(x=!0,this.adobe&&this.adobe.transformCode?x=!0:void 0!==this.colorTransform&&(x=!!this.colorTransform),i=this.components[0],n=this.components[1],r=this.components[2],d=0;d<t;d++)for(s=i.lines[0|d*i.scaleY*I],o=n.lines[0|d*n.scaleY*I],h=r.lines[0|d*r.scaleY*I],l=0;l<e;l++)P=x?(p=s[0|l*i.scaleX*_],u=o[0|l*n.scaleX*_],w=C(p+1.402*((f=h[0|l*r.scaleX*_])-128)),b=C(p-.3441363*(u-128)-.71413636*(f-128)),C(p+1.772*(u-128))):(w=s[0|l*i.scaleX*_],b=o[0|l*n.scaleX*_],h[0|l*r.scaleX*_]),k[S++]=w,k[S++]=b,k[S++]=P;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(x=!1,this.adobe&&this.adobe.transformCode?x=!0:void 0!==this.colorTransform&&(x=!!this.colorTransform),i=this.components[0],n=this.components[1],r=this.components[2],a=this.components[3],d=0;d<t;d++)for(s=i.lines[0|d*i.scaleY*I],o=n.lines[0|d*n.scaleY*I],h=r.lines[0|d*r.scaleY*I],c=a.lines[0|d*a.scaleY*I],l=0;l<e;l++)x?(p=s[0|l*i.scaleX*_],u=o[0|l*n.scaleX*_],f=h[0|l*r.scaleX*_],g=c[0|l*a.scaleX*_],y=255-C(p+1.402*(f-128)),m=255-C(p-.3441363*(u-128)-.71413636*(f-128)),v=255-C(p+1.772*(u-128))):(y=s[0|l*i.scaleX*_],m=o[0|l*n.scaleX*_],v=h[0|l*r.scaleX*_],g=c[0|l*a.scaleX*_]),k[S++]=255-y,k[S++]=255-m,k[S++]=255-v,k[S++]=255-g;break;default:throw new Error("Unsupported color mode")}return k},copyToImageData:function(e){var t,i,n,r,a,s,o,h,c=e.width,l=e.height,d=e.data,p=this.getData(c,l),u=0,f=0;switch(this.components.length){case 1:for(i=0;i<l;i++)for(t=0;t<c;t++)n=p[u++],d[f++]=n,d[f++]=n,d[f++]=n,d[f++]=255;break;case 3:for(i=0;i<l;i++)for(t=0;t<c;t++)s=p[u++],o=p[u++],h=p[u++],d[f++]=s,d[f++]=o,d[f++]=h,d[f++]=255;break;case 4:for(i=0;i<l;i++)for(t=0;t<c;t++)r=p[u++],a=p[u++],n=p[u++],s=255-C(r*(1-(r=p[u++])/255)+r),o=255-C(a*(1-r/255)+r),h=255-C(n*(1-r/255)+r),d[f++]=s,d[f++]=o,d[f++]=h,d[f++]=255;break;default:throw new Error("Unsupported color mode")}}},e}();i.decode=function(e,t){void 0===t&&(t=!0);var e=new Uint8Array(e),i=new r,e=(i.parse(e),i.colorTransform=t,new n.Image);return e.height=i.height,e.width=i.width,e.data=new Uint8Array(i.width*i.height*4),i.copyToImageData(e),e}},{"./image":33}],32:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.encode=void 0;var n=e("./image");function r(e){var D,k,C,z,p,u=Math.floor,M=new Array(64),E=new Array(64),O=new Array(64),L=new Array(64),g=new Array(65535),y=new Array(65535),F=new Array(64),m=new Array(64),A=[],j=0,R=7,T=new Array(64),B=new Array(64),Y=new Array(64),c=new Array(256),U=new Array(2048),v=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],G=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],H=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],q=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],K=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Q=[0,1,2,3,4,5,6,7,8,9,10,11],Z=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],$=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function t(e,t){for(var i=0,n=0,r=new Array,a=1;a<=16;a++){for(var s=1;s<=e[a];s++)r[t[n]]=[],r[t[n]][0]=i,r[t[n]][1]=a,n++,i++;i*=2}return r}function N(e){for(var t=e[0],i=e[1]-1;0<=i;)t&1<<i&&(j|=1<<R),i--,--R<0&&(255===j?(X(255),X(0)):X(j),R=7,j=0)}function X(e){A.push(e)}function W(e){X(e>>8&255),X(255&e)}function V(e,t,i,n,r){for(var a,s=r[0],o=r[240],h=function(e,t){for(var i,n=0,r=0;r<8;++r){var a,s=e[n],o=e[n+1],h=e[n+2],c=e[n+3],l=e[n+4],d=e[n+5],p=e[n+6],u=s+(a=e[n+7]),f=s-a,g=o+p,y=o-p,m=h+d,v=h-d,w=c+l,b=c-l,P=u+w,u=u-w,w=g+m,g=g-m,m=(e[n]=P+w,e[n+4]=P-w,.707106781*(g+u)),w=(e[n+2]=u+m,e[n+6]=u-m,.382683433*((P=b+v)-(g=y+f))),u=.5411961*P+w,m=1.306562965*g+w,b=.707106781*(v+y),P=f+b,g=f-b;e[n+5]=g+u,e[n+3]=g-u,e[n+1]=P+m,e[n+7]=P-m,n+=8}for(r=n=0;r<8;++r){s=e[n],o=e[n+8],h=e[n+16],c=e[n+24],l=e[n+32],d=e[n+40],p=e[n+48];var x=s+(a=e[n+56]),_=s-a,I=o+p,S=o-p,D=h+d,k=h-d,C=c+l,z=c-l,M=x+C,x=x-C,C=I+D,I=I-D,D=(e[n]=M+C,e[n+32]=M-C,.707106781*(I+x)),C=(e[n+16]=x+D,e[n+48]=x-D,.382683433*((M=z+k)-(I=S+_))),x=.5411961*M+C,D=1.306562965*I+C,z=.707106781*(k+S),M=_+z,I=_-z;e[n+40]=I+x,e[n+24]=I-x,e[n+8]=M+D,e[n+56]=M-D,n++}for(r=0;r<64;++r)i=e[r]*t[r],F[r]=0<i?.5+i|0:i-.5|0;return F}(e,t),c=0;c<64;++c)m[v[c]]=h[c];for(var e=m[0]-i,l=(i=m[0],0==e?N(n[0]):(N(n[y[a=32767+e]]),N(g[a])),63);0<l&&0===m[l];l--);if(0===l)N(s);else{for(var d=1;d<=l;){for(var p=d;0===m[d]&&d<=l;++d);p=d-p;if(16<=p){for(var u=p>>4,f=1;f<=u;++f)N(o);p&=15}a=32767+m[d],N(r[(p<<4)+y[a]]),N(g[a]),d++}63!==l&&N(s)}return i}function ee(e){if(p!==(e=100<(e=e<=0?1:e)?100:e)){for(var t=e<50?Math.floor(5e3/e):Math.floor(200-2*e),i=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var r=u((i[n]*t+50)/100);r<1?r=1:255<r&&(r=255),M[v[n]]=r}for(var a=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],s=0;s<64;s++){var o=u((a[s]*t+50)/100);o<1?o=1:255<o&&(o=255),E[v[s]]=o}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],c=0,l=0;l<8;l++)for(var d=0;d<8;d++)O[c]=1/(M[v[c]]*h[l]*h[d]*8),L[c]=1/(E[v[c]]*h[l]*h[d]*8),c++;p=e}}this.encode=function(e,t){t&&ee(t),A=new Array,j=0,R=7,W(65496),W(65504),W(16),X(74),X(70),X(73),X(70),X(0),X(1),X(1),X(0),W(1),W(1),X(0),X(0),W(65499),W(132),X(0);for(var i=0;i<64;i++)X(M[i]);X(1);for(var n=0;n<64;n++)X(E[n]);t=e.width,x=e.height,W(65472),W(17),X(8),W(x),W(t),X(3),X(1),X(17),X(0),X(2),X(17),X(1),X(3),X(17),X(1),W(65476),W(418),X(0);for(var r=0;r<16;r++)X(G[r+1]);for(var a=0;a<=11;a++)X(H[a]);X(16);for(var s=0;s<16;s++)X(J[s+1]);for(var o=0;o<=161;o++)X(q[o]);X(1);for(var h=0;h<16;h++)X(K[h+1]);for(var c=0;c<=11;c++)X(Q[c]);X(17);for(var l=0;l<16;l++)X(Z[l+1]);for(var d=0;d<=161;d++)X($[d]);W(65498),W(12),X(3),X(1),X(0),X(2),X(17),X(3),X(17),X(0),X(63),X(0);for(var p,u,f,g,y,m,v=0,w=0,b=0,P=(j=0,R=7,this.encode.displayName="_encode_",e.data),x=e.width,_=e.height,I=4*x,S=0;S<_;){for(p=0;p<I;){for(u=I*S+p,m=0;m<64;m++)f=u+(y=m>>3)*I+(g=4*(7&m)),_<=S+y&&(f-=I*(S+1+y-_)),I<=p+g&&(f-=p+g-I+4),y=P[f++],g=P[f++],f=P[f],T[m]=(U[y]+U[g+256>>0]+U[f+512>>0]>>16)-128,B[m]=(U[y+768>>0]+U[g+1024>>0]+U[f+1280>>0]>>16)-128,Y[m]=(U[y+1280>>0]+U[g+1536>>0]+U[f+1792>>0]>>16)-128;v=V(T,O,v,D,C),w=V(B,L,w,k,z),b=V(Y,L,b,k,z),p+=32}S+=8}return 0<=R&&((t=[])[1]=R+1,t[0]=(1<<R+1)-1,N(t)),W(65497),new Uint8Array(A)},e=e||50;for(var l=String.fromCharCode,i=0;i<256;i++)c[i]=l(i);D=t(G,H),k=t(K,Q),C=t(J,q),z=t(Z,$);for(var n=1,r=2,a=1;a<=15;a++){for(var s=n;s<r;s++)y[32767+s]=a,g[32767+s]=[],g[32767+s][1]=a,g[32767+s][0]=s;for(var o=-(r-1);o<=-n;o++)y[32767+o]=a,g[32767+o]=[],g[32767+o][1]=a,g[32767+o][0]=r-1+o;n<<=1,r<<=1}for(var h=0;h<256;h++)U[h]=19595*h,U[h+256>>0]=38470*h,U[h+512>>0]=7471*h+32768,U[h+768>>0]=-11059*h,U[h+1024>>0]=-21709*h,U[h+1280>>0]=32768*h+8421375,U[h+1536>>0]=-27439*h,U[h+1792>>0]=-5329*h;ee(e)}i.encode=function(e,t){var t=new r(t=void 0===t?50:t).encode(e,t),i=new n.Image;return i.data=t,i.width=e.width,i.height=e.height,i}},{"./image":33}],33:[function(e,t,i){function n(e){null!=e&&(this.width=e.width,this.height=e.height,this.data=new Uint8Array(e.data))}Object.defineProperty(i,"__esModule",{value:!0}),i.Image=void 0,n.prototype.getPixel=function(e,t){e+=t*this.width;return{r:this.data[4*e],g:this.data[4*e+1],b:this.data[4*e+2],a:this.data[4*e+3]}},n.prototype.setPixel=function(e,t,i){e+=t*this.width;this.data[4*e]=i.r,this.data[4*e+1]=i.g,this.data[4*e+2]=i.b,this.data[4*e+3]=i.a},i.Image=n},{}],34:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.pieceCut=void 0,i.pieceCut=function(o){function e(e){return l<=e}function t(e){return e%l!=0}function i(e){return e%l!=l-1}function n(e){return e<l*(d-1)}for(var h=o.scene,r=o.previewSrc,a=o.difficulty,s=r.width-a.origin.x,c=r.height-a.origin.y,l=(s={width:s-s%a.size.width,height:c-c%a.size.height}).width/a.size.width,d=s.height/a.size.height,p=a.size.width/4,u=a.size.height/4,f=d*l,y=new Array(f),m=new Array(f),v=new Array(f),w=0;w<f;w++)m[w]=new Array;for(var c=new g.Sprite({scene:h,src:r.src,srcX:a.origin.x,srcY:a.origin.y,width:s.width,height:s.height}),b=new g.E({scene:h}),P=new g.Sprite({scene:h,src:r.src}),x={x:0,y:0},_=0;_<d;_++){for(var I=x.x=0;I<l;I++){var S=_*l+I,D={x:I*a.size.width,y:_*a.size.height},k={width:a.size.width,height:a.size.height},C=(e(S)&&(D.y-=u,k.height+=u,m[S].push(S-l)),t(S)&&(D.x-=p,k.width+=p,m[S].push(S-1)),i(S)&&(k.width+=p,m[S].push(S+1)),n(S)&&(k.height+=u,m[S].push(S+l)),z=void 0,x),z=k;z=new g.Pane({scene:h,width:Math.ceil(z.width),height:Math.ceil(z.height),x:C.x,y:C.y}),P.x=-D.x-a.origin.x,P.y=-D.y-a.origin.y,P.modified(),z.append(P),b.append(g.SpriteFactory.createSpriteFromE(h,z)),x.x+=k.width}x.y+=k.height}for(var R=o.wakus.length/2,M=new Array(2*l*d),w=0;w<M.length;w++)M[w]=Math.floor(g.game.random.generate()*R*2);function E(e,t,i){var n,r=0==i||180==i?(n=O,T):(n=T,O),a=o.wakus[t].width*n,s=o.wakus[t].height*r,t=new g.Sprite({scene:h,src:o.wakus[t],scaleX:n,scaleY:r,angle:i,compositeOperation:"destination-out"});0==i?(t.x=e.x,t.y=e.y):180==i?(t.x=e.x+a,t.y=e.y+s):90==i?(t.x=e.x+s,t.y=e.y):-90==i&&(t.x=e.x,t.y=e.y+a),t.x=Math.ceil(t.x),t.y=Math.ceil(t.y),t.modified(),b.append(t)}var O=(a.size.width+2*p)/o.wakus[0].width,T=(a.size.height+2*u)/o.wakus[0].height;for(x.y=-u,_=0;_<d;_++){x.x=-p;for(I=0;I<l;I++){var L,F={x:I*(a.size.width+2*p),y:_*(a.size.height+2*u)},A={width:a.size.width,height:a.size.height},S=_*l+I,j=2*l*Math.floor(S/l)+S%l;e(S)&&(E(x,L=M[j-l],0),L%2==0&&(F.y-=u,A.height+=u)),t(S)&&(E(x,L=M[j-1],-90),L%2==0&&(F.x-=p,A.width+=p)),i(S)&&(E(x,L=(M[j]+1)%2,90),L%2==0&&(A.width+=p)),n(S)&&(E(x,L=(M[j+l]+1)%2,180),L%2==0&&(A.height+=u)),y[S]={x:F.x-2*p*I,y:F.y-2*u*_},v[S]={x:F.x,y:F.y,width:A.width+1,height:A.height+1},x.x+=a.size.width+2*p}x.y+=a.size.height+2*u}return(s=new g.Pane({scene:h,width:(l-1)*(a.size.width+2*p)+a.size.width+2,height:(d-1)*(a.size.height+2*u)+a.size.height+2})).append(b),r=g.SpriteFactory.createSpriteFromE(h,s),{pazzleID:o.pazzleID,level:o.level,title:"",preview:c,piecesSrc:r,answerPos:y,connectIds:m,cutInfo:v}}},{}],35:[function(e,t,i){var n=e("./PieceScene"),r=e("./params"),a=e("./PieceServer");function s(){var e=new n.PieceScene({game:g.game,assetIds:["joinBtn","playBtn","left","right","setting","zoomIn","zoomOut","previewBtn","titleBtn","infoBtn","visibleBtn","player_ban","result","resultBtn","crown_0","crown_1","crown_2","crown_3","select_E","select_N","select_H","sanka_nin","title_back","fit","fit2","voice_top","voice_left","voice_right","voice_bottom","voice_outer","voice_25","voice_50","voice_75","voice_8888"],assetPaths:["/assets/**/*"]});return r.GameParams.setAsset(e),r.GameParams.isServer&&(g.game.vars.server=new a.PieceServer({scene:e})),e}t.exports=function(e){var t;r.GameParams.init(),"atsumaru"==r.GameParams.operation?(r.GameParams.liverId=g.game.selfId,g.game.pushScene(s())):(t=new g.Scene({game:g.game}),g.game.onJoin.addOnce(function(e){r.GameParams.liverId=e.player.id,g.game.replaceScene(s())}),g.game.pushScene(t))}},{"./PieceScene":15,"./PieceServer":16,"./params":45}],36:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.AssetManager=void 0;var r=e("../params");function n(e){var t=(this.scene=e).asset.getText(r.Asset.ASSET_SETTING_TXT).data.split("\r\n");this.wakus=[];for(var i=0;i<+t[0];i++)this.wakus.push([this.scene.asset.getImage(r.Asset.WKAU_DIR+"/"+i+"0.png"),this.scene.asset.getImage(r.Asset.WKAU_DIR+"/"+i+"1.png")]);this.assets=[];for(i=0;i<+t[1];i++)this.assets.push(this.createPazzleAsset(i,t))}function a(e){e=e.split(",");return{count:+e[0],size:{width:+e[1],height:+e[2]},origin:{x:+e[3],y:+e[4]}}}n.prototype.createPazzleAsset=function(e,t){var i=4*e,n=t[2+i].split(" ");return{pazzleId:e,title:n[0],preview:new g.Sprite({scene:this.scene,src:this.scene.asset.getImage(r.Asset.ASSET_DIR+"/"+n[1]+".jpg")}),difficulty:[a(t[3+i]),a(t[4+i]),a(t[5+i])]}},n.prototype.createWaku=function(e){return[new g.Sprite({scene:this.scene,src:this.scene.asset.getImage(r.Asset.WKAU_DIR+"/"+e+"0.png")}),new g.Sprite({scene:this.scene,src:this.scene.asset.getImage(r.Asset.WKAU_DIR+"/"+e+"1.png")})]},i.AssetManager=n},{"../params":45}],37:[function(e,t,i){var n,r,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=(Object.defineProperty(i,"__esModule",{value:!0}),i.BitmapImage=void 0,r=g.E,a(s,r),s.prototype.renderSelf=function(e,t){var i,n=null==(i=this.imageData)?void 0:i.data;if(null!=n){for(var r=0;r<n.length;r++)n[r]=this.colorBuffer.data[r];return this.backSurface.renderer()._putImageData(this.imageData,0,0),e.save(),e.drawImage(this.backSurface,0,0,this.backSurface.width,this.backSurface.height,0,0),e.restore(),!0}},s);function s(e){var t=r.call(this,e)||this;return t.backSurface=g.game.resourceFactory.createSurface(t.width,t.height),t.imageData=t.backSurface.renderer()._getImageData(0,0,t.width,t.height),t.colorBuffer=e.colorBuffer,t}i.BitmapImage=a},{}],38:[function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=(Object.defineProperty(i,"__esModule",{value:!0}),i.ErrorNoticeCard=i.NormalNoticeCard=i.NoticeCardTemplate=void 0,e("@akashic-extension/akashic-label")),s=e("../lib/funcs"),o=e("./notice"),e=(Object.defineProperty(h.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),h.prototype.open=function(){this._state=o.NoticeCardState.Opening,this._scene.onUpdate.add(this.displaying,this)},h.prototype.close=function(){this._state=o.NoticeCardState.Closing,this._scene.onUpdate.add(this.closing,this)},h.prototype.displaying=function(){var e;this.makeVisible(),this.complateVisible()&&(this._state=o.NoticeCardState.Displaying,this._scene.onUpdate.remove(this.displaying,this),null!=(e=this._audio)&&e.play(),this.onOpened())},h.prototype.closing=function(){this.makeHide(),this.complateHide()&&(this._state=o.NoticeCardState.EndOfDisplay,this._scene.onUpdate.remove(this.closing,this),this.onClosed())},h);function h(e,t,i){this._state=o.NoticeCardState.Waiting,this._scene=e,this._audio=i,this.setDisplay(t)}i.NoticeCardTemplate=e;r(d,c=e),d.prototype.setDisplay=function(e){this.font=s.newFont("sans-serif",40),this.display=new g.FilledRect({scene:this._scene,cssColor:"rgba(255,255,255,0.5)",x:-310,y:10,width:300,height:70}),new a.Label({scene:this._scene,parent:this.display,x:10,y:10,width:270,font:this.font,widthAutoAdjust:!0,lineBreak:!1,text:e})},d.prototype.makeVisible=function(){this.display.x+=this.cardMoveSpeed,this.display.modified()},d.prototype.makeHide=function(){this.display.x-=this.cardMoveSpeed,this.display.modified()},d.prototype.complateVisible=function(){return this.display.x>this.displayMargin},d.prototype.complateHide=function(){return this.display.x<-this.display.width-this.displayMargin};var c,l=d;function d(){var e=null!==c&&c.apply(this,arguments)||this;return e.font=s.newFont("sans-serif",40),e.cardMoveSpeed=15,e.displayMargin=30,e}i.NormalNoticeCard=l;r(u,p=e),u.prototype.setDisplay=function(e){this.font=s.newFont("sans-serif",40,"red"),this.display=new g.FilledRect({scene:this._scene,parent:this.display,cssColor:"rgba(255,255,0,0.8)",x:100,y:-410,width:1100,height:180}),new a.Label({scene:this._scene,parent:this.display,x:10,y:10,width:1100,font:this.font,widthAutoAdjust:!0,lineBreak:!1,text:"サーバーインスタンスでエラーが発生しました"}),new a.Label({scene:this._scene,parent:this.display,x:10,y:60,width:1100,font:s.newFont("sans-serif",25),widthAutoAdjust:!0,lineBreak:!1,text:e+"\nこのメッセージの見えるスクショを@mujurin_2525に報告してくれると助かります"})},u.prototype.makeVisible=function(){this.display.y+=this.cardMoveSpeed,this.display.modified()},u.prototype.makeHide=function(){this.display.y-=this.cardMoveSpeed,this.display.modified()},u.prototype.complateVisible=function(){return this.display.y>this.displayMargin},u.prototype.complateHide=function(){return this.display.y<-this.display.height-this.displayMargin};var p,l=u;function u(){var e=null!==p&&p.apply(this,arguments)||this;return e.font=s.newFont("sans-serif",40,"red"),e.cardMoveSpeed=15,e.displayMargin=10,e}i.ErrorNoticeCard=l},{"../lib/funcs":30,"./notice":44,"@akashic-extension/akashic-label":8}],39:[function(e,t,i){var n,r,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=(Object.defineProperty(i,"__esModule",{value:!0}),i.Piece=void 0,r=g.Sprite,a(o,r),Object.defineProperty(o.prototype,"position",{get:function(){var e,t;return null==this.parent.isFit?{x:this.x,y:this.y}:(e=this.parent.justPxBw(this),{x:(t=this.parent.position).x+e.x,y:t.y+e.y})},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sceneEx",{get:function(){return this.scene},enumerable:!1,configurable:!0}),o.prototype.moveBy=function(e,t){r.prototype.moveBy.call(this,e,t),this.limitCheck()},o.prototype.moveTo=function(e,t){"number"==typeof e?r.prototype.moveTo.call(this,e,t):r.prototype.moveTo.call(this,e),this.parentPiece||this.limitCheck()},o.prototype.limitCheck=function(){this.x<0?this.x=0:this.x>this.jigsaw.pieceLimit.x&&(this.x=this.jigsaw.pieceLimit.x),this.y<0?this.y=0:this.y>this.jigsaw.pieceLimit.y&&(this.y=this.jigsaw.pieceLimit.y)},o.prototype.justPxBw=function(e){return{x:e.answer.x-this.answer.x,y:e.answer.y-this.answer.y}},o);function o(e){var t=r.call(this,s({src:e.createParam.piecesSrc.src,srcX:e.createParam.cutInfo[e.pieceID].x,srcY:e.createParam.cutInfo[e.pieceID].y,width:e.createParam.cutInfo[e.pieceID].width,height:+e.createParam.cutInfo[e.pieceID].height,touchable:!0},e))||this;return t.parentPiece=void 0,t.childPiece=[],t.isFit=!1,t.holder=void 0,t.jigsaw=e.jigsaw,t.pieceID=e.pieceID,t.connects=e.createParam.connectIds[t.pieceID],t.answer=e.createParam.answerPos[t.pieceID],t}i.Piece=a},{}],40:[function(e,t,i){function n(e,t){this.score=0,this.ban=!1,this.playerID=e.playerID,this.name=e.name,this.rank=null!=t?t:1}Object.defineProperty(i,"__esModule",{value:!0}),i.Player=void 0,n.prototype.FitPiece=function(){this.score++},n.prototype.SamePlayerID=function(e){return!!e&&this.playerID==e.playerID},i.Player=n},{}],41:[function(e,t,i){var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},n=(Object.defineProperty(i,"__esModule",{value:!0}),i.Slider=void 0,r.prototype.gripMoveBy=function(e){this.grip.x+=e,this.grip.x<0?(this.grip.x=0,this.per=0):this.grip.x>this.display.width?(this.grip.x=this.display.width,this.per=1):this.per=this.grip.x/this.display.width,this.grip.modified(),this.value=(this.max-this.min)*Math.pow(this.per,this.quadratic)+this.min},r);function r(e){var t=this,i=(this.onBarDown=new g.Trigger,this.onSliderMove=new g.Trigger,this.onSliderUp=new g.Trigger,this.onValueChange=new g.Trigger,new g.E(a(a({},e),{touchable:!1}))),n=(this.display=i).scene,r=(this.per=null!=(r=e.per)?r:0,this.min=null!=(r=e.min)?r:0,this.max=e.max,this.quadratic=null!=(r=e.quadratic)?r:1,new g.FilledRect({scene:n,parent:i,anchorY:.5,cssColor:"rgba(255,255,255,0.8)",y:e.height/2,width:i.width,height:i.height/2,touchable:!0}));i.append(r),this.grip=new g.FilledRect({scene:n,parent:i,anchorX:.5,cssColor:"rgba(0,0,0,0.8)",x:i.width*this.per,width:null!=(n=e.gripWidth)?n:50,height:i.height,touchable:!0}),i.append(this.grip),r.onPointDown.add(function(e){e.point.x<t.grip.x?(t.per=t.per-.1,t.per<0&&(t.per=0)):(t.per=t.per+.1,1<t.per&&(t.per=1)),t.grip.x=i.width*t.per,t.grip.modified(),t.value=(t.max-t.min)*t.per+t.min,t.onBarDown.fire(t.value),t.onValueChange.fire(t.value)}),this.grip.onPointMove.add(function(e){t.gripMoveBy(e.prevDelta.x),t.onSliderMove.fire(t.value),t.onValueChange.fire(t.value)}),this.grip.onPointUp.add(function(e){t.onSliderUp.fire(t.value)})}i.Slider=n},{}],42:[function(e,t,i){function n(e){this.stopTime=void 0,this.scene=e}Object.defineProperty(i,"__esModule",{value:!0}),i.StopWatch=void 0,Object.defineProperty(n.prototype,"ElapsedTime",{get:function(){var e;return Math.floor(((null!=(e=this.stopTime)?e:g.game.getCurrentTime())-this.startTime)/1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ElapsedTime_HMS",{get:function(){var e=this.ElapsedTime;return{h:Math.floor(e/3600),m:Math.floor(e/60)%60,s:e%60}},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.startTime=g.game.getCurrentTime(),this.stopTime=void 0},n.prototype.stop=function(){this.stopTime=g.game.getCurrentTime()},i.StopWatch=n},{}],43:[function(e,t,i){var n,r,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=(Object.defineProperty(i,"__esModule",{value:!0}),i.StrokeRect=void 0,r=g.FilledRect,a(s,r),s.prototype.renderSelf=function(e){var t=this.borderWidth/2,i=-t,n=-t,r=this.width+this.borderWidth,a=this.height+this.borderWidth;return e.fillRect(i,n,r,this.borderWidth,this.cssColor),e.fillRect(this.width-t,n,this.borderWidth,a,this.cssColor),e.fillRect(i,this.height-t,r,this.borderWidth,this.cssColor),e.fillRect(i,n,this.borderWidth,a,this.cssColor),!0},s);function s(e){var t=r.call(this,e)||this;return t.borderWidth=e.borderWidth,t}i.StrokeRect=a},{}],44:[function(e,t,i){function n(e,t){this._noticeCards=[],t<0&&(t=0),this._scene=e,this.displayTime=t,this.display=new g.E({scene:e,width:g.game.width,height:g.game.height})}Object.defineProperty(i,"__esModule",{value:!0}),i.NoticeViewer=i.NoticeCardState=void 0,i.NoticeCardState={Waiting:"waiting",Opening:"opening",Displaying:"displaying",Closing:"closing",EndOfDisplay:"endOfDisplay"},Object.defineProperty(n.prototype,"isStoping",{get:function(){return this._isStoping},enumerable:!1,configurable:!0}),n.prototype.addNoticeCard=function(e){var t=this;this._noticeCards.push(e),e.onOpened=function(){return t.openedCard(e)},e.onClosed=function(){return t.closedCard(e)},this._noticeCards.every(function(e){return e.state===i.NoticeCardState.Waiting})&&this.openNoticeCard()},n.prototype.openNoticeCard=function(){var e=this._noticeCards.find(function(e){return e.state===i.NoticeCardState.Waiting});null!=e&&this.openCard(e)},n.prototype.stop=function(){var t=this;this._isStoping||(this._isStoping=!0,this._noticeCards.forEach(function(e){e.state===i.NoticeCardState.Displaying&&t.closeCard(e)}))},n.prototype.resume=function(){this._isStoping&&(this._isStoping=!1,this.openNoticeCard())},n.prototype.openedCard=function(e){var t=this;this._scene.setTimeout(function(){t.closeCard(e)},this.displayTime,this)},n.prototype.closedCard=function(t){var e=this._noticeCards.findIndex(function(e){return e===t});-1!==e&&(this.display.remove(t.display),this._noticeCards.splice(e,1),this._isStoping||0===this._noticeCards.length||this.openNoticeCard())},n.prototype.openCard=function(e){e.state===i.NoticeCardState.Waiting&&(this.display.append(e.display),e.open())},n.prototype.closeCard=function(e){e.state===i.NoticeCardState.Displaying&&e.close()},i.NoticeViewer=n},{}],45:[function(e,t,i){function n(){}Object.defineProperty(i,"__esModule",{value:!0}),i.GameParams=i.Asset=void 0,i.Asset={ASSET_DIR:"/assets",ASSET_SETTING_TXT:"/assets/!.txt",WKAU_DIR:"/assets/!"},Object.defineProperty(n,"isOwner",{get:function(){return this.liverId==g.game.selfId},enumerable:!1,configurable:!0}),Object.defineProperty(n,"isServer",{get:function(){return n._isServer},enumerable:!1,configurable:!0}),Object.defineProperty(n,"operation",{get:function(){return this._operation},enumerable:!1,configurable:!0}),Object.defineProperty(n,"myFitSound",{get:function(){return this._myFitSound},enumerable:!1,configurable:!0}),Object.defineProperty(n,"otherFitSound",{get:function(){return this._otherFitSound},enumerable:!1,configurable:!0}),Object.defineProperty(n,"userBanMode",{get:function(){return this._userBanMode},enumerable:!1,configurable:!0}),n.banModeChange=function(){this._userBanMode=!this._userBanMode},n.init=function(){"undefined"==typeof window?this._isServer=!0:void 0!==window.RPGAtsumaru?(this._isServer=!0,this._operation="atsumaru"):this._operation="nicolive"},n.setAsset=function(e){var t=this;e.onLoad.addOnce(function(){t._myFitSound=e.asset.getAudioById("fit"),t._otherFitSound=e.asset.getAudioById("fit2")})},n._isServer=!1,n._userBanMode=!1,i.GameParams=n},{}]},{},[35])(35)});